/*******************************************************************************
* IBM Confidential
* OCO Source Materials
* IBM Sterling Order Management Store (5725-D10), IBM Order Management (5737-D18), IBM Store Engagement (5737D58)
* (C) Copyright IBM Corp. 2014, 2017 All Rights Reserved.
* The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.
******************************************************************************/
var iss=angular.module("store",["ngAria","ngTouch","ui.select","isc.shared"]);
(function(e,A){"use strict";e.module("store").controller("store.app",["$scope","$rootScope","iscScreen","iscState","iscMashup","iscResourcePermission","iscAppContext","iscModal","iscI18n","iscRule","iscOrder","iscObjectUtility","iscAppInfo","$timeout","$document","iscHttpRequest","iscPortletShipment","iscPersona",function(i,o,e,a,s,t,l,n,r,c,u,h,d,g,p,m,f,S){e.initializeScreen(i,{model:{inboxModel:{}},mashupRefs:[{mashupRefId:"getRuleDetails_AlertPollingInterval",mashupId:"getRuleDetails_AlertPollingInterval"},{mashupRefId:"getAlertStatistics",mashupId:"getAlertStatistics",modelName:"inboxModel"}],ui:{showGlobalSearch:"N",hideGlobalSearchAction:"N",isOpenMobileMenu:false,isOpenDesktopMenu:false,showAlertsIcon:true},uiShowAboutBox:function(){n.openModal("store.views.about.about",{},{})},uiShowOnlineHelp:function(){var e="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight;var t="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth;var i="width="+t+", height="+e;var o=i+",status=yes,toolbar=no,menubar=no,location=no,resizable=yes,scrollbars=yes";var a=d.getActiveHelpURL();var s=window.open(a,"Product_name",o);s.focus()},uiShowHome:function(){a.goToState("/home",{},{})},uiDoSwitch:function(){var e=d.getAppDeviceMode();var t="";if(e==="mobile"){t=d.getApplicationContext()+"/store/mobile/container/home.do"}else{t=d.getApplicationContext()+"/store/container/home.do"}window.location.href=m.addAdditionalParamsInURL(t,"GET")},uiDoLogout:function(){window.location.pathname=d.getApplicationContext()+"/ngstore/logout.do"},uiAlertClose:function(){o.ui.showAlertMessage=false},uiCloseGlobalSearch:function(e){i.$emit("uiSearchClose",{data:"close"});if(e!=null){e.preventDefault();e.stopPropagation()}},uiHandleGlobalSearchResult:function(e){var t="global-search";if(!A.isVoid(e)&&!A.isVoid(e.Mode)){t=e.Mode}if(t=="global-search"){o.$emit("uiSearchClose","close");if("orderList"==e.NextPage.action){a.goToState("order-list",{input:e.NextPage.model},{})}else if("orderDetails"==e.NextPage.action){if("0001"==e.NextPage.model.Order.DocumentType){u.viewOrderFromList(e.NextPage.model.Order,false)}else{a.goToState("order-list",{input:e.NextPage.model,callAPI:"N"},{})}}else if("customerList"==e.NextPage.action){a.goToState("customer-list",{input:e.NextPage.model},{})}else if("customerDetails"==e.NextPage.action){a.goToState("customer-details",{input:e.NextPage.model},{})}else if("shipmentList"==e.NextPage.action){if("basicSearch"==e.NextPage.type){f.handleShipmentOrderBarcodeTranslation(e.NextPage.model,"shipmentsummary")}else if("advancedSearch"==e.NextPage.type){a.goToState("globalshipmentsearch",{input:e.NextPage.model,ignoreDocumentType:e.NextPage.ignoreDocumentType},{})}}}},uiToggle:function(){this.uiCloseGlobalSearch();this.uiCloseAlertSearch()},initialize:function(){if(S.getUsePersonaBasedHomepageFlagValue()!==true){this.ui.showAlertsIcon=false}if(!t.hasPermission("WSC000036")&&!t.hasPermission("WSC000031")&&!t.hasPermission("WSC000037")){this.ui.hideGlobalSearchAction="Y"}o.$emit("$stateChangeStart");p.bind("touchend",function(e){p.triggerHandler("click",[e])});o.$on("uiSearchClose",function(e,t){if(t){i.ui.showGlobalSearch="N"}});o.$on("uiAlertSearchClose",function(e,t){i.ui.showAlertSearch="N"});var e={};e.Rules={};s.callMashup(this,"getRuleDetails_AlertPollingInterval",e,{}).then(this.handleResults.bind(this))},handleResults:function(e){var t=6e4;var i=s.getMashupOutput(e,"getRuleDetails_AlertPollingInterval");var o=i.Rules;var a=o.RuleSetValue;this._startPolling(a,t)},_startPolling:function(e,t){var i=this;var o=function(){var e={};e.getAlertStatisticsForUser={};s.callMashup(i,"getAlertStatistics",e,{showMask:false}).then(i.handleGetExceptionList.bind(i))};o();setInterval(o,e||t)},handleGetExceptionList:function(e){var t=s.getMashupOutput(e,"getAlertStatistics");o.ui.alertCount=t.getAlertStatisticsForUser.TotalAlerts},uiHandleToggleAlertSearch:function(){if(this.ui.showAlertSearch==="Y"){this.ui.showAlertSearch="N"}else{this.ui.showAlertSearch="Y";var e={};e.getAlertStatisticsForUser={};s.callMashup(this,"getAlertStatistics",e,{showMask:false}).then(this.handleGetExceptionList.bind(this))}},uiCloseAlertSearch:function(){this.ui.showAlertSearch="N"}})}])})(window.angular,window.iscCore);
(function(e){"use strict";e.module("store").config(["iscStateProvider","iscAppInfoProvider",function(e,n){e.otherwise(n.getLandingPageState())}]);e.module("store").run(["$window","iscI18n","iscAppInfo",function(e,n,t){var r=function(){return n.translate("shell.MESSAGE_Confirm_exit_dirty")};if(!t.isDevMode()&&t.isCheckOnExitEnabled()){e.onbeforeunload=r}}]);e.module("store").config(["$httpProvider",function(e){e.interceptors.push(["$window","$q","$rootScope","iscAppInfo",function(n,e,t,r){if(t.activeCalls===undefined){t.activeCalls=0}var o=function(e,n){if(n==="INCREMENT"&&e.showMask){t.activeCalls+=1}else if(n==="DECREMENT"&&e.showMask){t.activeCalls-=1}};var i=function(e){if(r.isDevMode()&&e.headers()["content-type"]==="text/html"){e.data=e.data.replace(/<!--[\s\S]*?-->/g,"")}};var a=function(e){if(e.headers().loginpage==="true"||e.headers().redirectpage==="true"){n.location.reload()}};return{request:function(e){o(e,"INCREMENT");e.headers.SCIAjax="true";return e},requestError:function(e){o(e.config,"DECREMENT");return e},response:function(e){a(e);o(e.config,"DECREMENT");i(e);return e},responseError:function(e){a(e);o(e.config,"DECREMENT");return e}}}])}])})(window.angular);
(function(l){angular.module("store").controller("storeLoginCtrl",["$scope","$rootScope","$timeout","iscRequest","iscModal","iscI18n","iscAppContext","iscAppInfo",function(e,i,o,s,r,d,t,u){e.ui={};e.ui.displayUserId="";e.ui.password="";e.ui.enterpriseCode=s.getRequestParam("EnterpriseCode");e.ui.storeId=s.getRequestParam("StoreId");e.ui.storeLocaleCode=s.getRequestParam("StoreLocaleCode");e.ui.landingpage=s.getRequestParam("landingpage");e.ui.embedded=s.getRequestParam("Embedded");e.ui.errorMsg=s.getRequestParam("ErrorMsg");if(!l.hasBundleKey("login."+e.ui.errorMsg)){e.ui.errorMsg=""}var a=false;e.ui.doLogin=function(){document.getElementById("fieldsForm").action=""+u.getApplicationContext()+"/"+"store/"+(t.isMobile()?"mobile/":"")+"processLogin.do";if(!l.isVoid(e.ui.displayUserId)&&!l.isVoid(e.ui.password)&&!a){a=true;e.ui.errorMsg="";document.getElementById("fieldsForm").submit()}else if(l.isVoid(e.ui.displayUserId)&&l.isVoid(e.ui.password)){e.ui.errorMsg="MESSAGE_User_id_password_required"}else if(l.isVoid(e.ui.displayUserId)){e.ui.errorMsg="MESSAGE_User_id_required"}else if(l.isVoid(e.ui.password)){e.ui.errorMsg="MESSAGE_Password_required"}};e.ui.actionPath="";console.log("isMobile : "+t.isMobile());console.log(""+u.getApplicationContext()+"/"+"store/"+(t.isMobile()?"mobile/":"")+"processLogin.do")}])})(window.iscCore);

angular.module("store").config(["iscModalProvider",function(o){var t={animation:true,templateUrl:"./store/views/about/about.tpl.html",controller:"store.views.about.about",size:"lg",windowClass:"about-box-dialog"};o.registerModal("store.views.about.about",t)}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("alertspreview",{templateUrl:"./store/views/alerts/alerts-preview.tpl.html",controller:"store.views.alerts.alerts-preview"})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("customerlookupportlet",{templateUrl:"./store/views/home/customer-lookup-portlet.tpl.html",controller:"store.views.home.customer-lookup-portlet",sequenceNumber:50,showPortlet:true,resourceId:"WSC000047",personaConfig:{personaName:"Customer_Service",personaSequenceNumber:20,miniViewTemplateUrl:"./store/views/home/customer-lookup-portlet-mini.tpl.html",miniViewController:"store.views.home.customer-lookup-portlet-mini"},sitemapConfig:{sitemapTitleKey:"globals.TITLE_Customer",sitemapLinkKey:"home.TITLE_FindCustomer",sitemapLinkActionMethod:"uiFindCustomers"}})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("findproductsportlet",{templateUrl:"./store/views/home/find-products-portlet.tpl.html",controller:"store.views.home.find-products-portlet",sequenceNumber:10,showPortlet:true,resourceId:"WSC000031",personaConfig:{personaName:"Customer_Service",personaSequenceNumber:5,miniViewTemplateUrl:"./store/views/home/find-products-portlet-mini.tpl.html",miniViewController:"store.views.home.find-products-portlet-mini"},sitemapConfig:{sitemapTitleKey:"home.TITLE_Order",sitemapLinkKey:"home.TITLE_FindProducts",sitemapLinkActionMethod:"uiOpenFindProducts"}})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("instoreappointmentportlet",{templateUrl:"./store/views/home/in-store-appointment-portlet.tpl.html",controller:"store.views.home.in-store-appointment-portlet",sequenceNumber:25,showPortlet:true,resourceId:"WSC000073",personaConfig:{personaName:"Customer_Service",personaSequenceNumber:25,miniViewTemplateUrl:"./store/views/home/in-store-appointment-portlet-mini.tpl.html",miniViewController:"store.views.home.in-store-appointment-portlet-mini"},sitemapConfig:{sitemapTitleKey:"home.TITLE_InStoreAppointment",sitemapLinkKey:"instoreappointment.ACTION_ViewAppointments",sitemapLinkActionMethod:"uiViewAppointments"}})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("instorereceivingportlet",{templateUrl:"./store/views/home/instore-receiving-portlet.tpl.html",controller:"store.views.home.instore-receiving-portlet",sequenceNumber:40,showPortlet:true,resourceId:"WSC000041",personaConfig:{personaName:"Order_Fulfillment",personaSequenceNumber:20,miniViewTemplateUrl:"./store/views/home/instore-receiving-portlet-mini.tpl.html",miniViewController:"store.views.home.instore-receiving-portlet-mini"},sitemapConfig:{sitemapTitleKey:"home.TITLE_Shipment",sitemapLinkKey:"home.TITLE_InStoreReceiving",sitemapLinkActionMethod:"uiOpenReceivingShipmentList"}})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("quickcheckoutportlet",{templateUrl:"./store/views/home/quick-checkout-portlet.tpl.html",controller:"store.views.home.quick-checkout-portlet",sequenceNumber:20,showPortlet:true,resourceId:"WSC000031",personaConfig:{personaName:"Customer_Service",personaSequenceNumber:10,miniViewTemplateUrl:"./store/views/home/quick-checkout-portlet-mini.tpl.html",miniViewController:"store.views.home.quick-checkout-portlet-mini"},sitemapConfig:{sitemapTitleKey:"",sitemapLinkKey:"",sitemapLinkActionMethod:""}})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("returnsportlet",{templateUrl:"./store/views/home/returns-portlet.tpl.html",controller:"store.views.home.returns-portlet",sequenceNumber:30,showPortlet:true,resourceId:"WSC000033",personaConfig:{personaName:"Customer_Service",personaSequenceNumber:15,miniViewTemplateUrl:"./store/views/home/returns-portlet-mini.tpl.html",miniViewController:"store.views.home.returns-portlet-mini"},sitemapConfig:{sitemapTitleKey:"home.TITLE_Returns",sitemapLinkKey:"home.TITLE_ReturnItems",sitemapLinkActionMethod:"uiOpenReturns"}})}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("/home",{templateUrl:"./store/views/home/store-home.tpl.html",controller:"store.views.home.store-home"})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("mytaskslist",{templateUrl:"./store/views/my-tasks/my-tasks-list.tpl.html",controller:"store.views.my-tasks.my-tasks-list"})}]);
angular.module("store").config(["iscStateProvider",function(r){r.state("ordercapture",{templateUrl:"./store/views/order/order-capture-wizard.tpl.html",addToHistory:false})}]);
angular.module("store").config(["iscStateProvider",function(o){o.state("ordermodification",{templateUrl:"./store/views/order/order-modification-wizard.tpl.html",addToHistory:false})}]);
angular.module("store").config(["iscTaskProvider",function(o){}]);
angular.module("store").config(["iscStateProvider",function(r){r.state("returnorder",{templateUrl:"./store/views/return/return-wizard.tpl.html",addToHistory:false})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("sitemap",{templateUrl:"./store/views/sitemap/sitemap.tpl.html",controller:"store.views.sitemap.sitemap"})}]);
angular.module("store").config(["iscModalProvider",function(e){var s={animation:true,templateUrl:"./store/views/common/address/addressselectionpopup.tpl.html",controller:"store.views.common.address.addressselectionpopup",keyboard:true,backdrop:"static",size:"md",windowClass:"address-select-dialog"};e.registerModal("store.views.common.address.addressselectionpopup",s)}]);
angular.module("store").config(["iscModalProvider",function(o){var e={animation:true,templateUrl:"./store/views/common/customer/customerpopup.tpl.html",controller:"store.views.common.customer.customerpopup",keyboard:true,backdrop:"static",size:"md",windowClass:"customer-dialog"};o.registerModal("store.views.common.customer.customerpopup",e)}]);
angular.module("store").config(["iscModalProvider",function(l){l.registerModal("store.views.common.fulfillment.fulfillmentoptions",{animation:true,templateUrl:"./store/views/common/fulfillment/fulfillmentoptions.tpl.html",controller:"store.views.common.fulfillment.fulfillmentoptions",size:"lg",keyboard:true,backdrop:"static",windowClass:"fulfillment-options-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(o){o.registerModal("store.views.common.gift.giftoptions",{animation:true,templateUrl:"./store/views/common/gift/giftoptions.tpl.html",controller:"store.views.common.gift.giftoptions",size:"md",keyboard:true,backdrop:"static",windowClass:"gift-options-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(r){var o={animation:true,templateUrl:"./store/views/common/orderaddress/orderaddresspopup.tpl.html",controller:"store.views.common.orderaddress.orderaddresspopup",keyboard:true,backdrop:"static",size:"md",windowClass:"order-address-dialog"};r.registerModal("store.views.common.orderaddress.orderaddresspopup",o)}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.common.priceoverride.priceoverride",{animation:true,templateUrl:"./store/views/common/priceoverride/priceoverride.tpl.html",controller:"store.views.common.priceoverride.priceoverride",keyboard:true,backdrop:"static",size:"md",windowClass:"record-shortage-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(o){o.registerModal("store.views.common.product.product-details-share",{animation:true,templateUrl:"./store/views/common/product/product-details-share.tpl.html",controller:"store.views.common.product.product-details-share",keyboard:true,backdrop:"static",size:"sm",windowClass:"product-details-share-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(o){o.registerModal("store.views.common.product.product-details",{animation:true,templateUrl:"./store/views/common/product/product-details.tpl.html",controller:"store.views.common.product.product-details",keyboard:true,backdrop:"static",size:"md",windowClass:"product-details-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(o){o.registerModal("store.views.common.shortage.record-shortage",{animation:true,templateUrl:"./store/views/common/shortage/record-shortage.tpl.html",controller:"store.views.common.shortage.record-shortage",keyboard:true,backdrop:"static",size:"md",windowClass:"record-shortage-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.common.storesearch.storesearch",{animation:true,templateUrl:"./store/views/common/storesearch/storesearch.tpl.html",controller:"store.views.common.storesearch.storesearch",size:"lg",keyboard:true,backdrop:"static",windowClass:"store-search-dialog"})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("customer-details",{templateUrl:"./store/views/customer/cust-details/global-customer-details.tpl.html",controller:"store.views.customer.cust-details.global-customer-details",resourceId:"",addToHistory:true})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("customer-list",{templateUrl:"./store/views/customer/cust-list/global-customer-list.tpl.html",controller:"store.views.customer.cust-list.global-customer-list",resourceId:"",addToHistory:true})}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("customerprofilewizard",{templateUrl:"./store/views/customer/customer-profile/customer-profile-wizard.tpl.html",resourceId:"WSC000047",addToHistory:true})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.customer.customer-profile.product-details",{animation:true,templateUrl:"./store/views/customer/customer-profile/product-details.tpl.html",controller:"store.views.customer.customer-profile.product-details",keyboard:true,backdrop:"static",size:"md",windowClass:"product-details-dialog",ariaLabelledBy:"modalTitle"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.customer.notes.customernotes",{animation:true,templateUrl:"./store/views/customer/notes/customernotes.tpl.html",controller:"store.views.customer.notes.customernotes",size:"md",keyboard:true,backdrop:"static",windowClass:"comment-dialog",ariaLabelledBy:"modalTitle"})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("customerpickupportlet",{templateUrl:"./store/views/home/common/customer-pickup-portlet.tpl.html",controller:"store.views.home.common.customer-pickup-portlet",sequenceNumber:15,showPortlet:true,resourceId:"WSC000068",personaConfig:{personaName:"Order_Fulfillment",personaSequenceNumber:15,miniViewTemplateUrl:"./store/views/home/common/customer-pickup-portlet-mini.tpl.html",miniViewController:"store.views.home.common.customer-pickup-portlet-mini"},sitemapConfig:{sitemapTitleKey:"pickupportlet.TITLE_CustomerPickup",sitemapLinkKey:"pickupportlet.ACTION_CustomerPickup",sitemapLinkActionMethod:"uiPickupOrders"}})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("moretasksportlet",{templateUrl:"./store/views/home/common/moretasks-portlet.tpl.html",controller:"store.views.home.common.moretasks-portlet",sequenceNumber:-100,showPortlet:true,resourceId:"",personaConfig:{personaName:"",personaSequenceNumber:-100,miniViewTemplateUrl:"",miniViewController:""},childPortletsArray:[]})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("mytasksportlet",{templateUrl:"./store/views/home/common/mytasks-portlet.tpl.html",controller:"store.views.home.common.mytasks-portlet",sequenceNumber:30,showPortlet:true,resourceId:"WSC000071",personaConfig:{personaName:"Order_Fulfillment",personaSequenceNumber:30,miniViewTemplateUrl:"./store/views/home/common/mytasks-portlet-mini.tpl.html",miniViewController:"store.views.home.common.mytasks-portlet-mini"},sitemapConfig:{sitemapTitleKey:"mytasksportlet.TITLE_MyTasks",sitemapLinkKey:"mytasksportlet.ACTION_MyTasks",sitemapLinkActionMethod:"uiViewMyTasks"}})}]);
angular.module("store").config(["iscStateProvider",function(a){a.state("/manager-dashboard",{templateUrl:"./store/views/home/manager-dashboard/manager-dashboard.tpl.html",controller:"store.views.home.manager-dashboard.manager-dashboard"})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("packportlet",{templateUrl:"./store/views/home/order-fulfillment/pack-portlet.tpl.html",controller:"store.views.home.order-fulfillment.pack-portlet",sequenceNumber:10,showPortlet:true,resourceId:"WSC000062",personaConfig:{personaName:"Order_Fulfillment",personaSequenceNumber:10,miniViewTemplateUrl:"./store/views/home/order-fulfillment/pack-portlet-mini.tpl.html",miniViewController:"store.views.home.order-fulfillment.pack-portlet-mini"},sitemapConfig:{sitemapTitleKey:"packportlet.TITLE_PackOrders",sitemapLinkKey:"packportlet.ACTION_PackOrders",sitemapLinkActionMethod:"uiPackOrders"}})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("pickportlet",{templateUrl:"./store/views/home/order-fulfillment/pick-portlet.tpl.html",controller:"store.views.home.order-fulfillment.pick-portlet",sequenceNumber:5,showPortlet:true,resourceId:"WSC000053|WSC000057|WSC000058",personaConfig:{personaName:"Order_Fulfillment",personaSequenceNumber:5,miniViewTemplateUrl:"./store/views/home/order-fulfillment/pick-portlet-mini.tpl.html",miniViewController:"store.views.home.order-fulfillment.pick-portlet-mini"},sitemapConfig:[{sitemapTitleKey:"pickportlet.TITLE_PickOrders",sitemapLinkKey:"pickportlet.ACTION_PickOrders",sitemapLinkActionMethod:"uiPickOrders",resourceId:"WSC000057|WSC000058"},{sitemapTitleKey:"pickportlet.TITLE_PickOrders",sitemapLinkKey:"pickportlet.ACTION_BATCHPICK",sitemapLinkActionMethod:"uiBatchPickOrders",resourceId:"WSC000053"}]})}]);
angular.module("store").config(["iscPortletPvdrProvider",function(e){e.registerPortlet("shipportlet",{templateUrl:"./store/views/home/order-fulfillment/ship-portlet.tpl.html",controller:"store.views.home.order-fulfillment.ship-portlet",sequenceNumber:25,showPortlet:true,resourceId:"WSC000067",personaConfig:{personaName:"Order_Fulfillment",personaSequenceNumber:25,miniViewTemplateUrl:"./store/views/home/order-fulfillment/ship-portlet-mini.tpl.html",miniViewController:"store.views.home.order-fulfillment.ship-portlet-mini"},sitemapConfig:{sitemapTitleKey:"shipportlet.TITLE_ShipOrders",sitemapLinkKey:"shipportlet.ACTION_ShipPackagess",sitemapLinkActionMethod:"uiShipPackages"}})}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("customer-appeasement",{templateUrl:"./store/views/order/appeasement/customer-appeasement.tpl.html",controller:"store.views.order.appeasement.customer-appeasement"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.order.cancel.cancelorder",{animation:true,templateUrl:"./store/views/order/cancel/cancelorder.tpl.html",controller:"store.views.order.cancel.cancelorder",size:"md",keyboard:true,backdrop:"static",windowClass:"cancel-order-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.order.cancel.cancelorderline",{animation:true,templateUrl:"./store/views/order/cancel/cancelorderline.tpl.html",controller:"store.views.order.cancel.cancelorderline",size:"md",keyboard:true,backdrop:"static",windowClass:"cancel-order-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.order.comments.comments",{animation:true,templateUrl:"./store/views/order/comments/comments.tpl.html",controller:"store.views.order.comments.comments",size:"md",keyboard:true,backdrop:"static",windowClass:"comment-dialog"})}]);
angular.module("store").config(["iscStateProvider",function(r){r.state("order-list",{templateUrl:"./store/views/order/list/global-order-list.tpl.html",controller:"store.views.order.list.global-order-list",resourceId:"",addToHistory:true})}]);
angular.module("store").config(["iscStateProvider","iscTaskProvider",function(e,r){e.state("ordersummary",{templateUrl:"./store/views/order/order-summary/order-summary.tpl.html",controller:"store.views.order.order-summary.order-summary"});var a={tasks:[{taskId:"cancelOrder",taskName:"Cancel Order",getTask:function(o){var n={};n.taskId="cancelOrder";n.taskName="ordersummary.ACTION_CancelOrder";n.isDisabled=o.IsCancellationAllowed=="N";n.isPrimary=false;n.isHidden=false;n.isDefault=false;n.resourcePermission="WSC000035";n.action=["iscModal","$q",function(e,r){var a=r.defer();var s={};s.Order=o;var t={modalInput:function(){return s}};e.openModal("store.views.order.cancel.cancelorder",t).then(function(e){if(e.cancelOrderAPIOutput.cancelOrderAPISuccess){var r={taskName:n.taskId,taskAPIOutput:e.cancelOrderAPIOutput};a.resolve(r)}}.bind(this),angular.noop);return a.promise}];if(o.DraftOrderFlag=="Y")n.isHidden=true;else n.isHidden=false;return n}}]};var s={tasks:[{taskId:"appeaseCustomer",taskName:"Appease Customer",getTask:function(t){var e={};e.taskId="appeaseCustomer";e.taskName="customerappeasement.ACTION_Appease_Customer";e.isDisabled=t.IsAppeasementAllowed=="N";e.isPrimary=false;e.isHidden=false;e.isDefault=false;e.resourcePermission="WSC000054";e.action=["iscState","$q",function(e,r){var a=r.defer();var s={};s.Order=t;e.goToState("customer-appeasement",{orderInput:s,showBackLink:true},{});return a.promise}];return e}}]};r.addTask("ORDER","APPEASE_CUSTOMER",s);r.addTask("ORDER","CANCEL_ORDER",a)}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.receiving.notes.shipment-notes",{animation:true,templateUrl:"./store/views/receiving/notes/shipment-notes.tpl.html",controller:"store.views.receiving.notes.shipment-notes",size:"md",keyboard:true,backdrop:"static",windowClass:"comment-dialog",ariaLabelledBy:"modalTitle"})}]);
angular.module("store").config(["iscStateProvider","iscTaskProvider",function(e,i){e.state("receive-shipment",{templateUrl:"./store/views/receiving/receive-shipment/receive-shipment-wizard.tpl.html",resourceId:"WSC000041",addToHistory:false});var r={tasks:[{taskId:"shipmentReceiveAll",taskName:"Receive All shipment",getTask:function(t){var n={};n.taskId="shipmentReceiveAll";n.taskName="instorereceiving.ACTION_ReceiveAll";n.isDisabled=false;n.isPrimary=false;n.isHidden=false;n.isDefault=false;n.resourcePermission="WSC000045";n.action=["iscModal","$q",function(e,i){var r=i.defer();var s={};s.Shipment=t;var a={modalInput:function(){return s}};e.openModal("store.views.receiving.receive-shipment.common.receive-full.receive-full-shipment",a).then(function(e){if(e.receiveOrderAPICallBack.apiSuccess){var i={taskName:n.taskId,taskAPIOutput:e.receiveOrderAPICallBack.apiOutput};r.resolve(i)}}.bind(this),angular.noop);return r.promise}];return n}}]};i.addTask("RECEIVE_SHIPMENT","RECEIVE_ALL_SHIPMENT",r)}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("receivingShipmentList",{templateUrl:"./store/views/receiving/receiving-shipment-list/receiving-shipment-list.tpl.html",controller:"store.views.receiving.receiving-shipment-list.receiving-shipment-list"})}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("receivingShipmentSummary",{templateUrl:"./store/views/receiving/receiving-shipment-summary/receiving-shipment-summary.tpl.html",controller:"store.views.receiving.receiving-shipment-summary.receiving-shipment-summary"})}]);
angular.module("store").config(["iscStateProvider",function(r){r.state("returnsummary",{templateUrl:"./store/views/return/return-summary/return-summary.tpl.html",controller:"store.views.return.return-summary.return-summary"})}]);
angular.module("store").config(["iscTaskProvider",function(a){var t={tasks:[{taskId:"performBackroomPick",taskName:"Perform Backroom Pick",getTask:function(s,a){if(s.Status){var n={};n.taskId="performBackroomPick";n.isPrimary=false;n.isDisabled=true;n.sequence=10;var t=s.ShipNode.ShipNode==null?s.ShipNode:s.ShipNode.ShipNode;var e=iscCore.getFromContext("storeName");var o=[];if(s.AllowedTransactions&&s.AllowedTransactions.Transaction){var r=s.AllowedTransactions.Transaction;for(i=0;i<r.length;i++){o.push(r[i].Tranid)}}if(s.DeliveryMethod){var m=s.DeliveryMethod;if(m=="SHP"){n.resourcePermission="WSC000058"}else{n.resourcePermission="WSC000057"}}if(e==t&&s.Status){var c=s.Status.Status?s.Status.Status:s.Status;if(o.length>0&&(o.indexOf("YCD_BACKROOM_PICK_IN_PROGRESS")>-1||o.indexOf("YCD_BACKROOM_PICK")>-1||o.indexOf("YCD_BACKROOM_PICK_IN_PROGRESS.0006")>-1||o.indexOf("YCD_BACKROOM_PICK.0006")>-1)){if(c.match("1100.70.06.10")||c.match("1100.70.06.20")){n.isDisabled=false;n.isPrimary=true}}if(c.match("1100.70.06.20")){n.taskName="shipmentsummary.ACTION_ContinueBackroomPick"}else if(c.match("1100.70.06.10")){n.taskName="shipmentsummary.ACTION_StartBackroomPick"}else{n.taskName="shipmentsummary.ACTION_StartBackroomPick"}}n.isHidden=false;n.isDefault=false;n.action=["iscState","$timeout","$q",function(a,t,e){var i=e.defer();t(function(){var a={taskName:n.taskId,taskAPIOutput:{}};i.resolve(a)},0);a.goToState("backroomPickWizard",{input:{Shipment:{ShipmentKey:s.ShipmentKey}}},{});return i.promise}];return n}}},{taskId:"assignStagingLocation",taskName:"Assign Staging Location",getTask:function(o){if(o.Status){var r={};r.taskId="assignStagingLocation";r.taskName="shipmentsummary.ACTION_AssignStagingLocation";var a=o.Status.Status?o.Status.Status:o.Status;if(a.match("1100.70.06.20")||a.match("1100.70.06.30")||a.match("1100.70.06.50")){r.isDisabled=false}else{r.isDisabled=true}r.isPrimary=false;r.isHidden=false;r.isDefault=false;r.ruleName="enableStagingLocation";r.sequence=20;r.action=["iscModal","$timeout","$q",function(a,t,e){var i=e.defer();var s={};s.shipment={};s.shipment.Shipment={};s.shipment.Shipment=o;var n={modalInput:function(){return s}};a.openModal("store.views.shipment.common.staging-location.staging-location",n,{}).then(function(a){if(a.data!==null&&a.data!==undefined){o.HoldLocation=a.data.StagingLocation;var t={taskName:r.taskId,taskAPIOutput:o};i.resolve(t)}});return i.promise}];return r}}}]};a.addTask("SHIPMENT","BACKROOM_PICK_RT",t)}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("batchpick",{templateUrl:"./store/views/shipment/batchpick/batchpick-wizard.tpl.html",addToHistory:false})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("shipmentConfirmDetails",{templateUrl:"./store/views/shipment/confirm/shipment-confirm-detail.tpl.html",controller:"store.views.shipment.confirm.shipment-confirm",addToHistory:true})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("shipmentConfirmList",{templateUrl:"./store/views/shipment/confirm/shipment-confirm-list.tpl.html",controller:"store.views.shipment.confirm.shipment-confirm-list"})}]);
angular.module("store").config(["iscTaskProvider",function(e){var t={tasks:[{taskId:"performPack",taskName:"Perform Pack",getTask:function(s,e){if(s.Status){var r={};r.taskId="performPack";r.isPrimary=false;r.isDisabled=true;r.sequence=50;var t=s.ShipNode.ShipNode==null?s.ShipNode:s.ShipNode.ShipNode;var a=iscCore.getFromContext("storeName");var n=s.AllowedTransactions.Transaction;var o=[];for(i=0;i<n.length;i++){o.push(n[i].Tranid)}r.resourcePermission="WSC000062";if(s.DeliveryMethod=="SHP"){r.isHidden=false}else{r.isHidden=true}r.isDefault=false;if(a==t&&s.Status){var m=s.Status.Status?s.Status.Status:s.Status;if(o.indexOf("YCD_UNDO_BACKROOM_PICK")>-1&&o.indexOf("PACK_SHIPMENT_COMPLETE")>-1||o.indexOf("PACK_SHIPMENT_COMPLETE")>-1&&o.indexOf("UNDO_PACK_SHMT_COMPLETE")>-1||o.indexOf("YCD_UNDO_BACKROOM_PICK.0006")>-1&&o.indexOf("PACK_SHIPMENT_COMPLETE.0006")>-1||o.indexOf("PACK_SHIPMENT_COMPLETE.0006")>-1&&o.indexOf("UNDO_PACK_SHP_CMP.0006")>-1){if(m.match("1100.70.06.50")||m.match("1100.70.06.70")){r.isDisabled=false;r.isPrimary=true}}if(m.match("1100.70.06.50")){r.taskName="shipmentsummary.ACTION_StartPackShipment"}else if(m.match("1100.70.06.70")){r.taskName="shipmentsummary.ACTION_ContinuePackShipment"}else{if(s.DeliveryMethod=="SHP"){r.taskName="shipmentsummary.ACTION_StartPackShipment"}}}r.action=["iscState","$timeout","$q",function(e,t,a){var i=a.defer();t(function(){var e={taskName:r.taskId,taskAPIOutput:{}};i.resolve(e)},0);e.goToState("containerpack",{input:{Shipment:{ShipmentKey:s.ShipmentKey}}},{});return i.promise}];return r}}}]};e.addTask("SHIPMENT","PACK_RT",t)}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("containerpack",{templateUrl:"./store/views/shipment/containerpack/containerpack-wizard.tpl.html",addToHistory:false})}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("extn-pack-search-list",{templateUrl:"./store/views/shipment/containerpack/extn-pack-search-list.tpl.html",controller:"store.views.shipment.containerpack.extn-pack-search-list",resourceId:"WSC000019",addToHistory:true})}]);
angular.module("store").config(["iscModalProvider",function(n){n.registerModal("store.views.shipment.containerunpack.container-unpack-reason",{animation:true,templateUrl:"./store/views/shipment/containerunpack/container-unpack-reason.tpl.html",controller:"store.views.shipment.containerunpack.container-unpack-reason",keyboard:true,backdrop:"static",size:"sm",windowClass:"container-unpack-reason"})}]);
angular.module("store").config(["iscTaskProvider",function(e){var t={tasks:[{taskId:"performCustomerPickup",taskName:"Perform Customer Pickup",getTask:function(a,e){if(a.Status){var r={};r.taskId="performCustomerPickup";r.isPrimary=false;r.isDisabled=true;r.sequence=30;var t=a.ShipNode.ShipNode==null?a.ShipNode:a.ShipNode.ShipNode;var s=iscCore.getFromContext("storeName");var o=[];if(a.AllowedTransactions&&a.AllowedTransactions.Transaction){var u=a.AllowedTransactions.Transaction;for(i=0;i<u.length;i++){o.push(u[i].Tranid)}}r.resourcePermission="WSC000068";if(a.DeliveryMethod=="PICK"){r.isHidden=false}else{r.isHidden=true}r.isDefault=false;if(s==t&&a.Status){var n=a.Status.Status?a.Status.Status:a.Status;if(o.length>0&&(o.indexOf("CONFIRM_SHIPMENT")>-1&&a.DeliveryMethod=="PICK")){if(n.match("1100.70.06.30")){r.isDisabled=false;r.isPrimary=true}}if(n.match("1100.70.06.30")){r.taskName="shipmentsummary.ACTION_CustomerPick"}else{if(a.DeliveryMethod=="PICK"){r.taskName="shipmentsummary.ACTION_CustomerPick"}}}r.action=["iscState","$timeout","$q",function(e,t,i){var s=i.defer();t(function(){var e={taskName:r.taskId,taskAPIOutput:{}};s.resolve(e)},0);e.goToState("customer-pickup",{input:{Shipment:{ShipmentKey:a.ShipmentKey}}},{});return s.promise}];return r}}},{taskId:"printPickupAck",taskName:"Print Pickup Acknowledgement",getTask:function(u,e){if(u.Status){var n={};n.taskId="printPickupAck";n.isPrimary=false;n.isDisabled=true;n.taskName="shipmentsummary.ACTION_PrintPickupAcknowledgement";n.resourcePermission="WSC000070";n.sequence=40;var t=u.ShipNode.ShipNode==null?u.ShipNode:u.ShipNode.ShipNode;var i=iscCore.getFromContext("storeName");if(u.DeliveryMethod=="PICK"){n.isHidden=false}else{n.isHidden=true}n.isDefault=false;if(i==t&&u.Status){var s=u.Status.Status?u.Status.Status:u.Status;var m=u.ShipNode.ShipNode?u.ShipNode.ShipNode:u.ShipNode;if(u.DeliveryMethod=="PICK"&&s.match("1400")){n.isDisabled=false;n.action=["iscMashup","$timeout","$q","iscPrint","iscModal",function(e,s,t,a,r){var o=t.defer();var i={Shipment:{ShipmentKey:u.ShipmentKey,ShipNode:m,Currency:u.Currency}};e.callSimpleMashup(null,"store.views.shipment.customer-pickup.printAcknowledgement",i,{}).then(function(t){var i=t.MashupRefs.MashupRef[0].Output;if(!iscCore.isVoid(i.Output.out)){s(function(){a.printHtmlOutput(i);var e={taskName:n.taskId,taskAPIOutput:t};o.resolve(e)},0)}else{r.showErrorMessage("shipmentsummary.Message_Print_failure")}});return o.promise}]}}return n}}}]};e.addTask("SHIPMENT","CUSTOMERPICKUP_RT",t)}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("customer-pickup",{templateUrl:"./store/views/shipment/customer-pickup/customer-pickup-wizard.tpl.html",resourceId:"WSC000068",addToHistory:false})}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("globalshipmentsearch",{templateUrl:"./store/views/shipment/global-shipment-search/global-shipment-search-list.tpl.html",controller:"store.views.shipment.global-shipment-search.global-shipment-search"})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("shipmentList",{templateUrl:"./store/views/shipment/list/shipment-list.tpl.html",controller:"store.views.shipment.list.shipment-list"})}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("shipmentsearch",{templateUrl:"./store/views/shipment/search/shipment-search.tpl.html",controller:"store.views.shipment.search.shipment-search"})}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("shipmentsummary",{templateUrl:"./store/views/shipment/summary/shipment-summary.tpl.html",controller:"store.views.shipment.summary.shipment-summary",resourceId:"",addToHistory:true})}]);
angular.module("store").config(["iscTaskProvider",function(e){var t={tasks:[{taskId:"addViewAppointmentNotes",taskName:"Add/View Notes for Appointment details",getTask:function(r){if(r){var i={};i.taskId="addViewAppointmentNotes";i.taskName="appointmentnotes.ACTION_Add_notes";i.isPrimary=false;i.isHidden=false;i.isDefault=false;i.isDisabled=false;i.resourcePermission="WSC000073";i.sequence=20;if(r.Notes.NumberOfNotes!=="0"){i.taskName=iscCore.translate("appointmentnotes.ACTION_View_notes",{count:r.Notes.NumberOfNotes})}i.action=["iscModal","$timeout","$q",function(e,t,s){var o=s.defer();var a={Order:{OrderHeaderKey:r.OrderHeaderKey}};var n={modalInput:function(){return a}};e.openModal("store.views.appointments.common.add-view-notes.add-view-notes",n,{}).then(function(e){r.Notes.NumberOfNotes=e.NoteList.TotalNumberOfRecords;if(r.Notes.NumberOfNotes!=="0"){i.taskName=iscCore.translate("appointmentnotes.ACTION_View_notes",{count:r.Notes.NumberOfNotes})}var t={taskName:i.taskId,taskAPIOutput:e};o.resolve(t)}.bind(this),angular.noop);return o.promise}];return i}}}]};e.addTask("WORK_ORDER","ADD_VIEW_NOTES",t)}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.appointments.common.add-view-notes.add-view-notes",{animation:true,templateUrl:"./store/views/appointments/common/add-view-notes/add-view-notes.tpl.html",controller:"store.views.appointments.common.add-view-notes.add-view-notes",size:"md",keyboard:true,backdrop:"static",windowClass:"add-view-notes-appointment-dialog comment-dialog"})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("appointmentlist",{templateUrl:"./store/views/appointments/common/appointment-list/appointment-list.tpl.html",controller:"store.views.appointments.common.appointment-list.appointment-list"})}]);
angular.module("store").config(["iscTaskProvider",function(e){var t={tasks:[{taskId:"editAppointment",taskName:"Edit Appointment details",getTask:function(s){if(s){var n={};n.taskId="editAppointment";n.taskName="globals.ACTION_EDIT";n.isPrimary=false;n.isHidden=false;n.isDefault=false;n.isDisabled=false;n.resourcePermission="WSC000074";n.sequence=10;if(s.DraftOrderFlag=="Y"||s.MinOrderStatus.match("3700.7777")||s.MinOrderStatus.match("9000")){n.isDisabled=true}n.action=["iscState","iscInStoreAppointment","$timeout","$q",function(e,t,a,r){var i=r.defer();a(function(){var e={taskName:n.taskId,taskAPIOutput:{}};i.resolve(e)},0);t.openCreateAppointmentWizard({input:{Order:{OrderHeaderKey:s.OrderHeaderKey}}});return i.promise}];return n}}}]};e.addTask("WORK_ORDER","EDIT_APPOINTMENT",t)}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("appointment-summary",{templateUrl:"./store/views/appointments/common/appointment-summary/appointment-summary.tpl.html",controller:"store.views.appointments.common.appointment-summary.appointment-summary",resourceId:"WSC000073",addToHistory:true})}]);
angular.module("store").config(["iscTaskProvider",function(a){var e={tasks:[{taskId:"cancelAppointment",taskName:"Cancel Appointment details",getTask:function(o){if(o){var r={};r.taskId="cancelAppointment";r.taskName="cancelAppointment.ACTION_CancelAppointment";r.isPrimary=false;r.isHidden=false;r.isDefault=false;r.isDisabled=false;r.resourcePermission="WSC000075";r.sequence=40;if(o.MinOrderStatus){var a=o.MinOrderStatus;if(a.match("3700.7777")||a.match("9000")){r.isDisabled=true}}r.action=["iscModal","$timeout","$q",function(a,e,t){var n=t.defer();var i={};i.appointmentModel=o;var s={modalInput:function(){return i}};a.openModal("store.views.appointments.common.cancel-appointment.cancel-appointment",s,{}).then(function(a){if(a.data!==null&&a.data!==undefined&&a.data.markAsCancelSuccess){var e={taskName:r.taskId,taskAPIOutput:a.data};n.resolve(e)}},angular.noop);return n.promise}];return r}}}]};a.addTask("WORK_ORDER","CANCEL_APPOINTMENT",e)}]);
angular.module("store").config(["iscModalProvider",function(n){n.registerModal("store.views.appointments.common.cancel-appointment.cancel-appointment",{animation:true,templateUrl:"./store/views/appointments/common/cancel-appointment/cancel-appointment.tpl.html",controller:"store.views.appointments.common.cancel-appointment.cancel-appointment",keyboard:true,backdrop:"static",size:"md",windowClass:"cancel-appointment-dialog"})}]);
angular.module("store").config(["iscTaskProvider",function(a){var e={tasks:[{taskId:"markAsCompleteAppointment",taskName:"Mark as Complete Appointment details",getTask:function(r){if(r){var i={};i.taskId="markAsCompleteAppointment";i.taskName="completeAppointment.ACTION_MarkAsComplete";i.isPrimary=false;i.isHidden=false;i.isDefault=false;i.isDisabled=false;i.sequence=30;if(r.MinOrderStatus){var a=r.MinOrderStatus;if(r.DraftOrderFlag=="Y"||a.match("3700.7777")||a.match("9000")){i.isDisabled=true}}i.action=["iscModal","$timeout","$q",function(a,e,t){var n=t.defer();var s={};s.appointmentModel=r;var o={modalInput:function(){return s}};a.openModal("store.views.appointments.common.mark-as-complete-appointment.mark-as-complete-appointment",o,{}).then(function(a){if(a.data!==null&&a.data!==undefined&&a.data.markAsCompleteSuccess){var e={taskName:i.taskId,taskAPIOutput:a.data};n.resolve(e)}},angular.noop);return n.promise}];return i}}}]};a.addTask("WORK_ORDER","MARK_AS_COMPLETE_APPOINTMENT",e)}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.appointments.common.mark-as-complete-appointment.mark-as-complete-appointment",{animation:true,templateUrl:"./store/views/appointments/common/mark-as-complete-appointment/mark-as-complete-appointment.tpl.html",controller:"store.views.appointments.common.mark-as-complete-appointment.mark-as-complete-appointment",keyboard:true,backdrop:"static",size:"md",windowClass:"mark-as-complete-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.appointments.common.service-description.service-description",{animation:true,templateUrl:"./store/views/appointments/common/service-description/service-description.tpl.html",controller:"store.views.appointments.common.service-description.service-description",size:"md",keyboard:true,backdrop:"static",windowClass:"service-description-dialog",ariaLabelledBy:"modalTitle"})}]);
angular.module("store").config(["iscTaskProvider",function(a){var e={tasks:[{taskId:"shareAppointment",taskName:"Share Appointment details",getTask:function(i){if(i){var o={};o.taskId="shareAppointment";o.taskName="globals.ACTION_Share";o.isPrimary=false;o.isHidden=false;o.isDefault=false;o.sequence=50;if(i.DraftOrderFlag=="Y"){o.isDisabled=true}o.action=["iscModal","$timeout","$q",function(a,e,t){var n=t.defer();var s={};s.appointmentModel=i;var r={modalInput:function(){return s}};a.openModal("store.views.appointments.common.share-appointment.share-appointment",r,{}).then(function(a){if(a.data!==null&&a.data!==undefined){var e={taskName:o.taskId,taskAPIOutput:i};n.resolve(e)}},angular.noop);return n.promise}];return o}}}]};a.addTask("WORK_ORDER","SHARE_APPOINTMENT",e)}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.appointments.common.share-appointment.share-appointment",{animation:true,templateUrl:"./store/views/appointments/common/share-appointment/share-appointment.tpl.html",controller:"store.views.appointments.common.share-appointment.share-appointment",keyboard:true,backdrop:"static",size:"sm",windowClass:"share-appointment-dialog",ariaLabelledBy:"modalTitle"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.appointments.in-store.change-store.change-store",{animation:true,templateUrl:"./store/views/appointments/in-store/change-store/change-store.tpl.html",controller:"store.views.appointments.in-store.change-store.change-store",size:"lg",keyboard:true,backdrop:"static",windowClass:"full-screen-modal screen-container change-store-dialog"})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("storeAppointmentCalendar",{templateUrl:"./store/views/appointments/in-store/store-appointments/appointments-calendar.tpl.html",controller:"store.views.appointments.in-store.store-appointments.appointments-calendar"})}]);
angular.module("store").config(["iscStateProvider",function(e){e.state("customerProfileList",{templateUrl:"./store/views/customer/customer-profile/list/customer-profile-list.tpl.html",controller:"store.views.customer.customer-profile.list.customer-profile-list",resourceId:"",addToHistory:true})}]);
angular.module("store").config(["iscModalProvider",function(o){o.registerModal("store.views.return.common.disposition.return-disposition",{animation:true,templateUrl:"./store/views/return/common/disposition/return-disposition.tpl.html",controller:"store.views.return.common.disposition.return-disposition",keyboard:true,backdrop:"static",size:"md",windowClass:"return-disposition-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(o){o.registerModal("store.views.return.common.override.override-policy-violation",{animation:true,templateUrl:"./store/views/return/common/override/override-policy-violation.tpl.html",controller:"store.views.return.common.override.override-policy-violation",keyboard:true,backdrop:"static",size:"md",windowClass:"override-policy-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.return.common.reason.return-reason-multiple",{animation:true,templateUrl:"./store/views/return/common/reason/return-reason-multiple.tpl.html",controller:"store.views.return.common.reason.return-reason-multiple",keyboard:true,backdrop:"static",size:"md",windowClass:"return-reason-multiple-dialog"});e.registerModal("store.views.return.common.reason.return-reason-oneline",{animation:true,templateUrl:"./store/views/return/common/reason/return-reason-multiple.tpl.html",controller:"store.views.return.common.reason.return-reason-multiple",keyboard:true,backdrop:"static",size:"md",windowClass:"return-reason-multiple-dialog single-product"})}]);
angular.module("store").config(["iscModalProvider",function(r){r.registerModal("store.views.return.common.reason.return-reason-single",{animation:true,templateUrl:"./store/views/return/common/reason/return-reason-single.tpl.html",controller:"store.views.return.common.reason.return-reason-single",keyboard:true,backdrop:"static",size:"md",windowClass:"return-reason-dialog"})}]);
angular.module("store").config(["iscStateProvider",function(r){r.state("pickorderlist",{templateUrl:"./store/views/shipment/backroom-pick/pick-order-list/pick-order-list.tpl.html",controller:"store.views.shipment.backroom-pick.pick-order-list.pick-order-list"})}]);
angular.module("store").config(["iscStateProvider",function(o){o.state("backroomPickWizard",{templateUrl:"./store/views/shipment/backroom-pick/wizard/backroom-pick-wizard.tpl.html",addToHistory:false})}]);
angular.module("store").config(["iscModalProvider",function(n){n.registerModal("store.views.shipment.common.abandon-shipment.abandon-shipment",{animation:true,templateUrl:"./store/views/shipment/common/abandon-shipment/abandon-shipment.tpl.html",controller:"store.views.shipment.common.abandon-shipment.abandon-shipment",keyboard:true,backdrop:"static",size:"md",windowClass:"abandon-shipment-dialog full-height-modal-mobile"})}]);
angular.module("store").config(["iscModalProvider",function(t){t.registerModal("store.views.shipment.common.product-details.product-details",{animation:true,templateUrl:"./store/views/shipment/common/product-details/product-details.tpl.html",controller:"store.views.shipment.common.product-details.product-details",keyboard:true,backdrop:"static",size:"md",windowClass:"obs-product-details-dialog",ariaLabelledBy:"modalTitle"})}]);
angular.module("store").config(["iscModalProvider",function(o){o.registerModal("store.views.shipment.common.record-shortage.record-shortage",{animation:true,templateUrl:"./store/views/shipment/common/record-shortage/record-shortage.tpl.html",controller:"store.views.shipment.common.record-shortage.record-shortage",keyboard:true,backdrop:"static",size:"md",windowClass:"record-shortage-dialog full-height-modal"})}]);
angular.module("store").config(["iscModalProvider",function(o){o.registerModal("store.views.shipment.common.staging-location.staging-location",{animation:true,templateUrl:"./store/views/shipment/common/staging-location/staging-location.tpl.html",controller:"store.views.shipment.common.staging-location.staging-location",keyboard:true,backdrop:"static",size:"md",windowClass:"staging-location-dialog"})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("packorderlist",{templateUrl:"./store/views/shipment/containerpack/pack-order-list/pack-order-list.tpl.html",controller:"store.views.shipment.containerpack.pack-order-list.pack-order-list"})}]);
angular.module("store").config(["iscModalProvider",function(t){t.registerModal("store.views.shipment.containerpack.pack-products.pack-container-products",{animation:true,templateUrl:"./store/views/shipment/containerpack/pack-products/pack-container-products.tpl.html",controller:"store.views.shipment.containerpack.pack-products.pack-container-products",keyboard:true,backdrop:"static",size:"md",windowClass:"pack-container-products"})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("customerpickorderlist",{templateUrl:"./store/views/shipment/customer-pickup/customer-pick-order-list/customer-pick-order-list.tpl.html",controller:"store.views.shipment.customer-pickup.customer-pick-order-list.customer-pick-order-list"})}]);
angular.module("store").config(["iscStateProvider",function(t){t.state("manage-appointment",{templateUrl:"./store/views/appointments/in-store/manage-appointment/wizard/manage-appointment-wizard.tpl.html",addToHistory:false})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.receiving.receive-shipment.common.multiple-shipments.multiple-receiving-shipments",{animation:true,templateUrl:"./store/views/receiving/receive-shipment/common/multiple-shipments/multiple-receiving-shipments.tpl.html",controller:"store.views.receiving.receive-shipment.common.multiple-shipments.multiple-receiving-shipments",keyboard:true,backdrop:"static",size:"md",windowClass:"multiple-receiving-shipments-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.receiving.receive-shipment.common.receive-full.receive-full-shipment",{animation:true,templateUrl:"./store/views/receiving/receive-shipment/common/receive-full/receive-full-shipment.tpl.html",controller:"store.views.receiving.receive-shipment.common.receive-full.receive-full-shipment",keyboard:true,backdrop:"static",size:"md",windowClass:"receive-full-shipment-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.receiving.receive-shipment.common.receive-later.receive-later",{animation:true,templateUrl:"./store/views/receiving/receive-shipment/common/receive-later/receive-later.tpl.html",controller:"store.views.receiving.receive-shipment.common.receive-later.receive-later",keyboard:true,backdrop:"static",size:"md",windowClass:"receive-later-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.receiving.receive-shipment.common.record-damage.record-damage",{animation:true,templateUrl:"./store/views/receiving/receive-shipment/common/record-damage/record-damage.tpl.html",controller:"store.views.receiving.receive-shipment.common.record-damage.record-damage",keyboard:true,backdrop:"static",size:"md",windowClass:"record-damage-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.receiving.receive-shipment.common.view-container.view-container",{animation:true,templateUrl:"./store/views/receiving/receive-shipment/common/view-container/view-container.tpl.html",controller:"store.views.receiving.receive-shipment.common.view-container.view-container",keyboard:true,backdrop:"static",size:"md",windowClass:"view-container-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(i){i.registerModal("store.views.shipment.backroom-pick.common.print-pick-ticket.print-pick-ticket",{animation:true,templateUrl:"./store/views/shipment/backroom-pick/common/print-pick-ticket/print-pick-ticket.tpl.html",controller:"store.views.shipment.backroom-pick.common.print-pick-ticket.print-pick-ticket",keyboard:true,backdrop:"static",size:"md",windowClass:"print-pick-ticket-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(i){i.registerModal("store.views.shipment.backroom-pick.common.shipment-in-batch.shipment-in-batch",{animation:true,templateUrl:"./store/views/shipment/backroom-pick/common/shipment-in-batch/shipment-in-batch.tpl.html",controller:"store.views.shipment.backroom-pick.common.shipment-in-batch.shipment-in-batch",keyboard:true,backdrop:"static",size:"md",windowClass:"shipment-in-batch-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(t){t.registerModal("store.views.shipment.batchpick.batch-list.departments.batch-list-departments",{animation:true,templateUrl:"./store/views/shipment/batchpick/batch-list/departments/batch-list-departments.tpl.html",controller:"store.views.shipment.batchpick.batch-list.departments.batch-list-departments",keyboard:true,backdrop:"static",size:"md",windowClass:"batch-list-departments-dialog"})}]);
angular.module("store").config(["iscModalProvider",function(e){e.registerModal("store.views.shipment.batchpick.batch-list.pref.batch-list-preferences",{animation:true,templateUrl:"./store/views/shipment/batchpick/batch-list/pref/batch-list-preferences.tpl.html",controller:"store.views.shipment.batchpick.batch-list.pref.batch-list-preferences",keyboard:true,backdrop:"static",size:"md",windowClass:"batch-list-pref-dialog"})}]);
angular.module("store").controller("store.views.about.about",["$scope","$rootScope","$uibModalInstance","modalInput","iscScreen","iscMashup","iscResourcePermission",function(e,i,s,a,o,n,t){o.initializeScreen(e,{model:{versionDetails:{}},mashupRefs:[{mashupRefId:"getVersionManagerDetails",mashupId:"getVersionManagerDetailsForStore",modelName:"versionDetails"}],ui:{},uiClose:function(){s.dismiss("cancel")},initialize:function(){if(t.hasPermission("WSCSYS00001")){n.callMashup(this,"getVersionManagerDetails",{},{})}}})}]);
angular.module("store").controller("store.views.alerts.alerts-preview",["$animate","$scope","$rootScope","$timeout","iscScreen","iscWizard","$locale","iscStateParams","iscMashup","iscModal","iscResourcePermission","$filter","iscReturn","iscI18n","iscOrder","iscState","iscAppContext","$interval","iscShipment",function(t,i,o,e,s,n,a,l,r,c,u,h,p,x,S,m,I,f,d){n.initializeWizardPage(i,{model:{getHotPickList:{},getSlaList:{},getAlertStatisticsForUser:{}},mashupRefs:[{mashupRefId:"getExceptionList_ForHotPick",mashupId:"getExceptionList_ForHotPick",modelName:"getHotPickList"},{mashupRefId:"getExceptionList_ForNearSLA",mashupId:"getExceptionList_ForNearSLA",modelName:"getSlaList"},{mashupRefId:"resolveException_HotPick",mashupId:"resolveException_HotPick"},{mashupRefId:"resolveException_Sla",mashupId:"resolveException_Sla"},{mashupRefId:"getAlertStatistics",mashupId:"getAlertStatistics",modelName:"getAlertStatisticsForUser"},{mashupRefId:"resolveException",mashupId:"resolveException"},{mashupRefId:"getAlertStatistics",mashupId:"getAlertStatistics"}],ui:{showHotPickAlerts:false,showSlaAlerts:false,inboxCountHotPick:20,inboxCountSla:20},initialize:function(){var t={};t.getAlertStatisticsForUser={};r.callMashup(this,"getAlertStatistics",t,{});i.$watch("ui.showHotPickAlerts",function(t,e){if(t){i.uiGetHotPickList()}});i.$watch("ui.showSlaAlerts",function(t,e){if(t){i.uiGetSlaList()}});o.$on("uiAlertSearchClose",function(t,e){i.ui.showAlertSearch="N"})},uiGetHotPickList:function(){var t={};t.Inbox={};t.Inbox.ComplexQuery={};t.Inbox.ComplexQuery.Or={};r.callMashup(this,"getExceptionList_ForHotPick",t,{})},uiGetSlaList:function(){var t={};t.Inbox={};t.Inbox.ComplexQuery={};t.Inbox.ComplexQuery.Or={};r.callMashup(this,"getExceptionList_ForNearSLA",t,{})},uiGetOtherExceptions:function(t){var e={};e.Inbox={};e.Inbox.ExceptionType=t;r.callMashup(this,"getExceptionList_Generic",e,{})},uiInboxScrollActionValidator:function(){return true},uiGetInboxListNextForHotPick:function(){if(this.ui.inboxCountHotPick<=this.model.getHotPickList.InboxList.Inbox.length){this.ui.inboxCountHotPick+=5}},uiGetInboxListNextForSla:function(){if(this.ui.inboxCountSla<=this.model.getSlaList.InboxList.Inbox.length){this.ui.inboxCountSla+=5}},uiResolveHotPickException:function(t){var e={};e.ResolutionDetails={};e.ResolutionDetails.Inbox={};e.ResolutionDetails.Inbox.InboxKey=t.InboxKey;r.callMashup(this,"resolveException_HotPick",e,{}).then(this.handleResolutionForHotPickException.bind(this,t.ShipmentKey))},uiResolveSlaException:function(t){var e={};e.ResolutionDetails={};e.ResolutionDetails.Inbox={};e.ResolutionDetails.Inbox.InboxKey=t.InboxKey;r.callMashup(this,"resolveException_Sla",e,{}).then(this.handleResolutionForSlaException.bind(this,t.ShipmentKey))},handleResolutionForHotPickException:function(t,e){this.uiAlertSearchClose();m.goToState("backroomPickWizard",{input:{Shipment:{ShipmentKey:t}}},{});this.refreshCount()},handleResolutionForSlaException:function(t,e){this.uiAlertSearchClose();m.goToState("backroomPickWizard",{input:{Shipment:{ShipmentKey:t}}},{});this.refreshCount()},uiGetImageUrl:function(t){return d.getFullURLForImage(t)},uiAlertSearchClose:function(){i.$emit("uiAlertSearchClose",{})},refreshCount:function(){var t={};t.getAlertStatisticsForUser={};r.callMashup(this,"getAlertStatistics",t,{showMask:false}).then(this.handleGetExceptionList.bind(this))},handleGetExceptionList:function(t){var e=r.getMashupOutput(t,"getAlertStatistics");o.ui.alertCount=e.getAlertStatisticsForUser.TotalAlerts}})}]);
(function(e,v){"use strict";e.module("store").controller("store.views.application-layout.header",["$scope","$rootScope","iscScreen","iscState","iscMashup","iscResourcePermission","iscPersona","iscModal","iscI18n","iscRule","iscOrder","iscObjectUtility","iscAppInfo","$timeout","$document","iscHttpRequest","iscPortletShipment","iscAppContext",function(i,o,e,a,n,t,s,r,l,c,u,h,g,d,m,p,f,S){e.initializeScreen(i,{model:{inboxModel:{}},mashupRefs:[{mashupRefId:"getRuleDetails_AlertPollingInterval",mashupId:"getRuleDetails_AlertPollingInterval"},{mashupRefId:"getAlertStatistics",mashupId:"getAlertStatistics",modelName:"inboxModel"}],ui:{showGlobalSearch:"N",hideGlobalSearchAction:"N",isOpenMobileMenu:false,isOpenDesktopMenu:false,showAlertsIcon:true},uiShowAboutBox:function(){r.openModal("store.views.about.about",{},{})},uiShowOnlineHelp:function(){var e="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight;var t="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth;var i="width="+t+", height="+e;var o=i+",status=yes,toolbar=no,menubar=no,location=no,resizable=yes,scrollbars=yes";var a=g.getActiveHelpURL();var n=window.open(a,"Product_name",o);n.focus()},uiShowHome:function(){var e=s.getCurrentPersona();var t=a.currentState;if(!s.isOOTBPersona(e)&&s.getPersonaSwitchAction(e)!=null){var i=s.getPersonaSwitchAction(e);i(e)}else{if(e==="Manager_Dashboard"&&t!=null&&t.path!=="/manager-dashboard"){a.goToState("/manager-dashboard",{},{})}else if(e!=="Manager_Dashboard"){if(t!=null&&t.path==="/home"&&t.params!=null&&t.params.personaName===e){}else{a.goToState("/home",{personaName:e},{})}}}},uiDoSwitch:function(){var e=g.getAppDeviceMode();var t="";if(e==="mobile"){t=g.getApplicationContext()+"/store/mobile/container/home.do"}else{t=g.getApplicationContext()+"/store/container/home.do"}window.location.href=p.addAdditionalParamsInURL(t,"GET")},uiDoLogout:function(){var e=S.getFromContext("ibmID");if(!e){e=S.getFromContext("emailID")}var t=S.getFromContext("isProductionEnv");if(t&&(t==="Y"||t==="y")&&e){this.showNPSSurvey()}else{window.location.pathname=g.getApplicationContext()+"/ngstore/logout.do"}},showNPSSurvey:function(){var e={};var t=S.getFromContext("availablePersonas");if(t.length==1&&t[0].id==="Manager_Dashboard"){e["trigger3"]=false}else{e["trigger3"]=true}this.setParamsOnWindowObject(e);window.location.pathname=g.getApplicationContext()+"/ngstore/logout.do"},uiAlertClose:function(){o.ui.showAlertMessage=false},uiCloseGlobalSearch:function(e){i.$emit("uiSearchClose",{data:"close"});if(e!=null){e.preventDefault();e.stopPropagation()}},uiHandleGlobalSearchResult:function(e){var t="global-search";if(!v.isVoid(e)&&!v.isVoid(e.Mode)){t=e.Mode}if(t=="global-search"){o.$emit("uiSearchClose","close");if("orderList"==e.NextPage.action){a.goToState("order-list",{input:e.NextPage.model},{})}else if("orderDetails"==e.NextPage.action){if("0001"==e.NextPage.model.Order.DocumentType){u.viewOrderFromList(e.NextPage.model.Order,false)}else{a.goToState("order-list",{input:e.NextPage.model,callAPI:"N"},{})}}else if("customerList"==e.NextPage.action){a.goToState("customer-list",{input:e.NextPage.model},{})}else if("customerDetails"==e.NextPage.action){a.goToState("customer-details",{input:e.NextPage.model},{})}else if("shipmentList"==e.NextPage.action){if("basicSearch"==e.NextPage.type){f.handleShipmentOrderBarcodeTranslation(e.NextPage.model,"shipmentsummary")}else if("advancedSearch"==e.NextPage.type){a.goToState("globalshipmentsearch",{input:e.NextPage.model,ignoreDocumentType:e.NextPage.ignoreDocumentType},{})}}}},uiToggle:function(){this.uiCloseGlobalSearch();this.uiCloseAlertSearch()},initialize:function(){if(!t.hasPermission("WSC000036")&&!t.hasPermission("WSC000031")&&!t.hasPermission("WSC000037")){this.ui.hideGlobalSearchAction="Y"}o.$emit("$stateChangeStart");m.bind("touchend",function(e){m.triggerHandler("click",[e])});o.$on("uiSearchClose",function(e,t){if(t){i.ui.showGlobalSearch="N"}});o.$on("uiAlertSearchClose",function(e,t){i.ui.showAlertSearch="N"});var e={};e.Rules={};n.callMashup(this,"getRuleDetails_AlertPollingInterval",e,{}).then(this.handleResults.bind(this))},handleResults:function(e){var t=6e4;var i=n.getMashupOutput(e,"getRuleDetails_AlertPollingInterval");var o=i.Rules;var a=o.RuleSetValue;this._startPolling(a,t)},_startPolling:function(e,t){var i=this;var o=function(){var e={};e.getAlertStatisticsForUser={};n.callMashup(i,"getAlertStatistics",e,{showMask:false}).then(i.handleGetExceptionList.bind(i))};o();setInterval(o,e||t)},handleGetExceptionList:function(e){var t=n.getMashupOutput(e,"getAlertStatistics");o.ui.alertCount=t.getAlertStatisticsForUser.TotalAlerts},uiHandleToggleAlertSearch:function(){if(this.ui.showAlertSearch==="Y"){this.ui.showAlertSearch="N"}else{this.ui.showAlertSearch="Y";var e={};e.getAlertStatisticsForUser={};n.callMashup(this,"getAlertStatistics",e,{showMask:false}).then(this.handleGetExceptionList.bind(this))}},uiCloseAlertSearch:function(){this.ui.showAlertSearch="N"},setParamsOnWindowObject:function(e){var t=S.getFromContext("ibmID");if(!t){t=S.getFromContext("emailID")}var i=iscData.userInfo;var o={};o["FirstName"]=S.getFromContext("firstName");o["LastName"]=S.getFromContext("lastName");o["EmailID"]=t;o["TenantName"]=S.getFromContext("tenantName");o["icn"]=S.getFromContext("customerICN");var a=JSON.stringify(g.getIBMMetaObject(i,o,e));localStorage.setItem("IBM_Meta",a)}})}])})(window.angular,window.iscCore);
angular.module("store").controller("store.views.home.customer-lookup-portlet-mini",["$scope","iscScreen",function(e,i){i.initializeScreen(e,{model:{},mashupRefs:[],ui:{},initialize:function(){}})}]);
angular.module("store").controller("store.views.home.customer-lookup-portlet",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscAppContext","$timeout","iscDomUtility",function(e,t,r,s,i,u,o,a,m){t.initializeScreen(e,{model:{},mashupRefs:[{mashupRefId:"findCustomerProfileBySearchCriteria",mashupId:"store.views.home.findCustomerProfileBySearchCriteria"}],ui:{showAdvanceSearch:false,setFocus:false,lookupType:""},initialize:function(){var s=this;e.$watch("ui.CustomerPaymentMethod.DisplayCreditCardNo",function(e,t){var o=/^\d+$/;if(!iscCore.isVoid(e)&&(e.length>4||!o.test(e))){s.ui.CustomerPaymentMethod.DisplayCreditCardNo=t}});e.$watch("ui.showAdvanceSearch",function(e,t){if(e){m.setFocus(document.getElementById("lookupCustomerfirstName"))}})},uiFindCustomers:function(){if(!iscCore.isVoid(this.model.lookupValue)){var e={Customer:{CustomerContactList:{CustomerContact:{ComplexQuery:{Or:{Exp:[]}}}}}};if(this.model.lookupValue.indexOf("@")>-1){this.ui.lookupType="EMAILID";var t={Name:"EmailID",QryType:"EQ",Value:this.model.lookupValue};e.Customer.CustomerContactList.CustomerContact.ComplexQuery.Or.Exp.push(t)}else{this.ui.lookupType="PHONE_NUMBER";var o={Name:"DayPhone",QryType:"EQ",Value:this.model.lookupValue};e.Customer.CustomerContactList.CustomerContact.ComplexQuery.Or.Exp.push(o)}u.callMashup(this,"findCustomerProfileBySearchCriteria",e,{}).then(this.processCustomerProfileSearchResult.bind(this,e),angular.noop)}else{s.showErrorMessage(i.translate("customerprofile.MSG_InvalidCustomerSearchData"))}},uiFindCustomerBySearchCriteria:function(){this.ui.lookupType="ADV_SEARCH";var e={Customer:{CustomerContactList:{CustomerContact:{}}}};if(this.ui.search&&this.ui.search.CustomerContactList){e.Customer.CustomerContactList.CustomerContact=this.ui.search.CustomerContactList.CustomerContact}if(this.ui.CustomerPaymentMethod&&this.ui.CustomerPaymentMethod.DisplayCreditCardNo){e.Customer.CustomerPaymentMethodList={CustomerPaymentMethod:this.ui.CustomerPaymentMethod}}u.callMashup(this,"findCustomerProfileBySearchCriteria",e,{}).then(this.processCustomerProfileSearchResult.bind(this,e),angular.noop)},processCustomerProfileSearchResult:function(e,t){var o=u.getMashupOutput(t,"findCustomerProfileBySearchCriteria");var s="",i={};console.log("Customer Profiles Output : ",o);if(o.CustomerList.TotalNumberOfRecords==="1"){i={Customer:o.CustomerList.Customer[0]};s="customerdetails"}else{i.getCustomerListInput={Customer:{CustomerContactList:{CustomerContact:{}}}};i.lookupType=this.ui.lookupType;i.getCustomerListInput=e;s="customerlist"}if(s=="customerdetails"){r.goToState("customerprofilewizard",{action:s,input:i},{})}else if(s=="customerlist"){r.goToState("customerProfileList",{input:i},{})}this.model.lookupValue=""},uiCloseAdvanceSearch:function(){this.ui.showAdvanceSearch=false;a(function(){document.getElementById("lookupCustomerAdvanceSearchLink").focus()},500)}})}]);
angular.module("store").controller("store.views.home.find-products-portlet-mini",["$scope","iscScreen",function(e,i){i.initializeScreen(e,{model:{},mashupRefs:[],ui:{},initialize:function(){}})}]);
angular.module("store").controller("store.views.home.find-products-portlet",["$scope","iscScreen","iscState","iscModal","iscI18n","$interval","$rootScope",function(e,o,t,r,d,i,c){o.initializeScreen(e,{model:{addProductInput:{}},uiOpenAddItems:function(e){if(!iscCore.isVoid(this.model.addProductInput.value)){t.goToState("ordercapture",{action:e,input:this.model.addProductInput.value},{})}else{r.showErrorMessage(d.translate("addItems.MSG_ProductSearchError"))}}})}]);
angular.module("store").controller("store.views.home.in-store-appointment-portlet-mini",["$scope","iscScreen","iscMashup","iscInStoreAppointment",function(e,t,n,o){t.initializeScreen(e,{model:{},mashupRefs:[{mashupRefId:"getStoreOpenAppointmentCountForToday",mashupId:"store.views.home.getStoreOpenAppointmentCount"}],ui:{isMashupCallInProgress:true,displayCount:0},initialize:function(){n.callMashup(this,"getStoreOpenAppointmentCountForToday",{WorkOrderAppointment:{StoreTimezoneOffset:o.getCurrentStoreTimezoneOffset()}},{showMask:false}).then(this.handleInitAPIs.bind(this),angular.noop)},handleInitAPIs:function(e){var t=n.getMashupOutput(e,"getStoreOpenAppointmentCountForToday");this.ui.displayCount=Number(t.WorkOrderAppointments.TotalNumberOfRecords);this.ui.isMashupCallInProgress=false}})}]);
angular.module("store").controller("store.views.home.in-store-appointment-portlet",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","$filter","iscInStoreAppointment","iscAppContext","$timeout","iscResourcePermission","iscDomUtility",function(e,r,p,o,n,u,i,m,t,s,a,d){r.initializeScreen(e,{model:{upcomingAppointmentDetails:{},lookupReferenceNo:"",customerSearchCriteria:{}},mashupRefs:[{mashupRefId:"getStoreOpenAppointmentCountForToday",mashupId:"store.views.home.getStoreOpenAppointmentCount"},{mashupRefId:"getUpcomingStoreAppointmentDetailsByCurrentTime",mashupId:"store.views.home.getUpcomingStoreAppointmentDetailsByCurrentTime"},{mashupRefId:"searchWorkOrderByWorkOrderNumber",mashupId:"store.views.home.searchWorkOrderByWorkOrderNumber"},{mashupRefId:"translateBarCodeForWorkOrder",mashupId:"store.views.home.translateBarCodeForWorkOrder"},{mashupRefId:"findAppointmentsByCustomerDetails",mashupId:"store.views.home.findAppointmentsByCustomerDetails"}],ui:{showAdvanceSearch:false,setFocus:false,storeAppointmentCount:0,upcomingAppntCount:0,hasPermissionToCreateAppnt:a.hasPermission("WSC000074")},initialize:function(){this.invokeInitAPIs();this.initializeWatchers()},invokeInitAPIs:function(){var e=[];var r={WorkOrderAppointment:{}};e.push(u.getMashupRefObj(this,"getStoreOpenAppointmentCountForToday",r));e.push(u.getMashupRefObj(this,"getUpcomingStoreAppointmentDetailsByCurrentTime",r));u.callMashups(this,e,{}).then(this.handleInitAPIs.bind(this),angular.noop)},initializeWatchers:function(){e.$watch("ui.showAdvanceSearch",function(e,r){if(e){d.setFocus(document.getElementById("lookupCustomerfirstName"))}})},handleInitAPIs:function(e){var r=u.getMashupOutput(e,"getStoreOpenAppointmentCountForToday");var t=u.getMashupOutput(e,"getUpcomingStoreAppointmentDetailsByCurrentTime");console.log("storeAppointmentList - ",r);console.log("storeAppointmentDetails - ",t);this.ui.storeAppointmentCount=Number(r.WorkOrderAppointments.TotalNumberOfRecords);this.ui.upcomingAppntCount=Number(t.WorkOrderAppointments.TotalNumberOfRecords);if(this.ui.upcomingAppntCount>0){this.model.upcomingAppointmentDetails={WorkOrderAppointment:t.WorkOrderAppointments.WorkOrderAppointment[0]}}},uiOpenCreateAppointmentWizard:function(){m.openCreateAppointmentWizard({})},uiShowStoreAppointmentView:function(){m.viewStoreApppointmentCalendar()},uiGetServiceDesription:function(){return m.getServiceDescriptionForAppointment(this.model.upcomingAppointmentDetails)},uiGetCustomerName:function(){return m.getCustomerDisplayNameForAppointment(this.model.upcomingAppointmentDetails)},uiViewAppointmentSummary:function(){var e=this.model.upcomingAppointmentDetails.WorkOrderAppointment.WorkOrder;var r={Order:{OrderHeaderKey:e.OrderHeaderKey,WorkOrderKey:e.WorkOrderKey}};m.openAppointmentSummary(r)},uiLookupReferenceNo:function(e){if(!iscCore.isVoid(this.model.lookupReferenceNo)){if(e=="SCAN"){var r={BarCode:{BarCodeData:this.model.lookupReferenceNo}};u.callMashup(this,"translateBarCodeForWorkOrder",r,{}).then(this.processBarCodeTranslation.bind(this),angular.noop)}else{var t={WorkOrder:{WorkOrderNo:this.model.lookupReferenceNo}};u.callMashup(this,"searchWorkOrderByWorkOrderNumber",t,{}).then(this.processBarCodeSearch.bind(this),angular.noop)}this.model.lookupReferenceNo=""}else{o.showErrorMessage(n.translate("instoreappointment.MSG_InvalidBarCodeData"))}},processBarCodeTranslation:function(e){var r=0,t={};var o=u.getMashupOutput(e,"translateBarCodeForWorkOrder");if(!iscCore.isVoid(o)&&!iscCore.isVoid(o.BarCode.Translations)&&!iscCore.isVoid(o.BarCode.Translations.TotalNumberOfRecords)){r=i("number")(o.BarCode.Translations.TotalNumberOfRecords);if(r==1&&o.BarCode.Translations.Translation[0].WorkOrderContextualInfo){var n=o.BarCode.Translations.Translation[0].WorkOrderContextualInfo;if(n&&n.IsSystemCancelledWorkOrder==="Y"){r=0}else{t={Order:{OrderHeaderKey:o.BarCode.Translations.Translation[0].WorkOrderContextualInfo.OrderHeaderKey,WorkOrderKey:o.BarCode.Translations.Translation[0].WorkOrderContextualInfo.WorkOrderKey}}}}}this.handleFinalOutput(r,t)},processBarCodeSearch:function(e){var r=0,t={};var o=u.getMashupOutput(e,"searchWorkOrderByWorkOrderNumber");if(!iscCore.isVoid(o)&&!iscCore.isVoid(o.WorkOrders)&&!iscCore.isVoid(o.WorkOrders.TotalNumberOfRecords)){r=i("number")(o.WorkOrders.TotalNumberOfRecords);if(r==1&&o.WorkOrders.WorkOrder[0]){var n=o.WorkOrders.WorkOrder[0];if(m.isSystemCancelledWorkOrder(n)){r=0}else{t={Order:{OrderHeaderKey:o.WorkOrders.WorkOrder[0].OrderHeaderKey,WorkOrderKey:o.WorkOrders.WorkOrder[0].WorkOrderKey}}}}}this.handleFinalOutput(r,t)},handleFinalOutput:function(e,r){if(e==0){o.showErrorMessage(n.translate("instoreappointment.MSG_NoWorkOrderFound"))}else{m.openAppointmentSummary(r)}},uiFindAppointmentsByCustomerDetails:function(){var e={Customer:{CustomerContactList:{CustomerContact:this.model.customerSearchCriteria}}};u.callMashup(this,"findAppointmentsByCustomerDetails",e,{}).then(this.processCustomerList.bind(this),angular.noop)},processCustomerList:function(e){var r=u.getMashupOutput(e,"findAppointmentsByCustomerDetails");var t=Number(r.CustomerList.TotalNumberOfRecords);if(t==1){var o=Number(r.CustomerList.OpenAppointmentCount);if(o==1){var n={Order:{OrderHeaderKey:r.CustomerList.WorkOrder.OrderHeaderKey}};m.openAppointmentSummary(n)}else{var i={Customer:{CustomerID:r.CustomerList.Customer[0].CustomerID,CustomerKey:r.CustomerList.Customer[0].CustomerKey}};var s={Status:"OPEN"};m.openAppointmentList(i,s)}}else{var a={Customer:{CustomerContactList:{CustomerContact:this.model.customerSearchCriteria}}};p.goToState("customer-list",{input:a,callApi:true,context:"APPOINTMENT"},{})}this.model.customerSearchCriteria=""},uiCloseAdvanceSearch:function(){this.ui.showAdvanceSearch=false;s(function(){document.getElementById("lookupRefNoAdvanceSearchLink").focus()},500)}})}]);
angular.module("store").controller("store.views.home.instore-receiving-portlet-mini",["$scope","iscScreen","iscMashup",function(e,i,n){i.initializeScreen(e,{model:{},mashupRefs:[{mashupRefId:"getIncomingReceivingShipmentsCount",mashupId:"store.views.home.getIncomingReceivingShipmentsCount"},{mashupRefId:"getDelayedReceivingShipmentsCount",mashupId:"store.views.home.getDelayedReceivingShipmentsCount"},{mashupRefId:"getReceiviedShipmentsCount",mashupId:"store.views.home.getReceiviedShipmentsCount"}],ui:{isMashupCallInProgress:true,incomingCount:0,delayedCount:0,receivedCount:0,displayCount:0},initialize:function(){var e=[];e.push(n.getMashupRefObj(this,"getIncomingReceivingShipmentsCount",{Shipment:{FromExpectedDeliveryDate:"",ToExpectedDeliveryDate:""}}));e.push(n.getMashupRefObj(this,"getDelayedReceivingShipmentsCount",{Shipment:{ExpectedDeliveryDate:""}}));e.push(n.getMashupRefObj(this,"getReceiviedShipmentsCount",{Receipt:{FromReceiptDate:"",ToReceiptDate:""}}));n.callMashups(this,e,{showMask:false}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){var i=n.getMashupOutput(e,"getIncomingReceivingShipmentsCount");var t=n.getMashupOutput(e,"getDelayedReceivingShipmentsCount");var s=n.getMashupOutput(e,"getReceiviedShipmentsCount");if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.Shipments)&&!iscCore.isVoid(i.Shipments.TotalNumberOfRecords)){this.ui.incomingCount=Number(i.Shipments.TotalNumberOfRecords)}if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.Shipments)&&!iscCore.isVoid(t.Shipments.TotalNumberOfRecords)){this.ui.delayedCount=Number(t.Shipments.TotalNumberOfRecords)}if(!iscCore.isVoid(s)&&!iscCore.isVoid(s.ReceiptList)&&!iscCore.isVoid(s.ReceiptList.TotalNumberOfRecords)){this.ui.receivedCount=Number(s.ReceiptList.TotalNumberOfRecords)}this.ui.displayCount=this.ui.incomingCount+this.ui.delayedCount+this.ui.receivedCount;this.ui.isMashupCallInProgress=false}})}]);
angular.module("store").controller("store.views.home.instore-receiving-portlet",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscAppContext","$filter","$timeout","iscDomUtility","iscPersona",function(e,i,n,r,h,c,t,p,s,o,a){i.initializeScreen(e,{model:{receivingShipmentCount:{IncomingCount:"0",DelayedCount:"0",ReceivedCount:"0",TotalCount:"0"},scanInput:{}},mashupRefs:[{mashupRefId:"getIncomingReceivingShipmentsCount",mashupId:"store.views.home.getIncomingReceivingShipmentsCount"},{mashupRefId:"getDelayedReceivingShipmentsCount",mashupId:"store.views.home.getDelayedReceivingShipmentsCount"},{mashupRefId:"getReceiviedShipmentsCount",mashupId:"store.views.home.getReceiviedShipmentsCount"},{mashupRefId:"getShipmentListForReceiving",mashupId:"store.views.receiving.getShipmentListForReceiving"},{mashupRefId:"translateBarCodeForShipmentReceiving",mashupId:"store.views.home.translateBarCodeForShipmentReceiving"}],ui:{showAdvanceSearch:false,new_usePersonaBasedHomepage:false},initialize:function(){var e=[];this.ui.new_usePersonaBasedHomepage=a.getUsePersonaBasedHomepageFlagValue();e.push(c.getMashupRefObj(this,"getIncomingReceivingShipmentsCount",{Shipment:{FromExpectedDeliveryDate:"",ToExpectedDeliveryDate:""}}));e.push(c.getMashupRefObj(this,"getDelayedReceivingShipmentsCount",{Shipment:{ExpectedDeliveryDate:""}}));e.push(c.getMashupRefObj(this,"getReceiviedShipmentsCount",{Receipt:{FromReceiptDate:"",ToReceiptDate:""}}));c.callMashups(this,e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){var i=c.getMashupOutput(e,"getIncomingReceivingShipmentsCount");var t=c.getMashupOutput(e,"getDelayedReceivingShipmentsCount");var n=c.getMashupOutput(e,"getReceiviedShipmentsCount");var s=Number(0);if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.Shipments)&&!iscCore.isVoid(i.Shipments.TotalNumberOfRecords)){this.model.receivingShipmentCount.IncomingCount=p("number")(i.Shipments.TotalNumberOfRecords);s+=Number(i.Shipments.TotalNumberOfRecords)}if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.Shipments)&&!iscCore.isVoid(t.Shipments.TotalNumberOfRecords)){this.model.receivingShipmentCount.DelayedCount=p("number")(t.Shipments.TotalNumberOfRecords);s+=Number(t.Shipments.TotalNumberOfRecords)}if(!iscCore.isVoid(n)&&!iscCore.isVoid(n.ReceiptList)&&!iscCore.isVoid(n.ReceiptList.TotalNumberOfRecords)){this.model.receivingShipmentCount.ReceivedCount=p("number")(n.ReceiptList.TotalNumberOfRecords);s+=Number(n.ReceiptList.TotalNumberOfRecords)}this.model.receivingShipmentCount.TotalCount=p("number")(s);console.log("this.receivingShipmentCount : ",this.model.receivingShipmentCount)},uiScanBarCodeData:function(){if(!iscCore.isVoid(this.model.scanInput.value)){var e={BarCode:{BarCodeData:this.model.scanInput.value}};c.callMashup(this,"translateBarCodeForShipmentReceiving",e,{}).then(this.processBarCodeTranslation.bind(this),angular.noop);this.model.scanInput.value=""}else{r.showErrorMessage(h.translate("instorereceiving.MSG_InvalidBarCodeData"))}},processBarCodeTranslation:function(e){var i=0,t="",n="",s=0;var o=c.getMashupOutput(e,"translateBarCodeForShipmentReceiving");if(!iscCore.isVoid(o)&&!iscCore.isVoid(o.BarCode.Shipments)&&!iscCore.isVoid(o.BarCode.Shipments.TotalNumberOfRecords)){n=o.BarCode.BarCodeTranslatedEntity;barCodeTranslatedValue=o.BarCode.BarCodeTranslatedValue;i=p("number")(o.BarCode.Shipments.TotalNumberOfRecords);t={Shipments:o.BarCode.Shipments}}var a={AutoReceiveEntity:n,TranslatedEntityValue:barCodeTranslatedValue};if("PRODUCT"==n){a.AutoReceiveProductQuantity=o.BarCode.ProductQuantityToReceive}if("0"==i){r.showErrorMessage(h.translate("instorereceiving.MSG_ShipmentNotFound"))}else if("1"==i){this.openReceiveShipmentWizard(t.Shipments.Shipment[0],a)}else{this.openMultipleReceivingShipmentsModal(t,a)}},uiOpenAdvanceSearch:function(){this.ui.showAdvanceSearch=true;o.setFocus(document.getElementById("packageId"))},uiAdvanceClose:function(){this.ui.showAdvanceSearch=false;s(function(){document.getElementById("advanceSearchLink").focus()},500)},uiAdvanceSearch:function(){if(!this.validateSearchInput()){r.showErrorMessage(h.translate("instorereceiving.MSG_AdvanceSearchBlankCriteria"))}else{c.callMashup(this,"getShipmentListForReceiving",this.getAdvanceSearchInput(),{}).then(this.processAdvanceSearchResults.bind(this),angular.noop)}},validateSearchInput:function(){var e=true;if(iscCore.isVoid(this.ui.search)){e=false}else if(!iscCore.isVoid(this.ui.search)&&iscCore.isVoid(this.ui.search.PackageId)&&iscCore.isVoid(this.ui.search.ShipmentNo)&&iscCore.isVoid(this.ui.search.OrderNo)&&iscCore.isVoid(this.ui.search.ProductCode)&&iscCore.isVoid(this.ui.search.POTONo)){e=false}return e},processAdvanceSearchResults:function(e){var i=0,t="";var n=c.getMashupOutput(e,"getShipmentListForReceiving");if(!iscCore.isVoid(n)&&!iscCore.isVoid(n.Shipments)&&!iscCore.isVoid(n.Shipments.TotalNumberOfRecords)){i=p("number")(n.Shipments.TotalNumberOfRecords);t={Shipments:n.Shipments}}if("0"==i){r.showErrorMessage(h.translate("instorereceiving.MSG_ShipmentNotFound"))}else if("1"==i){this.openReceiveShipmentWizard(t.Shipments.Shipment[0],"")}else{this.openMultipleReceivingShipmentsModal(t,"")}},openMultipleReceivingShipmentsModal:function(e,i){var t=this;var n={};n.shipmentList=e;if(i){n.entity=i.AutoReceiveEntity}else{n.entity=""}var s={modalInput:function(){return n}};r.openModal("store.views.receiving.receive-shipment.common.multiple-shipments.multiple-receiving-shipments",s,{}).then(function(e){if(e.data!==null&&e.data!==undefined){t.openReceiveShipmentWizard(e.data,i)}},angular.noop)},uiHandleSearchResult:function(e){console.log("searchResult is:",e);n.goToState("receive-shipment",{action:e.action,input:e.model},{})},openReceiveShipmentWizard:function(e,i){var t={Shipment:{ShipmentKey:e.ShipmentKey,ShipmentContainerizedFlag:e.ShipmentContainerizedFlag}};n.goToState("receive-shipment",{action:"receiveShipment",input:t,autoReceive:i},{})},getAdvanceSearchInput:function(){var e={Shipment:{}};if(!iscCore.isVoid(this.ui.search.PackageId)){if(!e.Shipment.Containers){e.Shipment.Containers={};e.Shipment.Containers.Container={}}e.Shipment.Containers.Container.ContainerScm=this.ui.search.PackageId;e.Shipment.Containers.Container.ContainerType="Case"}if(!iscCore.isVoid(this.ui.search.ShipmentNo)){e.Shipment.ShipmentNo=this.ui.search.ShipmentNo}if(!iscCore.isVoid(this.ui.search.OrderNo)){if(!e.Shipment.ShipmentLines){e.Shipment.ShipmentLines={};e.Shipment.ShipmentLines.ShipmentLine={}}e.Shipment.ShipmentLines.ShipmentLine.OrderLine={ChainedFromOrder:{OrderNo:this.ui.search.OrderNo}}}if(!iscCore.isVoid(this.ui.search.ProductCode)){if(!e.Shipment.ShipmentLines){e.Shipment.ShipmentLines={};e.Shipment.ShipmentLines.ShipmentLine={}}e.Shipment.ShipmentLines.ShipmentLine.ItemID=this.ui.search.ProductCode}if(!iscCore.isVoid(this.ui.search.POTONo)){if(!e.Shipment.ShipmentLines){e.Shipment.ShipmentLines={};e.Shipment.ShipmentLines.ShipmentLine={}}e.Shipment.ShipmentLines.ShipmentLine.OrderNo=this.ui.search.POTONo}return e},uiOpenInboundShipmentList:function(e){if(e!=null){n.goToState("receivingShipmentList",{defaultTab:e.toLowerCase()},{})}}})}]);
angular.module("store").controller("store.views.home.quick-checkout-portlet-mini",["$scope","iscScreen",function(e,i){i.initializeScreen(e,{model:{},mashupRefs:[],ui:{},initialize:function(){}})}]);
angular.module("store").controller("store.views.home.quick-checkout-portlet",["$scope","iscScreen","iscState","iscModal","iscI18n","iscAppContext","iscMashup",function(e,t,o,i,u,a,r){t.initializeScreen(e,{model:{quickCheckoutProductInput:{}},mashupRefs:[{mashupRefId:"quickCheckOut_getCompleteItemList",mashupId:"quickCheckOut_getCompleteItemList"}],uiCheckout:function(e){if(!iscCore.isVoid(this.model.quickCheckoutProductInput.value)){this.getCompleteItemDetails(this.model.quickCheckoutProductInput.value)}else{i.showErrorMessage(u.translate("viewcartdetails.MSG_InvalidBarCodeData"))}},getCompleteItemDetails:function(e){var t=this.getCompleteItemDetailsApiInput(e,true);r.callMashup(this,"quickCheckOut_getCompleteItemList",t,{}).then(this.handleBarcodeTransaltion.bind(this),angular.noop)},getCompleteItemDetailsApiInput:function(e,t){var o={};o.Item={};o.Item.ItemID=e;if(t){o.Item.BarCode={};o.Item.BarCode.BarCodeData=e}o.Item.EntryType=a.getFromContext("storeEntryType");return o},handleBarcodeTransaltion:function(e){var t=r.getMashupOutput(e,"quickCheckOut_getCompleteItemList");if(t.Order.OrderHeaderKey!==null){o.goToState("ordercapture",{action:"QUICKCHECKOUT",orderModel:t},{})}else{}this.model.quickCheckoutProductInput={}}})}]);
angular.module("store").controller("store.views.home.returns-portlet-mini",["$scope","iscScreen",function(e,i){i.initializeScreen(e,{model:{},mashupRefs:[],ui:{},initialize:function(){}})}]);
angular.module("store").controller("store.views.home.returns-portlet",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscAppContext",function(o,e,n,a,t,c,i){e.initializeScreen(o,{model:{},mashupRefs:[{mashupRefId:"advanceSearch_getCustomerListPaginated",mashupId:"returnLookup_getCustomerListPaginated",modelName:"getCustomerListPaginated"}],uiHandleSearchResult:function(e){console.log("searchResult is:",e);n.goToState("returnorder",{action:e.NextPage.action,input:e.NextPage.model,callAPI:e.NextPage.callAPI},{})},ui:{AdanceCustomerSearchShown:false,AdanceSearchShown:false},uiIsAdvanceSearchShown:function(){if(this.ui.AdvanceCustomerSearchShown===true||this.ui.AdvanceSearchShown===true){return true}else return false},initialize:function(){o.lookupSelection="ORDER";o.ui.AdvanceCustomerSearchShown=false;o.ui.AdvanceSearchShown=false;o.$on("AdvanceCustomerSelection",function(e,n){if(n){o.lookupSelection=n.data;o.ui.AdvanceCustomerSearchShown=true}});o.$on("AdvanceCustomerSelectionhide",function(e,n){if(n){o.lookupSelection=n.data;o.ui.AdvanceCustomerSearchShown=false}});o.$on("AdvanceSearchSelection",function(e,n){if(n){o.lookupSelection=n.data;o.ui.AdvanceSearchShown=true}});o.$on("AdvanceSearchSelectionhide",function(e,n){if(n){o.lookupSelection=n.data;o.ui.AdvanceSearchShown=false}})}})}]);
angular.module("store").controller("store.views.home.store-home-footer",["$scope","$rootScope","iscScreen","iscAppInfo","iscState","iscStateParams","iscResourcePermission","iscMashup","iscHttpRequest","iscPersona","iscPortletService","iscAppContext",function(e,t,o,l,a,i,r,s,n,c,m,d){o.initializeScreen(e,{model:{},mashupRefs:[{mashupRefId:"updateUserPersonaUserUiState",mashupId:"store.views.home.home-footer.updateUserPersona"}],ui:{availableActions:[]},hasPermissionToAtleastOneResource:function(e,o){var t=c.getAllPersonaToResourceIdListForVisiblePortlets();var a=t[e];var i=t["_oldSpec"];var s=false;if(a!=null){s=r.hasPermissionToOneOfTheResources(a)}if(s===false&&o===true&&!iscCore.isVoid(i)){s=r.hasPermissionToOneOfTheResources(i)}return s},initialize:function(){var e=c.getCurrentPersona();if(c.isSpecialPersona(e)){m.getAllVisibleSortedPortletsForPersonaAndExtraProcessing(e)}var o=c.getPersonaList();for(var t=0;t<o.length;t++){var a=o[t];if(e!==a["CodeName"]&&!iscCore.isVoid(a["CodeName"])){var i=false;if(c.isSpecialPersona(a["CodeName"])){i=this.hasPermissionToAtleastOneResource(a["CodeName"],false)}else{i=this.hasPermissionToAtleastOneResource(a["CodeName"],true)}if(i===true){this.ui.availableActions.push({id:a["CodeName"],name:"home.TOOLTIP_"+a["CodeName"]})}}}d.addToContext("availablePersonas",this.ui.availableActions);if(localStorage.hasOwnProperty("IBM_Meta")){localStorage.removeItem("IBM_Meta")}var s=l.isNPSScriptsLoaded();var r=d.getFromContext("isProductionEnv");var n=d.getFromContext("ibmID");if(!n){n=d.getFromContext("emailID")}if(r&&(r==="Y"||r==="y")&&n&&!s){this.showNPSSurvey();l.setNPSScriptsLoaded(true)}},showNPSSurvey:function(){var e={};var o=d.getFromContext("availablePersonas");if(o.length==1&&o[0].id==="Manager_Dashboard"){e["trigger1"]=false}else{e["trigger1"]=true}this.setWindowParams(e);if(typeof KAMPYLE_ONSITE_SDK!=="undefined"&&typeof KAMPYLE_ONSITE_SDK.updatePageView==="function"){KAMPYLE_ONSITE_SDK.updatePageView()}else{var t=document.createElement("script");t.src="https://nebula-cdn.kampyle.com/we/28600/onsite/embed.js";document.getElementsByTagName("head")[0].appendChild(t)}},setWindowParams:function(e){var o=d.getFromContext("ibmID");if(!o){o=d.getFromContext("emailID")}var t=iscData.userInfo;var a={};a["FirstName"]=d.getFromContext("firstName");a["LastName"]=d.getFromContext("lastName");a["EmailID"]=o;a["TenantName"]=d.getFromContext("tenantName");a["icn"]=d.getFromContext("customerICN");var i=l.getIBMMetaObject(t,a,e);window.IBM_Meta=i},uiOpenSiteMap:function(){a.goToState("sitemap",{},{})},uiPerformAction:function(e){c.updateCurrentPersona(e.id);var o={UserUiState:{Definition:e.id}};if(!c.isOOTBPersona(e.id)&&c.getPersonaSwitchAction(e.id)!=null){var t=c.getPersonaSwitchAction(e.id);t(e.id)}else{if(e.id==="Dojo_Order_Fulfill"){this.uiGoToDojoBackRoomPickup()}else if(e.id==="Manager_Dashboard"){s.callMashup(this,"updateUserPersonaUserUiState",o,{showMask:false});a.goToState("/manager-dashboard",{},{})}else{s.callMashup(this,"updateUserPersonaUserUiState",o,{showMask:false});a.goToState("/home",{personaName:e.id},{forceRefresh:true})}}},uiGoToDojoBackRoomPickup:function(){window.onbeforeunload=null;t.activeCalls++;var e=l.getAppDeviceMode();var o="";if(e==="mobile"){o=l.getApplicationContext()+"/store/mobile/container/home.do"}else{o=l.getApplicationContext()+"/store/container/home.do"}window.location.href=n.addAdditionalParamsInURL(o,"GET")}})}]);
angular.module("store").controller("store.views.home.store-home",["$scope","$rootScope","iscScreen","iscAppInfo","iscState","iscHttpRequest","iscResourcePermission","iscAppContext","iscPortletPvdr","iscStateParams","iscPersona","iscPortletService",function(i,o,e,s,t,a,n,r,l,P,d,c){e.initializeScreen(i,{model:{},mashupRefs:[],ui:{activePortlet:0,allVisibleSortedPortlets:null,hasMgrDashboardPermission:n.hasPermission("WSC000038")||n.hasPermission("WSC000039"),availableActions:[{id:"orderFulfillmentView",name:"home.TOOLTIP_SwitchView"},{id:"managerDashboardView",name:"home.TOOLTIP_ManagerDashboard"}],new_activePortlet:0,new_allVisibleSortedPortlets:null,new_usePersonaBasedHomepage:false,new_allVisibleSortedPortlets_isCountZero:false},initialize:function(){if(d.getUsePersonaBasedHomepageFlagValue()!==true){r.removeFromContext("inStoreReceiving_shipmentListConfigData");i.$on("$beforeStateChange",function(e,t){r.addToContext("HOME_PAGE_ACTIVE_PORTLET",this.ui.activePortlet)}.bind(this));var e=r.getFromContext("HOME_PAGE_ACTIVE_PORTLET");if(!iscCore.isVoid(e)){this.ui.activePortlet=e}this.ui.allVisibleSortedPortlets=l.getAllVisibleSortedPortlets()}else{this.new_personaBasedInitialize()}},uiGoToBackRoomPickup:function(){window.onbeforeunload=null;o.activeCalls++;var e=s.getAppDeviceMode();var t="";if(e==="mobile"){t=s.getApplicationContext()+"/store/mobile/container/home.do"}else{t=s.getApplicationContext()+"/store/container/home.do"}window.location.href=a.addAdditionalParamsInURL(t,"GET")},uiOpenSiteMap:function(){t.goToState("sitemap",{},{})},uiPerformAction:function(e){if(e.id==="orderFulfillmentView"){this.uiGoToBackRoomPickup()}else{t.goToState("/manager-dashboard",{},{})}},new_personaBasedInitialize:function(){r.removeFromContext("inStoreReceiving_shipmentListConfigData");this.ui.new_usePersonaBasedHomepage=true;i.$on("$beforeStateChange",function(e,t){if(t!=null&&t.state!=="/home"&&t.state!=="/manager-dashboard"){r.addToContext("HOME_PAGE_ACTIVE_PORTLET_PERSONA_SCOPE",this.ui.new_activePortlet)}else{r.addToContext("HOME_PAGE_ACTIVE_PORTLET_PERSONA_SCOPE",0)}}.bind(this));var e=d.getCurrentPersona();this.ui.new_allVisibleSortedPortlets=c.getAllVisibleSortedPortletsForPersonaAndExtraProcessing(e);this.ui.new_allVisibleSortedPortlets_isCountZero=this.ui.new_allVisibleSortedPortlets==null||this.ui.new_allVisibleSortedPortlets.length===0?true:false;var t=r.getFromContext("HOME_PAGE_ACTIVE_PORTLET_PERSONA_SCOPE");if(!iscCore.isVoid(t)){this.ui.new_activePortlet=t}}})}]);
angular.module("store").controller("store.views.my-tasks.my-tasks-list",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscAppContext","iscStateParams","iscResourcePermission","$timeout","iscWizard","iscShipment","$filter",function(t,e,i,a,s,n,h,o,r,p,u,c,l){e.initializeScreen(t,{model:{shipmentList:{},batchCountOutput:{},batchList:{}},mashupRefs:[{mashupRefId:"getShipmentListForMyTasks",mashupId:"store.views.my-tasks.getShipmentListForMyTasks",modelName:"shipmentList",isPaginated:true,pageSize:15,append:true,appendPath:"Shipments.Shipment"},{mashupRefId:"getShipmentListCountForMyTasks",mashupId:"store.views.home.common.getShipmentListCountForMyTasks",modelName:"shipmentCountOutput"},{mashupRefId:"getBatchListCountForMyTasks",mashupId:"store.views.home.common.getBatchListCountForMyTasks",modelName:"batchCountOutput"},{mashupRefId:"getBatchList",mashupId:"store.views.my-tasks.getBatchListForStore"}],ui:{apiCallInProgress:false,selectedShipmentKey:"",numOfOrders:-1,selectedStoreBatchKey:"",sortOptions:"N",hasPermissionForBatchPicking:r.hasPermission("WSC000053"),hasPermissionForOrders:r.hasPermission("WSC000057")||r.hasPermission("WSC000058")||r.hasPermission("WSC000062"),showOrdersView:true,showBatchesView:false,apiPageSize:15},initialize:function(){var t=[];var e={};e=this.prepareApiInputForSorting();if(this.ui.hasPermissionForOrders&&this.ui.hasPermissionForBatchPicking){t.push(n.getMashupRefObj(this,"getBatchListCountForMyTasks",{}));t.push(n.getMashupRefObj(this,"getShipmentListForMyTasks",e))}this.ui.apiCallInProgress=true;if(t.length>0){n.callMashups(this,t,{}).then(this.handleInitApiCalls.bind(this),angular.noop)}else{n.callMashup(this,"getShipmentListForMyTasks",e,{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)}},handleInitApiCalls:function(t){var e=t.MashupRefs.MashupRef;if(e!==null&&e!==undefined){var i=e.length;for(var s=0;s<i;s++){var a=e[s];if(a.mashupRefId==="getShipmentListForMyTasks"){this.processPaginatedShipmentList(t)}}}},processPaginatedShipmentList:function(t){this.ui.apiCallInProgress=false;var e=n.getMashupOutput(t,"getShipmentListForMyTasks");this.ui.numOfOrders=l("number")(e.Page.Output.Shipments.TotalNumberOfRecords);if(e.Page.Output.Shipments.Shipment){if(iscCore.isVoid(this.ui.selectedShipmentKey)){this.ui.selectedShipmentKey=e.Page.Output.Shipments.Shipment[0].ShipmentKey}this.processShipment(e.Page.Output.Shipments)}},processShipment:function(t){for(var e=0;e<t.Shipment.length;e++){var i=t.Shipment[e];i.OrderNoToDisplay=c.getDisplayOrderNumber(i.DisplayOrderNo,"|",", ",true);i.StatusDescriptionToDisplay=c.getShipmentStatusDescription(i)}},uiSelectShipment:function(t){this.ui.selectedShipmentKey=t.ShipmentKey},uiOrderListScrollActionValidator:function(){if(this.model.shipmentList.Page.IsLastPage!=="N"){return false}else return true},uiSelectBatch:function(t){this.ui.selectedBatchKey=t.StoreBatchKey},uiGetNextPackingRecords:function(){if(this.model.shipmentList.Page.IsLastPage!=="N"){return}this.ui.apiCallInProgress=true;var t=c.prepareGetShipmentListApiInput(this.ui.sortOptions,"SHP",this.ui.statusArray);n.callPaginatedMashup(this,"getShipmentList",t,"NEXT",{}).then(this.processPaginatedShipmentList.bind(this))},uiGoToShipmentSummary:function(t){i.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:t.ShipmentKey},flowName:"Pack"}},{})},uiUpdateSelection:function(t){if(t=="Order"){this.ui.showOrdersView=true;this.ui.showBatchesView=false;if(iscCore.isVoid(this.model.shipmentList)&&!this.ui.apiCallInProgress){n.callPaginatedMashup(this,"getShipmentListForMyTasks",{},"START",{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)}}else if(t=="Batch"){this.ui.showOrdersView=false;this.ui.showBatchesView=true;if(iscCore.isVoid(this.model.batchList)){var e={StoreBatch:{PageSize:this.ui.apiPageSize,NotStarted:"N",skipFilterOptions:"Y"}};this.callGetBatchList(e)}}},callGetBatchList:function(t){n.callMashup(this,"getBatchList",t,{}).then(function(t){var e=n.getMashupOutput(t,"getBatchList");this.handleGetBatchListPaginatedOutput(e,false)}.bind(this),angular.noop)},handleGetBatchListPaginatedOutput:function(t,e){this.ui.apiCallInProgress=false;if(e){var i=t.Page.Output.StoreBatchList.StoreBatch;for(var s=0;s<i.length;s++){this.model.batchlist.Page.Output.StoreBatchList.StoreBatch.push(i[s])}this.model.batchlist.Page.PageNumber=t.Page.PageNumber;this.model.batchlist.Page.IsLastPage=t.Page.IsLastPage}else{this.model.batchlist=t}this.massageBatchList()},massageBatchList:function(){var t=this.model.batchlist;if(iscCore.isVoid(this.ui.selectedBatchKey)){this.ui.selectedBatchKey=this.model.batchlist.Page.Output.StoreBatchList.StoreBatch[0].StoreBatchKey}var e=this.model.batchlist.Page.Output.StoreBatchList.StoreBatch;var i={};for(var s=0;s<e.length;s++){i=e[s];if(!iscCore.isVoid(i.DepartmentDisplayDesc)&&i.DepartmentDisplayDesc.lastIndexOf(",")!=-1){i.uiDepartmentDisplayDesc="MULTIPLE"}else{i.uiDepartmentDisplayDesc=i.DepartmentDisplayDesc}}},uiGetNextMyTaskRecords:function(){if(this.model.shipmentList.Page.IsLastPage!=="N"){return}this.ui.apiCallInProgress=true;var t={};t=this.prepareApiInputForSorting();n.callPaginatedMashup(this,"getShipmentListForMyTasks",t,"NEXT",{}).then(this.processPaginatedShipmentList.bind(this))},uiGetNextBatchRecords:function(){var t=this.model.batchlist.Page.Output.StoreBatchList;var e=t.StoreBatch.length;console.log("actualRecordsInModel="+e);if(e-this.ui.recordShownCount>=this.ui.pageSize){this.ui.recordShownCount+=this.ui.pageSize;console.log("Using existing model - doing client side pagination")}else{if(this.model.batchlist.Page.IsLastPage!="Y"){var i=Number(this.model.batchlist.Page.PageNumber);var s={StoreBatch:{PageNumber:i+1,PageSize:this.ui.apiPageSize,NotStarted:"N",skipFilterOptions:"Y",PreviousPage:{PageNumber:i,StoreBatch:{StoreBatchKey:t.StoreBatch[e-1].StoreBatchKey,BatchNo:t.StoreBatch[e-1].BatchNo}}}};console.log("calling API with input="+s);this.ui.searchInProgress=true;n.callMashup(this,"getBatchList",s,"NEXT",{}).then(function(t){var e=n.getMashupOutput(t,"getBatchList");this.handleGetBatchListPaginatedOutput(e,true);this.ui.searchInProgress=false}.bind(this),angular.noop)}else{this.ui.recordShownCount=e;console.log("not calling API but painting numItemsInModel="+numRecordsInModel+" items")}}},uiClose:function(){i.goToState("/home",{},{})},uiOpenPackFlow:function(t){i.goToState("containerpack",{input:{Shipment:{ShipmentKey:t.ShipmentKey}}},{})},uiOpenContinueBatch:function(t){i.goToState("batchpick",{action:"skipbatchList",input:{batch:t,skipBatchList:false}},{})},uiOpenPickFlow:function(t){i.goToState("backroomPickWizard",{input:{Shipment:{ShipmentKey:t}}},{})},uiOpenDepartmentModal:function(t){var e=this;var i={DepData:{}};i.DepData.Departments=t.DepartmentDisplayDesc;i.DepData.BatchNo=t.BatchNo;var s={modalInput:function(){return i}};a.openModal("store.views.shipment.batchpick.batch-list.departments.batch-list-departments",s,{}).then(function(t){},angular.noop)},prepareApiInputForSorting:function(){var t={};t.Shipment={};t.Shipment.OrderBy={};t.Shipment.OrderBy.Attribute={};t.Shipment.OrderBy.Attribute.Desc=this.ui.sortOptions;return t},uiApplySortOptions:function(t){if(t.sortOption=="NEW_TO_OLD"){this.ui.sortOptions="Y"}else if(t.sortOption=="OLD_TO_NEW"){this.ui.sortOptions="N"}var e=this.prepareApiInputForSorting();this.model.shipmentList={};n.callPaginatedMashup(this,"getShipmentListForMyTasks",e,"START",{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)}})}]);
angular.module("store").controller("store.views.order.order-capture-finish",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscState",function(e,i,o,r,t,a,s){o.initializeWizardPage(e,{model:{},mashupRefs:[],ui:{},initialize:function(){if(o.getWizardAction()==="FINISH"){var e=o.getWizardModel("orderModel");s.goToState("ordersummary",{orderInput:e},{})}else if(o.getWizardAction()==="CLOSE"){s.goToPreviousState()}}})}]);
angular.module("store").controller("store.views.order.order-capture-init",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams",function(o,a,r,e,s,i){r.initializeWizardPage(o,{model:{},mashupRefs:[],ui:{},initialize:function(){console.log(i);if(i.params.customerInfo){r.setWizardModel("customerModel",i.params.customerInfo)}if(i.params.action==="SEARCH"){r.gotoCustomPage("productSearch",i.params,{})}if(i.params.action==="SCAN"){r.gotoCustomPage("addItems",i.params,{});if(i.params.orderInfo){r.setWizardModel("orderModel",i.params.orderInfo)}}if(i.params.action==="QUICKCHECKOUT"){r.setWizardModel("orderModel",i.params.orderModel);r.gotoCustomPage("cartDetails",i.params,{})}}})}]);
angular.module("store").controller("store.views.order.order-modification-finish",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscState",function(i,e,o,r,t,a,s){o.initializeWizardPage(i,{model:{},mashupRefs:[],ui:{},initialize:function(){if(o.getWizardAction()==="FINISH"){var i=o.getWizardModel("orderModel");s.goToState("ordersummary",{orderInput:i},{})}else if(o.getWizardAction()==="CLOSE"){s.goToPreviousState()}}})}]);
angular.module("store").controller("store.views.order.order-modification-init",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams",function(e,i,r,a,o,s){r.initializeWizardPage(e,{model:{},mashupRefs:[],ui:{},initialize:function(){if(s.params.action==="EDITORDER"){r.setWizardModel("orderHeaderKey",s.params.orderHeaderKey);r.gotoCustomPage("editOrderDetails",s.params,{})}}})}]);
angular.module("store").controller("store.views.return.return-finish",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscState",function(e,i,r,t,o,a,s){r.initializeWizardPage(e,{model:{},mashupRefs:[],ui:{},initialize:function(){if(r.getWizardAction()==="FINISH"){var e=r.getWizardModel("returnOrder");var i=r.getWizardModel("returnLinesModel");s.goToState("returnsummary",{input:e},{})}else if(r.getWizardAction()==="CLOSE"){s.goToPreviousState()}}})}]);
angular.module("store").controller("store.views.return.return-init",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscOrder","iscModal","iscI18n",function(e,r,t,s,a,i,o,d,l){t.initializeWizardPage(e,{model:{},mashupRefs:[{mashupRefId:"getCompleteOrderDetails",mashupId:"orderDetails_getCompleteOrderDetails"},{mashupRefId:"deleteLinkedReturnOrders",mashupId:"orderDetails_deleteLinkedReturnOrders"}],ui:{orderDetailsStateParams:""},initialize:function(){console.log(i);if(i.params.action==="orderDetails"){this.ui.orderDetailsStateParams=i;this.validateSalesOrder()}else if(i.params.action==="orderList"){t.gotoCustomPage("orderList",i.params,{})}else if(i.params.action==="itemList"){t.gotoCustomPage("itemList",i.params,{})}else if(i.params.action==="addReturnItem"){t.gotoCustomPage("addReturnItem",i.params,{})}else if(i.params.action==="customerList"){t.gotoCustomPage("customerList",i.params,{})}else if(i.params.action==="customerDetails"){t.gotoCustomPage("customerDetails",i.params,{})}},validateSalesOrder:function(){var e=this.ui.orderDetailsStateParams.params.input;var r={Order:{OrderHeaderKey:e.Order.OrderHeaderKey}};s.callMashup(this,"getCompleteOrderDetails",r,{}).then(this.processSalesOrderDetails.bind(this),angular.noop)},processSalesOrderDetails:function(e){var a=this;var r=s.getMashupOutput(e,"getCompleteOrderDetails");if(!iscCore.isVoid(r.Order.MultipleReturnOrderExists)&&"Y"==r.Order.MultipleReturnOrderExists){d.showWarningMessage(l.translate("orderDetails.MSG_MultipleReturnOrderExists")).then(function(e){var r=a.ui.orderDetailsStateParams.params.input;var t={Order:{OrderHeaderKey:r.Order.OrderHeaderKey}};s.callMashup(a,"deleteLinkedReturnOrders",t,{}).then(a.postReturnOrderDelete.bind(a),angular.noop)})}else{this.gotoOrderDetailsPage()}},postReturnOrderDelete:function(e){this.gotoOrderDetailsPage()},gotoOrderDetailsPage:function(){t.gotoCustomPage(this.ui.orderDetailsStateParams.params.action,this.ui.orderDetailsStateParams.params,{})}})}]);
angular.module("store").controller("store.views.sitemap.sitemap",["$scope","$rootScope","iscScreen","iscMashup","iscResourcePermission","iscState","iscI18n","iscAppInfo","iscHttpRequest","iscPersona","iscPortletService","iscInStoreAppointment",function(e,t,i,o,n,s,r,a,u,l,c,d){i.initializeScreen(e,{model:{},mashupRefs:[{mashupRefId:"updateUserPersonaUserUiState",mashupId:"store.views.home.home-footer.updateUserPersona"}],ui:{hasMgrDashboardPermission:n.hasPermission("WSC000038")||n.hasPermission("WSC000039"),new_usePersonaBasedHomepage:false,personaAndPortletList:[]},initialize:function(){this.ui.new_usePersonaBasedHomepage=l.getUsePersonaBasedHomepageFlagValue();if(this.ui.new_usePersonaBasedHomepage===true){var e=[];var i=l.getCurrentPersona();var t=l.getPersonaList();for(var o=0;o<t.length;o++){var s=t[o];if(i!==s["CodeName"]&&!iscCore.isVoid(s["CodeName"])){var r=false;if(l.isSpecialPersona(s["CodeName"])){r=this.hasPermissionToAtleastOneResource(s["CodeName"],false)}else{r=this.hasPermissionToAtleastOneResource(s["CodeName"],true)}if(r===true){e.push({sitemapTitleKey:"home.TOOLTIP_"+s["CodeName"],sitemapLinkKey:"home.TOOLTIP_"+s["CodeName"],sitemapLinkActionMethod:this.getMethodStringForOOTBCodes(s["CodeName"])})}}}var n=c.getAllVisibleSortedPortletsForPersonaAndExtraProcessing(i);this.ui.personaAndPortletList=this.getSitemapConfigArray(n);this.ui.personaAndPortletList=e.concat(this.ui.personaAndPortletList)}},hasPermissionToAtleastOneResource:function(e,i){var t=l.getAllPersonaToResourceIdListForVisiblePortlets();var o=t[e];var s=t["_oldSpec"];var r=false;if(o!=null){r=n.hasPermissionToOneOfTheResources(o)}if(r===false&&i===true&&!iscCore.isVoid(s)){r=n.hasPermissionToOneOfTheResources(s)}return r},getMethodStringForOOTBCodes:function(e){var i="";if(e==="Customer_Service"){i="uiOpenCustomerService"}else if(e==="Manager_Dashboard"){i="uiOpenManagerDashboard_new"}else if(e==="Order_Fulfillment"){i="uiOpenOrderFulfillment_new"}else if(e==="Dojo_Order_Fulfill"){i="uiOpenOrderFulfillment"}return i},getSitemapConfigArray:function(e){var i=[];for(var t=0;t<e.length;t++){var o=e[t];var s=o.sitemapConfig;if(s!=null&&n.hasPermissionToOneOfTheResources(o.resourceId)){var r=this.validateAndReturnSiteMapAsArray(s);if(r.length>0){i=i.concat(r)}}}return i},validateAndReturnSiteMapAsArray:function(e){var i=[];if(e.length!=null&&e.length>0){for(var t=0;t<e.length;t++){if(!iscCore.isVoid(e[t].sitemapTitleKey)&&!iscCore.isVoid(e[t].sitemapLinkKey)&&!iscCore.isVoid(e[t].sitemapLinkActionMethod)){if(n.hasPermissionToOneOfTheResources(e[t].resourceId)){i.push(e[t])}}}}else{if(!iscCore.isVoid(e.sitemapTitleKey)&&!iscCore.isVoid(e.sitemapLinkKey)&&!iscCore.isVoid(e.sitemapLinkActionMethod)){i.push(e)}}return i},uiOpenCustomerService:function(){this.uiPerformPersonaSwitchAction("Customer_Service")},uiOpenManagerDashboard_new:function(){this.uiPerformPersonaSwitchAction("Manager_Dashboard")},uiOpenOrderFulfillment_new:function(){this.uiPerformPersonaSwitchAction("Order_Fulfillment")},uiPerformPersonaSwitchAction:function(e){l.updateCurrentPersona(e);var i={UserUiState:{Definition:e}};if(e==="Dojo_Order_Fulfill"){this.uiOpenOrderFulfillment()}else if(e==="Manager_Dashboard"){o.callMashup(this,"updateUserPersonaUserUiState",i,{showMask:false});s.goToState("/manager-dashboard",{},{})}else{o.callMashup(this,"updateUserPersonaUserUiState",i,{showMask:false});s.goToState("/home",{personaName:e},{forceRefresh:true})}},uiHandleSitemapLinkClick:function(e){if(e!=""&&this[e]!=null){this[e]()}},uiOpenOrderFulfillment:function(){window.onbeforeunload=null;t.activeCalls++;var e=a.getAppDeviceMode();var i="";if(e==="mobile"){i=a.getApplicationContext()+"/store/mobile/container/home.do"}else{i=a.getApplicationContext()+"/store/container/home.do"}window.location.href=u.addAdditionalParamsInURL(i,"GET")},uiOpenManagerDashboard:function(){s.goToState("/manager-dashboard",{},{})},uiOpenFindProducts:function(){s.goToState("ordercapture",{action:"SEARCH",input:"",openBlankPage:true},{})},uiOpenReturns:function(){s.goToState("returnorder",{action:"itemList",input:"",callAPI:false},{})},uiOpenReceivingShipmentList:function(){var e="INCOMING";s.goToState("receivingShipmentList",{defaultTab:e.toLowerCase()},{})},uiFindCustomers:function(){s.goToState("customerProfileList",{input:"",openBlankPage:true},{})},uiBatchPickOrders:function(){s.goToState("batchpick",{action:"batchList",input:{}},{})},uiPickOrders:function(){s.goToState("pickorderlist",{input:{FilterOptions:"All"}},{})},uiPackOrders:function(){s.goToState("packorderlist",{input:{FilterOptions:"All"}},{})},uiShipPackages:function(){s.goToState("shipmentConfirmList",{searchCriteria:{},titleKey:"ALL"},{})},uiPickupOrders:function(){s.goToState("customerpickorderlist",{input:{FilterOptions:"All"}},{})},uiViewMyTasks:function(){s.goToState("mytaskslist",{},{})},uiViewAppointments:function(){d.viewStoreApppointmentCalendar()}})}]);
angular.module("store").controller("store.views.common.address.addressselectionpopup",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscI18n",function(e,s,i,o,t,n){o.initializeModalScreen(e,{ui:{headerTitle:"",bodyTitle:"",personInfoList:{},addressSelected:false,selectedAddress:{}},initialize:function(){this.ui.personInfoList=t.PersonInfoList;this.ui.headerTitle=t.HeaderTitle;this.ui.bodyTitle=t.BodyTitle},uiSelectedAddress:function(e,s){for(var i=0;i<this.ui.personInfoList.PersonInfo.length;i++){if(i!=s){this.ui.personInfoList.PersonInfo[i].Selected="N"}else{this.ui.personInfoList.PersonInfo[i].Selected="Y"}}this.ui.selectedAddress=e;this.ui.addressSelected=true},uiClose:function(){for(var e=0;e<this.ui.personInfoList.PersonInfo.length;e++){this.ui.personInfoList.PersonInfo[e].Selected="N"}i.dismiss("cancel")},uiOK:function(){delete this.ui.selectedAddress.Selected;var e={PersonInfo:this.ui.selectedAddress};i.close(e)}})}]);
angular.module("store").controller("store.views.common.customer.customerpopup",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscI18n",function(d,e,o,t,s,r,a,n){t.initializeModalScreen(d,{ui:{selectedAddress:{},selectedCustomer:{}},initialize:function(){this.uiChangeScreenState("CustomerSearch");this.ui.showSearchList=false;this.ui.showVerifiedAddresses=false;this.ui.showSearchBtn=true;this.ui.showReToSearchBtn=false;this.ui.noRecordsFound=false;if(s.Mode=="Identify"){this.ui.mode=s.Mode}else{this.ui.mode="Identify"}d.$on("AddressVerified",function(e,t){d.formScope=t.formScope;if(t){var s={customer:{},addressSelected:t.data};if(t.State=="SINGLE_ADDRESS"){if(d.formScope.addressCapture.$invalid){console.log("screen in error")}else{var i={data:s};d.uiCallManageApi(i)}}else if(t.State=="MULTI_ADDRESS"){d.currentSelection={data:s};d.uiChangeScreenState("AddressMatchSelected")}else if(t.State=="MODIFY_ADDRESS"){d.currentSelection={data:s};d.uiChangeScreenState("AddressBeingModified")}}})},uiCreateOnEnter:function(e){d.uiOK()},uiSelectOnEnter:function(e){d.uiOK()},uiChangeScreenState:function(e){this.ui.screenState=e},uiNewCustomerSelected:function(){this.uiChangeScreenState("NewCustomerCreation");this.ui.showReToSearchBtn=false;this.ui.showSearchList=false},uiCustomerSearchSelected:function(){this.uiChangeScreenState("CustomerSearch");this.ui.showSearchList=false},uiReDoSearch:function(){d.customerAdditionalAddressKey="";this.initialize()},uiCustomerSelected:function(){this.uiChangeScreenState("CustomerSelected");var e=this.ui.selectedCustomer;if(e.CustomerContactList.CustomerContact[0].CustomerAdditionalAddressList.CustomerAdditionalAddress){var t=e.CustomerContactList.CustomerContact[0].CustomerAdditionalAddressList.CustomerAdditionalAddress;this.ui.errorText="";var s=false;for(i=0;t.length>i;i++){var r=t[i];if(r.IsDefaultShipTo==="Y"){this.ui.selectedAddress=r;d.customerAdditionalAddressKey=r.CustomerAdditionalAddressKey;s=true;break}else if(i==t.length-1&&!s){this.ui.selectedAddress=t[0];d.customerAdditionalAddressKey=t[0].CustomerAdditionalAddressKey}}}else{this.ui.selectedAddress={};d.customerAdditionalAddressKey={}}},uiSelectedAddress:function(e,t){if(!this.ui.selectedCustomer.CustomerKey){this.ui.errorText=n.translate("address.LABEL_Select_Customer")}else if(this.ui.selectedCustomer.CustomerKey!=t.CustomerKey){this.ui.errorText=n.translate("address.LABEL_Incorrect_Address")}else{this.ui.errorText="";d.customerAdditionalAddressKey=e.CustomerAdditionalAddressKey;this.ui.selectedAddress=e;this.uiChangeScreenState("CustomerAddressSelected")}},uiClose:function(){o.dismiss("cancel")},uiOK:function(){if(d.formScope&&d.formScope.addressCapture&&d.formScope.addressCapture.$invalid){console.log("Screen is in error")}else if(this.ui.showSearchList){var e={customerModel:{Customer:this.ui.selectedCustomer},addressSelected:this.ui.selectedAddress};var t={data:e};o.close(t)}else if(this.ui.screenState=="AddressMatchSelected"){delete d.currentSelection.data.addressSelected.$$hashKey;d.uiCallManageApi(d.currentSelection)}else{d.$broadcast("callVerifyAddress",{id:"1"})}},uiSearchOnEnter:function(){d.uiSearch()},uiSearch:function(e){this.ui.selectedCustomer={};this.ui.selectedAddress={};d.customerAdditionalAddressKey="";if(!this.ui.search){this.ui.search={}}var t=angular.copy(this.ui.search);this.callSearchApi(t)},callSearchApi:function(e){var t="Customer_listCustomer";var s={};s.Customer={};s.Customer.CustomerContactList={};s.Customer.CustomerContactList.CustomerContact={};s.Customer.CustomerContactList.CustomerContact=e;s.Customer.CustomerContactList.CustomerContact.EmailID=e.EMailID;delete s.Customer.CustomerContactList.CustomerContact.EMailID;r.callSimpleMashup(this,t,s,{}).then(this.successHandler.bind(this),this.failureHandler.bind(this))},uiCallManageApi:function(e){var t="Customer_manageCustomer";var s=e.data.addressSelected;var i={};i.Customer={};i.Customer=s;r.callSimpleMashup(this,t,i,{}).then(this.successHandler.bind(this),this.failureHandler.bind(this))},processGetCustomerListOutput:function(e){this.ui.showReToSearchBtn=true;var t=e.Output.CustomerList;if(t.Customer){this.uiChangeScreenState("CustomerSearchListed");d.customerList=t.Customer;d.customerList.TotalNumberOfRecords=t.TotalNumberOfRecords;d.ui.TotalRecordText=n.translate("globals.MSG_TotalNumberOfRecords",{TotalNumberOfRecords:t.TotalNumberOfRecords});var s=d.customerList[0];if(s){this.ui.selectedCustomer=s;var r=s.CustomerContactList.CustomerContact[0];if(r){var o=r.CustomerAdditionalAddressList.CustomerAdditionalAddress;var a=false;if(!iscCore.isVoid(o)){for(i=0;o.length>i;i++){var u=o[i];if(u.IsDefaultShipTo==="Y"){this.ui.selectedAddress=u;d.customerAdditionalAddressKey=u.CustomerAdditionalAddressKey;a=true;break}else if(i==o.length-1&&!a){this.ui.selectedAddress=o[0];d.customerAdditionalAddressKey=o[0].CustomerAdditionalAddressKey}}}}}this.ui.showSearchList=true;this.ui.noRecordsFound=false}else{this.ui.showReToSearchBtn=false;this.ui.noRecordsFound=true;this.uiChangeScreenState("CustomerSearch")}},processManageCustomerOutput:function(e){var t=e.Output;var s=t.Customer.CustomerContactList.CustomerContact[0].CustomerAdditionalAddressList.CustomerAdditionalAddress[0];var i={customerModel:t,addressSelected:s};var r={data:i};this.ui.showVerifiedAddresses=false;o.close(r);o.dismiss("cancel")},uiValidatorForEmail:function(e,t,s,i){if(t.pattern||t.email){e.booleanResponse=false;e.errorMesssage=n.translate("datatype.EmailFormat")}return e},successHandler:function(e){var t=e.MashupRefs.MashupRef;for(i=0;t[i];i++){if(t[i].mashupId){var s=t[i].mashupId;if(s=="Customer_listCustomer"){this.processGetCustomerListOutput(t[i])}else if(s=="Customer_manageCustomer"){this.processManageCustomerOutput(t[i])}}}},failureHandler:function(e){}})}]);
angular.module("store").controller("store.views.common.fulfillment.fulfillmentoptions",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscWizard","iscResourcePermission","iscAppContext","$filter","iscI18n","iscItem",function(a,e,s,i,r,o,t,n,l,u,h,d){i.initializeModalScreen(a,{subscribers:[{event:"AddressVerified",handler:"verifyHandler"}],verifyHandler:function(e,i){var t=i;if(t){var r=angular.copy(t.data);a.formScope=t.formScope;var s=this;if(a.formScope&&a.formScope.addressCapture&&a.formScope.addressCapture.$invalid){s.ui.availabiltyErrorText=h.translate("fulfillmentOptions.LABEL_ShippingAddress_Error")}else if(t.State=="SINGLE_ADDRESS"){s.ui.availabiltyErrorText="";a.holdAPIcall=false;s.setAddress(r);o.callMashup(s,"fulfillmentoptionsgetItemAvailabilityForStore",s.ui.getItemAvailabilityForStoreInput,{}).then(s.onSuccessgetItemAvailability.bind(s),angular.noop)}else if(t.State=="MULTI_ADDRESS"){a.currentSelection=angular.copy(r);a.holdAPIcall=false}else if(t.State=="MODIFY_ADDRESS"){a.currentSelection=angular.copy(r);a.holdAPIcall=true}}},model:{fulfillmentOptionsItemAvailability:{},CarrierServiceOptions:{},storeList:{},searchStoreList:{},defaultRadiusValue:{},maxRadiusValue:{},distanceUOM:{},FulfillmentType:{}},mashupRefs:[{mashupRefId:"fulfillmentoptionsgetItemAvailabilityForStore",mashupId:"fulfillmentoptions_getItemAvailabilityForStore",modelName:"fulfillmentOptionsItemAvailability"},{mashupRefId:"fulfillmentoptionsgetCarrierServiceOptionsForOrdering",mashupId:"WSCfulfillmentoptions_getCarrierServiceOptionsForOrdering",modelName:"CarrierServiceOptions"},{mashupRefId:"storeSelectiongetAlternateStoreAvailability",mashupId:"storeSelection_getAlternateStoreAvailability",isPaginated:"true",modelName:"storeList",append:true,appendPath:"AlternateStores.NodeList.Node"},{mashupRefId:"storeSearchgetAlternateStoreAvailability",mashupId:"storeSelection_getAlternateStoreAvailability",isPaginated:"true",modelName:"searchStoreList",append:true,appendPath:"AlternateStores.NodeList.Node"},{mashupRefId:"wscCommonGetDefaultRadiusValue",mashupId:"WSC_getRuleDetails",modelName:"defaultRadiusValue"},{mashupRefId:"wscCommonGetMaxRadiusValue",mashupId:"WSC_getRuleDetails",modelName:"maxRadiusValue"},{mashupRefId:"wscCommonGetFulfillmentTypeForStore",mashupId:"WSC_getRuleDetails",modelName:"FulfillmentType"},{mashupRefId:"wscDistanceUOM",mashupId:"WSC_getDistanceUOM",modelName:"distanceUOM"}],ui:{pickTab:"false",ShipTab:"false",InStoreTab:"false",Pick:"",Ship:"",InStore:"",currentDelMethod:"",newDelMethod:"",availabiltyErrorText:"Not Available",getItemAvailabilityForStoreInput:{},selectedStore:"",searchedStore:"",searchedStoreDesc:"",nearStore:"",nearStoreDesc:"",selectedStoreDesc:"",Country:"",State:"",city:"",ZipCode:"",searchStore:"false",errorText:"",nearbyView:"true",searchView:"false",noOfStoresFound:"",noOfStoresSearched:"",nearRadius:"",maxNearRadius:"",oldNearRadius:"",nearWach:"",searchRadius:"",maxSearchRadius:"",oldSearchRadius:"",searchWach:"",nearApiExecComplete:"true",searchApiExecComplete:"true",personInfo:{},getAlternateStoreAvailabilityInput:{},pickupUnAvailable:"",FetchNextRecords:false,noStoreFound:"",searchButtonClick:"false",carrierUnAvailable:"N",shipUnAvailable:"",selectedCarrier:"",selectedCarrierDesc:"",EarliestShipDate:"",displayEarliestShipDate:"",personInfoShipTo:{},tmpPersonInfoShipTo:{},addShipAddress:"false",editShipAddress:"false",getCarrierServiceOptionsForOrderingInput:{},noCarriers:"false",carriersNotConfigured:"",InStoreUnAvailable:"",InStoreAvailMsg:"",InStoreUnAvailMsg:"",confirmedOrder:"false",newOrderLine:false,currentStoreDesc:"",InStrAvailabilityError:"N",selectedCarrierServiceCode:"",activeTabIndex:0},initialize:function(){this.ui.currentStoreDesc=l.getFromContext("storeDesc");var e=l.getFromContext("storeAddress").ShipNodePersonInfo;this.ui.getItemAvailabilityForStoreInput={Promise:{OrderHeaderKey:r.inputData.OrderHeaderKey,PromiseLines:{PromiseLine:{ItemID:r.inputData.orderLine.ItemDetails.ItemID,UnitOfMeasure:r.inputData.orderLine.ItemDetails.UnitOfMeasure,ProductClass:r.inputData.orderLine.Item.ProductClass,RequiredQty:r.inputData.orderLine.OrderLineTranQuantity.OrderedQty,OrderLine:{OrderLineKey:r.inputData.orderLine.OrderLineKey,DeliveryMethod:r.inputData.orderLine.DeliveryMethod}}}}};this.ui.getAlternateStoreAvailabilityInput={AlternateStore:{NodeSearch:{ShipToAddress:{Country:e.Country,State:e.State,City:e.City,ZipCode:e.ZipCode}},OrderLines:{OrderLine:{RequiredQty:r.inputData.orderLine.OrderLineTranQuantity.OrderedQty,Item:{ItemID:r.inputData.orderLine.ItemDetails.ItemID,ProductClass:r.inputData.orderLine.Item.ProductClass,UnitOfMeasure:r.inputData.orderLine.ItemDetails.UnitOfMeasure}}}}};this.ui.getCarrierServiceOptionsForOrderingInput={Order:{OrderHeaderKey:r.inputData.OrderHeaderKey,OrderLines:{OrderLine:{ItemID:r.inputData.orderLine.ItemDetails.ItemID,ProductClass:r.inputData.orderLine.Item.ProductClass,UnitOfMeasure:r.inputData.orderLine.ItemDetails.UnitOfMeasure}}}};if(!iscCore.isVoid(r.inputData.DraftOrderFlag)&&r.inputData.DraftOrderFlag==="Y"){this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.OrderLineKey=r.inputData.orderLine.OrderLineKey}if(r.inputData.DraftOrderFlag==="N"){this.ui.confirmedOrder="true"}if(!iscCore.isVoid(r.inputData.newOrderLine)){if(r.inputData.newOrderLine==true){this.ui.newOrderLine=true}}if(!iscCore.isVoid(r.inputData.orderLine.PersonInfoShipTo)){var i=angular.copy(r.inputData.orderLine.PersonInfoShipTo);this.setAddress(i)}else if(!iscCore.isVoid(r.inputData.orderPersonInfoShipTo)){var t=angular.copy(r.inputData.orderPersonInfoShipTo);this.setAddress(t)}this.ui.tmpPersonInfoShipTo=angular.copy(this.ui.personInfoShipTo);this.ui.currentDelMethod=r.inputData.orderLine.DeliveryMethod;if(this.ui.currentDelMethod=="PICK"){this.ui.pickTab="true";this.ui.activeTabIndex=2}else if(this.ui.currentDelMethod=="SHP"){this.ui.shipTab="true";this.ui.activeTabIndex=1;this.ui.selectedCarrierServiceCode=r.inputData.orderLine.CarrierServiceCode}else if(this.ui.currentDelMethod=="CARRY"){this.ui.InStoreTab="true";this.ui.activeTabIndex=0}o.callMashup(this,"fulfillmentoptionsgetItemAvailabilityForStore",this.ui.getItemAvailabilityForStoreInput,{}).then(this.onSuccessgetItemAvailabilityForStore.bind(this),angular.noop)},uiShip:function(){this.ui.shipTab="true";this.ui.pickTab="false";this.ui.InStoreTab="false";this.ui.availabiltyErrorText="";this.ui.errorText="";this.ui.newDelMethod="SHP";this.uiInitShip()},uiPickup:function(){this.ui.shipTab="false";this.ui.pickTab="true";this.ui.InStoreTab="false";this.model.storeList={};this.ui.availabiltyErrorText="";this.ui.newDelMethod="PICK";this.uiInitPickup()},uiInStore:function(){this.ui.shipTab="false";this.ui.pickTab="false";this.ui.InStoreTab="true";this.ui.errorText="";this.ui.availabiltyErrorText="";this.uiInitInStore()},uiInitInStore:function(){var e=t.getWizardModel("isOrgRoleNode");if(!iscCore.isVoid(e)&&e=="N")this.ui.InStoreUnAvailable="Y";if(this.ui.InStoreUnAvailable=="Y"){if(this.ui.InStrAvailabilityError=="Y"){this.ui.availabiltyErrorText=h.translate("fulfillmentOptions.ErrMsg")}else if(this.ui.InStrAvailabilityError=="N"){this.ui.InStoreUnAvailMsg=h.translate("fulfillmentOptions.LABEL_NotAvailable_InStore",{curStore:this.ui.currentStoreDesc})}}else if(this.ui.InStoreUnAvailable=="N"){this.ui.InStoreAvailMsg=h.translate("fulfillmentOptions.LABEL_Available_InStore",{curStore:this.ui.currentStoreDesc})}this.ui.newDelMethod="CARRY"},uiInitPickup:function(){if(this.ui.pickupUnAvailable=="Y"){this.ui.availabiltyErrorText=h.translate("fulfillmentOptions.ErrMsg")}else if(this.ui.pickupUnAvailable=="N"){this.ui.newDelMethod="PICK";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var e={Rules:{RuleSetFieldName:"WSC_STORE_STORE_SEARCH"}};var i={Rules:{RuleSetFieldName:"WSC_STORE_DISTANCE_TO_CONSIDER"}};var t={Rules:{RuleSetFieldName:"WSC_MAX_STORE_DISTANCE_TO_CONSIDER"}};var r={};var s=[];s.push(o.getMashupRefObj(this,"wscCommonGetFulfillmentTypeForStore",e));s.push(o.getMashupRefObj(this,"wscCommonGetDefaultRadiusValue",i));s.push(o.getMashupRefObj(this,"wscCommonGetMaxRadiusValue",t));s.push(o.getMashupRefObj(this,"wscDistanceUOM",r));o.callMashups(this,s,{}).then(function(e){this.onSuccessGetFulfillmentType()}.bind(this),angular.noop)}},uiNearbyView:function(){this.ui.errorText="";if(iscCore.isVoid(this.model.storeList)){this.ui.nearStoreDesc="";this.ui.nearStore="";this.ui.errorText="";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach()}else if(iscCore.isVoid(this.model.storeList.Page.Output.AlternateStores.NodeList)||this.model.storeList.Page.Output.AlternateStores.NodeList.TotalNumberOfRecords==0){this.ui.nearStoreDesc="";this.ui.nearStore="";this.ui.errorText=h.translate("storeSearch.Store_ErrMsg");if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach()}else if(iscCore.isVoid(this.ui.nearStoreDesc)){this.ui.nearStoreDesc=this.model.storeList.Page.Output.AlternateStores.NodeList.Node[0].Description;this.ui.nearStore=this.model.storeList.Page.Output.AlternateStores.NodeList.Node[0];this.ui.errorText="";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var t=this;this.ui.nearWach=a.$watch(function(e){return e.ui.nearRadius},function(e,i){t.onNearRadiusChange(e,i)});this.ui.searchWach=a.$watch(function(e){return e.ui.searchRadius},function(e,i){t.onSearchRadiusChange(e,i)})}else if(!iscCore.isVoid(this.model.storeList.Page.Output.AlternateStores.NodeList)){if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var t=this;this.ui.nearWach=a.$watch(function(e){return e.ui.nearRadius},function(e,i){t.onNearRadiusChange(e,i)});this.ui.searchWach=a.$watch(function(e){return e.ui.searchRadius},function(e,i){t.onSearchRadiusChange(e,i)})}this.ui.searchStore="false";this.ui.nearbyView="true";this.ui.searchView="false"},uiAlternateStoreGetNextRecords:function(){this.ui.getAlternateStoreAvailabilityInput.AlternateStore.NodeSearch.FulfillmentType=this.model.FulfillmentType.Rules.RuleSetValue;this.ui.getAlternateStoreAvailabilityInput.AlternateStore.NodeSearch.DistanceToConsider=this.ui.nearRadius;this.ui.getAlternateStoreAvailabilityInput.AlternateStore.NodeSearch.DistanceToConsiderUOM=this.ui.distanceUOM;if(this.ui.FetchNextRecords===true){o.callPaginatedMashup(this,"storeSelectiongetAlternateStoreAvailability",this.ui.getAlternateStoreAvailabilityInput,"NEXT",{}).then(this.getStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this),angular.noop);this.ui.FetchNextRecords=false}},getStoreAvailibility:function(){if(iscCore.isVoid(this.model.storeList.Page.Output.AlternateStores.NodeList)){this.ui.errorText=h.translate("storeSearch.Store_ErrMsg");this.ui.noOfStoresFound=""}else{this.ui.errorText="";if(iscCore.isVoid(this.ui.nearStoreDesc)){this.ui.nearStoreDesc=this.model.storeList.Page.Output.AlternateStores.NodeList.Node[0].Description;this.ui.nearStore=this.model.storeList.Page.Output.AlternateStores.NodeList.Node[0]}this.ui.noOfStoresFound=h.translate("storeSearch.LABEL_Stores_found",{noOfStores:this.model.storeList.Page.Output.AlternateStores.NodeList.Node.length});this.model.storeList=d.fetchAvailability(this.model.storeList)}this.ui.FetchNextRecords=true;this.ui.nearApiExecComplete="true";this.ui.oldNearRadius=""},onNearRadiusChange:function(e,i){if(!iscCore.isVoid(this.ui.oldNearRadius)){i=this.ui.oldNearRadius}if(!(e==i)){if(this.ui.nearApiExecComplete=="false"){this.ui.nearRadius=i}else if(this.ui.nearApiExecComplete=="true"){this.ui.oldNearRadius=i;this.ui.errorText="";this.ui.nearStoreDesc="";this.ui.nearStore="";this.model.storeList={};if(iscCore.isVoid(this.ui.getAlternateStoreAvailabilityInput.AlternateStore.NodeSearch.ShipToAddress.Country)){this.ui.errorText=h.translate("storeSearch.Store_ErrMsg")}else{this.ui.getAlternateStoreAvailabilityInput.AlternateStore.NodeSearch.DistanceToConsider=e;this.ui.getAlternateStoreAvailabilityInput.AlternateStore.NodeSearch.DistanceToConsiderUOM=this.ui.distanceUOM;this.ui.getAlternateStoreAvailabilityInput.AlternateStore.NodeSearch.FulfillmentType=this.model.FulfillmentType.Rules.RuleSetValue;o.callPaginatedMashup(this,"storeSelectiongetAlternateStoreAvailability",this.ui.getAlternateStoreAvailabilityInput,"START",{}).then(this.getStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false;this.ui.nearApiExecComplete="false"}}}},onSuccessGetDefaultRadiusValue:function(){if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();if(iscCore.isVoid(this.ui.nearRadius)){this.ui.nearRadius=this.model.defaultRadiusValue.Rules.RuleSetValue}if(iscCore.isVoid(this.ui.searchRadius)){this.ui.searchRadius=this.model.defaultRadiusValue.Rules.RuleSetValue}if(iscCore.isVoid(this.ui.getAlternateStoreAvailabilityInput.AlternateStore.NodeSearch.ShipToAddress.Country)){this.ui.errorText=h.translate("storeSearch.Store_ErrMsg")}else{this.ui.getAlternateStoreAvailabilityInput.AlternateStore.NodeSearch.FulfillmentType=this.model.FulfillmentType.Rules.RuleSetValue;this.ui.getAlternateStoreAvailabilityInput.AlternateStore.NodeSearch.DistanceToConsider=this.ui.nearRadius;this.ui.getAlternateStoreAvailabilityInput.AlternateStore.NodeSearch.DistanceToConsiderUOM=this.ui.distanceUOM;o.callPaginatedMashup(this,"storeSelectiongetAlternateStoreAvailability",this.ui.getAlternateStoreAvailabilityInput,"START",{}).then(this.getStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false}var t=this;this.ui.nearWach=a.$watch(function(e){return e.ui.nearRadius},function(e,i){t.onNearRadiusChange(e,i)});this.ui.searchWach=a.$watch(function(e){return e.ui.searchRadius},function(e,i){t.onSearchRadiusChange(e,i)})},onSuccessGetMaxRadiusValue:function(){this.ui.maxSearchRadius=this.model.maxRadiusValue.Rules.RuleSetValue;this.ui.maxNearRadius=this.model.maxRadiusValue.Rules.RuleSetValue},handleGetDefaultRadiusValueError:function(){if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();this.ui.nearRadius="25";this.ui.searchRadius="25";this.ui.errorText=h.translate("storeSearch.Store_ErrMsg");var t=this;this.ui.nearWach=a.$watch(function(e){return e.ui.nearRadius},function(e,i){t.onNearRadiusChange(e,i)});this.ui.searchWach=a.$watch(function(e){return e.ui.searchRadius},function(e,i){t.onSearchRadiusChange(e,i)})},handleGetMaxRadiusValueError:function(){this.ui.maxNearRadius="50";this.ui.maxSearchRadius="50"},uiSearchView:function(){this.ui.errorText="";if(iscCore.isVoid(this.model.searchStoreList)){this.ui.searchedStoreDesc="";this.ui.searchedStore="";this.ui.errorText="";this.ui.searchStore="true";this.ui.searchView="false";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach()}else if(iscCore.isVoid(this.model.searchStoreList.Page.Output.AlternateStores.NodeList)||this.model.searchStoreList.Page.Output.AlternateStores.NodeList.TotalNumberOfRecords==0){this.ui.searchedStoreDesc="";this.ui.searchedStore="";if(!iscCore.isVoid(this.ui.noStoreFound)){this.ui.errorText=""}else{this.ui.errorText=h.translate("storeSearch.Store_ErrMsg")}this.ui.searchStore="true";this.ui.searchView="false";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach()}else if(iscCore.isVoid(this.ui.searchedStoreDesc)){this.ui.searchedStoreDesc=this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node[0].Description;this.ui.selectedStore=this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node[0];this.ui.errorText="";this.ui.searchStore="false";this.ui.searchView="true";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var t=this;this.ui.nearWach=a.$watch(function(e){return e.ui.nearRadius},function(e,i){t.onNearRadiusChange(e,i)});this.ui.searchWach=a.$watch(function(e){return e.ui.searchRadius},function(e,i){t.onSearchRadiusChange(e,i)})}else if(!iscCore.isVoid(this.model.searchStoreList.Page.Output.AlternateStores.NodeList)){this.ui.searchView="true";this.ui.searchStore="false";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var t=this;this.ui.nearWach=a.$watch(function(e){return e.ui.nearRadius},function(e,i){t.onNearRadiusChange(e,i)});this.ui.searchWach=a.$watch(function(e){return e.ui.searchRadius},function(e,i){t.onSearchRadiusChange(e,i)})}this.ui.nearbyView="false"},uiBacktoSearch:function(){this.ui.searchStore="true";this.ui.nearbyView="false";this.ui.searchView="false";this.ui.noStoreFound="";this.ui.searchedStoreDesc="";this.ui.searchedStore="";this.ui.errorText="";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach()},uiSearchStore:function(){this.ui.searchButtonClick="true";if(iscCore.isVoid(this.ui.personInfo.ZipCode)){if(iscCore.isVoid(this.ui.personInfo.City)){this.ui.errorText=h.translate("storeSearch.Address_ErrMsg");this.model.searchStoreList={}}else if(iscCore.isVoid(this.ui.personInfo.State)){this.ui.errorText=h.translate("storeSearch.Address_ErrMsg");this.model.searchStoreList={}}else{this.ui.errorText="";this.ui.searchedStoreDesc="";this.ui.searchedStore="";this.model.searchStoreList={};var e={AlternateStore:{NodeSearch:{DistanceToConsider:this.ui.searchRadius,DistanceToConsiderUOM:this.ui.distanceUOM,FulfillmentType:this.model.FulfillmentType.Rules.RuleSetValue,ShipToAddress:{Country:this.ui.personInfo.Country,City:this.ui.personInfo.City,State:this.ui.personInfo.State.RegionName,ZipCode:this.ui.personInfo.ZipCode}},OrderLines:{OrderLine:{RequiredQty:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.RequiredQty,Item:{ItemID:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.ItemID,ProductClass:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.ProductClass,UnitOfMeasure:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.UnitOfMeasure}}}}};o.callPaginatedMashup(this,"storeSearchgetAlternateStoreAvailability",e,"START",{}).then(this.getSearchStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false;this.ui.searchStore="false";this.ui.nearbyView="false";this.ui.searchView="true";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var t=this;this.ui.nearWach=a.$watch(function(e){return e.ui.nearRadius},function(e,i){t.onNearRadiusChange(e,i)});this.ui.searchWach=a.$watch(function(e){return e.ui.searchRadius},function(e,i){t.onSearchRadiusChange(e,i)})}}else{this.ui.errorText="";this.model.searchStoreList={};var i="";if(!iscCore.isVoid(this.ui.personInfo.State)){i=this.ui.personInfo.State.RegionName}var e={AlternateStore:{NodeSearch:{DistanceToConsider:this.ui.searchRadius,DistanceToConsiderUOM:this.ui.distanceUOM,FulfillmentType:this.model.FulfillmentType.Rules.RuleSetValue,ShipToAddress:{Country:this.ui.personInfo.Country,City:this.ui.personInfo.City,State:i,ZipCode:this.ui.personInfo.ZipCode}},OrderLines:{OrderLine:{RequiredQty:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.RequiredQty,Item:{ItemID:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.ItemID,ProductClass:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.ProductClass,UnitOfMeasure:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.UnitOfMeasure}}}}};o.callPaginatedMashup(this,"storeSearchgetAlternateStoreAvailability",e,"START",{}).then(this.getSearchStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false;this.ui.searchStore="false";this.ui.nearbyView="false";this.ui.searchView="true";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var t=this;this.ui.nearWach=a.$watch(function(e){return e.ui.nearRadius},function(e,i){t.onNearRadiusChange(e,i)});this.ui.searchWach=a.$watch(function(e){return e.ui.searchRadius},function(e,i){t.onSearchRadiusChange(e,i)})}},uiAlternateSearchStoreGetNextRecords:function(){var e="";if(!iscCore.isVoid(this.ui.personInfo.State)){e=this.ui.personInfo.State.RegionName}var i={AlternateStore:{NodeSearch:{DistanceToConsider:this.ui.searchRadius,DistanceToConsiderUOM:this.ui.distanceUOM,FulfillmentType:this.model.FulfillmentType.Rules.RuleSetValue,ShipToAddress:{Country:this.ui.personInfo.Country,City:this.ui.personInfo.City,State:e,ZipCode:this.ui.personInfo.ZipCode}},OrderLines:{OrderLine:{RequiredQty:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.RequiredQty,Item:{ItemID:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.ItemID,ProductClass:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.ProductClass,UnitOfMeasure:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.UnitOfMeasure}}}}};if(this.ui.FetchNextRecords===true){o.callPaginatedMashup(this,"storeSearchgetAlternateStoreAvailability",i,"NEXT",{}).then(this.getSearchStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false}},getSearchStoreAvailibility:function(){if(iscCore.isVoid(this.model.searchStoreList.Page.Output.AlternateStores.NodeList)&&this.ui.searchButtonClick=="true"){this.ui.errorText="";this.ui.searchStore="true";this.ui.nearbyView="false";this.ui.searchView="false";this.ui.noStoreFound=h.translate("storeSearch.Store_ErrMsg");this.ui.noOfStoresSearched=""}else if(iscCore.isVoid(this.model.searchStoreList.Page.Output.AlternateStores.NodeList)){this.ui.errorText=h.translate("storeSearch.Store_ErrMsg");this.ui.noOfStoresSearched="";this.ui.searchButtonClick="false";this.ui.noStoreFound=""}else{if(this.model.searchStoreList.Page.Output.AlternateStores.NodeList.TotalNumberOfRecords==0){this.ui.errorText=h.translate("storeSearch.Store_ErrMsg")}else{this.ui.errorText=""}this.ui.noStoreFound="";this.ui.searchButtonClick="false";if(iscCore.isVoid(this.ui.searchedStoreDesc)){this.ui.searchedStoreDesc=this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node[0].Description;this.ui.searchedStore=this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node[0]}this.ui.noOfStoresSearched=h.translate("storeSearch.LABEL_Stores_found",{noOfStores:this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node.length});this.model.searchStoreList=d.fetchAvailability(this.model.searchStoreList)}this.ui.FetchNextRecords=true;this.ui.searchApiExecComplete="true";this.ui.oldSearchRadius=""},onSearchRadiusChange:function(e,i){if(!iscCore.isVoid(this.ui.oldSearchRadius)){i=this.ui.oldSearchRadius}if(!(e==i)){if(this.ui.searchApiExecComplete=="false"){this.ui.searchRadius=i}else if(this.ui.searchApiExecComplete=="true"){this.ui.oldSearchRadius=i;this.ui.errorText="";this.ui.searchedStoreDesc="";this.ui.searchedStore="";this.model.searchStoreList={};var t="";if(!iscCore.isVoid(this.ui.personInfo.State)){t=this.ui.personInfo.State.RegionName}var r={AlternateStore:{NodeSearch:{DistanceToConsider:e,DistanceToConsiderUOM:this.ui.distanceUOM,FulfillmentType:this.model.FulfillmentType.Rules.RuleSetValue,ShipToAddress:{Country:this.ui.personInfo.Country,City:this.ui.personInfo.City,State:t,ZipCode:this.ui.personInfo.ZipCode}},OrderLines:{OrderLine:{RequiredQty:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.RequiredQty,Item:{ItemID:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.ItemID,ProductClass:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.ProductClass,UnitOfMeasure:this.ui.getAlternateStoreAvailabilityInput.AlternateStore.OrderLines.OrderLine.Item.UnitOfMeasure}}}}};o.callPaginatedMashup(this,"storeSearchgetAlternateStoreAvailability",r,"START",{}).then(this.getSearchStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.searchApiExecComplete="false";this.ui.FetchNextRecords=false}}},handleGetAlternateStoreError:function(){this.ui.errorText=h.translate("storeSearch.Store_ErrMsg")},handleGetFulfillmentTypeError:function(){this.ui.AlternateStoreInput.AlternateStore.NodeSearch.FulfillmentType=""},onSuccessGetFulfillmentType:function(){this.onSuccessGetMaxRadiusValue();this.onSuccessDistanceUOM();this.onSuccessGetDefaultRadiusValue()},onSuccessDistanceUOM:function(){this.ui.distanceUOM=this.model.distanceUOM.Rules.RuleSetValue;this.ui.distanceUOMDesc=this.model.distanceUOM.Rules.DistanceUOMDesc},uiInitShip:function(){if(this.ui.shipUnAvailable=="Y"){this.ui.availabiltyErrorText=h.translate("fulfillmentOptions.ErrMsg")}else if(this.ui.shipUnAvailable=="N"){this.ui.newDelMethod="SHP";if(this.ui.carrierUnAvailable=="N"){this.ui.addShipAddress="false";this.ui.editShipAddress="false";this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.EarliestShipDate=this.ui.EarliestShipDate;var e=this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo;if(!iscCore.isVoid(e)){if(!iscCore.isVoid(e.State)){if(!iscCore.isVoid(e.State.RegionName)){var i=e.State.RegionName;this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo.State="";this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo.State=i}}}o.callMashup(this,"fulfillmentoptionsgetCarrierServiceOptionsForOrdering",this.ui.getCarrierServiceOptionsForOrderingInput,{}).then(this.onSuccessCarrierServiceOptionsForOrdering.bind(this),angular.noop)}else if(this.ui.carrierUnAvailable=="Y"){this.ui.addShipAddress="true";this.ui.editShipAddress="false"}}},onSuccessCarrierServiceOptionsForOrdering:function(){if(iscCore.isVoid(this.model.CarrierServiceOptions.Order.OrderLines.OrderLine[0].CarrierServiceList)){this.ui.carrierUnAvailable="N";this.ui.editShipAddress="false";this.ui.addShipAddress="false";this.ui.noCarriers="true";this.ui.carriersNotConfigured=h.translate("fulfillmentOptions.LABEL_CarriersNotConfigured",{EShipDate:u("date")(this.ui.EarliestShipDate,"fullDate")})}else{var e={CarrierServiceDesc:"None"};this.model.CarrierServiceOptions.Order.OrderLines.OrderLine[0].CarrierServiceList.CarrierService.splice(0,0,e);this.ui.selectedCarrier=this.model.CarrierServiceOptions.Order.OrderLines.OrderLine[0].CarrierServiceList.CarrierService[0];this.ui.selectedCarrierDesc=this.model.CarrierServiceOptions.Order.OrderLines.OrderLine[0].CarrierServiceList.CarrierService[0].CarrierServiceDesc;this.ui.noCarriers="false";this.ui.carrierUnAvailable="N";this.ui.editShipAddress="false";this.ui.addShipAddress="false";var i=this.model.CarrierServiceOptions.Order.OrderLines.OrderLine[0].CarrierServiceList.CarrierService.length;if(!iscCore.isVoid(i)){for(var t=0;t<this.model.CarrierServiceOptions.Order.OrderLines.OrderLine[0].CarrierServiceList.CarrierService.length;t++){if(this.ui.selectedCarrierServiceCode==this.model.CarrierServiceOptions.Order.OrderLines.OrderLine[0].CarrierServiceList.CarrierService[t].CarrierServiceCode){this.ui.selectedCarrierDesc=this.model.CarrierServiceOptions.Order.OrderLines.OrderLine[0].CarrierServiceList.CarrierService[t].CarrierServiceDesc}}}}},uiEditShipTo:function(){this.ui.carrierUnAvailable="Y";this.ui.addShipAddress="false";this.ui.editShipAddress="true"},uiAddShipTo:function(){if(this.ui.carrierUnAvailable=="Y"){this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.EarliestShipDate=this.ui.EarliestShipDate;var e=this;if(a.currentSelection&&!a.holdAPIcall){e.ui.availabiltyErrorText="";e.setAddress(a.currentSelection);o.callMashup(e,"fulfillmentoptionsgetItemAvailabilityForStore",e.ui.getItemAvailabilityForStoreInput,{}).then(e.onSuccessgetItemAvailability.bind(e),angular.noop)}else{a.$broadcast("callVerifyAddress",{})}}},onSuccessgetItemAvailabilityForStore:function(){if(iscCore.isVoid(this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities)){this.ui.availabiltyErrorText=h.translate("fulfillmentOptions.ErrMsg")}else{var e=this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability.length;if(iscCore.isVoid(e)){var i=this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability;if(i.DeliveryMethod=="SHP"){this.ui.pickupUnAvailable="Y";this.ui.InStoreUnAvailable="Y";this.ui.shipUnAvailable=i.HasAnyUnavailableQty;if(this.ui.shipUnAvailable=="N"){this.ui.EarliestShipDate=i.EarliestShipDate;if(i.IsAvailableToday=="Y"){this.ui.displayEarliestShipDate=h.translate("globals.LABEL_ItemShpAvailableToday")}else{this.ui.displayEarliestShipDate=h.translate("fulfillmentOptions.LABEL_EarliestShipDate",{EarliestShipDate:u("date")(this.ui.EarliestShipDate,"fullDate")})}}if(iscCore.isVoid(this.ui.getCarrierServiceOptionsForOrderingInput.Order.PersonInfoShipTo)){if(iscCore.isVoid(this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo)){this.ui.carrierUnAvailable="Y";this.ui.addShipAddress="true";this.ui.editShipAddress="false"}}}}else{if(this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability.length==2){this.ui.shipUnAvailable="Y"}for(var t=0;t<this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability.length;t++){var r=this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability[t];if(r.DeliveryMethod=="PICK"){this.ui.pickupUnAvailable=r.HasAnyUnavailableQty}else if(r.DeliveryMethod=="SHP"){this.ui.shipUnAvailable=r.HasAnyUnavailableQty;if(this.ui.shipUnAvailable=="N"){this.ui.EarliestShipDate=r.EarliestShipDate;if(r.IsAvailableToday=="Y"){this.ui.displayEarliestShipDate=h.translate("globals.LABEL_ItemShpAvailableToday")}else{this.ui.displayEarliestShipDate=h.translate("fulfillmentOptions.LABEL_EarliestShipDate",{EarliestShipDate:u("date")(this.ui.EarliestShipDate,"fullDate")})}}if(iscCore.isVoid(this.ui.getCarrierServiceOptionsForOrderingInput.Order.PersonInfoShipTo)){if(iscCore.isVoid(this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo)){this.ui.carrierUnAvailable="Y";this.ui.addShipAddress="true";this.ui.editShipAddress="false"}}}else{this.ui.InStoreUnAvailable=r.HasAnyUnavailableQty}}}}if(this.ui.currentDelMethod=="PICK"){this.uiInitPickup()}else if(this.ui.currentDelMethod=="SHP"){this.uiInitShip()}else if(this.ui.currentDelMethod=="CARRY"){this.uiInitInStore()}},onSuccessgetItemAvailability:function(){if(iscCore.isVoid(this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities)){this.ui.availabiltyErrorText=h.translate("fulfillmentOptions.ErrMsg")}else{var e=this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability.length;if(iscCore.isVoid(e)){var i=this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability;if(i.DeliveryMethod=="SHP"){this.ui.pickupUnAvailable="Y";this.ui.InStoreUnAvailable="Y";this.ui.shipUnAvailable=i.HasAnyUnavailableQty;if(this.ui.shipUnAvailable=="N"){this.ui.EarliestShipDate=i.EarliestShipDate;if(i.IsAvailableToday=="Y"){this.ui.displayEarliestShipDate=h.translate("globals.LABEL_ItemShpAvailableToday")}else{this.ui.displayEarliestShipDate=h.translate("fulfillmentOptions.LABEL_EarliestShipDate",{EarliestShipDate:u("date")(this.ui.EarliestShipDate,"fullDate")})}this.model.CarrierServiceOptions={};o.callMashup(this,"fulfillmentoptionsgetCarrierServiceOptionsForOrdering",this.ui.getCarrierServiceOptionsForOrderingInput,{}).then(this.onSuccessCarrierServiceOptionsForOrdering.bind(this),angular.noop)}}}else{if(this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability.length==2){this.ui.shipUnAvailable="Y"}for(var t=0;t<this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability.length;t++){var r=this.model.fulfillmentOptionsItemAvailability.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability[t];if(r.DeliveryMethod=="PICK"){this.ui.pickupUnAvailable=r.HasAnyUnavailableQty}else if(r.DeliveryMethod=="SHP"){this.ui.shipUnAvailable=r.HasAnyUnavailableQty;if(this.ui.shipUnAvailable=="N"){this.ui.EarliestShipDate=r.EarliestShipDate;if(r.IsAvailableToday=="Y"){this.ui.displayEarliestShipDate=h.translate("globals.LABEL_ItemShpAvailableToday")}else{this.ui.displayEarliestShipDate=h.translate("fulfillmentOptions.LABEL_EarliestShipDate",{EarliestShipDate:u("date")(this.ui.EarliestShipDate,"fullDate")})}this.model.CarrierServiceOptions={};o.callMashup(this,"fulfillmentoptionsgetCarrierServiceOptionsForOrdering",this.ui.getCarrierServiceOptionsForOrderingInput,{}).then(this.onSuccessCarrierServiceOptionsForOrdering.bind(this),angular.noop)}}else{this.ui.InStoreUnAvailable=r.HasAnyUnavailableQty}}}}},setAddress:function(e){this.ui.personInfoShipTo={};this.ui.personInfoShipTo.Country=e.Country;this.ui.personInfoShipTo.City=e.City;this.ui.personInfoShipTo.State=e.State;this.ui.personInfoShipTo.ZipCode=e.ZipCode;this.ui.personInfoShipTo.AddressLine1=e.AddressLine1;this.ui.personInfoShipTo.FirstName=e.FirstName;this.ui.personInfoShipTo.LastName=e.LastName;this.ui.personInfoShipTo.EMailID=e.EMailID;this.ui.personInfoShipTo.DayPhone=e.DayPhone;this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo={};this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo.Country=e.Country;this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo.City=e.City;this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo.State=e.State;this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo.ZipCode=e.ZipCode;this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo.AddressLine1=e.AddressLine1;this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo.FirstName=e.FirstName;this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo.LastName=e.LastName;this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo.EMailID=e.EMailID;this.ui.getCarrierServiceOptionsForOrderingInput.Order.OrderLines.OrderLine.PersonInfoShipTo.DayPhone=e.DayPhone;this.ui.getItemAvailabilityForStoreInput.Promise.PromiseLines.PromiseLine.ShipToAddress={};this.ui.getItemAvailabilityForStoreInput.Promise.PromiseLines.PromiseLine.ShipToAddress.Country=e.Country;this.ui.getItemAvailabilityForStoreInput.Promise.PromiseLines.PromiseLine.ShipToAddress.City=e.City;this.ui.getItemAvailabilityForStoreInput.Promise.PromiseLines.PromiseLine.ShipToAddress.State=e.State;this.ui.getItemAvailabilityForStoreInput.Promise.PromiseLines.PromiseLine.ShipToAddress.ZipCode=e.ZipCode;this.ui.getItemAvailabilityForStoreInput.Promise.PromiseLines.PromiseLine.ShipToAddress.AddressLine1=e.AddressLine1;this.ui.getItemAvailabilityForStoreInput.Promise.PromiseLines.PromiseLine.ShipToAddress.FirstName=e.FirstName;this.ui.getItemAvailabilityForStoreInput.Promise.PromiseLines.PromiseLine.ShipToAddress.LastName=e.LastName;this.ui.getItemAvailabilityForStoreInput.Promise.PromiseLines.PromiseLine.ShipToAddress.EMailID=e.EMailID;this.ui.getItemAvailabilityForStoreInput.Promise.PromiseLines.PromiseLine.ShipToAddress.DayPhone=e.DayPhone},uiClose:function(){s.dismiss("cancel")},uiSubmit:function(){if(this.ui.newDelMethod=="SHP"){if(this.ui.shipUnAvailable=="N"){var e=this.ui.personInfoShipTo;if(!iscCore.isVoid(e)){if(!iscCore.isVoid(e.State)){if(!iscCore.isVoid(e.State.RegionName)){var i=e.State.RegionName;this.ui.personInfoShipTo.State="";this.ui.personInfoShipTo.State=i}}}var t=angular.copy(this.ui.selectedCarrier);if(!iscCore.isVoid(t)){if(t.CarrierServiceDesc=="None"){t=""}}var r={};if(angular.equals(this.ui.personInfoShipTo,this.ui.tmpPersonInfoShipTo)){r={data:{currentDelMethod:this.ui.currentDelMethod,newDelMethod:this.ui.newDelMethod,selectedCarrier:t,EarliestShipDate:this.ui.EarliestShipDate,personInfoShipTo:""}}}else{r={data:{currentDelMethod:this.ui.currentDelMethod,newDelMethod:this.ui.newDelMethod,selectedCarrier:t,EarliestShipDate:this.ui.EarliestShipDate,personInfoShipTo:this.ui.personInfoShipTo}}}s.close(r)}}else if(this.ui.newDelMethod=="PICK"){if(this.ui.pickupUnAvailable=="N"){if(this.ui.searchView=="true"){this.ui.selectedStore=this.ui.searchedStore}else if(this.ui.nearbyView=="true"){this.ui.selectedStore=this.ui.nearStore}if(this.ui.selectedStore.Available=="false"){this.ui.errorText=h.translate("storeSearch.OutofStock_ErrMsg")}else{var r={data:{currentDelMethod:this.ui.currentDelMethod,newDelMethod:this.ui.newDelMethod,selectedStore:this.ui.selectedStore}};s.close(r)}}}else if(this.ui.newDelMethod=="CARRY"){if(this.ui.InStoreUnAvailable=="N"){this.ui.InStrAvailabilityError="N";var r={data:{currentDelMethod:this.ui.currentDelMethod,newDelMethod:this.ui.newDelMethod,InStoreAvailability:"Y"}};s.close(r)}else{this.ui.InStrAvailabilityError="Y";this.ui.availabiltyErrorText=h.translate("fulfillmentOptions.ErrMsg")}}}})}]);
angular.module("store").controller("store.views.common.gift.giftoptions",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscModal","iscI18n",function(i,e,t,s,a,f,g,o,u){s.initializeModalScreen(i,{model:{IsgiftWrap:{}},mashupRefs:[{mashupRefId:"giftwrapgetRuleDetails",mashupId:"WSC_getRuleDetails",modelName:"IsgiftWrap"}],ui:{giftFlag:"Y",giftWrap:"",giftWrapChecked:"N",FirstName:"",giftMessage:"",giftWrapCheck:"false",showRemoveGift:"N"},initialize:function(){if(iscCore.isVoid(a.gift.giftWrap)){this.ui.giftWrap="Y"}else{this.ui.giftWrap=a.gift.giftWrap}this.ui.FirstName=a.gift.giftRecipient;this.ui.giftMessage=a.gift.giftMessage;if(iscCore.isVoid(a.gift.giftWrapChecked)){this.ui.giftWrapChecked="N"}else{this.ui.giftWrapChecked=a.gift.giftWrapChecked}if(iscCore.isVoid(a.gift.showRemoveGift)){this.ui.showRemoveGift="N"}else{this.ui.showRemoveGift=a.gift.showRemoveGift}var i={Rules:{RuleSetFieldName:"WSC_STORE_ALLOW_GIFT_WRAP"}};f.callMashup(this,"giftwrapgetRuleDetails",i,{}).then(this.onSuccessgiftwrapgetRuleDetails.bind(this),angular.noop)},uiClose:function(){t.dismiss("cancel")},uiRemoveGift:function(){var i={data:{removeGift:"Y"}};t.close(i)},uiSubmit:function(){var i={data:{giftFlag:this.ui.giftFlag,giftRecipient:this.ui.FirstName,giftMessage:this.ui.giftMessage,giftWrapChecked:this.ui.giftWrapChecked}};t.close(i)},onSuccessgiftwrapgetRuleDetails:function(){if(this.model.IsgiftWrap.Rules.RuleSetValue=="Y"){if(this.ui.giftWrap=="Y"){this.ui.giftWrapCheck="true"}else{this.ui.giftWrapCheck="false"}}}})}]);
angular.module("store").controller("store.views.common.orderaddress.orderaddresspopup",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission",function(s,e,a,i,o,t,n){i.initializeModalScreen(s,{ui:{hideShipaddress:false},uiClose:function(){a.dismiss("cancel")},uiManageOnEnter:function(){s.uiOK()},uiOK:function(){if(s.currentSelection&&!s.holdAPIcall){a.close(s.currentSelection)}else{s.$broadcast("callVerifyAddress",{})}},initialize:function(){s.holdAPIcall=false;this.ui.mode=o.Mode;this.ui.hideShipaddress=o.hideShipaddress;this.ui.context=o.Context;if(this.ui.mode=="Edit"){this.ui.personInfo=o.PersonInfo}if(!this.ui.context){this.ui.context="showDefaultshipto"}s.$on("AddressVerified",function(e,i){if(i){var o=angular.copy(i.data);if(i.State=="SINGLE_ADDRESS"){var t={data:o};s.holdAPIcall=false;a.close(t)}else if(i.State=="MULTI_ADDRESS"){s.currentSelection={data:o};s.holdAPIcall=false}else if(i.State=="MODIFY_ADDRESS"){s.currentSelection={data:o};s.holdAPIcall=true}}})}})}]);
angular.module("store").controller("store.views.common.priceoverride.priceoverride",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n",function(i,e,r,s,t,o,n,c,a){s.initializeModalScreen(i,{model:{reasonList:{}},mashupRefs:[{mashupRefId:"priceoverridegetOverrideReasonList",mashupId:"priceoverride_getCommonCodeListForStore",modelName:"reasonList"}],ui:{listPrice:"",tmplistPrice:"",UnitPrice:"",tmpUnitPrice:"",DisplayUnitPrice:"",selectedReason:"",Currency:"",ariaErrMsg:""},initialize:function(){this.ui.listPrice=t.price.listPrice;this.ui.UnitPrice=t.price.unitPrice;this.ui.Currency=t.price.Currency;if(!iscCore.isVoid(this.ui.UnitPrice)){this.ui.DisplayUnitPrice=o("iscCurrency")(angular.copy(this.ui.UnitPrice),this.ui.Currency)}n.callMashup(this,"priceoverridegetOverrideReasonList",{},{}).then(this.onsucesspriceoverridegetOverrideReasonList.bind(this),angular.noop)},uiClose:function(){r.dismiss("cancel")},uiSubmit:function(i){if(i&&i.$valid){this.ui.ariaErrMsg="";if(iscCore.isVoid(this.ui.UnitPrice)){i.currencyField.$setValidity("required",false);this.ui.ariaErrMsg=a.translate("priceoverride.aria_ErrMsg");document.getElementById("displayCurrencyField").focus()}else{i.currencyField.$setValidity("required",true);this.ui.ariaErrMsg="";var e={};e={data:{newprice:this.ui.UnitPrice,reason:this.ui.selectedReason}};r.close(e)}}else{this.ui.ariaErrMsg=a.translate("priceoverride.aria_ErrMsg")}},uiOnEnterInputField:function(i){this.uiSubmit(i)},onsucesspriceoverridegetOverrideReasonList:function(){if(iscCore.isVoid(this.ui.selectedReason)&&!iscCore.isVoid(this.model.reasonList.CommonCodeList)){if(!iscCore.isVoid(this.model.reasonList.CommonCodeList.CommonCode[0]))this.ui.selectedReason=this.model.reasonList.CommonCodeList.CommonCode[0].CodeShortDescription}}})}]);
angular.module("store").controller("store.views.common.product.product-details-share",["$scope","$uibModalInstance","modalInput","$filter","iscScreen","iscMashup","iscDomUtility","$timeout",function(e,t,i,s,a,o,m,l){a.initializeModalScreen(e,{model:{customerDetails:{}},mashupRefs:[{mashupRefId:"getCustomerDetails",mashupId:"store.views.common.product.getCustomerDetails",modelName:"customerDetails"},{mashupRefId:"productdetails_sendEmail",mashupId:"store.views.common.product.sendProductDetailsInEmail"}],ui:{emailid:"",showEmailError:false,emailSent:false,emailForm:{}},initialize:function(){if(!iscCore.isVoid(i.CustomerDetails.CustomerID)){o.callMashup(this,"getCustomerDetails",{Customer:{CustomerID:i.CustomerDetails.CustomerID}},{}).then(this.handleInitApi.bind(this),angular.noop)}l(function(){m.setFocus(document.getElementById("productdetails_emailId"))},0)},handleInitApi:function(e){var t=o.getMashupOutput(e,"getCustomerDetails");var i=t.Customer.CustomerID;if(t.Customer.CustomerContactList&&t.Customer.CustomerContactList.CustomerContact[0]&&t.Customer.CustomerContactList.CustomerContact[0].EmailID){this.ui.emailid=t.Customer.CustomerContactList.CustomerContact[0].EmailID}},uiSendEmail:function(){var t=this;l(function(){t.ui.emailForm.$setDirty();if(iscCore.isVoid(t.ui.emailid)||!t.ui.emailForm.$valid){t.ui.showEmailError=true;document.getElementById("productdetails_emailId").focus()}else if(t.ui.emailForm.$valid){var e={};e.ItemdDetails={};e.ItemdDetails.ItemID=i.ItemDetails.ItemID;e.ItemdDetails.ItemKey=i.ItemDetails.ItemKey;e.ItemdDetails.UnitOfMeasure=i.ItemDetails.UnitOfMeasure;e.ItemdDetails.CustomerID=i.CustomerDetails.CustomerID;e.ItemdDetails.ToEmailID=this.ui.emailid;o.callMashup(t,"productdetails_sendEmail",e,{}).then(t.emailCallBackHandler.bind(t),angular.noop)}}.bind(this),200)},uiResetEmailFlags:function(){var e=document.getElementById("productdetails_emailId").value;if(!iscCore.isVoid(e)){this.ui.emailSent=false;this.ui.showEmailError=false}},emailCallBackHandler:function(e){var t=o.getMashupOutput(e,"productdetails_sendEmail");if(t){this.ui.emailSent=true}},uiClose:function(){t.dismiss({})}})}]);
angular.module("store").controller("store.views.common.product.product-details",["$scope","$rootScope","$uibModalInstance","iscScreen","iscProduct","iscWizard","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal",function(e,t,i,s,r,o,l,n,m,a,u,c){s.initializeModalScreen(e,{model:{itemDetails:{},itemSpecDetails:{},itemCompDetails:{},orderline:{}},mashupRefs:[{mashupRefId:"getCompleteItemDetails",mashupId:"product_getCompleteItemList"},{mashupRefId:"getCompleteItemSpecsList",mashupId:"product_getCompleteItemSpecsList"},{mashupRefId:"getCompleteItemComponentList",mashupId:"product_getCompleteItemComponentList"}],ui:{selectedReason:"",carousel:{myInterval:0,noWrapSlides:false,data:[]},openOverview:true,openSpecs:false,openComponents:false,showComponents:false,itemSpecsEmpty:false},initialize:function(){this.model.orderline=l.orderline;m.callMashup(this,"getCompleteItemDetails",this.getCompleteItemListInput(),{}).then(this.initializeItemDetails.bind(this),angular.noop)},initializeItemDetails:function(e){var t=m.getMashupOutput(e,"getCompleteItemDetails");if(t.ItemList.Item){this.model.itemDetails=r.getFirstItemChildElementFromItemList(t)}else{console.log("ERROR: Unable to fetch Item Details - ",t)}console.log("Item Details - ",this.model.itemDetails);this.prepareProductCarouselData(this.model.itemDetails);if(r.isPhysicalKit(this.model.itemDetails)||r.isBundleParent(this.model.itemDetails)){this.ui.showComponents=true}},prepareProductCarouselData:function(e){if(!iscCore.isVoid(e.Item)&&!iscCore.isVoid(e.Item.AssetList)&&!iscCore.isVoid(e.Item.AssetList.Asset)){var t=n("number")(e.Item.AssetList.Asset.length);if(!isNaN(t)&&t>0){this.ui.carousel.hasSlides=true;var i=0;for(var s=0;s<e.Item.AssetList.Asset.length;s++){var o=e.Item.AssetList.Asset[s];if(!iscCore.isVoid(o)){var l=r.getImageURLByAsset(o);var m=o.Label;this.ui.carousel.data[i]={};this.ui.carousel.data[i].productImage=[];var a=[];a[0]={ImageURL:l,ImageLabel:m};this.ui.carousel.data[i].productImage=a;i++}}}}console.log("Product Carousel Data - ",this.ui.carousel)},uiGetExtendedDescription:function(e){if(!iscCore.isVoid()){e=e.replaceAll(/\n/g,"<br />")}return e},uiOnTabClick:function(e){if("SPECS"===e&&iscCore.isVoid(this.model.itemSpecDetails)){m.callMashup(this,"getCompleteItemSpecsList",this.getCompleteItemListInput(),{}).then(this.initializeItemSpecifications.bind(this),angular.noop)}else if("COMPONENTS"===e&&iscCore.isVoid(this.model.itemCompDetails)){m.callMashup(this,"getCompleteItemComponentList",this.getCompleteItemListInput(),{}).then(this.initializeItemComponents.bind(this),angular.noop)}},initializeItemSpecifications:function(e){var t=m.getMashupOutput(e,"getCompleteItemSpecsList");if(t.ItemList.Item){this.model.itemSpecDetails=r.getFirstItemChildElementFromItemList(t)}else{console.log("ERROR: Unable to fetch Item Specs Details - ",t)}if(iscCore.isVoid(this.model.itemSpecDetails.Item.ItemAttributeGroupTypeList.ItemAttributeGroupType.ItemAttributeGroupList.ItemAttributeGroup)){this.ui.itemSpecsEmpty=true}console.log("Item Specs Details - ",this.model.itemSpecDetails)},initializeItemComponents:function(e){var t=m.getMashupOutput(e,"getCompleteItemComponentList");if(t.ItemList.Item){this.model.itemCompDetails=r.getFirstItemChildElementFromItemList(t)}else{console.log("ERROR: Unable to fetch Component Specs Details - ",t)}console.log("Item Component Details - ",this.model.itemCompDetails)},uiIsBlankImage:function(e){return iscCore.isVoid(this.uiGetComponentImageUrl(e))?true:false},uiGetComponentImageUrl:function(e){var t=null;if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Item)&&!iscCore.isVoid(e.Item.PrimaryInformation)){var i=e.Item.PrimaryInformation.ImageLocation;var s=e.Item.PrimaryInformation.ImageID;if(!iscCore.isVoid(s)&&!iscCore.isVoid(i)){t=i+"/"+s}}return t},uiGetAttributeName:function(e){return iscCore.isVoid(e.Attribute.ShortDescription)?e.ItemAttributeName:e.Attribute.ShortDescription},uiGetAttributeValue:function(e){var t="-";if(!iscCore.isVoid(e.AssignedValueList)&&!iscCore.isVoid(e.AssignedValueList.AssignedValue)&&!iscCore.isVoid(e.AssignedValueList.AssignedValue.length)){t=e.AssignedValueList.AssignedValue[0].ShortDescription;if(!iscCore.isVoid(t)){if("Y"==t){t=u.translate("globals.ACTION_Yes")}else if("N"==t){t=u.translate("globals.ACTION_No")}}else{t="-"}}return t},getCompleteItemListInput:function(){var e={};e.Item={};if(!iscCore.isVoid(this.model.orderline)&&!iscCore.isVoid(this.model.orderline.ItemDetails)&&!iscCore.isVoid(this.model.orderline.ItemDetails.ItemID)&&!iscCore.isVoid(this.model.orderline.ItemDetails.UnitOfMeasure)){e.Item.ItemID=this.model.orderline.ItemDetails.ItemID;e.Item.UnitOfMeasure=this.model.orderline.ItemDetails.UnitOfMeasure}else{console.log("ERROR: ItemID or UnitOfMeasure is null for orderline - ",this.model.orderline)}return e},uiClose:function(){i.dismiss({})}})}]);
angular.module("store").controller("store.views.common.shortage.record-shortage",["$scope","$rootScope","$uibModalInstance","iscScreen","iscWizard","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal",function(i,e,o,s,a,t,n,c,l,h,r){s.initializeModalScreen(i,{model:{shortageReasonList:{},cancelReasonList:{},shipmentLine:{}},mashupRefs:[{mashupRefId:"getShortageReasonList",mashupId:"recordShortage_getShortageReasonList",modelName:"shortageReasonList"},{mashupRefId:"getCancelReasonList",mashupId:"recordShortage_getShortageReasonList",modelName:"cancelReasonList"}],ui:{selectedShortageReasonCode:"",processType:"BACKROOM_PICK",showCancelReason:false,cancelReason:"",markAllLines:false},initialize:function(){var o=this;i.$watch("ui.selectedShortageReasonCode",function(e){if(!iscCore.isVoid(e)){o.onShortageReasonSelect(e)}});this.model.shipmentLine=t.shipmentLine;var e=t.codeType;if(iscCore.isVoid(e)){e="YCD_PICK_SHORT_RESOL";this.ui.processType="BACKROOM_PICK"}else if(e.indexOf("PACK")>-1){this.ui.processType="PACK"}else if(e.indexOf("YCD_SHORT_RESOLU")>-1){this.ui.processType="CUSTOMER_PICKUP"}var s={};s.CommonCode={};s.CommonCode.CodeType=e;c.callMashup(this,"getShortageReasonList",s,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){if(iscCore.isVoid(this.ui.selectedShortageReasonCode)){this.ui.selectedShortageReasonCode=this.model.shortageReasonList.CommonCodeList.CommonCode[0].CodeValue}},onShortageReasonSelect:function(e){if(this.ui.mode="CUSTOMER_PICKUP"&&e==="Cancel"){this.ui.showCancelReason=true;if(iscCore.isVoid(this.model.cancelReasonList)){var o={};o.CommonCode={};o.CommonCode.CodeType="YCD_CANCEL_REASON";c.callMashup(this,"getCancelReasonList",o,{}).then(function(e){if(iscCore.isVoid(this.ui.cancelReason)){this.ui.cancelReason=this.model.cancelReasonList.CommonCodeList.CommonCode[0]}}.bind(this),angular.noop)}}else{this.ui.showCancelReason=false}},uiClose:function(){o.dismiss({})},uiSubmit:function(){var e={};e={data:{RecordShortage:{ShortageReasonCode:this.ui.selectedShortageReasonCode}}};if(this.ui.processType!="BACKROOM_PICK"){e.data.RecordShortage.MarkAllLines=this.ui.markAllLines;if(this.ui.processType=="CUSTOMER_PICKUP"&&this.ui.selectedShortageReasonCode==="Cancel"){e.data.RecordShortage.CancellationReason=this.ui.cancelReason.CodeValue}}o.close(e)}})}]);
angular.module("store").controller("store.views.common.storesearch.storesearch",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscAppContext","$filter","iscI18n","iscItem",function(r,e,t,i,o,u,s,h,a,n,c){i.initializeModalScreen(r,{model:{storeList:{},defaultRadiusValue:{},maxRadiusValue:{},distanceUOM:{},searchStoreList:{},FulfillmentType:{}},mashupRefs:[{mashupRefId:"storeSelectiongetAlternateStoreAvailability",mashupId:"storeSelection_getAlternateStoreAvailability",isPaginated:"true",modelName:"storeList",append:true,appendPath:"AlternateStores.NodeList.Node"},{mashupRefId:"storeSearchgetAlternateStoreAvailability",mashupId:"storeSelection_getAlternateStoreAvailability",isPaginated:"true",modelName:"searchStoreList",append:true,appendPath:"AlternateStores.NodeList.Node"},{mashupRefId:"wscCommonGetDefaultRadiusValue",mashupId:"WSC_getRuleDetails",modelName:"defaultRadiusValue"},{mashupRefId:"wscCommonGetMaxRadiusValue",mashupId:"WSC_getRuleDetails",modelName:"maxRadiusValue"},{mashupRefId:"wscDistanceUOM",mashupId:"WSC_getDistanceUOM",modelName:"distanceUOM"},{mashupRefId:"wscCommonGetFulfillmentTypeForStore",mashupId:"WSC_getRuleDetails",modelName:"FulfillmentType"}],ui:{selectedStore:"",searchedStore:"",searchedStoreDesc:"",nearStore:"",nearStoreDesc:"",selectedStoreDesc:"",Country:"",State:"",city:"",ZipCode:"",searchStore:"false",errorText:"",nearbyView:"true",searchView:"false",noOfStoresFound:"",noOfStoresSearched:"",nearRadius:"",maxNearRadius:"",oldNearRadius:"",nearWach:"",searchRadius:"",maxSearchRadius:"",oldSearchRadius:"",distanceUOM:"",distanceUOMDesc:"",searchWach:"",nearApiExecComplete:"true",searchApiExecComplete:"true",personInfo:{},FetchNextRecords:false,noStoreFound:"",searchButtonClick:"false",AlternateStoreInput:{}},initialize:function(){var e=h.getFromContext("storeAddress").ShipNodePersonInfo;if(o.inputData.callingMode=="ADDITEMS"){this.ui.AlternateStoreInput={AlternateStore:{NodeSearch:{ShipToAddress:{Country:e.Country,State:e.State,City:e.City,ZipCode:e.ZipCode}},OrderLines:{OrderLine:{RequiredQty:o.inputData.RequiredQty,Item:{ItemID:o.inputData.itemDetails.ItemID,ProductClass:o.inputData.itemDetails.PrimaryInformation.DefaultProductClass,UnitOfMeasure:o.inputData.itemDetails.UnitOfMeasure}}}}}}else if(o.inputData.callingMode=="CARTDETAILS"){this.ui.AlternateStoreInput={AlternateStore:{NodeSearch:{ShipToAddress:{Country:e.Country,State:e.State,City:e.City,ZipCode:e.ZipCode}},OrderLines:{OrderLine:{RequiredQty:o.inputData.orderLine.OrderLineTranQuantity.OrderedQty,Item:{ItemID:o.inputData.orderLine.ItemDetails.ItemID,ProductClass:o.inputData.orderLine.ItemDetails.ProductClass,UnitOfMeasure:o.inputData.orderLine.ItemDetails.UnitOfMeasure}}}}}}var t={Rules:{RuleSetFieldName:"WSC_STORE_STORE_SEARCH"}};var i={Rules:{RuleSetFieldName:"WSC_STORE_DISTANCE_TO_CONSIDER"}};var r={Rules:{RuleSetFieldName:"WSC_MAX_STORE_DISTANCE_TO_CONSIDER"}};var s={};var a=[];a.push(u.getMashupRefObj(this,"wscCommonGetFulfillmentTypeForStore",t));a.push(u.getMashupRefObj(this,"wscCommonGetDefaultRadiusValue",i));a.push(u.getMashupRefObj(this,"wscCommonGetMaxRadiusValue",r));a.push(u.getMashupRefObj(this,"wscDistanceUOM",s));u.callMashups(this,a,{}).then(function(e){this.onSuccessGetFulfillmentType()}.bind(this),angular.noop)},uiClose:function(){t.dismiss("cancel")},uiSubmit:function(){if(this.ui.searchView=="true"){this.ui.selectedStore=this.ui.searchedStore}else if(this.ui.nearbyView=="true"){this.ui.selectedStore=this.ui.nearStore}if(this.ui.selectedStore.Available=="false"){this.ui.errorText=n.translate("storeSearch.OutofStock_ErrMsg")}else{var e={data:{selectedStore:this.ui.selectedStore}};t.close(e)}},uiBacktoSearch:function(){this.ui.searchStore="true";this.ui.nearbyView="false";this.ui.searchView="false";this.ui.noStoreFound="";this.ui.searchedStoreDesc="";this.ui.searchedStore="";this.ui.errorText="";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach()},uiNearbyView:function(){this.ui.errorText="";if(iscCore.isVoid(this.model.storeList)){this.ui.nearStoreDesc="";this.ui.nearStore="";this.ui.errorText="";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach()}else if(iscCore.isVoid(this.model.storeList.Page.Output.AlternateStores.NodeList)||this.model.storeList.Page.Output.AlternateStores.NodeList.TotalNumberOfRecords==0){this.ui.nearStoreDesc="";this.ui.nearStore="";this.ui.errorText=n.translate("storeSearch.Store_ErrMsg");if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach()}else if(iscCore.isVoid(this.ui.nearStoreDesc)){this.ui.nearStoreDesc=this.model.storeList.Page.Output.AlternateStores.NodeList.Node[0].Description;this.ui.nearStore=this.model.storeList.Page.Output.AlternateStores.NodeList.Node[0];this.ui.errorText="";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var i=this;this.ui.nearWach=r.$watch(function(e){return e.ui.nearRadius},function(e,t){i.onNearRadiusChange(e,t)});this.ui.searchWach=r.$watch(function(e){return e.ui.searchRadius},function(e,t){i.onSearchRadiusChange(e,t)})}else if(!iscCore.isVoid(this.model.storeList.Page.Output.AlternateStores.NodeList)){if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var i=this;this.ui.nearWach=r.$watch(function(e){return e.ui.nearRadius},function(e,t){i.onNearRadiusChange(e,t)});this.ui.searchWach=r.$watch(function(e){return e.ui.searchRadius},function(e,t){i.onSearchRadiusChange(e,t)})}this.ui.searchStore="false";this.ui.nearbyView="true";this.ui.searchView="false"},uiSearchView:function(){this.ui.errorText="";if(iscCore.isVoid(this.model.searchStoreList)){this.ui.searchedStoreDesc="";this.ui.searchedStore="";this.ui.errorText="";this.ui.searchStore="true";this.ui.searchView="false";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach()}else if(iscCore.isVoid(this.model.searchStoreList.Page.Output.AlternateStores.NodeList)||this.model.searchStoreList.Page.Output.AlternateStores.NodeList.TotalNumberOfRecords==0){this.ui.searchedStoreDesc="";this.ui.searchedStore="";if(!iscCore.isVoid(this.ui.noStoreFound)){this.ui.errorText=""}else{this.ui.errorText=n.translate("storeSearch.Store_ErrMsg")}this.ui.searchStore="true";this.ui.searchView="false";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach()}else if(iscCore.isVoid(this.ui.searchedStoreDesc)){this.ui.searchedStoreDesc=this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node[0].Description;this.ui.selectedStore=this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node[0];this.ui.errorText="";this.ui.searchStore="false";this.ui.searchView="true";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var i=this;this.ui.nearWach=r.$watch(function(e){return e.ui.nearRadius},function(e,t){i.onNearRadiusChange(e,t)});this.ui.searchWach=r.$watch(function(e){return e.ui.searchRadius},function(e,t){i.onSearchRadiusChange(e,t)})}else if(!iscCore.isVoid(this.model.searchStoreList.Page.Output.AlternateStores.NodeList)){this.ui.searchView="true";this.ui.searchStore="false";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var i=this;this.ui.nearWach=r.$watch(function(e){return e.ui.nearRadius},function(e,t){i.onNearRadiusChange(e,t)});this.ui.searchWach=r.$watch(function(e){return e.ui.searchRadius},function(e,t){i.onSearchRadiusChange(e,t)})}this.ui.nearbyView="false"},uiAlternateStoreGetNextRecords:function(){this.ui.AlternateStoreInput.AlternateStore.NodeSearch.DistanceToConsider=this.ui.nearRadius;this.ui.AlternateStoreInput.AlternateStore.NodeSearch.DistanceToConsiderUOM=this.ui.distanceUOM;this.ui.AlternateStoreInput.AlternateStore.NodeSearch.FulfillmentType=this.model.FulfillmentType.Rules.RuleSetValue;if(this.ui.FetchNextRecords===true){u.callPaginatedMashup(this,"storeSelectiongetAlternateStoreAvailability",this.ui.AlternateStoreInput,"NEXT",{}).then(this.getStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false}},getStoreAvailibility:function(){if(iscCore.isVoid(this.model.storeList.Page.Output.AlternateStores.NodeList)||iscCore.isVoid(this.model.storeList.Page.Output.AlternateStores.NodeList.Node)){this.ui.errorText=n.translate("storeSearch.Store_ErrMsg");this.ui.noOfStoresFound=""}else{this.ui.errorText="";if(iscCore.isVoid(this.ui.nearStoreDesc)){this.ui.nearStoreDesc=this.model.storeList.Page.Output.AlternateStores.NodeList.Node[0].Description;this.ui.nearStore=this.model.storeList.Page.Output.AlternateStores.NodeList.Node[0]}this.ui.noOfStoresFound=n.translate("storeSearch.LABEL_Stores_found",{noOfStores:this.model.storeList.Page.Output.AlternateStores.NodeList.Node.length});this.model.storeList=c.fetchAvailability(this.model.storeList)}this.ui.FetchNextRecords=true;this.ui.nearApiExecComplete="true";this.ui.oldNearRadius=""},onNearRadiusChange:function(e,t){if(!iscCore.isVoid(this.ui.oldNearRadius)){t=this.ui.oldNearRadius}if(!(e==t)){if(this.ui.nearApiExecComplete=="false"){this.ui.nearRadius=t}else if(this.ui.nearApiExecComplete=="true"){this.ui.oldNearRadius=t;this.ui.errorText="";this.ui.nearStoreDesc="";this.ui.nearStore="";this.model.storeList={};if(iscCore.isVoid(this.ui.AlternateStoreInput.AlternateStore.NodeSearch.ShipToAddress.Country==null)){this.ui.errorText=n.translate("storeSearch.Store_ErrMsg")}else{this.ui.AlternateStoreInput.AlternateStore.NodeSearch.DistanceToConsider=e;this.ui.AlternateStoreInput.AlternateStore.NodeSearch.DistanceToConsiderUOM=this.ui.distanceUOM;this.ui.AlternateStoreInput.AlternateStore.NodeSearch.FulfillmentType=this.model.FulfillmentType.Rules.RuleSetValue;u.callPaginatedMashup(this,"storeSelectiongetAlternateStoreAvailability",this.ui.AlternateStoreInput,"START",{}).then(this.getStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false;this.ui.nearApiExecComplete="false"}}}},uiSearchStore:function(){this.ui.searchButtonClick="true";if(iscCore.isVoid(this.ui.personInfo.ZipCode)){if(iscCore.isVoid(this.ui.personInfo.City)){this.ui.errorText=n.translate("storeSearch.Address_ErrMsg");this.model.searchStoreList={}}else if(iscCore.isVoid(this.ui.personInfo.State)){this.ui.errorText=n.translate("storeSearch.Address_ErrMsg");this.model.searchStoreList={}}else{this.ui.errorText="";this.ui.searchedStoreDesc="";this.ui.searchedStore="";this.model.searchStoreList={};var e={AlternateStore:{NodeSearch:{DistanceToConsider:this.ui.searchRadius,DistanceToConsiderUOM:this.ui.distanceUOM,FulfillmentType:this.model.FulfillmentType.Rules.RuleSetValue,ShipToAddress:{Country:this.ui.personInfo.Country,City:this.ui.personInfo.City,State:this.ui.personInfo.State.RegionName,ZipCode:this.ui.personInfo.ZipCode}},OrderLines:{OrderLine:{RequiredQty:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.RequiredQty,Item:{ItemID:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.ItemID,ProductClass:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.ProductClass,UnitOfMeasure:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.UnitOfMeasure}}}}};u.callPaginatedMashup(this,"storeSearchgetAlternateStoreAvailability",e,"START",{}).then(this.getSearchStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false;this.ui.searchStore="false";this.ui.nearbyView="false";this.ui.searchView="true";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var i=this;this.ui.nearWach=r.$watch(function(e){return e.ui.nearRadius},function(e,t){i.onNearRadiusChange(e,t)});this.ui.searchWach=r.$watch(function(e){return e.ui.searchRadius},function(e,t){i.onSearchRadiusChange(e,t)})}}else{var t="";if(!iscCore.isVoid(this.ui.personInfo.State)){t=this.ui.personInfo.State.RegionName}this.ui.errorText="";this.model.searchStoreList={};var e={AlternateStore:{NodeSearch:{DistanceToConsider:this.ui.searchRadius,DistanceToConsiderUOM:this.ui.distanceUOM,FulfillmentType:this.model.FulfillmentType.Rules.RuleSetValue,ShipToAddress:{Country:this.ui.personInfo.Country,City:this.ui.personInfo.City,State:t,ZipCode:this.ui.personInfo.ZipCode}},OrderLines:{OrderLine:{RequiredQty:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.RequiredQty,Item:{ItemID:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.ItemID,ProductClass:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.ProductClass,UnitOfMeasure:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.UnitOfMeasure}}}}};u.callPaginatedMashup(this,"storeSearchgetAlternateStoreAvailability",e,"START",{}).then(this.getSearchStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false;this.ui.searchStore="false";this.ui.nearbyView="false";this.ui.searchView="true";if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();var i=this;this.ui.nearWach=r.$watch(function(e){return e.ui.nearRadius},function(e,t){i.onNearRadiusChange(e,t)});this.ui.searchWach=r.$watch(function(e){return e.ui.searchRadius},function(e,t){i.onSearchRadiusChange(e,t)})}},uiFetchNextRecords:function(){return this.ui.FetchNextRecords},uiAlternateSearchStoreGetNextRecords:function(){var e="";if(!iscCore.isVoid(this.ui.personInfo.State)){e=this.ui.personInfo.State.RegionName}var t={AlternateStore:{NodeSearch:{DistanceToConsider:this.ui.searchRadius,DistanceToConsiderUOM:this.ui.distanceUOM,FulfillmentType:this.model.FulfillmentType.Rules.RuleSetValue,ShipToAddress:{Country:this.ui.personInfo.Country,City:this.ui.personInfo.City,State:e,ZipCode:this.ui.personInfo.ZipCode}},OrderLines:{OrderLine:{RequiredQty:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.RequiredQty,Item:{ItemID:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.ItemID,ProductClass:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.ProductClass,UnitOfMeasure:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.UnitOfMeasure}}}}};if(this.ui.FetchNextRecords===true){u.callPaginatedMashup(this,"storeSearchgetAlternateStoreAvailability",t,"NEXT",{}).then(this.getSearchStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false}},getSearchStoreAvailibility:function(){if((iscCore.isVoid(this.model.searchStoreList.Page.Output.AlternateStores.NodeList)||iscCore.isVoid(this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node))&&this.ui.searchButtonClick=="true"){this.ui.errorText="";this.ui.searchStore="true";this.ui.nearbyView="false";this.ui.searchView="false";this.ui.noStoreFound=n.translate("storeSearch.Store_ErrMsg");this.ui.noOfStoresSearched=""}else if(iscCore.isVoid(this.model.searchStoreList.Page.Output.AlternateStores.NodeList)||iscCore.isVoid(this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node)){this.ui.errorText=n.translate("storeSearch.Store_ErrMsg");this.ui.noOfStoresSearched="";this.ui.searchButtonClick="false";this.ui.noStoreFound=""}else{if(this.model.searchStoreList.Page.Output.AlternateStores.NodeList.TotalNumberOfRecords==0){this.ui.errorText=n.translate("storeSearch.Store_ErrMsg")}else{this.ui.errorText=""}this.ui.noStoreFound="";this.ui.searchButtonClick="false";if(iscCore.isVoid(this.ui.searchedStoreDesc)){this.ui.searchedStoreDesc=this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node[0].Description;this.ui.searchedStore=this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node[0]}this.ui.noOfStoresSearched=n.translate("storeSearch.LABEL_Stores_found",{noOfStores:this.model.searchStoreList.Page.Output.AlternateStores.NodeList.Node.length});this.model.searchStoreList=c.fetchAvailability(this.model.searchStoreList)}this.ui.searchApiExecComplete="true";this.ui.oldSearchRadius="";this.ui.FetchNextRecords=true},onSearchRadiusChange:function(e,t){if(!iscCore.isVoid(this.ui.oldSearchRadius)){t=this.ui.oldSearchRadius}if(!(e==t)){if(this.ui.searchApiExecComplete=="false"){this.ui.searchRadius=t}else if(this.ui.searchApiExecComplete=="true"){this.ui.oldSearchRadius=t;this.ui.errorText="";this.ui.searchedStoreDesc="";this.ui.searchedStore="";this.model.searchStoreList={};var i="";if(!iscCore.isVoid(this.ui.personInfo.State)){i=this.ui.personInfo.State.RegionName}var r={AlternateStore:{NodeSearch:{DistanceToConsider:e,DistanceToConsiderUOM:this.ui.distanceUOM,FulfillmentType:this.model.FulfillmentType.Rules.RuleSetValue,ShipToAddress:{Country:this.ui.personInfo.Country,City:this.ui.personInfo.City,State:i,ZipCode:this.ui.personInfo.ZipCode}},OrderLines:{OrderLine:{RequiredQty:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.RequiredQty,Item:{ItemID:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.ItemID,ProductClass:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.ProductClass,UnitOfMeasure:this.ui.AlternateStoreInput.AlternateStore.OrderLines.OrderLine.Item.UnitOfMeasure}}}}};u.callPaginatedMashup(this,"storeSearchgetAlternateStoreAvailability",r,"START",{}).then(this.getSearchStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false;this.ui.searchApiExecComplete="false"}}},handleGetAlternateStoreError:function(){this.ui.errorText=n.translate("storeSearch.Store_ErrMsg")},onSuccessGetDefaultRadiusValue:function(){if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();this.ui.nearRadius=this.model.defaultRadiusValue.Rules.RuleSetValue;this.ui.searchRadius=this.model.defaultRadiusValue.Rules.RuleSetValue;if(iscCore.isVoid(this.ui.AlternateStoreInput.AlternateStore.NodeSearch.ShipToAddress.Country)){this.ui.errorText=n.translate("storeSearch.Store_ErrMsg")}else{this.ui.AlternateStoreInput.AlternateStore.NodeSearch.FulfillmentType=this.model.FulfillmentType.Rules.RuleSetValue;this.ui.AlternateStoreInput.AlternateStore.NodeSearch.DistanceToConsider=this.ui.nearRadius;this.ui.AlternateStoreInput.AlternateStore.NodeSearch.DistanceToConsiderUOM=this.ui.distanceUOM,u.callPaginatedMashup(this,"storeSelectiongetAlternateStoreAvailability",this.ui.AlternateStoreInput,"START",{}).then(this.getStoreAvailibility.bind(this),this.handleGetAlternateStoreError.bind(this));this.ui.FetchNextRecords=false}var i=this;this.ui.nearWach=r.$watch(function(e){return e.ui.nearRadius},function(e,t){i.onNearRadiusChange(e,t)});this.ui.searchWach=r.$watch(function(e){return e.ui.searchRadius},function(e,t){i.onSearchRadiusChange(e,t)})},onSuccessGetMaxRadiusValue:function(){this.ui.maxNearRadius=this.model.maxRadiusValue.Rules.RuleSetValue;this.ui.maxSearchRadius=this.model.maxRadiusValue.Rules.RuleSetValue},onSuccessDistanceUOM:function(){this.ui.distanceUOM=this.model.distanceUOM.Rules.RuleSetValue;this.ui.distanceUOMDesc=this.model.distanceUOM.Rules.DistanceUOMDesc},handleDistanceUOMError:function(){this.ui.distanceUOM="MILE";this.ui.distanceUOMDesc="Mile"},handleGetDefaultRadiusValueError:function(){if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();this.ui.nearRadius="25";this.ui.searchRadius="25";this.ui.errorText=n.translate("storeSearch.Store_ErrMsg");var i=this;this.ui.nearWach=r.$watch(function(e){return e.ui.nearRadius},function(e,t){i.onNearRadiusChange(e,t)});this.ui.searchWach=r.$watch(function(e){return e.ui.searchRadius},function(e,t){i.onSearchRadiusChange(e,t)})},handleGetMaxRadiusValueError:function(){this.ui.maxNearRadius="50";this.ui.maxSearchRadius="50"},handleGetFulfillmentTypeError:function(){this.ui.AlternateStoreInput.AlternateStore.NodeSearch.FulfillmentType=""},onSuccessGetFulfillmentType:function(){this.onSuccessGetMaxRadiusValue();this.onSuccessDistanceUOM();this.onSuccessGetDefaultRadiusValue()}})}]);
angular.module("store").controller("store.views.customer.cust-details.global-customer-details",["$animate","$timeout","$document","$scope","$rootScope","$filter","iscScreen","iscWizard","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscState","iscOrder","iscRule",function(e,t,r,s,i,o,u,a,n,d,l,m,c,h,p,f,O){var C=function(e){if(e.which===27&&!e.defaultPrevented){this.ui.showCustomerPreview=false;r.off("keydown",C);s.$apply()}};s.$on("$destroy",function(){r.off("keydown",C)});u.initializeScreen(s,{model:{customerDetails:{},orderList:{},getOrderListInput:{Order:{}}},mashupRefs:[{mashupRefId:"getOrderList",mashupId:"return_getCustomerOrders"},{mashupRefId:"getItemThumbnails",mashupId:"store.views.common.getItemThumbnails"}],ui:{pageSize:5,recordShownCount:10,customerPreviewTemplate:"store/views/return/customer-details/customer-preview.tpl.html",showCustomerPreview:false,getFilterFromContext:false},initialize:function(){var e=n.params.input;this.handleGetCustomerDetailsOutput(e,false)},uiShowCustomerPreview:function(){if(!this.ui.showCustomerPreview){this.ui.showCustomerPreview=true}else if(this.ui.showCustomerPreview){this.ui.showCustomerPreview=false;r.off("keydown",C)}},uiToggleViewProductsButton:function(e){if(!iscCore.isVoid(e)&&"Y"==e.DraftOrderFlag&&!m.hasPermission("WSC000031")){return true}else{return false}},uiGetOrderListNext:function(){this.ui.recordShownCount+=this.ui.pageSize},uiNextPageActionValidator:function(){return true},handleGetCustomerDetailsOutput:function(e){this.model.customerDetails=e;this.ui.headerCustomerId=c.translate("address.LABEL_Display_name",{firstname:this.model.customerDetails.Customer.CustomerContactList.CustomerContact[0].FirstName,lastname:this.model.customerDetails.Customer.CustomerContactList.CustomerContact[0].LastName});this.getCustomerOrders()},getCustomerOrders:function(){this.model.getOrderListInput={Order:{BillToID:this.model.customerDetails.Customer.CustomerID}};var e=this.model.getOrderListInput;if(n.options&&n.options.backButtonClicked){var t=h.getFromContext("orderListFilter");if(!iscCore.isVoid(t)&&t.input){e=t.input;this.ui.getFilterFromContext=true}}else{h.removeFromContext("orderListFilter")}d.callMashup(this,"getOrderList",e,{}).then(function(e){var t=d.getMashupOutput(e,"getOrderList");this.updateOrderListModel(t)}.bind(this),angular.noop)},updateOrderListModel:function(e){this.model.orderList=e},uiViewOrderDetails:function(e){f.viewOrderFromList(e,true)},uiCancel:function(){p.goToState("/home",{},{})},uiApplyFilterOnOrderList:function(e){d.callMashup(this,"getOrderList",e,{}).then(function(e){var t=d.getMashupOutput(e,"getOrderList");var r=o("number")(t.OrderList.TotalNumberOfRecords);if(r>0){t=f.stampDisplayStatusOnOrderList(t)}this.updateOrderListModel(t)}.bind(this),angular.noop)},uiSelectOrder:function(r){if(O.isRuleEnabled("ShowItemImage")&&iscCore.isVoid(r.ItemThumbnails)){var e={OrderLine:{OrderHeaderKey:r.OrderHeaderKey}};d.callMashup(this,"getItemThumbnails",e,{}).then(function(e){var t=d.getMashupOutput(e,"getItemThumbnails");r.ItemThumbnails=t;this.ui.selectedOrderHeaderKey=r.OrderHeaderKey}.bind(this),angular.noop)}else{this.ui.selectedOrderHeaderKey=r.OrderHeaderKey}},uiGetCssClassByOrderStatus:function(e){return f.getCssClassByOrderStatus(e.MaxOrderStatus)},uiSetDisplayStatus:function(e){e.DisplayStatus=f.getDisplayStatus(e)}})}]);
angular.module("store").controller("store.views.customer.cust-list.global-customer-list",["$scope","$rootScope","iscScreen","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscState",function(e,t,s,i,a,o,r,u,n,g){s.initializeScreen(e,{pageModel:{},model:{customerList:{}},mashupRefs:[{mashupRefId:"getCustomerListPaginated",mashupId:"returnLookup_getCustomerList",isPaginated:true,pageSize:n.getFromContext("listApiPageSize"),append:true,appendPath:"CustomerList.Customer",modelName:"customerList"}],ui:{pageSize:Number(n.getFromContext("masterDataPageSize")),recordShownCount:Number(n.getFromContext("masterDataPageSize")),apiPageSize:Number(n.getFromContext("listApiPageSize")),noOfSearchResults:0,searchInProgress:false,hasViewCustomerProfilePermission:r.hasPermission("WSC000047"),screenContext:"GLOBAL_SEARCH"},initialize:function(){var e=i.params.input;var t=i.params.callApi;var s=i.params.context;if(t){this.getCustomerListByInput(e)}else{this.handleGetCustomerListOutput(e,false)}if(!iscCore.isVoid(s)){this.ui.screenContext=s=="APPOINTMENT"?"APPOINTMENT":"GLOBAL_SEARCH"}},getCustomerListByInput:function(e){var s=this;var t={scPageSize:n.getFromContext("listApiPageSize"),scPageNumber:1,scPaginationStrategy:"NEXTPAGE"};a.callPaginatedMashup(this,"getCustomerListPaginated",e,"START",{}).then(function(e){var t=a.getMashupOutput(e,"getCustomerListPaginated");s.handleGetCustomerListOutput(t,false)}.bind(this),angular.noop)},uiOpenCustomerDetails:function(e){if(!iscCore.isVoid(e)){var t={};t.Customer=e;var s={input:t,callAPI:false};g.goToState("customer-details",{input:t},{})}else{o.showErrorMessage(u.translate("return.MSG_CustomerNotFound"))}},uiOpenCustomerProfile:function(e){g.goToState("customerprofilewizard",{action:"customerdetails",input:{Customer:e}},{})},uigetNextCustomerRecords:function(){var e=this.model.customerList.Page.Output.CustomerList;var t=e.Customer.length;console.log("numRecordsInModel="+t);if(t-this.ui.recordShownCount>=this.ui.pageSize){this.ui.recordShownCount+=this.ui.pageSize;console.log("Using existing model - doing client side pagination")}else{if(this.model.customerList.Page.IsLastPage!="Y"){var s=e.SearchText;var i={Customer:{CustomerContactList:{CustomerContact:{DayPhone:s}}}};console.log("calling API with input="+i);this.ui.searchInProgress=true;a.callPaginatedMashup(this,"getCustomerListPaginated",i,"NEXT",{}).then(function(e){this.ui.searchInProgress=false;this.uigetNextCustomerRecords()}.bind(this),angular.noop)}else{this.ui.recordShownCount=t;console.log("not calling API but painting numItemsInModel="+t+" items")}}},uiNextPageActionValidator:function(){if(!this.ui.searchInProgress){return true}else if(this.ui.searchInProgress){return false}},handleGetCustomerListOutput:function(e,t){this.ui.searchInProgress=false;if(t){var s=e.Page.Output.CustomerList.Customer;for(var i=0;i<s.length;i++){this.model.customerList.Page.Output.CustomerList.Customer.push(s[i])}this.model.customerList.Page.PageNumber=e.Page.PageNumber;this.model.customerList.Page.IsFirstPage=e.Page.IsFirstPage;this.model.customerList.Page.IsLastPage=e.Page.IsLastPage;this.uigetNextCustomerRecords()}else{this.model.customerList=e;var a=Number(this.model.customerList.Page.Output.CustomerList.TotalNumberOfRecords);if(a>0){this.ui.selectedCustomerKey=e.Page.Output.CustomerList.Customer[0].CustomerKey}this.ui.headerProductId=u.translate("customer.LABEL_Customer_Search_Result_Blind_Search",{count:this.model.customerList.Page.Output.CustomerList.TotalNumberOfRecords});this.pageModel.getCustomerListPaginated={};this.pageModel.getCustomerListPaginated["0"]={};this.pageModel.getCustomerListPaginated[e.Page.PageNumber]=e.Page.LastRecord;this.pageModel.getCustomerListPaginated.currentPageNumber=e.Page.PageNumber;this.pageModel.getCustomerListPaginated.IsLastPage=e.Page.IsLastPage;this.pageModel.getCustomerListPaginated.IsFirstPage=e.Page.IsFirstPage;this.pageModel.getCustomerListPaginated.IsValidPage=e.Page.IsValidPage}},uiCancel:function(){g.goToState("/home",{},{})}})}]);
angular.module("store").controller("store.views.customer.customer-profile.customer-profile-details",["$scope","$rootScope","iscWizard","iscState","iscMashup","iscResourcePermission","iscAppContext","iscStateParams","$timeout","iscModal","iscMedia","iscRule","iscCustomer","iscDateFilter","amSubtractFilter","iscRecommendations",function(e,t,i,s,h,o,a,r,d,m,C,n,u,l,c,I){i.initializeWizardPage(e,{model:{customerDetails:{},orderHistoryDetails:{},itemsRecommended:{},itemsViewed:{},itemsWishlist:{},customerDraftOrder:{},appointmentListCount:{},wishlist:{},itemKeywordSearchList:{},openCartList:{},openStoreCartList:{}},mashupRefs:[{mashupRefId:"getOrderHistoryListCount",mashupId:"store.views.customer.customer-profile.getOrderListCount",modelName:"orderHistoryDetails"},{mashupRefId:"getCustomerLast10PurchasedItems",mashupId:"store.views.customer.customer-profile.getLastPurchasedItems"},{mashupRefId:"getRecommededItems",mashupId:"store.views.customer.customer-profile.getRecommendedItemList",modelName:"itemsRecommended"},{mashupRefId:"getLastViewedItems",mashupId:"store.views.customer.customer-profile.getLastViewedItemList",modelName:"itemsViewed"},{mashupRefId:"getCustomerDraftOrder",mashupId:"store.views.customer.customer-profile.getCustomerDraftOrder"},{mashupRefId:"getAppointmentCount",mashupId:"store.views.customer.customer-profile.getAppointmentCount",modelName:"appointmentListCount"},{mashupRefId:"getWishListItems",mashupId:"store.views.customer.customer-profile.getWishListItems",modelName:"wishlist"},{mashupRefId:"getOnlineCartListForCustomer",mashupId:"store.views.customer.customer-profile.getOnlineCartListForCustomer",modelName:"openCartList"},{mashupRefId:"getItemKeywordSearchList",mashupId:"store.views.customer.customer-profile.getItemKeywordSearchListForCustomer",modelName:"itemKeywordSearchList"},{mashupRefId:"getPaginatedWishListItems",mashupId:"store.views.customer.customer-profile.getWishListProductDetails"},{mashupRefId:"getPaginatedOpenCartListItems",mashupId:"store.views.customer.customer-profile.getPaginatedOpenCartListItems"},{mashupRefId:"createOrder",mashupId:"store.views.customer.customer-profile.createOrder",modelName:"orderDetails"},{mashupRefId:"modifyFulfillmentOptions",mashupId:"store.views.customer.customer-profile.modifyFulfillmentOptions",modelName:"orderDetails"},{mashupRefId:"onlinecart_createOrder",mashupId:"store.views.customer.customer-profile.pullCartCreateOrder",modelName:"orderDetails"},{mashupRefId:"onlinecart_modifyFulfillmentOptions",mashupId:"store.views.customer.customer-profile.pullCartModifyFulfillmentOptions",modelName:"orderDetails"}],ui:{showInfo:true,loadingRecommendations:false,loadingLastViewed:false,loadingWishlist:false,loadingOpenCarts:false,lastViewedItemsLoaded:false,recommendedItemsLoaded:false,wishlistItemsLoaded:false,openCartListLoaded:false,activeTabIndex:-1,bottompanelIndex:-1,itemSearchKeywordsLoaded:false,itemSearchKeywordsNotAvailable:false,loadingItemSearchKeywords:false,hasPermissionForLastViewed:o.hasPermission("WSC000049"),hasPermissionForToViewKeywordsSearched:o.hasPermission("WSC000076"),minicartparam:{carticon:"app-glyphicons app-icon-shoppingCart_30",cartbtnlabel:"addItems.ACTION_Checkout",wizardmodelname:"customerDraftOrder"},noOfProductsToshow:5,noOfRecommendedItemsToshow:6,noOfLastViewedItemsToshow:6,noOfWishListItemsToshow:6,noOfCartItemsToshow:6,noOfTabsToshowInMobile:3,DisplayType:"CAROUSEL"},initialize:function(){var e=i.getWizardPageInput().customerDetails;if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Customer)){this.model.customerDetails={Customer:u.getDisplayAddressForCustomer(e.Customer)}}this.updateDefaultSelectedTab();this.setDisplayTypeForProductListCarousel();var t={Order:{BillToID:this.model.customerDetails.Customer.CustomerID}};var s={WorkOrder:{Order:{BillToID:this.model.customerDetails.Customer.CustomerID}}};var r=[];r.push(h.getMashupRefObj(this,"getCustomerDraftOrder",t));r.push(h.getMashupRefObj(this,"getAppointmentCount",s));h.callMashups(this,r,{}).then(function(e){var t=h.getMashupOutput(e,"getCustomerDraftOrder");if(!iscCore.isVoid(t.OrderList.Order)){this.model.customerDraftOrder.Order=t.OrderList.Order[0]}else{this.model.customerDraftOrder.Order={OrderLines:{TotalNumberOfRecords:"0"}}}}.bind(this),angular.noop)},setDisplayTypeForProductListCarousel:function(){var e=[{tab:"Recommendations",resourceId:"WSC000048"},{tab:"LastViewed",resourceId:"WSC000049"},{tab:"LastViewed",resourceId:"WSC000076"}];var t=[{tab:"Wishlist",resourceId:"WSC000077"},{tab:"OpenCarts",resourceId:"WSC000078"}];var s=0;for(var r=0;r<e.length;r++){if(o.hasPermission(e[r].resourceId)){s++;break}}var i=0;for(var r=0;r<t.length;r++){if(o.hasPermission(t[r].resourceId)){i++;break}}if(s>0&&i>0){this.ui.DisplayType="CAROUSEL"}else{this.ui.DisplayType="LIST"}if(s=="0"&&i!="0"){this.ui.activeTabIndex=2}this.ui.bottompanelIndex=0},updateDefaultSelectedTab:function(){var e=n.getRuleSetValue("customerProfileDefaultTabToShow");e=iscCore.isVoid(e)?0:e;var t=parseInt(e);var s=[{tab:"Recommendations",resourceId:"WSC000048"},{tab:"LastViewed",resourceId:"WSC000049|WSC000076"}];if(!o.hasPermissionToOneOfTheResources(s[t].resourceId)){for(var r=0;r<s.length;r++){if(o.hasPermissionToOneOfTheResources(s[r].resourceId)){t=r;break}}}this.ui.activeTabIndex=t},uiGetLastViewedItemList:function(){var e=3;if(C.isMediaEnabled("lte-768")){e=this.ui.noOfLastViewedItemsToshow}else if(!C.isMediaEnabled("lte-768")&&this.ui.DisplayType==="LIST"){e=8;this.ui.noOfLastViewedItemsToshow=8}if(o.hasPermission("WSC000049")){if(!this.ui.lastViewedItemsLoaded){this.ui.loadingLastViewed=true;var t={LastViewed:{pageSize:e,Customer:{CustomerKey:this.model.customerDetails.Customer.CustomerKey,CustomerID:this.model.customerDetails.Customer.CustomerID}}};h.callMashup(this,"getLastViewedItems",t,{showMask:false}).then(function(e){this.ui.loadingLastViewed=false;this.ui.lastViewedItemsLoaded=true}.bind(this),function(){this.ui.loadingLastViewed=false;this.ui.lastViewedItemsLoaded=true;this.ui.lastViewedItemsNotAvailable=true}.bind(this))}}if(this.ui.hasPermissionForToViewKeywordsSearched){this.getItemKeywordSearchList()}},uiGetPaginatedLastViewedItems:function(e){this.uiGetNextRecordsForCustomerProfileTabs(e,this.model.itemsViewed,"handleGetPaginatedLastViewedItems","LastViewed")},handleGetPaginatedLastViewedItems:function(e,t,s){var r=h.getMashupOutput(s,"getPaginatedWishListItems");var i=[];var i=r.ItemList.Item;var o=[];this.ui.loadingLastViewed=false;o=this.model.itemsViewed.ItemList.Item;for(var a=0;a<i.length;a++){o[e]=i[a];e++}if(t=="LIST"){this.ui.noOfLastViewedItemsToshow=this.ui.noOfLastViewedItemsToshow+i.length}},getItemKeywordSearchList:function(){if(!this.ui.itemSearchKeywordsLoaded){this.ui.loadingItemSearchKeywords=true;var e={SearchTerm:{Customer:{CustomerKey:this.model.customerDetails.Customer.CustomerKey,CustomerID:this.model.customerDetails.Customer.CustomerID}}};console.log("getItemKeywordSearchList is - ",e);h.callMashup(this,"getItemKeywordSearchList",e,{showMask:false}).then(function(e){this.ui.loadingItemSearchKeywords=false;this.ui.itemSearchKeywordsLoaded=true;this.model.itemKeywordSearchList=h.getMashupOutput(e,"getItemKeywordSearchList");console.log("itemKeywordSearchList - ",this.model.itemKeywordSearchList)}.bind(this),function(){console.log("Error while getting search term list");this.ui.itemSearchKeywordsLoaded=true;this.ui.loadingItemSearchKeywords=false;this.ui.itemSearchKeywordsNotAvailable=true}.bind(this))}},uiSearchProductsByKeyword:function(e){s.goToState("ordercapture",{action:"SCAN",input:e,flowName:"CLIENTELING",customerInfo:this.model.customerDetails},{})},uiGetRecommendedItemList:function(){var r=3;if(C.isMediaEnabled("lte-768")){r=this.ui.noOfRecommendedItemsToshow}else if(!C.isMediaEnabled("lte-768")&&this.ui.DisplayType==="LIST"){r=8;this.ui.noOfRecommendedItemsToshow=8}if(o.hasPermission("WSC000048")){if(!this.ui.recommendedItemsLoaded){this.ui.loadingRecommendations=true;var e=[];var t={OrderLine:{Order:{BillToID:this.model.customerDetails.Customer.CustomerID}}};e.push(h.getMashupRefObj(this,"getCustomerLast10PurchasedItems",t));h.callMashups(this,e,{showMask:false}).then(function(e){var t=h.getMashupOutput(e,"getCustomerLast10PurchasedItems");var s=I.getRecommendationsInputFromOrderLineList(t,10);s.Recommendations.pageSize=r;this.getRecommendedItems(s)}.bind(this),angular.noop)}}},uiGetPaginatedRecommendedItemList:function(e){this.uiGetNextRecordsForCustomerProfileTabs(e,this.model.itemsRecommended,"handleGetPaginatedRecommendedItems","RecommendedItems")},handleGetPaginatedRecommendedItems:function(e,t,s){var r=h.getMashupOutput(s,"getPaginatedWishListItems");var i=[];var i=r.ItemList.Item;var o=[];this.ui.loadingRecommendations=false;o=this.model.itemsRecommended.ItemList.Item;for(var a=0;a<i.length;a++){o[e]=i[a];e++}if(t=="LIST"){this.ui.noOfRecommendedItemsToshow=this.ui.noOfRecommendedItemsToshow+i.length}},uiGetNextRecordsForCustomerProfileTabs:function(e,t,s,r){var i=[];i=t.ItemList.Item;len=t.ItemList.TotalItemList;var o=3;var a=null;if(e.Page.displayType=="CAROUSEL"){if(!iscCore.isVoid(e.Page.newValue)&&!iscCore.isVoid(e.Page.oldValue)){a=e.Page.newValue+1;o=3}if(r=="OpenCarts"){o=o-1}}else if(e.Page.displayType=="LIST"){o=5;if(!C.isMediaEnabled("lte-768")&&this.ui.DisplayType==="LIST"){o=8}if(!iscCore.isVoid(e.Page.noOfProductsShown)){if(e.Page.noOfProductsShown<len){a=e.Page.noOfProductsShown/o+1}}}var d=a*o-o;var m=a*o-1;if(len-1<m){m=len-1}var n={};if(!iscCore.isVoid(a)&&iscCore.isVoid(i[d].PrimaryInformation)){n.Item={};n.Item.ComplexQuery={};n.Item.ComplexQuery.Or={};n.Item.ComplexQuery.Or.Exp=[];if(r=="OpenCarts"){n.Item.OCartItemList={};n.Item.OCartItemList.ItemList={};n.Item.OCartItemList.ItemList.Item=[]}var u=0;for(var l=d;l<=m;l++){n.Item.ComplexQuery.Or.Exp[u]={};n.Item.ComplexQuery.Or.Exp[u].Name="ItemID";n.Item.ComplexQuery.Or.Exp[u].Value=i[l].ItemID;if(r=="OpenCarts"){n.Item.OCartItemList.ItemList.Item[u]={};n.Item.OCartItemList.ItemList.Item[u]=angular.copy(i[l])}u++}n.Item.pageSize=u;if(r=="RecommendedItems"){this.ui.loadingRecommendations=true}else if(r=="Wishlist"){this.ui.loadingWishlist=true}else if(r=="LastViewed"){this.ui.loadingLastViewed=true}else if(r=="OpenCarts"){this.ui.loadingOpenCarts=true}if(r!="OpenCarts"){h.callMashup(this,"getPaginatedWishListItems",n,{}).then(this[s].bind(this,d,e.Page.displayType),angular.noop)}else{h.callMashup(this,"getPaginatedOpenCartListItems",n,{}).then(this[s].bind(this,d,e.Page.displayType),angular.noop)}}},uiGetWishListItems:function(){var e=3;if(C.isMediaEnabled("lte-768")){e=this.ui.noOfWishListItemsToshow}else if(!C.isMediaEnabled("lte-768")&&this.ui.DisplayType==="LIST"){e=6;this.ui.noOfWishListItemsToshow=6}if(o.hasPermission("WSC000077")){if(!this.ui.wishlistItemsLoaded){this.ui.loadingWishlist=true;var t={WishList:{pageSize:e,Customer:{CustomerKey:this.model.customerDetails.Customer.CustomerKey,CustomerID:this.model.customerDetails.Customer.CustomerID}}};h.callMashup(this,"getWishListItems",t,{showMask:false}).then(function(e){this.ui.loadingWishlist=false;this.ui.wishlistItemsLoaded=true}.bind(this),function(){this.ui.loadingWishlist=false;this.ui.wishlistItemsLoaded=true;this.ui.wishlistNotAvailable=true}.bind(this))}}},uiGetOnlineCartListForCustomer:function(){var e=2;if(C.isMediaEnabled("lte-768")){e=this.ui.noOfCartItemsToshow}else if(!C.isMediaEnabled("lte-768")&&this.ui.DisplayType==="LIST"){e=6;this.ui.noOfCartItemsToshow=6}if(!this.ui.openCartListLoaded){this.ui.loadingOpenCarts=true}var t={CartList:{pageSize:e,Customer:{CustomerKey:this.model.customerDetails.Customer.CustomerKey,CustomerID:this.model.customerDetails.Customer.CustomerID}}};h.callMashup(this,"getOnlineCartListForCustomer",t,{showMask:false}).then(function(e){this.model.openCartList.CartList.Cart[0].ItemList.TotalItemList=this.model.openCartList.CartList.Cart[0].ItemList.TotalNumberOfRecords;this.ui.loadingOpenCarts=false;this.ui.openCartListLoaded=true;this.model.openStoreCartList=angular.copy(this.model.openCartList);var t=this.model.openCartList.CartList.Cart[0].StoreItemList.Item;for(var s=0;s<t.length;s++){this.model.openStoreCartList.CartList.Cart[0].ItemList.Item[s]=this.model.openStoreCartList.CartList.Cart[0].StoreItemList.Item[s]}delete this.model.openStoreCartList.CartList.Cart[0].StoreItemList}.bind(this),function(){this.ui.loadingOpenCarts=false;this.ui.openCartListLoaded=true;this.ui.openCartsNotAvailable=true}.bind(this))},uiGetPaginatedCartListItems:function(e){this.uiGetNextRecordsForCustomerProfileTabs(e,this.model.openCartList.CartList.Cart[0],"handleGetPaginatedOpenCartItems","OpenCarts")},handleGetPaginatedOpenCartItems:function(e,t,s){var r=h.getMashupOutput(s,"getPaginatedOpenCartListItems");var i=r.ItemList.Item;var o=this.model.openCartList.CartList.Cart[0].ItemList.Item;for(var a=0;a<i.length;a++){var d=i[a];if(d.ItemID==o[e].ItemID&&d.UnitOfMeasure==o[e].UnitOfMeasure){o[e]=angular.copy(d);e++}}this.ui.loadingOpenCarts=false;if(t=="LIST"){this.ui.noOfCartItemsToshow=this.ui.noOfCartItemsToshow+i.length}},uiHandleAddAllToStoreCart:function(){if(iscCore.isVoid(this.model.customerDraftOrder.Order.OrderHeaderKey)){var e=this.prepareAddToStoreCartInput();e.Order.notifyCartStatusInput=this.prepareNotifyCartStatusInput("All",{});h.callMashup(this,"onlinecart_createOrder",e,{}).then(function(e){var t=h.getMashupOutput(e,"onlinecart_createOrder");this.model.customerDraftOrder=t}.bind(this),angular.noop)}else{var t=this.prepareAddToStoreCartInput();t.Order.notifyCartStatusInput=this.prepareNotifyCartStatusInput("All",{});h.callMashup(this,"onlinecart_modifyFulfillmentOptions",t,{}).then(function(e){var t=h.getMashupOutput(e,"onlinecart_modifyFulfillmentOptions");this.model.customerDraftOrder=t;this.ui.openCartListLoaded=false;this.model.openCartList={};this.uiGetOnlineCartListForCustomer()}.bind(this),angular.noop)}},prepareNotifyCartStatusInput:function(e,t){var s={};s.CartStatus={};s.CartStatus.ItemList={};s.CartStatus.ItemList.Item=[];s.CartStatus.CartId=this.model.openStoreCartList.CartList.Cart[0].CartID;if(e=="oneItem"){s.CartStatus.ItemList.Item[0]={};s.CartStatus.ItemList.Item[0]=t;s.CartStatus.ItemList.TotalNumberOfRecords="1"}else if(e=="All"){s.CartStatus.ItemList.Item=this.model.openStoreCartList.CartList.Cart[0].ItemList.Item;s.CartStatus.ItemList.TotalNumberOfRecords=this.model.openStoreCartList.CartList.Cart[0].ItemList.Item.length}return s},prepareAddToStoreCartInput:function(){var e={};e.Order={};if(iscCore.isVoid(this.model.customerDraftOrder.Order.OrderHeaderKey)){e.Order.EntryType=a.getFromContext("storeEntryType");e.Order.DocumentType=a.getFromContext("salesOrderDocType");if(!iscCore.isVoid(this.model.customerDetails)){this.addCustomerInfoToCreateOrderInput(e)}}else{e.Order.OrderHeaderKey=this.model.customerDraftOrder.Order.OrderHeaderKey}e.Order.OrderLines={};e.Order.OrderLines.OrderLine=[];var t=this.model.openCartList.CartList.Cart[0].ItemList.Item;for(var s=0;s<t.length;s++){var r=t[s];e.Order.OrderLines.OrderLine[s]={Item:{ItemID:r.ItemID,UnitOfMeasure:r.UnitOfMeasure,ProductClass:r.ProductClass}};e.Order.OrderLines.OrderLine[s].OrderLineTranQuantity={};if(iscCore.isVoid(r.OrderedQuantity)){e.Order.OrderLines.OrderLine[s].OrderLineTranQuantity.OrderedQty=1}else{e.Order.OrderLines.OrderLine[s].OrderLineTranQuantity.OrderedQty=r.OrderedQuantity}this.stampDeliveryMethodOnOLineForStore(e.Order.OrderLines.OrderLine[s],r)}return e},stampDeliveryMethodOnOLineForStore:function(e,t){var s=t.CartDeiveryMethod;if(!iscCore.isVoid(s)){if(s=="CARRY"){e.DeliveryMethod="CARRY"}else if(s=="PICK"){if(iscCore.isVoid(t.ShipNode)){e.DeliveryMethod="CARRY"}else{e.DeliveryMethod="PICK";e.ShipNode=t.ShipNode}}else if(s=="SHP"){e.DeliveryMethod="SHP"}}else{e.DeliveryMethod="CARRY"}},addCustomerInfoToCreateOrderInput:function(e){var t=this.model.customerDetails;var s=t;e.Order.BillToID=t.Customer.CustomerID;if(!iscCore.isVoid(t.Customer.DisplayCustomerAddress)){e.Order.PersonInfoShipTo={};e.Order.PersonInfoShipTo=angular.copy(t.Customer.DisplayCustomerAddress);e.Order.PersonInfoBillTo={};e.Order.PersonInfoBillTo=angular.copy(t.Customer.DisplayCustomerAddress)}if(s.Customer.CustomerType==="02"||s.Customer.CustomerContactList&&s.Customer.CustomerContactList.CustomerContact&&s.Customer.CustomerContactList.CustomerContact.length===1){e.Order.CustomerContactID=s.Customer.CustomerContactList.CustomerContact[0].CustomerContactID;e.Order.CustomerFirstName=s.Customer.CustomerContactList.CustomerContact[0].FirstName;e.Order.CustomerLastName=s.Customer.CustomerContactList.CustomerContact[0].LastName;e.Order.CustomerEMailID=s.Customer.CustomerContactList.CustomerContact[0].EmailID;if(!iscCore.isVoid(t.addressSelected)){e.Order.CustomerZipCode=t.addressSelected.PersonInfo.ZipCode}}return e},uiGetPaginatedWishLisItems:function(e){this.uiGetNextRecordsForCustomerProfileTabs(e,this.model.wishlist,"handleGetPaginatedWishListItems","Wishlist")},handleGetPaginatedWishListItems:function(e,t,s){var r=h.getMashupOutput(s,"getPaginatedWishListItems");var i=[];var i=r.ItemList.Item;var o=[];this.ui.loadingWishlist=false;o=this.model.wishlist.ItemList.Item;for(var a=0;a<i.length;a++){o[e]=i[a];e++}if(t=="LIST"){this.ui.noOfWishListItemsToshow=this.ui.noOfWishListItemsToshow+i.length}},getRecommendedItems:function(e){h.callMashup(this,"getRecommededItems",e,{showMask:false}).then(function(e){this.ui.loadingRecommendations=false;this.ui.recommendedItemsLoaded=true}.bind(this),function(){this.ui.loadingRecommendations=false;this.ui.recommendedItemsLoaded=true;this.ui.recommendationsNotAvailable=true}.bind(this))},uiShowProductDetails:function(e){console.log(e);var t=this.model.customerDetails.Customer.CustomerID;var s="";if(this.model.customerDetails.Customer.CustomerContactList&&this.model.customerDetails.Customer.CustomerContactList.CustomerContact[0]&&this.model.customerDetails.Customer.CustomerContactList.CustomerContact[0].EmailID){s=this.model.customerDetails.Customer.CustomerContactList.CustomerContact[0].EmailID}var r=this;var i={modalInput:function(){return{ItemDetails:{ItemID:e.Item.ItemID,UnitOfMeasure:e.Item.UnitOfMeasure},CustomerInfo:r.model.customerDetails,OrderInfo:r.model.customerDraftOrder,CustomerDetails:{CustomerID:t,EmailID:s}}}};var o=null;if(!iscCore.isVoid(e.Item.CarouselContext)){o=e.Item.CarouselContext}var a={};m.openModal("store.views.customer.customer-profile.product-details",i,a).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){r.uihandleAddTocart.call(r,e.data,o)}},angular.noop)},uihandleAddTocart:function(e,s){if(!iscCore.isVoid(s)&&s=="OpenCarts"){var t=this.getMatchingOnlineCartItemDetails(e,this.model.openStoreCartList.CartList.Cart[0].ItemList)}var r=null;if(iscCore.isVoid(this.model.customerDraftOrder.Order.OrderHeaderKey)){var i=this.prepareCreateOrderInput(e,s,t);i.Order.notifyCartStatusInput=this.prepareNotifyCartStatusInput("oneItem",t);if(!iscCore.isVoid(s)&&s=="OpenCarts"){r="onlinecart_createOrder"}else{r="createOrder"}h.callMashup(this,r,i,{}).then(function(e){var t=h.getMashupOutput(e,r);this.model.customerDraftOrder=t;if(!iscCore.isVoid(s)&&s=="OpenCarts"){this.ui.openCartListLoaded=false;this.model.openCartList={};this.uiGetOnlineCartListForCustomer()}}.bind(this),angular.noop)}else{var o=this.prepareModifyFulfillmentOptionsInput(e,s,t);if(!iscCore.isVoid(s)&&s=="OpenCarts"){o.Order.notifyCartStatusInput=this.prepareNotifyCartStatusInput("oneItem",t);r="onlinecart_modifyFulfillmentOptions"}else{r="modifyFulfillmentOptions"}h.callMashup(this,r,o,{}).then(function(e){var t=h.getMashupOutput(e,r);this.model.customerDraftOrder=t;if(!iscCore.isVoid(s)&&s=="OpenCarts"){this.ui.openCartListLoaded=false;this.model.openCartList={};this.uiGetOnlineCartListForCustomer()}}.bind(this),angular.noop)}},getMatchingOnlineCartItemDetails:function(e,t){var s=t.Item;var r=null;for(var i=0;i<s.length;i++){var o=s[i];if(e.itemDetails.Item.ItemID==o.ItemID&&e.itemDetails.Item.OrganizationCode==o.OrganizationCode&&e.itemDetails.Item.UnitOfMeasure==o.UnitOfMeasure){r=angular.copy(o);break}}return r},prepareModifyFulfillmentOptionsInput:function(e,t,s){var r={};r.Order={};r.Order.OrderHeaderKey=this.model.customerDraftOrder.Order.OrderHeaderKey;r.Order.OrderLines={};r.Order.OrderLines.OrderLine=[{Item:{ItemID:e.itemDetails.Item.ItemID,UnitOfMeasure:e.itemDetails.Item.UnitOfMeasure,ProductClass:e.itemDetails.Item.PrimaryInformation.DefaultProductClass},OrderLineTranQuantity:{OrderedQty:1}}];if(!iscCore.isVoid(t)&&t=="OpenCarts"){if(!iscCore.isVoid(s.OrderedQuantity)){r.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};r.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.OrderedQty=s.OrderedQuantity}this.stampDeliveryMethodOnOLineForStore(r.Order.OrderLines.OrderLine[0],s)}else{this.stampDeliveryMethodOnTheOrderLine(r,e.availabilityInfo)}return r},prepareCreateOrderInput:function(e,t,s){var r={};r.Order={};r.Order.EntryType=a.getFromContext("storeEntryType");r.Order.DocumentType=a.getFromContext("salesOrderDocType");if(!iscCore.isVoid(this.model.customerDetails)){var i=this.model.customerDetails;var o=i;r.Order.BillToID=i.Customer.CustomerID;if(!iscCore.isVoid(i.Customer.DisplayCustomerAddress)){r.Order.PersonInfoShipTo={};r.Order.PersonInfoShipTo=angular.copy(i.Customer.DisplayCustomerAddress);r.Order.PersonInfoBillTo={};r.Order.PersonInfoBillTo=angular.copy(i.Customer.DisplayCustomerAddress)}if(o.Customer.CustomerType==="02"||o.Customer.CustomerContactList&&o.Customer.CustomerContactList.CustomerContact&&o.Customer.CustomerContactList.CustomerContact.length===1){r.Order.CustomerContactID=o.Customer.CustomerContactList.CustomerContact[0].CustomerContactID;r.Order.CustomerFirstName=o.Customer.CustomerContactList.CustomerContact[0].FirstName;r.Order.CustomerLastName=o.Customer.CustomerContactList.CustomerContact[0].LastName;r.Order.CustomerEMailID=o.Customer.CustomerContactList.CustomerContact[0].EmailID;if(!iscCore.isVoid(i.addressSelected)){r.Order.CustomerZipCode=i.addressSelected.PersonInfo.ZipCode}}}r.Order.OrderLines={};r.Order.OrderLines.OrderLine=[{Item:{ItemID:e.itemDetails.Item.ItemID,UnitOfMeasure:e.itemDetails.Item.UnitOfMeasure,ProductClass:e.itemDetails.Item.PrimaryInformation.DefaultProductClass},OrderLineTranQuantity:{OrderedQty:1}}];if(!iscCore.isVoid(t)&&t=="OpenCarts"){if(!iscCore.isVoid(s.OrderedQuantity)){r.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};r.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.OrderedQty=s.OrderedQuantity}this.stampDeliveryMethodOnOLineForStore(r.Order.OrderLines.OrderLine[0],s)}else{this.stampDeliveryMethodOnTheOrderLine(r,e.availabilityInfo)}return r},stampDeliveryMethodOnTheOrderLine:function(e,t){if(t.availability.itemCarryAvailable&&t.availability.itemAvailableQty>0){e.Order.OrderLines.OrderLine[0].DeliveryMethod="CARRY"}else if(t.availability.itemShpAvailable){e.Order.OrderLines.OrderLine[0].DeliveryMethod="SHP";e.Order.OrderLines.OrderLine[0].EarliestShipDate=t.availability.itemShpAvailableDate;e.Order.OrderLines.OrderLine[0].ReqShipDate=t.availability.itemShpAvailableDate}},uiGotoHistoryPage:function(){var e={};e.customerDetails=i.getWizardPageInput().customerDetails;i.gotoCustomPage("orderhistory",e,{})},uiCloseWizard:function(){i.closeWizard()},uiopenAppointmentList:function(){s.goToState("appointmentlist",{input:{customerDetails:this.model.customerDetails}},{})},uiAddNotes:function(){var t=this;var e={Customer:{CustomerKey:this.model.customerDetails.Customer.CustomerKey}};var s={modalInput:function(){return e}};m.openModal("store.views.customer.notes.customernotes",s,{}).then(function(e){t.model.customerDetails.Customer.NoteList.TotalNumberOfRecords=e.NoteList.TotalNumberOfRecords},angular.noop)},uiCheckout:function(){console.log("Checking out order from customer profile");s.goToState("ordercapture",{action:"QUICKCHECKOUT",orderModel:this.model.customerDraftOrder,customerInfo:this.model.customerDetails},{})}})}]);
angular.module("store").controller("store.views.customer.customer-profile.customer-profile-finish",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscState",function(i,e,o,s,t,r,a){o.initializeWizardPage(i,{model:{},mashupRefs:[],ui:{},initialize:function(){if(o.getWizardAction()==="CLOSE"){a.goToState("/home",{},{})}}})}]);
angular.module("store").controller("store.views.customer.customer-profile.customer-profile-init",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscDateFilter","amSubtractFilter","iscRule",function(e,t,s,i,r,a,o,u,m){s.initializeWizardPage(e,{model:{},mashupRefs:[{mashupRefId:"getCustomerDetails",mashupId:"store.views.customer.customer-profile.getCustomerDetails"}],ui:{},initialize:function(){var e=a.params.input;var e={Customer:{CustomerKey:e.Customer.CustomerKey,CustomerID:e.Customer.CustomerID,OrganizationCode:e.Customer.OrganizationCode}};var t=[];t.push(i.getMashupRefObj(this,"getCustomerDetails",e));i.callMashups(this,t,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){var t={};t.customerDetails=i.getMashupOutput(e,"getCustomerDetails");s.startCustomWizard("customerdetails",t,{})}})}]);
angular.module("store").controller("store.views.customer.customer-profile.customer-profile-order-history",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscDateFilter","amSubtractFilter","iscRule","iscOrder","iscAppContext","iscI18n","iscRecommendations","iscModal","iscState",function(e,t,o,i,a,r,s,u,d,m,n,l,c,h,I){o.initializeWizardPage(e,{model:{customerDetails:{},orderHistoryDetails:{},orderListForHistory:{},customerDraftOrder:{}},mashupRefs:[{mashupRefId:"getOrderHistoryListByFilterCriteria",mashupId:"store.views.customer.customer-profile.getOrderHistoryListByFilterCriteria",isPaginated:true,pageSize:n.getFromContext("listApiPageSize"),append:true,appendPath:"OrderList.Order",modelName:"orderListForHistory"},{mashupRefId:"getRecommededItems",mashupId:"store.views.customer.customer-profile.getRecommendedItemList"},{mashupRefId:"getCustomerDraftOrder",mashupId:"store.views.customer.customer-profile.getCustomerDraftOrder"}],ui:{pageInput:"",showInfo:true,orderListHistoryShownCount:5,filterNotApplied:true,recommendationItemsImagesToShowCount:3,purchasedItemsImagesToShowCount:3,orderHistoryConfiguredAge:0,showRecommendationImagesPanel:true,showPurchasedProductsImagesPanel:false,selectedOrderHeaderKey:"",recommendationPanelResourceId:"WSC000048",showProductImages:"",hasRecommendationPanelPermission:""},initialize:function(){this.ui.pageInput=JSON.stringify(o.getWizardPageInput());this.model.customerDetails=o.getWizardPageInput().customerDetails;this.model.orderHistoryDetails=o.getWizardPageInput().orderHistoryDetails;this.ui.orderHistoryConfiguredAge=d.getRuleSetValue("customerProfileOrderHistoryAge");if(d.isRuleEnabled("ShowItemImage")){this.ui.showProductImages=true}else{this.ui.showProductImages=false}this.ui.hasRecommendationPanelPermission=a.hasPermission(this.ui.recommendationPanelResourceId);var e=d.getRuleSetValue("customerProfileOrderHistoryAge");var t={Order:{BillToID:this.model.customerDetails.Customer.CustomerID}};i.callPaginatedMashup(this,"getOrderHistoryListByFilterCriteria",t,"START",{}).then(this.handlePaginatedMashupOutput.bind(this),angular.noop);var r={Order:{BillToID:this.model.customerDetails.Customer.CustomerID}};var s=[];s.push(i.getMashupRefObj(this,"getCustomerDraftOrder",r));i.callMashups(this,s,{}).then(function(e){var t=i.getMashupOutput(e,"getCustomerDraftOrder");if(!iscCore.isVoid(t.OrderList.Order)){this.model.customerDraftOrder.Order=t.OrderList.Order[0]}else{this.model.customerDraftOrder.Order={OrderLines:{TotalNumberOfRecords:"0"}}}}.bind(this),angular.noop)},handlePaginatedMashupOutput:function(e){if(e!=null&&e.MashupRefs.MashupRef[0]["mashupRefId"]==="getOrderHistoryListByFilterCriteria"){this.model.orderListForHistory=e.MashupRefs.MashupRef[0]["Output"]["Page"]["Output"];for(var t=0;t<this.model.orderListForHistory.OrderList.Order.length;t++){var r=this.model.orderListForHistory.OrderList.Order[t];r.purchasedItemsImagesToShow=angular.copy(r.OrderLines);if(r.purchasedItemsImagesToShow.TotalNumberOfRecords>this.ui.purchasedItemsImagesToShowCount){r.purchasedItemsImagesToShow.MoreRecords=r.purchasedItemsImagesToShow.TotalNumberOfRecords-this.ui.purchasedItemsImagesToShowCount;r.purchasedItemsImagesToShow.OrderLine.splice(this.ui.purchasedItemsImagesToShowCount)}else{r.purchasedItemsImagesToShow.MoreRecords=0}}}},uiCloseWizard:function(){o.closeWizard()},uiViewOrderDetails:function(e){if(!e.DraftOrderFlag)e.DraftOrderFlag="N";m.viewOrderFromList(e,true)},uiGetOrderListNext:function(){if(this.ui.orderListHistoryShownCount==this.model.orderListForHistory.OrderList.Order.length){this.ui.refineResults="Y"}else if(this.ui.orderListHistoryShownCount<=this.model.orderListForHistory.OrderList.Order.length){this.ui.orderListHistoryShownCount+=5}},uiOrderListScrollActionValidator:function(){return true},uiApplyFilterOnOrderHistoryList:function(e,t){this.model.orderListForHistory={};this.ui.filterNotApplied=false;e.Order.BillToID=this.model.customerDetails.Customer.CustomerID;i.callPaginatedMashup(this,"getOrderHistoryListByFilterCriteria",e,"START",{}).then(this.handlePaginatedMashupOutput.bind(this),angular.noop);this.ui.showRecommendationImagesPanel=false;this.ui.showPurchasedProductsImagesPanel=false;this.ui.selectedOrderHeaderKey="";for(var r=0;r<t.length;r++){if(t[r]=="product_pictures_recommendations")this.ui.showRecommendationImagesPanel=true;if(t[r]=="product_pictures_purchased")this.ui.showPurchasedProductsImagesPanel=true}},uiLoadRecommendations:function(t){t.loadingRecommendations=true;var e=c.getRecommendationsInputForOrder(t,10);i.callMashup(this,"getRecommededItems",e,{showMask:false}).then(function(e){t.loadingRecommendations=false;t.recommendedItems=i.getMashupOutput(e,"getRecommededItems");t.recommendedItemsToShow=angular.copy(t.recommendedItems.ItemList);if(t.recommendedItemsToShow.TotalNumberOfRecords>this.ui.recommendationItemsImagesToShowCount){t.recommendedItemsToShow.MoreRecords=t.recommendedItemsToShow.TotalNumberOfRecords-this.ui.recommendationItemsImagesToShowCount;t.recommendedItemsToShow.Item.splice(this.ui.recommendationItemsImagesToShowCount)}else{t.recommendedItemsToShow.MoreRecords=0}}.bind(this),function(){t.loadingRecommendations=false;t.recommendationsNotAvailable=true}.bind(this))},uiOpenProductDetail:function(e){var t="";var r="";if(e.ItemDetails){t=e.ItemDetails.ItemID;r=e.ItemDetails.UnitOfMeasure}else{t=e.ItemID;r=e.UnitOfMeasure}var s={};s.ItemDetails={};s.ItemDetails.ItemID=t;s.ItemDetails.UnitOfMeasure=r;s.CustomerDetails={};s.CustomerDetails.CustomerID=this.model.customerDetails.Customer.CustomerID;s.CustomerDetails.EmailID=this.model.customerDetails.Customer.CustomerContactList.CustomerContact[0].EmailID;s.CustomerInfo=this.model.customerDetails;s.OrderInfo=this.model.customerDraftOrder;var o={modalInput:function(){return s}};var i={};h.openModal("store.views.customer.customer-profile.product-details",o,i).then(function(e){},angular.noop)},uishowRecommendationImagesPanel:function(e){if(this.ui.hasRecommendationPanelPermission&&(this.ui.showRecommendationImagesPanel||e.OrderHeaderKey==this.ui.selectedOrderHeaderKey)){return true}else{return false}},uiSetDisplayStatus:function(e){e.DisplayStatus=m.getDisplayStatus(e)},uiGetCssClassByOrderStatus:function(e){return m.getCssClassByOrderStatus(e)},uiCheckout:function(){console.log("Checking out order from customer profile");I.goToState("ordercapture",{action:"QUICKCHECKOUT",orderModel:this.model.customerDraftOrder,customerInfo:this.model.customerDetails},{})}})}]);
angular.module("store").controller("store.views.customer.customer-profile.customer-profile-search",["$scope","$rootScope","iscScreen","iscWizard","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscReturn",function(i,e,t,a,s,r,o,u,g,n,m){a.initializeWizardPage(i,{pageModel:{},model:{customerList:{}},mashupRefs:[{mashupRefId:"getCustomerListPaginated",mashupId:"returnLookup_getCustomerList",isPaginated:true,pageSize:n.getFromContext("listApiPageSize"),append:true,appendPath:"CustomerList.Customer",modelName:"customerList"}],ui:{pageSize:Number(n.getFromContext("masterDataPageSize")),recordShownCount:Number(n.getFromContext("masterDataPageSize")),apiPageSize:Number(n.getFromContext("listApiPageSize")),noOfSearchResults:0,searchInProgress:false,hideSearch:"N",isListPage:true},initialize:function(){var e=a.getWizardPageInput();var t=e.input;var s=e.callAPI;if(s){}else{this.handleGetCustomerListOutput(t,false)}m.setMiniCartParam(this);i.$on("uiSearchClose",function(e,t){if(t){i.ui.hideSearch="N"}})},uiOpenCustomerDetails:function(e){if(!iscCore.isVoid(e)){var t={};t.Customer=e;var s={input:t,callAPI:false};a.gotoCustomPage("customerDetails",s,{})}else{o.showErrorMessage(g.translate("return.MSG_CustomerNotFound"))}},uigetNextCustomerRecords:function(){var e=this.model.customerList.Page.Output.CustomerList;var t=e.Customer.length;if(t-this.ui.recordShownCount>=this.ui.pageSize){this.ui.recordShownCount+=this.ui.pageSize}else{if(this.model.customerList.Page.IsLastPage!="Y"){var s=e.SearchText;var i={Customer:{CustomerContactList:{CustomerContact:{DayPhone:s}}}};this.ui.searchInProgress=true;r.callPaginatedMashup(this,"getCustomerListPaginated",i,"NEXT",{}).then(function(e){this.ui.searchInProgress=false;this.uigetNextCustomerRecords()}.bind(this))}else{this.ui.recordShownCount=t}}},uiNextPageActionValidator:function(){if(!this.ui.searchInProgress){return true}else if(this.ui.searchInProgress){return false}},handleGetCustomerListOutput:function(e,t){this.ui.searchInProgress=false;if(t){var s=e.Page.Output.CustomerList.Customer;for(var i=0;i<s.length;i++){this.model.customerList.Page.Output.CustomerList.Customer.push(s[i])}this.model.customerList.Page.PageNumber=e.Page.PageNumber;this.model.customerList.Page.IsFirstPage=e.Page.IsFirstPage;this.model.customerList.Page.IsLastPage=e.Page.IsLastPage;this.uigetNextCustomerRecords()}else{this.model.customerList=e;this.ui.headerProductId=g.translate("returnHeader.LABEL_Customer_Search_Result",{count:this.model.customerList.Page.Output.CustomerList.TotalNumberOfRecords});this.pageModel.getCustomerListPaginated={};this.pageModel.getCustomerListPaginated["0"]={};this.pageModel.getCustomerListPaginated[e.Page.PageNumber]=e.Page.LastRecord;this.pageModel.getCustomerListPaginated.currentPageNumber=e.Page.PageNumber;this.pageModel.getCustomerListPaginated.IsLastPage=e.Page.IsLastPage;this.pageModel.getCustomerListPaginated.IsFirstPage=e.Page.IsFirstPage;this.pageModel.getCustomerListPaginated.IsValidPage=e.Page.IsValidPage}},uiHandleSearchResult:function(e){var t={input:e.NextPage.model,callAPI:e.NextPage.callAPI};a.gotoCustomPage(e.NextPage.action,t,{})},uiHandleReviewReturn:function(){a.gotoCustomPage("returnsList",{input:this.model.returnOrder.Order.OrderHeaderKey},{})},uiCancel:function(){a.closeWizard()}})}]);
angular.module("store").controller("store.views.customer.customer-profile.product-details",["$scope","$rootScope","$uibModalInstance","iscScreen","iscProduct","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal","iscMedia","iscDomUtility","$timeout","iscState","iscItem",function(e,t,i,s,a,o,l,m,n,u,r,I,h,d,f,c){s.initializeModalScreen(e,{model:{itemDetails:{},relatedItemsModel:{}},mashupRefs:[{mashupRefId:"getCompleteItemDetails",mashupId:"store.views.customer.customer-profile.getProductDetails"},{mashupRefId:"productdetails_sendEmail",mashupId:"store.views.customer.customer-profile.sendProductDetailsInEmail"},{mashupRefId:"getCompleteRelatedItemList",mashupId:"product_getRelatedItemList"},{mashupRefId:"getItemAvailabilityForStore",mashupId:"store.views.customer.customer-profile.getItemAvailabilityForStore"}],ui:{emailid:"",showEmailError:false,emailSent:false,emailForm:{},openRelatedItems:false,showItemDescriptionLink:false,itemsShownCount:0,noOfMoreItemsCount:0,relatedItemsCount:0,availabilityInfo:{},availabilityInfoLoading:true,itemId:"",itemUom:"",active:0,showShopNowButton:false,isIosDevice:false,hasMoreImages:false},initialize:function(){if(I.isMediaEnabled("gt-480")){this.ui.openRelatedItems=true}this.ui.emailid=o.CustomerDetails.EmailID;this.ui.itemId=o.ItemDetails.ItemID;this.ui.itemUom=o.ItemDetails.UnitOfMeasure;if(navigator.userAgent.match(/iPhone|iPad|iPod/i)){this.ui.isIosDevice=true}var e=[];e.push(m.getMashupRefObj(this,"getCompleteItemDetails",this.getCompleteItemDetailsInput()));e.push(m.getMashupRefObj(this,"getCompleteRelatedItemList",this.getCompleteItemDetailsInput()));m.callMashups(this,e,{}).then(this.handleInitApiCalls.bind(this),angular.noop);d(function(){h.setFocus(document.getElementById("productdetails_emailId"))},0)},handleInitApiCalls:function(e){var t=e.MashupRefs.MashupRef;if(t!==null&&t!==undefined){var i=t.length;for(var s=0;s<i;s++){var a=t[s];if(a.mashupRefId==="getCompleteItemDetails"){this.initializeItemDetails(e)}else if(a.mashupRefId==="getCompleteRelatedItemList"){this.initializeRelatedItems(e)}}}d(function(){var e=[];e.push(m.getMashupRefObj(this,"getItemAvailabilityForStore",this.getItemAvailabilityInput()));m.callMashups(this,e,{showMask:false}).then(function(e){var t=m.getMashupOutput(e,"getItemAvailabilityForStore");var i=t.Promise.PromiseLines.PromiseLine[0];if(!iscCore.isVoid(i.Availabilities)){this.ui.availabilityInfoLoading=false;this.ui.availabilityInfo=c.handleItemAvailability(i.Availabilities,{},this.model.itemDetails.Item.PrimaryInformation.IsShippingAllowed,this.model.itemDetails.Item.PrimaryInformation.IsPickupAllowed);this.EnableAddToCartButton(this.ui.availabilityInfo)}}.bind(this),angular.noop)}.bind(this),0)},EnableAddToCartButton:function(e){if(!iscCore.isVoid(this.model.itemDetails.Item.PrimaryInformation.IsModelItem)&&this.model.itemDetails.Item.PrimaryInformation.IsModelItem=="Y"){this.ui.showShopNowButton=true}else if(!this.ui.availabilityInfo.availability.itemCarryAvailable&&!this.ui.availabilityInfo.availability.itemShpAvailable&&this.ui.availabilityInfo.availability.itemPickAvailable){this.ui.showShopNowButton=true}},initializeItemDetails:function(e){var t=m.getMashupOutput(e,"getCompleteItemDetails");this.model.itemDetails.Item=t.ItemList.Item[0];if(!iscCore.isVoid(this.model.itemDetails.Item.PrimaryInformation.IsModelItem)&&this.model.itemDetails.Item.PrimaryInformation.IsModelItem=="Y"){this.ui.showShopNowButton=true}this.model.itemDetails.Item.Currency=t.ItemList.Currency;this.setItemImage(this.model.itemDetails)},getCompleteItemListInput:function(){var e={};e.Item={};if(!iscCore.isVoid(this.model.itemDetails)&&!iscCore.isVoid(this.model.itemDetails.Item.ItemID)&&!iscCore.isVoid(this.model.itemDetails.Item.UnitOfMeasure)){e.Item.ItemID=this.model.itemDetails.Item.ItemID;e.Item.UnitOfMeasure=this.model.itemDetails.Item.UnitOfMeasure}else{console.log("ERROR: ItemID or UnitOfMeasure is null for item - ",this.model.itemDetails)}return e},initializeRelatedItems:function(e){var t=m.getMashupOutput(e,"getCompleteRelatedItemList");if(t.ItemList){this.model.relatedItemsModel=t;if(!(this.model.relatedItemsModel.ItemList.TotalNumberOfRecords=="0")){if(I.isMediaEnabled("gt-480")||I.isMediaEnabled("lte-480")){this.ui.relatedItemsCount=parseInt(this.model.relatedItemsModel.ItemList.TotalNumberOfRecords,10);if(this.ui.relatedItemsCount>=2){this.ui.itemsShownCount=2;if(this.ui.relatedItemsCount>2){this.ui.noOfMoreItemsCount=this.ui.relatedItemsCount-this.ui.itemsShownCount;if(this.ui.noOfMoreItemsCount>=5){this.ui.noOfMoreItemsCount=5}}}else{this.ui.itemsShownCount=1;this.ui.noOfMoreItemsCount=0}}}else{this.ui.openRelatedItems=false}}},uiLoadMoreItems:function(){if(this.ui.relatedItemsCount>0&&this.ui.itemsShownCount===0){this.ui.itemsShownCount=2}else{this.ui.itemsShownCount=this.ui.itemsShownCount+this.ui.noOfMoreItemsCount}if(this.ui.relatedItemsCount>2){this.ui.noOfMoreItemsCount=this.ui.relatedItemsCount-this.ui.itemsShownCount;if(this.ui.noOfMoreItemsCount>=5){this.ui.noOfMoreItemsCount=5}}},uiGetExtendedDescription:function(e){if(!iscCore.isVoid()){e=e.replaceAll(/\n/g,"<br />")}return e},uiSendEmail:function(){var t=this;d(function(){t.ui.emailForm.$setDirty();if(iscCore.isVoid(t.ui.emailid)||!t.ui.emailForm.$valid){t.ui.showEmailError=true;document.getElementById("productdetails_emailId").focus()}else if(t.ui.emailForm.$valid){var e={};e.ItemdDetails={};e.ItemdDetails.ItemID=this.model.itemDetails.Item.ItemID;e.ItemdDetails.ItemKey=this.model.itemDetails.Item.ItemKey;e.ItemdDetails.UnitOfMeasure=this.model.itemDetails.Item.UnitOfMeasure;e.ItemdDetails.CustomerID=o.CustomerDetails.CustomerID;e.ItemdDetails.ToEmailID=this.ui.emailid;m.callMashup(t,"productdetails_sendEmail",e,{}).then(t.emailCallBackHandler.bind(t),angular.noop)}}.bind(this),200)},uiResetEmailFlags:function(){var e=document.getElementById("productdetails_emailId").value;if(!iscCore.isVoid(e)){this.ui.emailSent=false;this.ui.showEmailError=false}},emailCallBackHandler:function(e){var t=m.getMashupOutput(e,"productdetails_sendEmail");if(t){this.ui.emailSent=true}},uiClose:function(){i.dismiss({})},uiShopNow:function(){i.dismiss({});f.goToState("ordercapture",{action:"SCAN",input:o.ItemDetails.ItemID,customerInfo:o.CustomerInfo,orderInfo:o.OrderInfo},{})},uiHandleAddToCart:function(){var e={data:{itemDetails:this.model.itemDetails,availabilityInfo:this.ui.availabilityInfo}};i.close(e)},getCompleteItemDetailsInput:function(){var e={};e.Item={};e.Item.ItemID=this.ui.itemId;e.Item.UnitOfMeasure=this.ui.itemUom;return e},getItemAvailabilityInput:function(){var e={Promise:{PromiseLines:{PromiseLine:{ItemID:this.ui.itemId,UnitOfMeasure:this.ui.itemUom}}}};return e},uiOpenItemDetails:function(e){this.ui.itemId=e.ItemID;this.ui.itemUom=e.UnitOfMeasure;this.ui.itemsShownCount=0;this.ui.noOfMoreItemsCount=0;this.ui.relatedItemsCount=0;var t=[];t.push(m.getMashupRefObj(this,"getCompleteItemDetails",this.getCompleteItemDetailsInput()));t.push(m.getMashupRefObj(this,"getCompleteRelatedItemList",this.getCompleteItemDetailsInput()));m.callMashups(this,t,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},setItemImage:function(e){var t=null;var i="";var s=0;t=e.Item.AssetList.Asset;if(!iscCore.isVoid(t)){s=t.length;for(var a=0;a<s;a=a+1){var o=null;var l=null;if(!iscCore.isVoid(t)){o=t[a];l=o.Type;if(l==="ITEM_IMAGE_1"){i=o.ContentLocation;this.ui.hasMoreImages=false}else if(l==="ITEM_IMAGE_LRG_1"){this.ui.hasMoreImages=true}}}}if(!this.ui.hasMoreImages){}else{this.handleMoreImages(e)}},handleMoreImages:function(e){var t=null;t=this.getAssetList(e,this);length=t.length;if(length>0){for(var i=0;i<length;i=i+1){var s=t[i];var a=encodeURI(s.ItemImage.ContentLocation);var o=encodeURIComponent(s.ItemImage.ContentID);var l=a+"/"+o;var m="itemThumbnail"+i}}},getAssetList:function(e,t){var i=[];var s=null;var a={};var s=e.Item.AssetList.Asset;var o=s.length;for(var l=0;l<o;l=l+1){var m=null;m=s[l];if(!iscCore.isVoid(m)){if(m.Type==="ITEM_IMAGE_LRG_1"){var n={};n.ItemImage=m;var u=encodeURI(m.ContentLocation);var r=encodeURIComponent(m.ContentID);var I=u+"/"+r;n.ItemImage.ImageSource=I;i.push(n)}}}a={Item:{AssetList:{Asset:i}}};this.model.moreImages=a;return i}})}]);
angular.module("store").controller("store.views.customer.notes.customernotes",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscModal","iscI18n",function(s,e,o,t,r,a,i,u,n){t.initializeModalScreen(s,{model:{customerNotesList:{}},mashupRefs:[{mashupRefId:"getParticipantNoteList",mashupId:"store.views.customer.notes.getParticipantNoteList",modelName:"customerNotesList"},{mashupRefId:"manageCustomer",mashupId:"store.views.customer.notes.manageCustomer"}],ui:{},initialize:function(){var e={};e.Note={};e.Note.TableKey=r.Customer.CustomerKey;a.callMashup(this,"getParticipantNoteList",e,{})},uiClose:function(){o.close(this.model.customerNotesList)},uiPostNote:function(e){var s={};s.Customer={};s.Customer.CustomerKey=r.Customer.CustomerKey;s.Customer.NoteList=e;var t=[];t.push(a.getMashupRefObj(this,"manageCustomer",s));t.push(a.getMashupRefObj(this,"getParticipantNoteList",{Note:{TableKey:r.Customer.CustomerKey}}));a.callMashups(this,t,{}).then(this.handleManageCustomerSuccess.bind(this),this.handleManageCustomerError.bind(this))},handleManageCustomerSuccess:function(e){s.$broadcast("clearNoteFields")},handleManageCustomerError:function(e){var s=e.Errors.Error[0].ErrorDescription;var t=e.Errors.Error[0].ErrorCode;if(n.hasKey("apierror."+t)){s=n.translate("apierror."+t);u.showErrorMessage(s,null,null)}else{u.showErrorMessage(s,null,null)}o.dismiss(e)}})}]);
angular.module("store").controller("store.views.home.common.customer-pickup-portlet-mini",["$scope","iscScreen","iscMashup",function(t,i,e){i.initializeScreen(t,{model:{shipmentCountOutput:{}},mashupRefs:[{mashupRefId:"getReadyForPickupShipmentCount",mashupId:"store.views.home.common.getReadyForPickupShipmentCount",modelName:"shipmentCountOutput"}],ui:{isMashupCallInProgress:true,displayCount:0},initialize:function(){e.callMashup(this,"getReadyForPickupShipmentCount",{Shipment:{}},{showMask:false}).then(this.handleInitAPIs.bind(this),angular.noop)},handleInitAPIs:function(t){if(!iscCore.isVoid(this.model.shipmentCountOutput)&&!iscCore.isVoid(this.model.shipmentCountOutput.Shipments)&&!iscCore.isVoid(this.model.shipmentCountOutput.Shipments.TotalNumberOfRecords)){this.ui.displayCount=Number(this.model.shipmentCountOutput.Shipments.TotalNumberOfRecords)}this.ui.isMashupCallInProgress=false}})}]);
angular.module("store").controller("store.views.home.common.customer-pickup-portlet",["$scope","iscScreen","iscMashup","iscResourcePermission","$filter","iscModal","iscI18n","iscState","$timeout","iscDomUtility","iscShipment","iscPortletShipment","iscShipmentStatus",function(e,t,i,n,o,s,u,h,a,r,p,c,m){t.initializeScreen(e,{model:{shipmentCountOutput:{},pickupShipmentCount:{totalShipmentCount:0}},mashupRefs:[{mashupRefId:"getReadyForPickupShipmentCount",mashupId:"store.views.home.common.getReadyForPickupShipmentCount",modelName:"shipmentCountOutput"},{mashupRefId:"getShipmentCountForPortletAdvSearch",mashupId:"store.views.common.outboundShipment.getShipmentCountForPortletAdvSearch"}],ui:{showAdvanceSearch:false,search:{},isPickupRecipient:false,pickupPage:"customer-pickup",searchCriteria:{}},initialize:function(){var e={Shipment:{}};i.callMashup(this,"getReadyForPickupShipmentCount",e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){if(!iscCore.isVoid(this.model.shipmentCountOutput)&&!iscCore.isVoid(this.model.shipmentCountOutput.Shipments)&&!iscCore.isVoid(this.model.shipmentCountOutput.Shipments.TotalNumberOfRecords)){this.model.pickupShipmentCount.totalShipmentCount=o("number")(this.model.shipmentCountOutput.Shipments.TotalNumberOfRecords)}},uiOpenAdvanceSearch:function(){this.ui.showAdvanceSearch=true;r.setFocus(document.getElementById("customerPickup_customer_firstName"))},uiAdvanceClose:function(){this.ui.showAdvanceSearch=false;a(function(){document.getElementById("advanceSearchLink").focus()},500)},uiOpenTotalShipmentList:function(){h.goToState("customerpickorderlist",{input:{FilterOptions:"All"}},{})},uiHandleBarcodeOrSearchOutput:function(e){c.handleShipmentOrderBarcodeTranslation(e,this.ui.pickupPage)},uiAdvanceSearch:function(){if(!iscCore.isVoid(this.ui.search)){var e=angular.copy(this.ui.search);if(e.EMailID)e.EMailIDQryType="FLIKE";var t={};if(this.ui.isPickupRecipient){t={Shipment:{ShipmentLines:{ShipmentLine:{OrderLine:{PersonInfoMarkFor:e}}}}}}else{t={Shipment:{BillToAddress:e}}}this.ui.searchCriteria=t;i.callMashup(this,"getShipmentCountForPortletAdvSearch",this.ui.searchCriteria,{}).then(this.handleAdvSearchApiCall.bind(this),angular.noop)}else{s.showErrorMessage(u.translate("outboundShipments.MSG_AdvanceSearchBlankCriteria"))}},handleAdvSearchApiCall:function(e){var t=i.getMashupOutput(e,"getShipmentCountForPortletAdvSearch");if(t&&t.Shipments){t.Shipments.TotalNumberOfRecords=!(t.Shipments.Shipment&&t.Shipments.Shipment.length)?0:t.Shipments.Shipment.length;c.handlePortletAdvancedSearch(t,this.ui.pickupPage,this.ui.searchCriteria,angular.copy(m.getShipmentStatusCodeList("Pickup")))}else{s.showErrorMessage(u.translate("outboundShipments.MSG_ShipmentNotFound"))}}})}]);
angular.module("store").controller("store.views.home.common.moretasks-portlet",["$scope","iscScreen","iscPortletPvdr","iscAppContext","$interval",function(t,e,i,r,n){e.initializeScreen(t,{model:{},mashupRefs:[],ui:{miniPortletsArray:[],currentSelectedPortlet:null,isPortletExpanded:false,selectedMiniPortletIndex:-1,currentSelectedPortletTheme:""},_intervalInstance:null,deriveThemeNameFromControllerName:function(e){var t=e;t=t.substring(t.lastIndexOf(".")+1);if(t.indexOf("-portlet")!=-1){t=t.substring(0,t.indexOf("-portlet"))+"-theme"}return t},initialize:function(){this.initializeMiniPortletsArray();t.$on("$beforeStateChange",function(e,t){if(t!=null&&t.state!=="/home"&&t.state!=="/manager-dashboard"){r.addToContext("HOME_PAGE_MINIPORTLET_INDEX_PERSONA_SCOPE",this.ui.selectedMiniPortletIndex)}else{r.addToContext("HOME_PAGE_MINIPORTLET_INDEX_PERSONA_SCOPE",-1)}}.bind(this));t.$on("$destroy",function(){if(this._intervalInstance!=null){n.cancel(this._intervalInstance)}}.bind(this));var e=r.getFromContext("HOME_PAGE_MINIPORTLET_INDEX_PERSONA_SCOPE");if(!iscCore.isVoid(e)&&e!=-1){this.uiHandleMiniPortletClick(this.ui.miniPortletsArray[e],e)}},initializeMiniPortletsArray:function(){this.ui.miniPortletsArray=[];var e=i.getConfigForMoreTasksPortlet();this.ui.miniPortletsArray=angular.copy(e.childPortletsArray);for(var t=0;t<this.ui.miniPortletsArray.length;t++){this.ui.miniPortletsArray[t]["personaConfig"]=JSON.parse(this.ui.miniPortletsArray[t]["personaConfig"])}},uiHandleMiniPortletClick:function(e,t){this.ui.selectedMiniPortletIndex=t;r.addToContext("HOME_PAGE_MINIPORTLET_INDEX_PERSONA_SCOPE",this.ui.selectedMiniPortletIndex);this.ui.currentSelectedPortlet=e;this.ui.isPortletExpanded=true;this.ui.currentSelectedPortletTheme=this.deriveThemeNameFromControllerName(this.ui.currentSelectedPortlet["controller"])},uiHandleBackToMoreTasks:function(){this.ui.isPortletExpanded=false;this.ui.selectedMiniPortletIndex=-1;r.addToContext("HOME_PAGE_MINIPORTLET_INDEX_PERSONA_SCOPE",this.ui.selectedMiniPortletIndex);this.initializeMiniPortletsArray();this._intervalInstance=n(function(){this.ui.currentSelectedPortlet=null}.bind(this),1e3,1)}})}]);
angular.module("store").controller("store.views.home.common.mytasks-portlet-mini",["$scope","iscScreen","iscMashup","iscResourcePermission",function(s,t,i,o){t.initializeScreen(s,{model:{shipmentCountOutput:{},batchCountOutput:{}},mashupRefs:[{mashupRefId:"getShipmentListCountForMyTasks",mashupId:"store.views.home.common.getShipmentListCountForMyTasks",modelName:"shipmentCountOutput"},{mashupRefId:"getBatchListCountForMyTasks",mashupId:"store.views.home.common.getBatchListCountForMyTasks",modelName:"batchCountOutput"}],ui:{isMashupCallInProgress:true,hasPermissionForBatchPicking:o.hasPermission("WSC000053"),shipmentCount:0,batchCount:0,displayCount:0},initialize:function(){var s=[];s.push(i.getMashupRefObj(this,"getShipmentListCountForMyTasks",{}));if(this.ui.hasPermissionForBatchPicking){s.push(i.getMashupRefObj(this,"getBatchListCountForMyTasks",{}))}i.callMashups(this,s,{showMask:false}).then(this.handleInitAPIs.bind(this),angular.noop)},handleInitAPIs:function(){var s=this.model.shipmentCountOutput;var t=this.model.batchCountOutput;if(!iscCore.isVoid(s)&&!iscCore.isVoid(s.Shipments)&&!iscCore.isVoid(s.Shipments.TotalNumberOfRecords)){this.ui.shipmentCount=Number(s.Shipments.TotalNumberOfRecords)}if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.StoreBatchList)&&!iscCore.isVoid(t.StoreBatchList.TotalNumberOfRecords)){this.ui.batchCount=Number(t.StoreBatchList.TotalNumberOfRecords)}this.ui.displayCount=this.ui.shipmentCount+this.ui.batchCount;this.ui.isMashupCallInProgress=false}})}]);
angular.module("store").controller("store.views.home.common.mytasks-portlet",["$scope","iscScreen","iscMashup","iscResourcePermission","$filter","iscModal","iscI18n","iscState","$timeout","iscDomUtility","iscShipment",function(t,s,i,o,e,n,u,a,m,h,r){s.initializeScreen(t,{model:{shipmentCountOutput:{},batchCountOutput:{},myTaskCount:{shipmentCount:0,totalTaskCount:0,batchCount:0}},mashupRefs:[{mashupRefId:"getShipmentListCountForMyTasks",mashupId:"store.views.home.common.getShipmentListCountForMyTasks",modelName:"shipmentCountOutput"},{mashupRefId:"getBatchListCountForMyTasks",mashupId:"store.views.home.common.getBatchListCountForMyTasks",modelName:"batchCountOutput"}],ui:{hasPermissionForBatchPicking:o.hasPermission("WSC000053")},initialize:function(){var t=[];t.push(i.getMashupRefObj(this,"getShipmentListCountForMyTasks",{}));if(this.ui.hasPermissionForBatchPicking){t.push(i.getMashupRefObj(this,"getBatchListCountForMyTasks",{}))}if(t.length>0){i.callMashups(this,t,{}).then(this.handleInitApiCalls.bind(this),angular.noop)}},handleInitApiCalls:function(t){var s=this.model.shipmentCountOutput;var i=this.model.batchCountOutput;var o=Number(0);if(!iscCore.isVoid(s)&&!iscCore.isVoid(s.Shipments)&&!iscCore.isVoid(s.Shipments.TotalNumberOfRecords)){this.model.myTaskCount.shipmentCount=e("number")(s.Shipments.TotalNumberOfRecords);o+=Number(e("number")(s.Shipments.TotalNumberOfRecords))}if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.StoreBatchList)&&!iscCore.isVoid(i.StoreBatchList.TotalNumberOfRecords)){this.model.myTaskCount.batchCount=e("number")(i.StoreBatchList.TotalNumberOfRecords);o+=Number(e("number")(i.StoreBatchList.TotalNumberOfRecords))}this.model.myTaskCount.totalTaskCount=o},uiOpenMyTaskList:function(t){a.goToState("mytaskslist",{},{})}})}]);
angular.module("store").controller("store.views.home.manager-dashboard.manager-dashboard-bopus-portlet",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscResourcePermission","iscDialChartD3Pvdr","iscManagerDashboardService","iscDialChartD3Service","$interval",function(e,t,i,s,a,u,o,r,n,l,h){t.initializeScreen(e,{model:{bopus_sla_shipmentCountForGivenStatuses:{},bopus_orderstatus_shipmentCountForGivenStatuses:{}},mashupRefs:[{mashupRefId:"bopus_sla_getShipmentCountForGivenStatuses",mashupId:"bopus_sla_getShipmentCountForGivenStatuses",modelName:"bopus_sla_shipmentCountForGivenStatuses"},{mashupRefId:"bopus_orderstatus_getShipmentCountForGivenStatuses",mashupId:"bopus_orderstatus_getShipmentCountForGivenStatuses",modelName:"bopus_orderstatus_shipmentCountForGivenStatuses"}],ui:{hasBOPUSPermission:o.hasPermission("WSC000038"),hasSFSPermission:o.hasPermission("WSC000039"),currentView:o.hasPermission("WSC000038")&&o.hasPermission("WSC000039")?"sla":"slaNorderstatus",isMashupCallInProgress:false,isCommonCodeSLAConfigValidFor_bopus:true,iconLabel:a.translate("managerDashboard.LABEL_OrdersBySLA"),hideLink:true,bopus_data:{sla:[],orderstatus:[]},toggleClassValue_sla:"",toggleClassValue_orderstatus:o.hasPermission("WSC000038")&&o.hasPermission("WSC000039")?"":"toggle-visibility-clazz"},initialize:function(){var t=r.getManagerDashboardConfig();var s=t["pickupInStore"];this._slaConfig=s["sla"];this._orderStatusConfig=s["shipmentStatus"];if(n.bopus_getActiveChart()!=null){this.ui.currentView=n.bopus_getActiveChart()}e.$on("event_mgrDashboardPortletRefresh",function(t,s){this.callRequiredMashup()}.bind(this));e.$on("event_chartRegionSelection",function(t,s){this.validateAndGotoRequestedState(s)}.bind(this));e.$on("event_chartCenterRegionSelection",function(t,s){this.validateAndGotoRequestedState(s)}.bind(this));if(n.getCommonCodeListData()==null){e.$on("event_mgrDashboardCommonCodeDataAvailable",function(t,s){this.ui.hideLink=false;this.callRequiredMashup()}.bind(this))}else{this.ui.hideLink=false;this.callRequiredMashup()}this._hiddenPortletActiveHack()},callRequiredMashup:function(){this.ui.isCommonCodeSLAConfigValidFor_bopus=n.validateCommonCodeListDataForFulfillmentMethod("bopus");var t=[];if(this.ui.currentView==="slaNorderstatus"){t=[u.getMashupRefObj(this,"bopus_sla_getShipmentCountForGivenStatuses",n.getInputJson(this._slaConfig,this._orderStatusConfig,"bopus","sla")),u.getMashupRefObj(this,"bopus_orderstatus_getShipmentCountForGivenStatuses",n.getInputJson(this._slaConfig,this._orderStatusConfig,"bopus","orderstatus"))]}else if(this.ui.currentView==="orderstatus"){t=[u.getMashupRefObj(this,"bopus_orderstatus_getShipmentCountForGivenStatuses",n.getInputJson(this._slaConfig,this._orderStatusConfig,"bopus",this.ui.currentView))]}else{t=[u.getMashupRefObj(this,"bopus_sla_getShipmentCountForGivenStatuses",n.getInputJson(this._slaConfig,this._orderStatusConfig,"bopus",this.ui.currentView))]}if(!this.ui.isCommonCodeSLAConfigValidFor_bopus){if(this.ui.currentView==="slaNorderstatus"||this.ui.currentView==="sla"){t.splice(0,1)}}if(t.length>0){this.ui.isMashupCallInProgress=true;u.callMashups(this,t,{showMask:false}).then(this.handleMashupOutput.bind(this),angular.noop)}},uiSwitchView:function(t){if(t==="orderstatus"){this.ui.toggleClassValue_orderstatus="";if(!(o.hasPermission("WSC000038")&&o.hasPermission("WSC000039"))){this.ui.toggleClassValue_sla="toggle-visibility-clazz"}else{this.ui.toggleClassValue_sla=""}}else{this.ui.toggleClassValue_sla="";if(!(o.hasPermission("WSC000038")&&o.hasPermission("WSC000039"))){this.ui.toggleClassValue_orderstatus="toggle-visibility-clazz"}else{this.ui.toggleClassValue_orderstatus=""}}if(this.ui.currentView!=="slaNorderstatus"){this.ui.currentView=t}n.bopus_setActiveChart(this.ui.currentView);this.callRequiredMashup()},validateAndGotoRequestedState:function(t){if(t["id"]==="bopusChart_orderStatus"||t["id"]==="bopusChart_sla"){var s=t.name;var e=this.ui.currentView;if(e==="slaNorderstatus"){e=t["id"]==="bopusChart_orderStatus"?"orderstatus":"sla"}if(s==null){s=n.getFirstDisplayStatusInArray("bopus",e)}i.goToState("shipmentList",{fulfillmentMethod:"bopus",view:e,selectedStatus:s},{})}},handleMashupOutput:function(){if(this.ui.currentView==="slaNorderstatus"){this.handleMashupOutput_sla();this.handleMashupOutput_orderstatus()}else if(this.ui.currentView==="orderstatus"){this.handleMashupOutput_orderstatus()}else{if(this.ui.currentView==null){this.ui.currentView="sla";n.bopus_setActiveChart(this.ui.currentView);console.warn("currentView came null in manager-dashboard-bopus-portlet, defaulting to sla.")}this.handleMashupOutput_sla()}this.ui.isMashupCallInProgress=false},handleMashupOutput_orderstatus:function(){var t=n.getDataFromModel(null,this.model.bopus_orderstatus_shipmentCountForGivenStatuses,"bopus","orderstatus");h(function(){e.$broadcast("event_createChart",{id:"bopusChart_orderStatus",data:t["orderstatus"]})}.bind(this),10,1);this.ui.bopus_data["orderstatus"]=t["orderstatus"]},handleMashupOutput_sla:function(){var t=n.getDataFromModel(this.model.bopus_sla_shipmentCountForGivenStatuses,null,"bopus","sla");h(function(){e.$broadcast("event_createChart",{id:"bopusChart_sla",data:t["sla"]})}.bind(this),10,1);this.ui.bopus_data["sla"]=t["sla"]},_hiddenPortletActiveHack:function(){try{e.$watch("$parent.$parent.$parent.$parent.active",function(t,s){if(t&&t!=s){if(this.ui.currentView==="slaNorderstatus"){this.handleMashupOutput_sla();this.handleMashupOutput_orderstatus()}else if(this.ui.currentView==="orderstatus"){this.handleMashupOutput_orderstatus()}else{if(this.ui.currentView==null){console.warn("Special watch expression: currentView came null in manager-dashboard-bopus-portlet, defaulting to sla.")}this.handleMashupOutput_sla()}console.log("manager-dashboard-bopus-portlet.controller: again re-rendering chart as portlet became visible.")}}.bind(this))}catch(t){console.warn("manager-dashboard-bopus-portlet.controller: issue while adding listener to try and track the active portlet.",t)}}})}]);
angular.module("store").controller("store.views.home.manager-dashboard.manager-dashboard-sfs-portlet",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscResourcePermission","iscDialChartD3Pvdr","iscManagerDashboardService","iscDialChartD3Service","$interval",function(e,s,i,t,a,r,n,u,o,l,h){s.initializeScreen(e,{model:{sfs_sla_shipmentCountForGivenStatuses:{},sfs_orderstatus_shipmentCountForGivenStatuses:{}},mashupRefs:[{mashupRefId:"sfs_sla_getShipmentCountForGivenStatuses",mashupId:"sfs_sla_getShipmentCountForGivenStatuses",modelName:"sfs_sla_shipmentCountForGivenStatuses"},{mashupRefId:"sfs_orderstatus_getShipmentCountForGivenStatuses",mashupId:"sfs_orderstatus_getShipmentCountForGivenStatuses",modelName:"sfs_orderstatus_shipmentCountForGivenStatuses"}],ui:{hasBOPUSPermission:n.hasPermission("WSC000038"),hasSFSPermission:n.hasPermission("WSC000039"),currentView:n.hasPermission("WSC000038")&&n.hasPermission("WSC000039")?"sla":"slaNorderstatus",isMashupCallInProgress:false,isCommonCodeSLAConfigValidFor_sfs:true,iconLabel:a.translate("managerDashboard.LABEL_OrdersBySLA"),hideLink:true,sfs_data:{sla:{},orderstatus:{}},toggleClassValue_sla:"",toggleClassValue_orderstatus:n.hasPermission("WSC000038")&&n.hasPermission("WSC000039")?"":"toggle-visibility-clazz"},initialize:function(){var s=u.getManagerDashboardConfig();var t=s["shipFromStore"];this._slaConfig=t["sla"];this._orderStatusConfig=t["shipmentStatus"];if(o.sfs_getActiveChart()!=null){this.ui.currentView=o.sfs_getActiveChart()}e.$on("event_mgrDashboardPortletRefresh",function(s,t){this.callRequiredMashup()}.bind(this));e.$on("event_chartRegionSelection",function(s,t){this.validateAndGotoRequestedState(t)}.bind(this));e.$on("event_chartCenterRegionSelection",function(s,t){this.validateAndGotoRequestedState(t)}.bind(this));if(o.getCommonCodeListData()==null){e.$on("event_mgrDashboardCommonCodeDataAvailable",function(s,t){this.ui.hideLink=false;this.callRequiredMashup()}.bind(this))}else{this.ui.hideLink=false;this.callRequiredMashup()}this._hiddenPortletActiveHack()},callRequiredMashup:function(){this.ui.isCommonCodeSLAConfigValidFor_sfs=o.validateCommonCodeListDataForFulfillmentMethod("sfs");var s=[];if(this.ui.currentView==="slaNorderstatus"){s=[r.getMashupRefObj(this,"sfs_sla_getShipmentCountForGivenStatuses",o.getInputJson(this._slaConfig,this._orderStatusConfig,"sfs","sla")),r.getMashupRefObj(this,"sfs_orderstatus_getShipmentCountForGivenStatuses",o.getInputJson(this._slaConfig,this._orderStatusConfig,"sfs","orderstatus"))]}else if(this.ui.currentView==="orderstatus"){s=[r.getMashupRefObj(this,"sfs_orderstatus_getShipmentCountForGivenStatuses",o.getInputJson(this._slaConfig,this._orderStatusConfig,"sfs",this.ui.currentView))]}else{s=[r.getMashupRefObj(this,"sfs_sla_getShipmentCountForGivenStatuses",o.getInputJson(this._slaConfig,this._orderStatusConfig,"sfs",this.ui.currentView))]}if(!this.ui.isCommonCodeSLAConfigValidFor_sfs){if(this.ui.currentView==="slaNorderstatus"||this.ui.currentView==="sla"){s.splice(0,1)}}if(s.length>0){this.ui.isMashupCallInProgress=true;r.callMashups(this,s,{showMask:false}).then(this.handleMashupOutput.bind(this),angular.noop)}},uiSwitchView:function(s){if(s==="orderstatus"){this.ui.toggleClassValue_orderstatus="";if(!(n.hasPermission("WSC000038")&&n.hasPermission("WSC000039"))){this.ui.toggleClassValue_sla="toggle-visibility-clazz"}else{this.ui.toggleClassValue_sla=""}}else{this.ui.toggleClassValue_sla="";if(!(n.hasPermission("WSC000038")&&n.hasPermission("WSC000039"))){this.ui.toggleClassValue_orderstatus="toggle-visibility-clazz"}else{this.ui.toggleClassValue_orderstatus=""}}if(this.ui.currentView!=="slaNorderstatus"){this.ui.currentView=s}o.sfs_setActiveChart(this.ui.currentView);this.callRequiredMashup()},validateAndGotoRequestedState:function(s){if(s["id"]==="sfsChart_orderStatus"||s["id"]==="sfsChart_sla"){var t=s.name;var e=this.ui.currentView;if(e==="slaNorderstatus"){e=s["id"]==="sfsChart_orderStatus"?"orderstatus":"sla"}if(t==null){t=o.getFirstDisplayStatusInArray("sfs",e)}i.goToState("shipmentList",{fulfillmentMethod:"sfs",view:e,selectedStatus:t},{})}},handleMashupOutput:function(){if(this.ui.currentView==="slaNorderstatus"){this.handleMashupOutput_sla();this.handleMashupOutput_orderstatus()}else if(this.ui.currentView==="orderstatus"){this.handleMashupOutput_orderstatus()}else{if(this.ui.currentView==null){this.ui.currentView="sla";o.sfs_setActiveChart(this.ui.currentView);console.warn("currentView came null in manager-dashboard-sfs-portlet, defaulting to sla.")}this.handleMashupOutput_sla()}this.ui.isMashupCallInProgress=false},handleMashupOutput_orderstatus:function(){var s=o.getDataFromModel(null,this.model.sfs_orderstatus_shipmentCountForGivenStatuses,"sfs","orderstatus");h(function(){e.$broadcast("event_createChart",{id:"sfsChart_orderStatus",data:s["orderstatus"]})}.bind(this),10,1);this.ui.sfs_data["orderstatus"]=s["orderstatus"]},handleMashupOutput_sla:function(){var s=o.getDataFromModel(this.model.sfs_sla_shipmentCountForGivenStatuses,null,"sfs","sla");h(function(){e.$broadcast("event_createChart",{id:"sfsChart_sla",data:s["sla"]})}.bind(this),10,1);this.ui.sfs_data["sla"]=s["sla"]},_hiddenPortletActiveHack:function(){try{e.$watch("$parent.$parent.$parent.$parent.active",function(s,t){if(s&&s!=t){if(this.ui.currentView==="slaNorderstatus"){this.handleMashupOutput_sla();this.handleMashupOutput_orderstatus()}else if(this.ui.currentView==="orderstatus"){this.handleMashupOutput_orderstatus()}else{if(this.ui.currentView==null){console.warn("Special watch expression: currentView came null in manager-dashboard-sfs-portlet, defaulting to sla.")}this.handleMashupOutput_sla()}console.log("manager-dashboard-sfs-portlet.controller: again re-rendering chart as portlet became visible.")}}.bind(this))}catch(s){console.warn("manager-dashboard-sfs-portlet.controller: issue while adding listener to try and track the active portlet.",s)}}})}]);
angular.module("store").controller("store.views.home.manager-dashboard.manager-dashboard",["$scope","$rootScope","iscScreen","iscState","iscAppInfo","iscPersona","iscDialChartD3Pvdr","iscHttpRequest","iscResourcePermission","iscMashup","iscManagerDashboardService","iscDialChartD3Service","$interval",function(e,o,s,t,a,i,n,r,u,l,h,d,m){s.initializeScreen(e,{model:{commonCodeListData_combined:{},dashboardPollingIntervalRuleDetails:{},bopus_sla_shipmentCountForGivenStatuses:{},bopus_orderstatus_shipmentCountForGivenStatuses:{},sfs_sla_shipmentCountForGivenStatuses:{},sfs_orderstatus_shipmentCountForGivenStatuses:{}},mashupRefs:[{mashupRefId:"mgrdb_getCommonCodeListForSLA",mashupId:"mgrdb_getCommonCodeListForSLA",modelName:"commonCodeListData_combined"},{mashupRefId:"mgrdb_getDashboardPollingIntervalRuleDetails",mashupId:"mgrdb_getDashboardPollingIntervalRuleDetails",modelName:"dashboardPollingIntervalRuleDetails"},{mashupRefId:"bopus_sla_getShipmentCountForGivenStatuses",mashupId:"bopus_sla_getShipmentCountForGivenStatuses",modelName:"bopus_sla_shipmentCountForGivenStatuses"},{mashupRefId:"bopus_orderstatus_getShipmentCountForGivenStatuses",mashupId:"bopus_orderstatus_getShipmentCountForGivenStatuses",modelName:"bopus_orderstatus_shipmentCountForGivenStatuses"},{mashupRefId:"sfs_sla_getShipmentCountForGivenStatuses",mashupId:"sfs_sla_getShipmentCountForGivenStatuses",modelName:"sfs_sla_shipmentCountForGivenStatuses"},{mashupRefId:"sfs_orderstatus_getShipmentCountForGivenStatuses",mashupId:"sfs_orderstatus_getShipmentCountForGivenStatuses",modelName:"sfs_orderstatus_shipmentCountForGivenStatuses"}],ui:{hasOrderCapturePermission:u.hasPermission("WSC000031")||u.hasPermission("WSC000033")||u.hasPermission("WSC000047")||u.hasPermission("WSC000041"),hasBOPUSPermission:u.hasPermission("WSC000038"),hasSFSPermission:u.hasPermission("WSC000039"),isCommonCodeSLAConfigValidFor_bopus:true,isCommonCodeSLAConfigValidFor_sfs:true,hideLink:true,slaAreaClazz:"visibility-clazz-invisible",orderstatusAreaClazz:"visibility-clazz-visible",availableActions:[{id:"orderFulfillmentView",name:"managerDashboard.TOOLTIP_OrderFulfillment"},{id:"customerServiceView",name:"managerDashboard.TOOLTIP_CustomerService"}],counts:{sfs_sla:[],sfs_orderstatus:[],bopus_sla:[],bopus_orderstatus:[],total_sla:[],total_orderstatus:[],total_orderstatus_totalOrders:0},legendJsonConfigArray_orderstatus:[],legendJsonConfigArray_sla:[],isMashupCallInProgress:false,usePersonaBasedHomepage:false},initialize:function(){if(i.getUsePersonaBasedHomepageFlagValue()===true){this.ui.usePersonaBasedHomepage=true}var s=h.getCommonCodeListData();e.$on("$destroy",function(){if(e._intervalInstance!=null){m.cancel(e._intervalInstance)}});if(s==null){var t=[l.getMashupRefObj(this,"mgrdb_getCommonCodeListForSLA",{}),l.getMashupRefObj(this,"mgrdb_getDashboardPollingIntervalRuleDetails",{})];l.callMashups(this,t,{showMask:true}).then(this.handleMashupOutput.bind(this),angular.noop)}else{this.setupIntervalAndInitializeData()}},handleMashupOutput:function(){h.setCommonCodeListData(this.model.commonCodeListData_combined);e.$broadcast("event_mgrDashboardCommonCodeDataAvailable",{});this.setupIntervalAndInitializeData()},setupIntervalAndInitializeData:function(){var s=n.getManagerDashboardConfig();if(this.model.dashboardPollingIntervalRuleDetails.Rules!=null&&this.model.dashboardPollingIntervalRuleDetails.Rules.RuleSetFieldName==="WSC_DASHBOARD_POLLING_INTERVAL"&&this.model.dashboardPollingIntervalRuleDetails.Rules.RuleSetValue!=null&&this.model.dashboardPollingIntervalRuleDetails.Rules.RuleSetValue!=""){n.updateManagerDashboardConfigWithRefreshInterval(this.model.dashboardPollingIntervalRuleDetails.Rules.RuleSetValue)}else if(s["refreshInterval"]==null){console.warn("manager-dashboard.controller - WSC_DASHBOARD_POLLING_INTERVAL was not configured... Defaulting to 300sec");n.updateManagerDashboardConfigWithRefreshInterval(3e5)}s=n.getManagerDashboardConfig();this._mgrDashboardBopusConfig=s["pickupInStore"];this._mgrDashboardSfsConfig=s["shipFromStore"];e._intervalInstance=m(function(){e.$broadcast("event_mgrDashboardPortletRefresh",null);this.callCombinedMashupsForShipmentCount()}.bind(this),+s.refreshInterval);this.callCombinedMashupsForShipmentCount()},callCombinedMashupsForShipmentCount:function(){if(this.ui.hasBOPUSPermission&&this.ui.hasSFSPermission){this.ui.isCommonCodeSLAConfigValidFor_bopus=h.validateCommonCodeListDataForFulfillmentMethod("bopus");this.ui.isCommonCodeSLAConfigValidFor_sfs=h.validateCommonCodeListDataForFulfillmentMethod("sfs");var s=[];if(this.ui.isCommonCodeSLAConfigValidFor_bopus&&this.ui.isCommonCodeSLAConfigValidFor_sfs){s=[l.getMashupRefObj(this,"bopus_sla_getShipmentCountForGivenStatuses",h.getInputJson(this._mgrDashboardBopusConfig["sla"],this._mgrDashboardBopusConfig["shipmentStatus"],"bopus","sla")),l.getMashupRefObj(this,"bopus_orderstatus_getShipmentCountForGivenStatuses",h.getInputJson(this._mgrDashboardBopusConfig["sla"],this._mgrDashboardBopusConfig["shipmentStatus"],"bopus","orderstatus")),l.getMashupRefObj(this,"sfs_sla_getShipmentCountForGivenStatuses",h.getInputJson(this._mgrDashboardSfsConfig["sla"],this._mgrDashboardSfsConfig["shipmentStatus"],"sfs","sla")),l.getMashupRefObj(this,"sfs_orderstatus_getShipmentCountForGivenStatuses",h.getInputJson(this._mgrDashboardSfsConfig["sla"],this._mgrDashboardSfsConfig["shipmentStatus"],"sfs","orderstatus"))]}else{s=[l.getMashupRefObj(this,"bopus_orderstatus_getShipmentCountForGivenStatuses",h.getInputJson(this._mgrDashboardBopusConfig["sla"],this._mgrDashboardBopusConfig["shipmentStatus"],"bopus","orderstatus")),l.getMashupRefObj(this,"sfs_orderstatus_getShipmentCountForGivenStatuses",h.getInputJson(this._mgrDashboardSfsConfig["sla"],this._mgrDashboardSfsConfig["shipmentStatus"],"sfs","orderstatus"))]}this.ui.hideLink=true;this.ui.isMashupCallInProgress=true;l.callMashups(this,s,{showMask:false}).then(this.handleCombinedMashupsForShipmentCountOutput.bind(this),angular.noop)}},handleCombinedMashupsForShipmentCountOutput:function(){this._bopus_data=h.getDataFromModel(this.model.bopus_sla_shipmentCountForGivenStatuses,this.model.bopus_orderstatus_shipmentCountForGivenStatuses,"bopus",null);this.ui.counts.bopus_sla=this._bopus_data.sla;this.ui.counts.bopus_orderstatus=this._bopus_data.orderstatus;this._sfs_data=h.getDataFromModel(this.model.sfs_sla_shipmentCountForGivenStatuses,this.model.sfs_orderstatus_shipmentCountForGivenStatuses,"sfs",null);this.ui.counts.sfs_sla=this._sfs_data.sla;this.ui.counts.sfs_orderstatus=this._sfs_data.orderstatus;this.ui.hideLink=false;this.ui.isMashupCallInProgress=false;this.updateTotals();this.ui.legendJsonConfigArray_orderstatus=d.getLegendJsonConfigArray("bopus","orderstatus",this.ui.counts.total_orderstatus);if(this.ui.isCommonCodeSLAConfigValidFor_bopus&&this.ui.isCommonCodeSLAConfigValidFor_sfs){this.ui.legendJsonConfigArray_sla=d.getLegendJsonConfigArray("bopus","sla",this.ui.counts.total_sla)}},updateTotals:function(){this.ui.counts.total_orderstatus_totalOrders=0;if(this.ui.isCommonCodeSLAConfigValidFor_bopus&&this.ui.isCommonCodeSLAConfigValidFor_sfs){for(var s=0;s<this.ui.counts.bopus_sla.length;s++){this.ui.counts.total_sla[s]=this.ui.counts.bopus_sla[s]+this.ui.counts.sfs_sla[s]}}for(var s=0;s<this.ui.counts.bopus_orderstatus.length;s++){this.ui.counts.total_orderstatus[s]=this.ui.counts.bopus_orderstatus[s]+this.ui.counts.sfs_orderstatus[s];this.ui.counts.total_orderstatus_totalOrders=this.ui.counts.total_orderstatus_totalOrders+this.ui.counts.total_orderstatus[s]}},uiToggleTopPortletClass:function(s){if(s=="orderstatus"){this.ui.slaAreaClazz="visibility-clazz-invisible";this.ui.orderstatusAreaClazz="visibility-clazz-visible"}else{this.ui.slaAreaClazz="visibility-clazz-visible";this.ui.orderstatusAreaClazz="visibility-clazz-invisible"}},uiGoToBackRoomPickup:function(){window.onbeforeunload=null;o.activeCalls++;var s=a.getAppDeviceMode();var t="";if(s==="mobile"){t=a.getApplicationContext()+"/store/mobile/container/home.do"}else{t=a.getApplicationContext()+"/store/container/home.do"}window.location.href=r.addAdditionalParamsInURL(t,"GET")},uiPerformAction:function(s){if(s.id==="orderFulfillmentView"){this.uiGoToBackRoomPickup()}else{t.goToState("/home",{},{})}}})}]);
angular.module("store").controller("store.views.home.order-fulfillment.pack-portlet-mini",["$scope","iscScreen","iscMashup",function(e,i,t){i.initializeScreen(e,{model:{},mashupRefs:[{mashupRefId:"getPackInProgressShipmentCount",mashupId:"store.views.home.order-fulfillment.getPackInProgressShipmentCount"},{mashupRefId:"getReadyForPackShipmentCount",mashupId:"store.views.home.order-fulfillment.getReadyForPackShipmentCount"}],ui:{isMashupCallInProgress:true,inProgressShipmentCount:0,readyForPackShipmentCount:0,displayCount:0},initialize:function(){var e=[];var i={Shipment:{}};e.push(t.getMashupRefObj(this,"getPackInProgressShipmentCount",i));e.push(t.getMashupRefObj(this,"getReadyForPackShipmentCount",i));t.callMashups(this,e,{showMask:false}).then(this.handleInitAPIs.bind(this),angular.noop)},handleInitAPIs:function(e){var i=t.getMashupOutput(e,"getPackInProgressShipmentCount");var s=t.getMashupOutput(e,"getReadyForPackShipmentCount");if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.Shipments)&&!iscCore.isVoid(i.Shipments.TotalNumberOfRecords)){this.ui.inProgressShipmentCount=Number(i.Shipments.TotalNumberOfRecords)}if(!iscCore.isVoid(s)&&!iscCore.isVoid(s.Shipments)&&!iscCore.isVoid(s.Shipments.TotalNumberOfRecords)){this.ui.readyForPackShipmentCount=Number(s.Shipments.TotalNumberOfRecords)}this.ui.displayCount=this.ui.inProgressShipmentCount+this.ui.readyForPackShipmentCount;this.ui.isMashupCallInProgress=false}})}]);
angular.module("store").controller("store.views.home.order-fulfillment.pack-portlet",["$scope","iscScreen","iscMashup","iscResourcePermission","$filter","iscModal","iscI18n","iscState","$timeout","iscDomUtility","iscShipment","iscPortletShipment","iscShipmentStatus",function(e,t,a,i,n,o,r,s,u,h,c,p,m){t.initializeScreen(e,{model:{packShipmentCount:{inprogressShipmentCount:0,totalShipmentCount:0,notStartedShipmentCount:0},productScanInput:{},itemPackRule:{Rules:{RuleSetValue:"N"}}},mashupRefs:[{mashupRefId:"getPackInProgressShipmentCount",mashupId:"store.views.home.order-fulfillment.getPackInProgressShipmentCount"},{mashupRefId:"getReadyForPackShipmentCount",mashupId:"store.views.home.order-fulfillment.getReadyForPackShipmentCount"},{mashupRefId:"translateBarCodeForShipmentPack",mashupId:"store.views.home.order-fulfillment.getShipmentForPackingByItemId"},{mashupRefId:"getRuleForItemPack",mashupId:"store.views.home.order-fulfillment.getRuleForItemPack",modelName:"itemPackRule"},{mashupRefId:"getShipmentCountForPortletAdvSearch",mashupId:"store.views.common.outboundShipment.getShipmentCountForPortletAdvSearch"}],ui:{showAdvanceSearch:false,search:{},packListPage:"packorderlist",packPage:"containerpack",searchCriteria:{}},initialize:function(){var e=[];var t={Shipment:{}};e.push(a.getMashupRefObj(this,"getPackInProgressShipmentCount",t));e.push(a.getMashupRefObj(this,"getReadyForPackShipmentCount",t));e.push(a.getMashupRefObj(this,"getRuleForItemPack",{}));if(e.length>0){a.callMashups(this,e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)}},handleInitApiCalls:function(e){var t=a.getMashupOutput(e,"getPackInProgressShipmentCount");var i=a.getMashupOutput(e,"getReadyForPackShipmentCount");var o=Number(0);if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.Shipments)&&!iscCore.isVoid(t.Shipments.TotalNumberOfRecords)){this.model.packShipmentCount.inprogressShipmentCount=n("number")(t.Shipments.TotalNumberOfRecords);o+=Number(n("number")(t.Shipments.TotalNumberOfRecords))}if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.Shipments)&&!iscCore.isVoid(i.Shipments.TotalNumberOfRecords)){this.model.packShipmentCount.notStartedShipmentCount=n("number")(i.Shipments.TotalNumberOfRecords);o+=Number(n("number")(i.Shipments.TotalNumberOfRecords))}this.model.packShipmentCount.totalShipmentCount=o},uiOpenAdvanceSearch:function(){this.ui.showAdvanceSearch=true;if(this.model.itemPackRule.Rules.RuleSetValue==="N")h.setFocus(document.getElementById("packAssignedTo"));else h.setFocus(document.getElementById("pack_shipment_orderNumber"))},uiAdvanceClose:function(){this.ui.showAdvanceSearch=false;u(function(){document.getElementById("advanceSearchLink").focus()},500)},uiOpenTotalShipmentList:function(){s.goToState(this.ui.packListPage,{input:{FilterOptions:"All"}},{})},uiOpenInprogressShipmentList:function(){s.goToState(this.ui.packListPage,{input:{FilterOptions:"InProgress"}},{})},uiOpenNotStartedShipmentList:function(){s.goToState(this.ui.packListPage,{input:{FilterOptions:"NotStarted"}},{})},uiScanProductBarCodeData:function(e){if(!iscCore.isVoid(this.model.productScanInput.value)){var t={BarCode:{BarCodeData:this.model.productScanInput.value}};a.callMashup(this,"translateBarCodeForShipmentPack",t,{}).then(this.processProductBarCodeTranslation.bind(this),angular.noop);this.model.productScanInput.value=""}else{o.showErrorMessage(r.translate("packportlet.MSG_InvalidBarCodeData"))}},processProductBarCodeTranslation:function(e){var t=a.getMashupOutput(e,"translateBarCodeForShipmentPack");if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.BarCode.ErrorCode)){o.showErrorMessage("apierror."+t.BarCode.ErrorCode)}else{s.goToState("containerpack",{input:{Shipment:t.BarCode.Shipment}},{})}},processProductBarCodeSearch:function(e){},uiHandleBarcodeOrSearchOutput:function(e){p.handleShipmentOrderBarcodeTranslation(e,this.ui.packPage)},uiAdvanceSearch:function(){if(!iscCore.isVoid(this.ui.search)){this.ui.searchCriteria=this.ui.search;a.callMashup(this,"getShipmentCountForPortletAdvSearch",this.ui.searchCriteria,{}).then(this.handleAdvSearchApiCall.bind(this),angular.noop)}else{o.showErrorMessage(r.translate("outboundShipments.MSG_AdvanceSearchBlankCriteria"))}},handleAdvSearchApiCall:function(e){var t=a.getMashupOutput(e,"getShipmentCountForPortletAdvSearch");if(t&&t.Shipments){t.Shipments.TotalNumberOfRecords=!(t.Shipments.Shipment&&t.Shipments.Shipment.length)?0:t.Shipments.Shipment.length;p.handlePortletAdvancedSearch(t,this.ui.packPage,this.ui.searchCriteria,angular.copy(m.getShipmentStatusCodeList("Pack")))}else{o.showErrorMessage(r.translate("outboundShipments.MSG_ShipmentNotFound"))}}})}]);
angular.module("store").controller("store.views.home.order-fulfillment.pick-portlet-mini",["$scope","iscScreen","iscMashup","iscResourcePermission","iscShipment",function(i,e,t,s,n){e.initializeScreen(i,{model:{},mashupRefs:[{mashupRefId:"getPickInProgressShipmentCount",mashupId:"store.views.home.order-fulfillment.getPickInProgressShipmentCount"},{mashupRefId:"getReadyForPickShipmentCount",mashupId:"store.views.home.order-fulfillment.getReadyForPickShipmentCount"}],ui:{isMashupCallInProgress:true,hasPermissionForSFSOrders:s.hasPermission("WSC000058"),hasPermissionForBOPISOrders:s.hasPermission("WSC000057"),inProgressShipmentCount:0,notStartedShipmentCount:0,displayCount:0},initialize:function(){var i=[];i.push(t.getMashupRefObj(this,"getPickInProgressShipmentCount",this.getShipmentCountInput(["1100.70.06.20"])));i.push(t.getMashupRefObj(this,"getReadyForPickShipmentCount",this.getShipmentCountInput(["1100.70.06.10"])));t.callMashups(this,i,{showMask:false}).then(this.handleInitAPIs.bind(this),angular.noop)},getShipmentCountInput:function(i){var e={Shipment:{}};var s="";var t=null;if(this.ui.hasPermissionForSFSOrders&&!this.ui.hasPermissionForBOPISOrders){s="SHP"}else if(!this.ui.hasPermissionForSFSOrders&&this.ui.hasPermissionForBOPISOrders){s="PICK";t=["0001"]}return n.prepareShipmentListApiInput(e,i,t,s)},handleInitAPIs:function(i){var e=t.getMashupOutput(i,"getPickInProgressShipmentCount");var s=t.getMashupOutput(i,"getReadyForPickShipmentCount");if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Shipments)&&!iscCore.isVoid(e.Shipments.TotalNumberOfRecords)){this.ui.inProgressShipmentCount=Number(e.Shipments.TotalNumberOfRecords)}if(!iscCore.isVoid(s)&&!iscCore.isVoid(s.Shipments)&&!iscCore.isVoid(s.Shipments.TotalNumberOfRecords)){this.ui.notStartedShipmentCount=Number(s.Shipments.TotalNumberOfRecords)}this.ui.displayCount=this.ui.inProgressShipmentCount+this.ui.notStartedShipmentCount;this.ui.isMashupCallInProgress=false}})}]);
angular.module("store").controller("store.views.home.order-fulfillment.pick-portlet",["$scope","iscScreen","iscMashup","iscResourcePermission","$filter","iscModal","iscI18n","iscState","$timeout","iscDomUtility","iscShipment","iscPortletShipment","iscShipmentStatus",function(e,t,n,i,o,s,r,h,a,u,p,c,m){t.initializeScreen(e,{model:{pickShipmentCount:{inprogressShipmentCount:0,totalShipmentCount:0,notStartedShipmentCount:0}},mashupRefs:[{mashupRefId:"getPickInProgressShipmentCount",mashupId:"store.views.home.order-fulfillment.getPickInProgressShipmentCount"},{mashupRefId:"getReadyForPickShipmentCount",mashupId:"store.views.home.order-fulfillment.getReadyForPickShipmentCount"},{mashupRefId:"getShipmentCountForPortletAdvSearch",mashupId:"store.views.common.outboundShipment.getShipmentCountForPortletAdvSearch"}],ui:{hasPermissionForSFSOrders:i.hasPermission("WSC000058"),hasPermissionForBOPISOrders:i.hasPermission("WSC000057"),hasPermissionForBatchPick:i.hasPermission("WSC000053"),showAdvanceSearch:false,search:{},pickListPage:"pickorderlist",pickPage:"backroomPickWizard",searchCriteria:{}},initialize:function(){var e=[];e.push(n.getMashupRefObj(this,"getPickInProgressShipmentCount",this.getShipmentCountInput(["1100.70.06.20"])));e.push(n.getMashupRefObj(this,"getReadyForPickShipmentCount",this.getShipmentCountInput(["1100.70.06.10"])));if(e.length>0){n.callMashups(this,e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)}},getShipmentCountInput:function(e){var t={Shipment:{}};var i="";var s=null;if(this.ui.hasPermissionForSFSOrders&&!this.ui.hasPermissionForBOPISOrders){i="SHP"}else if(!this.ui.hasPermissionForSFSOrders&&this.ui.hasPermissionForBOPISOrders){i="PICK";s=["0001"]}return p.prepareShipmentListApiInput(t,e,s,i)},handleInitApiCalls:function(e){var t=n.getMashupOutput(e,"getPickInProgressShipmentCount");var i=n.getMashupOutput(e,"getReadyForPickShipmentCount");var s=Number(0);if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.Shipments)&&!iscCore.isVoid(t.Shipments.TotalNumberOfRecords)){this.model.pickShipmentCount.inprogressShipmentCount=o("number")(t.Shipments.TotalNumberOfRecords);s+=Number(o("number")(t.Shipments.TotalNumberOfRecords))}if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.Shipments)&&!iscCore.isVoid(i.Shipments.TotalNumberOfRecords)){this.model.pickShipmentCount.notStartedShipmentCount=o("number")(i.Shipments.TotalNumberOfRecords);s+=Number(o("number")(i.Shipments.TotalNumberOfRecords))}this.model.pickShipmentCount.totalShipmentCount=s},uiOpenAdvanceSearch:function(){this.ui.showAdvanceSearch=true;u.setFocus(document.getElementById("pickAssignedTo"))},uiAdvanceClose:function(){this.ui.showAdvanceSearch=false;a(function(){document.getElementById("advanceSearchLink").focus()},500)},uiOpenBatchList:function(){h.goToState("batchpick",{action:"batchList",input:{}},{})},uiOpenTotalShipmentList:function(){h.goToState(this.ui.pickListPage,{input:{FilterOptions:"All"}},{})},uiOpenInprogressShipmentList:function(){h.goToState(this.ui.pickListPage,{input:{FilterOptions:"InProgress"}},{})},uiOpenNotStartedShipmentList:function(){h.goToState(this.ui.pickListPage,{input:{FilterOptions:"NotStarted"}},{})},uiHandleBarcodeOrSearchOutput:function(e){c.handleShipmentOrderBarcodeTranslation(e,this.ui.pickPage)},uiAdvanceSearch:function(){if(!iscCore.isVoid(this.ui.search.assignedTo)){this.ui.searchCriteria={Shipment:{AssignedToUserId:this.ui.search.assignedTo}};n.callMashup(this,"getShipmentCountForPortletAdvSearch",this.ui.searchCriteria,{}).then(this.handleAdvSearchApiCall.bind(this),angular.noop)}else{s.showErrorMessage(r.translate("outboundShipments.MSG_AdvanceSearchBlankCriteria"))}},handleAdvSearchApiCall:function(e){var t=n.getMashupOutput(e,"getShipmentCountForPortletAdvSearch");if(t&&t.Shipments){t.Shipments.TotalNumberOfRecords=!(t.Shipments.Shipment&&t.Shipments.Shipment.length)?0:t.Shipments.Shipment.length;c.handlePortletAdvancedSearch(t,this.ui.pickPage,this.ui.searchCriteria,angular.copy(m.getShipmentStatusCodeList("Pick")))}else{s.showErrorMessage(r.translate("outboundShipments.MSG_ShipmentNotFound"))}}})}]);
angular.module("store").controller("store.views.home.order-fulfillment.ship-portlet-mini",["$scope","iscScreen","iscMashup",function(e,s,i){s.initializeScreen(e,{model:{packagesModel:{}},mashupRefs:[{mashupRefId:"getPackagesCount",mashupId:"store.views.home.order-fulfillment.getPackagesCount",modelName:"packagesModel"}],ui:{isMashupCallInProgress:true,displayCount:0},initialize:function(){i.callMashup(this,"getPackagesCount",{Container:{Shipment:{}}},{showMask:false}).then(this.handleInitAPIs.bind(this),angular.noop)},handleInitAPIs:function(){var e=this.model.packagesModel;if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Containers)&&!iscCore.isVoid(e.Containers.TotalNumberOfRecords)){this.ui.displayCount=parseInt(e.Containers.TotalContainers,10)}this.ui.isMashupCallInProgress=false}})}]);
angular.module("store").controller("store.views.home.order-fulfillment.ship-portlet",["$scope","iscScreen","iscMashup","iscResourcePermission","$filter","iscModal","iscI18n","iscState","$timeout","iscDomUtility","iscShipment",function(e,i,t,s,a,o,n,l,r,c,u){i.initializeScreen(e,{model:{packagesModel:{}},mashupRefs:[{mashupRefId:"getPackagesCount",mashupId:"store.views.home.order-fulfillment.getPackagesCount",modelName:"packagesModel"}],ui:{totalPackages:0},initialize:function(){var e={Container:{}};e.Container.Shipment={};t.callMashup(this,"getPackagesCount",e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){var i=this.model.packagesModel;if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.Containers)&&!iscCore.isVoid(i.Containers.TotalNumberOfRecords)){this.ui.totalPackages=parseInt(i.Containers.TotalContainers,10)}},uiOpenTotalPackagesList:function(){l.goToState("shipmentConfirmList",{searchCriteria:{},titleKey:"ALL"},{})}})}]);
angular.module("store").controller("store.views.order.add-cart.add-items",["$animate","$scope","$rootScope","iscScreen","iscWizard","iscState","$location","$sce","$filter","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscOrder",function(e,i,l,t,n,a,r,s,o,d,u,h,m,c,f,v){n.initializeWizardPage(i,{model:{getCompleteItemList:{},itemDetails:{},orderDetails:{},orderLineList:{},getItemAvailabilityForStore:{},changeVariationInput:null,openBlankPage:false,customerDetails:{}},mashupRefs:[{mashupRefId:"getCompleteItemList",mashupId:"additems_getCompleteItemList",modelName:"getCompleteItemList"},{mashupRefId:"getRelatedItems",mashupId:"addItems_getRelatedItems",modelName:"relatedItemDetails"},{mashupRefId:"createOrder",mashupId:"addItems_createOrder",modelName:"orderDetails"},{mashupRefId:"modifyFulfillmentOptions",mashupId:"addItems_modifyFulfillmentOptions",modelName:"orderDetails"},{mashupRefId:"createOrderWithOvp",mashupId:"addItems_ovp_createOrder",modelName:"orderDetails"},{mashupRefId:"modifyFulfillmentOptionsWithOvp",mashupId:"addItems_ovp_modifyFulfillmentOptions",modelName:"orderDetails"},{mashupRefId:"getItemAvailabilityForStore",mashupId:"addItems_getItemAvailabilityForStore",modelName:"getItemAvailabilityForStore"},{mashupRefId:"getCompleteOrderDetails",mashupId:"addItems_getCompleteOrderDetails",modelName:"orderDetails"},{mashupRefId:"getRealTimeItemAvailabilityForStore",mashupId:"addItems_getRealTimeItemAvailability"},{mashupRefId:"changeOrderPendingChanges",mashupId:"changeVariation_changeOrderPendingChanges"}],ui:{showItemDetails:false,showCheckOutButton:true,noProductsFound:false,showItemDesc:true,showRelatedItems:false,defaultQty:1,orderTotalQty:0,deliveryMethod:"",searchInput:"",variantItemId:"",variantItemSelected:false,isScreenDirty:false,focusScanField:false,gift:{giftOptionsAvailable:true},priceOverride:{isPriceOverriden:false,priceOverrideReason:""},selectedShipNode:{shipNode:"",shipNodeDesc:""},showUpdateCart:false,showItemSearch:true,availability:{itemShpAvailableDate:"",itemShpAvailableText:"",itemShpAvailable:false,itemShpAvailableToday:false,itemPickAvailable:false,itemPickAvailableText:"",itemPickAvailableDate:"",itemCarryAvailable:false,itemCarryAvailableDate:""},activeTabIndex:0,showProductShare:true},handleChangeVariation:function(e){this.model.changeVariationInput=e;this.ui.defaultQty=e.OrderLine.OrderLineTranQuantity.OrderedQty;this.ui.deliveryMethod=this.model.changeVariationInput.OrderLine.DeliveryMethod;if(!iscCore.isVoid(e.OrderLine.LinePriceInfo.IsPriceLocked)&&e.OrderLine.LinePriceInfo.IsPriceLocked==="Y"){this.ui.priceOverride.isPriceOverriden=true}},initialize:function(){var e=n.getWizardPageInput();var i=e.input;if(!iscCore.isVoid(e.openBlankPage)){this.ui.openBlankPage=e.openBlankPage}this.model.customerDetails=n.getWizardModel("customerModel");var t=e.searchContext;var a=n.getWizardModel("orderModel");if(!iscCore.isVoid(a)&&a.Order.DraftOrderFlag==="N"){this.ui.showUpdateCart=true}if(!iscCore.isVoid(t)&&(t==="scanInStore"||t==="changeVariation")){l.$showBackButtonForStates=false;this.ui.showCheckOutButton=false;if(t==="changeVariation"){this.ui.showItemSearch=false;i=e.input.OrderLine.ItemDetails.ItemID;this.handleChangeVariation(e.input)}}this.ui.focusScanField=false;if(!iscCore.isVoid(a)&&!iscCore.isVoid(a.Order.OrderHeaderKey)){if(iscCore.isVoid(i)){h.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}else{var r=this.getCompleteItemDetailsApiInput(i,true);r.Item.DefaultPageSize=f.getFromContext("defaultPageSize");var s={Order:{OrderHeaderKey:a.Order.OrderHeaderKey}};var o=[];o.push(u.getMashupRefObj(this,"getCompleteItemList",r));o.push(u.getMashupRefObj(this,"getCompleteOrderDetails",s));u.callMashups(this,o,{}).then(this.handleInitApiCalls.bind(this),angular.noop)}}else{this.getCompleteItemDetails(i)}},handleInitApiCalls:function(e){var i=e.MashupRefs.MashupRef;if(i!==null&&i!==undefined){var t=i.length;for(var a=0;a<t;a++){var r=i[a];if(r.mashupRefId==="getCompleteItemList"){this.handleGetCompleteItemDetails(e)}else if(r.mashupRefId==="getCompleteOrderDetails"){orderDetails=this.model.orderDetails;n.setWizardModel("orderModel",this.model.orderDetails);this.ui.orderTotalQty=orderDetails.Order.OrderLines.TotalNumberOfRecords;if(!iscCore.isVoid(orderDetails)&&orderDetails.Order.DraftOrderFlag==="N"){this.ui.showUpdateCart=true;this.ui.showCheckOutButton=false;this.ui.availability.itemCarryAvailable=false}}}}},uiCancel:function(){if(!this.ui.showCheckOutButton){n.gotoPreviousPage(true)}else{var e=c.translate("order.WarningMessage_Cancel");if(this.ui.orderTotalQty<1){e=c.translate("addItems.WarningMessage_Cancel")}h.showConfirmationMessage(e).then(function(e){if(e==="YES"){n.closeWizard()}},function(e){})}},uiOpenProductSearch:function(t){var a=this;var e=true;if(this.ui.isScreenDirty){h.showConfirmationMessage(c.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){if(!iscCore.isVoid(t)){var i={input:t};if(this.ui.showUpdateCart===true||!this.ui.showCheckOutButton){n.gotoCustomPage("productSearch",i,{wizardPageCssClass:"fullscreen-modal"})}else{n.gotoCustomPage("productSearch",i,{})}}else{h.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}}else{a.model.searchInput=""}})}else{if(!iscCore.isVoid(t)){var i={input:t};if(this.ui.showUpdateCart===true){n.gotoCustomPage("productSearch",i,{wizardPageCssClass:"fullscreen-modal"})}else{n.gotoCustomPage("productSearch",i,{})}}else{h.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}}},uiHandleCheckout:function(){if(this.ui.isScreenDirty){h.showConfirmationMessage(c.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){n.gotoCustomPage("cartDetails",{},{})}})}else{n.gotoCustomPage("cartDetails",{},{})}},uiGetItemDetails:function(e){if(!iscCore.isVoid(e)){this.getCompleteItemDetails(e)}else{h.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}this.model.searchInput=""},uiOpenItemDetails:function(a){var r=this;this.ui.variantItemSelected=false;if(iscCore.isVoid(a)){h.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}else if(this.ui.isScreenDirty){h.showConfirmationMessage(c.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){if(r.ui.showUpdateCart===true||!r.ui.showCheckOutButton){var i=n.getWizardPageInput();var t={input:a};if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.searchContext)){t.searchContext=i.searchContext}n.gotoCustomPage("addItems",t,{removeCurrent:true,wizardPageCssClass:"fullscreen-modal"})}else{n.gotoCustomPage("addItems",{input:a},{})}}else{r.model.searchInput=""}})}else if(this.ui.showUpdateCart===true||!this.ui.showCheckOutButton){var e=n.getWizardPageInput();var i={input:a};if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.searchContext)){i.searchContext=e.searchContext}n.gotoCustomPage("addItems",i,{removeCurrent:true,wizardPageCssClass:"fullscreen-modal"})}else{n.gotoCustomPage("addItems",{input:a},{})}},uiShowVariantItemDetails:function(e){this.ui.variantItemSelected=true;this.getCompleteItemDetails(e)},uiIncreaseQty:function(){this.ui.isScreenDirty=true;this.ui.defaultQty++;this.callGetItemAvailabilityForStoreApi(this.ui.defaultQty)},uiDecreaseQty:function(){if(this.ui.defaultQty!==1){this.ui.isScreenDirty=true;this.ui.defaultQty--;this.callGetItemAvailabilityForStoreApi(this.ui.defaultQty)}},uiShowItemDesc:function(){this.ui.showItemDesc=true;this.ui.activeTabIndex=0;this.ui.showRelatedItems=false},uiShowRelatedItems:function(){if(iscCore.isVoid(this.model.relatedItemDetails)){this.showRelatedItems()}else{this.ui.showItemDesc=false;this.ui.activeTabIndex=1;this.ui.showRelatedItems=true}},uiHandleAddToCart:function(){this.ui.focusScanField=false;var e=this.getAddToCartInput();if(e!==-1){this.saveItemToCart(e)}},uiHandleUpdateCart:function(){this.ui.focusScanField=false;var e=this.getAddToCartInput();if(e!==-1){this.updateCart(e)}},uiHandlePriceOverride:function(){var e=this;var i={};i.price={};i.price.listPrice=this.model.itemDetails.ComputedPrice.ListPrice;i.price.unitPrice=this.model.itemDetails.ComputedPrice.UnitPrice;i.price.Currency=this.model.getCompleteItemList.ItemList.Currency;var t={modalInput:function(){return i}};h.openModal("store.views.common.priceoverride.priceoverride",t,{}).then(function(e){if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.data)){this.model.itemDetails.ComputedPrice.UnitPrice=e.data.newprice;this.ui.priceOverride.priceOverrideReason=e.data.reason;this.ui.priceOverride.isPriceOverriden=true;this.ui.isScreenDirty=true}}.bind(this),angular.noop)},uiSetDeliveryMethod:function(e){if(e==="SHP"&&iscCore.isBooleanTrue(this.model.itemDetails.PrimaryInformation.IsShippingAllowed)){this.ui.deliveryMethod=e}if(e==="PICK"&&iscCore.isBooleanTrue(this.model.itemDetails.PrimaryInformation.IsPickupAllowed)){this.ui.deliveryMethod=e}if(e==="CARRY"){this.ui.deliveryMethod=e}},uiOpenStoreSearch:function(e){if(this.model.itemDetails.PrimaryInformation.IsPickupAllowed==="Y"){var i=this;i.fromContext=e;var t={modalInput:function(){return{inputData:{callingMode:"ADDITEMS",itemDetails:i.model.itemDetails,RequiredQty:i.ui.defaultQty}}}};h.openModal("store.views.common.storesearch.storesearch",t,{}).then(function(e){i.afterStoreSelection.call(i,e.data,i.fromContext)},angular.noop)}},uiFetchVariantItemDetails:function(e){this.getCompleteItemDetails(e)},uiRenderHtml:function(e){return s.trustAsHtml(e)},handleGetCompleteItemDetails:function(e){var i=u.getMashupOutput(e,"getCompleteItemList");var t=i.ItemList.Item;if(!n.getWizardContext("findProductDone")&&f.isMobile()&&n.getWizardAction()=="NEXT"){n.setWizardContext("findProductDone","true");this.ui.focusScanField=false}else if(n.getWizardContext("findProductDone")&&f.isMobile()&&n.getWizardAction()=="PREVIOUS"){n.setWizardContext("findProductDone",false);this.ui.focusScanField=false}else{this.ui.focusScanField=true}var a=i.ItemList.SearchResult;if(iscCore.isVoid(t)&&iscCore.isVoid(a)){this.ui.noProductsFound=true;this.ui.showItemDetails=false}else if(!iscCore.isVoid(a)){var r=n.getWizardPageInput();var s="";if(!iscCore.isVoid(r)&&!iscCore.isVoid(r.flowName)){s=r.flowName}if(!this.ui.showCheckOutButton){a.searchContext="scanInStore";n.gotoCustomPage("productSearch",a,{removeCurrent:true,wizardPageCssClass:"fullscreen-modal",flowName:s})}else{n.gotoCustomPage("productSearch",a,{removeCurrent:true,flowName:s})}}else{this.ui.showItemDetails=true;this.resetUIAttributes();this.model.itemDetails=this.model.getCompleteItemList.ItemList.Item[0];if(this.model.itemDetails.PrimaryInformation.KitCode==="BUNDLE"||this.model.itemDetails.PrimaryInformation.KitCode==="PK"||this.model.itemDetails.PrimaryInformation.KitCode==="DPK"){h.showErrorMessage(c.translate("globals.MSG_Item_not_supported"));return}if(!iscCore.isVoid(this.model.itemDetails.ClassificationCodes)&&!iscCore.isVoid(this.model.itemDetails.ClassificationCodes.Model)){this.ui.variantItemId=this.model.itemDetails.ItemID}if(!iscCore.isVoid(this.model.itemDetails.Availabilities)){this.handleItemAvailability(this.model.itemDetails.Availabilities)}}},resetUIAttributes:function(){this.ui.noProductsFound=false;this.ui.showItemDesc=true;this.ui.activeTabIndex=0;this.ui.showRelatedItems=false;if(!iscCore.isVoid(this.model.changeVariationInput)){this.ui.defaultQty=this.model.changeVariationInput.OrderLine.OrderLineTranQuantity.OrderedQty}else{this.ui.defaultQty=1}this.ui.priceOverride.isPriceOverriden=false;this.ui.variantItemId="";this.resetAvailabilityUIAttrs();this.ui.selectedShipNode={shipNode:"",shipNodeDesc:""};this.model.relatedItemDetails={}},resetAvailabilityUIAttrs:function(){this.ui.availability={itemShpAvailableDate:"",itemShpAvailableText:"",itemShpAvailable:false,itemShpAvailableToday:false,itemPickAvailable:false,itemPickAvailableText:"",itemPickAvailableDate:"",itemCarryAvailable:false,itemCarryAvailableDate:""}},handleShpAvailabilityInfo:function(e,i){var t="";var a="";if(!iscCore.isVoid(e)){t=e.HasAnyUnavailableQty;a=e.EarliestShipDate}if(t==="N"){if(this.model.itemDetails.PrimaryInformation.IsShippingAllowed==="Y"&&this.ui.deliveryMethod===""){this.ui.deliveryMethod="SHP"}if(i==="Y"){this.ui.availability.itemShpAvailableText=a;this.ui.availability.itemShpAvailableDate=a}else if(i==="N"){this.ui.availability.itemShpAvailableText=e.ProductAvailDate;this.ui.availability.itemShpAvailableDate=e.ProductAvailDate}this.ui.availability.itemShpAvailable=true;var r=e.IsAvailableToday;if(r==="Y"){this.ui.availability.itemShpAvailableToday=true}}else{this.ui.availability.itemShpAvailable=false;this.ui.availability.itemShpAvailableText=""}},handlePickAvailabilityInfo:function(e){var i="";var t="";var a="";var r=false;if(!iscCore.isVoid(e)){i=e.HasAnyUnavailableQty;t=e.IsAvailableToday}if(i==="N"){if(!iscCore.isVoid(e.ShipNode)){if(f.getFromContext("storeName")===e.ShipNode){this.ui.selectedShipNode.shipNode=e.ShipNode;this.ui.selectedShipNode.shipNodeDesc=e.ShipNodeDescription;r=true}}if(this.model.itemDetails.PrimaryInformation.IsPickupAllowed==="Y"&&this.ui.deliveryMethod===""){this.ui.deliveryMethod="PICK"}this.ui.availability.itemPickAvailable=true;this.ui.availability.itemPickAvailableDate=e.ProductAvailDate;if(t==="Y"){if(r){this.ui.availability.itemPickAvailableText=c.translate("globals.LABEL_ItemAvailableTodayAtStore",{date:o("date")(e.ProductAvailDate,"mediumDate"),shipNodeDesc:this.ui.selectedShipNode.shipNodeDesc})}else{this.ui.availability.itemPickAvailableText=c.translate("addItems.LABEL_ItemPickAvailableTodayDiffStore",{date:o("date")(e.ProductAvailDate,"mediumDate"),distance:o("number")(e.Distance,2),distanceUOM:e.DistanceUOMDesc})}}else{if(r){this.ui.availability.itemPickAvailableText=c.translate("addItems.LABEL_ItemPickAvailableNotTodaySameStore",{date:o("date")(e.ProductAvailDate,"fullDate"),shipNodeDesc:this.ui.selectedShipNode.shipNodeDesc})}else{this.ui.availability.itemPickAvailableText=c.translate("addItems.LABEL_ItemPickAvailableNotTodayDiffStore",{date:o("date")(e.ProductAvailDate,"fullDate"),distance:o("number")(e.Distance,2),distanceUOM:e.DistanceUOMDesc})}}}else{this.ui.availability.itemPickAvailable=false;this.ui.availability.itemPickAvailableText="";this.ui.availability.itemPickAvailableDate=""}},handleCarryAvailabilityInfo:function(e){var i="";var t="";if(!iscCore.isVoid(e)){i=e.HasAnyUnavailableQty;t=e.IsAvailableToday}var a=n.getWizardModel("isOrgRoleNode");if(!iscCore.isVoid(a)&&a=="N")i="Y";if(i==="N"){if(this.ui.deliveryMethod===""){if(!iscCore.isVoid(this.model.orderDetails)){if(!iscCore.isVoid(this.model.orderDetails.Order)){if(!iscCore.isVoid(this.model.orderDetails.Order.DraftOrderFlag)){if(this.model.orderDetails.Order.DraftOrderFlag=="Y"){this.ui.deliveryMethod="CARRY"}}}}}if(t==="Y"){this.ui.availability.itemCarryAvailable=true;var r=e.ProductAvailDate;this.ui.availability.itemCarryAvailableDate=c.translate("globals.LABEL_ItemAvailableTodayAtStore",{date:o("date")(e.ProductAvailDate,"mediumDate"),shipNodeDesc:e.ShipNodeDescription})}}else{this.ui.availability.itemCarryAvailable=false;this.ui.availability.itemCarryAvailableDate=""}},handleItemAvailability:function(e){var i=e.IsAvailabilityRealTimeData;this.resetAvailabilityUIAttrs();if(!iscCore.isVoid(this.ui.deliveryMethod)){var t=this.getAvailabilityInfoBasedOnDelMethod(e,this.ui.deliveryMethod);if(!iscCore.isVoid(t)){var a=t.HasAnyUnavailableQty;if(a==="Y"){this.ui.deliveryMethod=""}}}var t=null;if(e.Availability instanceof Array){t=this.getAvailabilityInfoBasedOnDelMethod(e,"CARRY");this.handleCarryAvailabilityInfo(t);t=this.getAvailabilityInfoBasedOnDelMethod(e,"SHP");this.handleShpAvailabilityInfo(t,i);t=this.getAvailabilityInfoBasedOnDelMethod(e,"PICK");this.handlePickAvailabilityInfo(t)}else{t=e.Availability;this.processAvailabilityInfo(t,i)}},getAvailabilityInfoBasedOnDelMethod:function(e,i){var t=null;if(e.Availability instanceof Array){var a=e.Availability;var r=a.length;for(var s=0;s<r;s++){t=a[s];if(t.DeliveryMethod===i||i==="CARRY"&&iscCore.isVoid(t.DeliveryMethod)){return t}}}},processAvailabilityInfo:function(e,i){if(!iscCore.isVoid(e)){var t=e.DeliveryMethod;if(!iscCore.isVoid(t)){if(t==="CARRY"){this.handleCarryAvailabilityInfo(e)}if(t==="SHP"){this.handleShpAvailabilityInfo(e,i)}if(t==="PICK"){this.handlePickAvailabilityInfo(e)}}}},showRelatedItems:function(){var e=this.getCompleteItemDetailsApiInput(this.model.itemDetails.ItemID,false);u.callMashup(this,"getRelatedItems",e,{}).then(function(){this.ui.showItemDesc=false;this.ui.activeTabIndex=1;this.ui.showRelatedItems=true}.bind(this),angular.noop)},afterStoreSelection:function(e,i){this.ui.isScreenDirty=true;this.ui.selectedShipNode.shipNode=e.selectedStore.ShipNode;this.ui.selectedShipNode.shipNodeDesc=e.selectedStore.Description;if(iscCore.isBooleanTrue(e.selectedStore.Availability.IsAvailable)&&iscCore.isBooleanFalse(e.selectedStore.Availability.IsFutureAvailability)){this.ui.availability.itemPickAvailable=true;this.ui.availability.itemPickAvailableDate=e.selectedStore.Availability.AvailableDate;if(f.getFromContext("storeName")===e.selectedStore.ShipNode){this.ui.availability.itemPickAvailableText=c.translate("globals.LABEL_ItemAvailableTodayAtStore",{date:o("date")(e.selectedStore.Availability.AvailableDate,"mediumDate"),shipNodeDesc:this.ui.selectedShipNode.shipNodeDesc})}else{this.ui.availability.itemPickAvailableText=c.translate("addItems.LABEL_ItemPickAvailableTodayDiffStore",{date:o("date")(e.selectedStore.Availability.AvailableDate,"mediumDate"),distance:o("number")(e.selectedStore.DistanceFromShipToAddress,2),distanceUOM:e.selectedStore.DistanceUOMDesc})}}else if(iscCore.isBooleanTrue(e.selectedStore.Availability.IsAvailable)&&iscCore.isBooleanTrue(e.selectedStore.Availability.IsFutureAvailability)){this.ui.availability.itemPickAvailable=true;this.ui.availability.itemPickAvailableDate=e.selectedStore.Availability.AvailableDate;this.ui.availability.itemPickAvailableText=c.translate("addItems.LABEL_ItemPickAvailableNotTodaySameStore",{date:o("date")(e.selectedStore.Availability.AvailableDate,"fullDate"),shipNodeDesc:this.ui.selectedShipNode.shipNodeDesc})}else if(iscCore.isBooleanFalse(e.selectedStore.Availability.IsAvailable)&&iscCore.isBooleanFalse(e.selectedStore.Availability.IsFutureAvailability)){this.ui.availability.itemPickAvailable=false}this.uiSetDeliveryMethod("PICK");if(i!==null&&i!==undefined&&i==="addToCart"){this.uiHandleAddToCart()}else if(i==="changeVariation"){this.uiHandleUpdateCart()}},getAddToCartInput:function(){var e={};e.Order={};var i=n.getWizardPageInput();var t=i.input;var a=i.searchContext;if(!iscCore.isVoid(this.model.orderDetails)){e.Order.OrderHeaderKey=this.model.orderDetails.Order.OrderHeaderKey}else{e.Order.EntryType=f.getFromContext("storeEntryType");e.Order.DocumentType=f.getFromContext("salesOrderDocType");if(!iscCore.isVoid(n.getWizardModel("customerModel"))){var r=n.getWizardModel("customerModel");var s=r;e.Order.BillToID=r.Customer.CustomerID;if(!iscCore.isVoid(r.Customer.DisplayCustomerAddress)){e.Order.PersonInfoShipTo={};e.Order.PersonInfoShipTo=angular.copy(r.Customer.DisplayCustomerAddress);e.Order.PersonInfoBillTo={};e.Order.PersonInfoBillTo=angular.copy(r.Customer.DisplayCustomerAddress)}if(s.Customer.CustomerType==="02"||s.Customer.CustomerContactList&&s.Customer.CustomerContactList.CustomerContact&&s.Customer.CustomerContactList.CustomerContact.length===1){e.Order.CustomerContactID=s.Customer.CustomerContactList.CustomerContact[0].CustomerContactID;e.Order.CustomerFirstName=s.Customer.CustomerContactList.CustomerContact[0].FirstName;e.Order.CustomerLastName=s.Customer.CustomerContactList.CustomerContact[0].LastName;e.Order.CustomerEMailID=s.Customer.CustomerContactList.CustomerContact[0].EmailID;if(!iscCore.isVoid(r.addressSelected)){e.Order.CustomerZipCode=r.addressSelected.PersonInfo.ZipCode}}}}e.Order.OrderLines={};e.Order.OrderLines.OrderLine=[{Item:{ItemID:this.model.itemDetails.ItemID,UnitOfMeasure:this.model.itemDetails.UnitOfMeasure,ProductClass:this.model.itemDetails.PrimaryInformation.DefaultProductClass},OrderLineTranQuantity:{OrderedQty:this.ui.defaultQty}}];if(this.ui.deliveryMethod!=""){if(this.ui.deliveryMethod==="CARRY"){e.Order.OrderLines.OrderLine[0].DeliveryMethod=this.ui.deliveryMethod}else if(this.ui.deliveryMethod==="PICK"){if(this.ui.showUpdateCart===true&&this.ui.variantItemSelected===false&&(!iscCore.isVoid(i.searchContext)&&i.searchContext==="changeVariation")){this.ui.selectedShipNode.shipNode=this.model.changeVariationInput.OrderLine.Shipnode.ShipNode}if(this.ui.selectedShipNode.shipNode===""){if(!iscCore.isVoid(i.searchContext)&&i.searchContext==="changeVariation"){this.uiOpenStoreSearch("changeVariation")}else{this.uiOpenStoreSearch("addToCart")}return-1}else{e.Order.OrderLines.OrderLine[0].ShipNode=this.ui.selectedShipNode.shipNode;e.Order.OrderLines.OrderLine[0].DeliveryMethod=this.ui.deliveryMethod;e.Order.OrderLines.OrderLine[0].ReqShipDate=this.ui.availability.itemPickAvailableDate}}else if(this.ui.deliveryMethod==="SHP"){e.Order.OrderLines.OrderLine[0].DeliveryMethod=this.ui.deliveryMethod;var o=this.model.getCompleteItemList.ItemList.Item[0].Availabilities.IsAvailabilityRealTimeData;if(o==="Y"){e.Order.OrderLines.OrderLine[0].EarliestShipDate=this.ui.availability.itemShpAvailableDate;e.Order.OrderLines.OrderLine[0].ReqShipDate=this.ui.availability.itemShpAvailableDate}}}if(this.ui.showUpdateCart===true){e.Order.PendingChanges={RecordPendingChanges:"Y"};var l="";var d={};if(this.ui.variantItemSelected===true&&(!iscCore.isVoid(i.searchContext)&&i.searchContext==="changeVariation")){l=c.translate("addItems.MSG_VariationChanged",{itemId:i.input.OrderLine.ItemDetails.ItemID});d=v.addNote(l,"YCD_CHANGE_VARIATION");e.Order.OrderLines.OrderLine[1]={OrderLineKey:i.input.OrderLine.OrderLineKey,Action:"CANCEL"};e.Order.Notes=[];e.Order.Notes.push(d)}else if(this.ui.showUpdateCart===true&&!iscCore.isVoid(i.input.OrderLine)){e.Order.OrderLines.OrderLine[0].OrderLineKey=i.input.OrderLine.OrderLineKey}else{e.Order.Notes=[];l=c.translate("addItems.MSG_NewLineNoteText",{itemId:i.input});d=v.addNote(l,"YCD_MULTI_ADD_LINES_INFO");e.Order.Notes.push(d)}}return e},setPriceOverrideInAddToCartInput:function(e){e.Order.OrderLines.OrderLine[0].LinePriceInfo={ListPrice:this.model.itemDetails.ComputedPrice.ListPrice,UnitPrice:this.model.itemDetails.ComputedPrice.UnitPrice,IsPriceLocked:"Y"};this.addPriceOverrideDefaultNote(e)},addPriceOverrideDefaultNote:function(e){var i=c.translate("addItems.MSG_PriceOverrideReason",{overrideReason:this.ui.priceOverride.priceOverrideReason});e.Order.OrderLines.OrderLine[0].Notes=[{Note:{NoteText:i,ReasonCode:"YCD_NEW_ITEM_INFO"}}]},updateCart:function(e){var i="changeOrderPendingChanges";if(!iscCore.isVoid(e)&&e.Order.OrderLines.OrderLine[0].DeliveryMethod==="SHP"&&iscCore.isVoid(e.Order.OrderLines.OrderLine[0].EarliestShipDate)){var t=this.getItemAvailabilityForStoreApiInput(this.ui.defaultQty);t.Promise.addToCartInput=e;t.Promise.mashupToCall=i;u.callMashup(this,"getRealTimeItemAvailabilityForStore",t,{}).then(function(e){var i=e.MashupRefs.MashupRef[0].Output;n.setWizardModel("orderModel",i);this.ui.focusScanField=false;n.gotoCustomPage("editOrderDetails",{},{removeCurrent:true})}.bind(this),angular.noop)}else{u.callMashup(this,i,e,{}).then(function(e){var i=e.MashupRefs.MashupRef[0].Output;n.setWizardModel("orderModel",i);this.model.orderDetails=i;this.ui.focusScanField=false;n.gotoCustomPage("editOrderDetails",{},{removeCurrent:true})}.bind(this),angular.noop)}},saveItemToCart:function(e){var i="createOrder";if(e&&!iscCore.isVoid(e.Order)){if(this.ui.priceOverride.isPriceOverriden){this.setPriceOverrideInAddToCartInput(e);if(!iscCore.isVoid(e.Order.OrderHeaderKey)){i="modifyFulfillmentOptionsWithOvp"}else{i="createOrderWithOvp"}}else{if(!iscCore.isVoid(e.Order.OrderHeaderKey)){i="modifyFulfillmentOptions"}else{i="createOrder"}}}if((i==="modifyFulfillmentOptions"||i==="createOrder")&&e.Order.OrderLines.OrderLine[0].DeliveryMethod==="SHP"&&iscCore.isVoid(e.Order.OrderLines.OrderLine[0].EarliestShipDate)){var t=this.getItemAvailabilityForStoreApiInput(this.ui.defaultQty);t.Promise.addToCartInput=e;t.Promise.mashupToCall=i;u.callMashup(this,"getRealTimeItemAvailabilityForStore",t,{}).then(function(e){var i=e.MashupRefs.MashupRef[0].Output;n.setWizardModel("orderModel",i);this.ui.orderTotalQty=i.Order.OrderLines.TotalNumberOfRecords;this.model.orderDetails=i;this.ui.focusScanField=false;this.resetOrderRelatedAttrs();if(!this.ui.showCheckOutButton){n.gotoPreviousPage()}else{var t=c.translate("additems.aria_cartAdditionSuccessMessage",{quantity:this.ui.orderTotalQty});h.showA11YAlertMessage(t)}}.bind(this),angular.noop)}else{u.callMashup(this,i,e,{}).then(function(e){var i=e.MashupRefs.MashupRef[0].Output;n.setWizardModel("orderModel",i);this.ui.orderTotalQty=i.Order.OrderLines.TotalNumberOfRecords;this.model.orderDetails=i;this.ui.focusScanField=false;this.resetOrderRelatedAttrs();if(!this.ui.showCheckOutButton){n.gotoPreviousPage()}else{var t=c.translate("additems.aria_cartAdditionSuccessMessage",{quantity:this.ui.orderTotalQty});h.showA11YAlertMessage(t)}}.bind(this),angular.noop)}},resetOrderRelatedAttrs:function(){this.ui.isScreenDirty=false},getCompleteItemDetailsApiInput:function(e,i){var t={Item:{ItemID:e,RequiredQty:this.ui.defaultQty}};var a=n.getWizardModel("orderModel");if(!iscCore.isVoid(a)){var r=iscCore.getValueFromJsonPath(a,"Order.BillToID");if(!iscCore.isVoid(r)){t.Item.CustomerInformation={CustomerID:r}}}if(i){t.Item.BarCode={};t.Item.BarCode.BarCodeData=e}return t},getCompleteItemDetails:function(e){if(iscCore.isVoid(e)){if(!this.ui.openBlankPage)h.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}else{var i=this.getCompleteItemDetailsApiInput(e,true);i.Item.DefaultPageSize=f.getFromContext("defaultPageSize");u.callMashup(this,"getCompleteItemList",i,{}).then(this.handleGetCompleteItemDetails.bind(this),angular.noop)}},callGetItemAvailabilityForStoreApi:function(e){var i=this.getItemAvailabilityForStoreApiInput(e);u.callMashup(this,"getItemAvailabilityForStore",i,{}).then(function(e){var i=u.getMashupOutput(e,"getItemAvailabilityForStore");var t=i.Promise.PromiseLines.PromiseLine[0];if(!iscCore.isVoid(t.Availabilities)){this.handleItemAvailability(t.Availabilities)}}.bind(this),angular.noop)},getItemAvailabilityForStoreApiInput:function(e){var i=f.getFromContext("storeAddress").ShipNodePersonInfo;var t={Promise:{ShipToAddress:i,PromiseLines:[{PromiseLine:{ItemID:this.model.itemDetails.ItemID,UnitOfMeasure:this.model.itemDetails.UnitOfMeasure,ProductClass:this.model.itemDetails.PrimaryInformation.DefaultProductClass,RequiredQty:e}}]}};var a=n.getWizardModel("orderModel");if(!iscCore.isVoid(a)&&!iscCore.isVoid(a.Order.OrderHeaderKey)){t.Promise.OrderHeaderKey=a.Order.OrderHeaderKey}return t},handleWizardBack:function(){var e=n.isFirstPage();if(!iscCore.isVoid(this.model.customerDetails)&&!iscCore.isVoid(this.model.customerDetails.Customer.CustomerKey)){e=false}if(this.ui.isScreenDirty){if(e){this.uiCancel()}else{h.showConfirmationMessage(c.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){n.gotoPreviousPage(true)}})}return true}else if(e){this.uiCancel();return true}else{return false}},handleWizardExit:function(){var e=c.translate("order.WarningMessage_Cancel");if(this.ui.orderTotalQty<1){e=c.translate("addItems.WarningMessage_Cancel")}h.showConfirmationMessage(e).then(function(e){if(e==="YES"){n.exitWizard()}},function(e){});return true},uiShareProductDetails:function(){var e=this;var i="";var t=iscCore.getValueFromJsonPath(this.model.orderDetails,"Order.BillToID");if(!iscCore.isVoid(t)){i=t}else if(!iscCore.isVoid(n.getWizardModel("customerModel"))){var a=n.getWizardModel("customerModel");i=a.Customer.CustomerID}var r={modalInput:function(){return{ItemDetails:{ItemID:e.model.itemDetails.ItemID,UnitOfMeasure:e.model.itemDetails.UnitOfMeasure,ItemKey:e.model.itemDetails.ItemKey},CustomerDetails:{CustomerID:i}}}};h.openModal("store.views.common.product.product-details-share",r,{}).then(angular.noop,angular.noop)}})}]);
angular.module("store").controller("store.views.order.appeasement.customer-appeasement",["$scope","$rootScope","$filter","iscScreen","iscMashup","iscResourcePermission","iscState","iscStateParams","iscPrint","iscModal","iscOrder","iscPayment","iscPaymentinput","$timeout","iscI18n","iscAppContext",function(r,e,c,t,p,a,s,o,n,i,d,u,l,m,O,f){t.initializeScreen(r,{model:{orderAppeaseReasons:{},productAppeaseReasons:{},orderAppeaseOptions:{},productAppeaseOptions:{},orderLineList:{},orderModel:{},noteList:{},productAppeaseOptionsUnchanged:{},orderAppeaseOptionsUnchanged:{}},mashupRefs:[{mashupRefId:"customerAppeasement_getReasonCodes",mashupId:"customerAppeasement_getReasonCodes",modelName:"orderAppeaseReasons"},{mashupRefId:"customerAppeasement_getProductReasonCodes",mashupId:"customerAppeasement_getProductReasonCodes",modelName:"productAppeaseReasons"},{mashupRefId:"getAppeasementOffersForStoreUE",mashupId:"store.views.order.appeasement.customer-appeasement.getAppeasementOffersForStoreUE",modelName:"orderAppeaseOptions"},{mashupRefId:"provideAppeasementInStoreUE",mashupId:"store.views.order.appeasement.customer-appeasement.provideAppeasementInStoreUE",modelName:"provideAppeasementInStoreUE"},{mashupRefId:"sendFutureOrderCustomerAppeasementUE",mashupId:"store.views.order.appeasement.customer-appeasement.sendFutureOrderCustomerAppeasementUE",modelName:"sendFutureOrderCustomerAppeasementUE"},{mashupRefId:"provideAppeasementAsCouponUE",mashupId:"store.views.order.appeasement.customer-appeasement.provideAppeasementAsCouponUE",modelName:"provideAppeasementAsCouponUE"},{mashupRefId:"provideAppeasementAsGiftCardUE",mashupId:"store.views.order.appeasement.customer-appeasement.provideAppeasementAsGiftCardUE",modelName:"provideAppeasementAsGiftCardUE"},{mashupRefId:"getNoteList",mashupId:"store.views.order.appeasement.customer-appeasement.getNoteList",modelName:"noteList"},{mashupRefId:"changeOrder",mashupId:"store.views.order.appeasement.customer-appeasement.changeOrder"},{mashupRefId:"getCompleteOrderLineList",mashupId:"store.views.order.appeasement.customer-appeasement.getCompleteOrderLineList",modelName:"orderLineList"}],ui:{mainDisplaySelection:"ORDER",oLineShownCount:4,Currency:"",UnitPrice:"",showBackLink:"Y",activeTabIndex:0,selectedProductOrderLines:[],selectedOrderReason:"",selectedOrderReasonDesc:"",selectedProductReason:"",selectedProductReasonDesc:"",selectedOrderOption:"",selectedOrderOptionDesc:"",selectedProductOption:"",selectedProductOptionDesc:"",offerAmount:0},uiClose:function(){var e=O.translate("editorderdetails.MSG_CloseWithNoPendingChanges");i.showConfirmationMessage(e).then(function(e){if(e==="YES"){s.goToPreviousState()}},function(e){})},uiShowHome:function(){s.goToState("/home",{},{})},uiOLineScrollActionValidator:function(){return true},initialize:function(){this.model.orderModel=o.params.orderInput;this.ui.Currency=this.model.orderModel.Order.PriceInfo.Currency;if(o.params.showBackLink){this.ui.showBackLink="Y"}var e={};e.InvokeUE={DocumentType:this.model.orderModel.Order.DocumentType};e.InvokeUE.XMLData={};e.InvokeUE.XMLData.AppeasementOffers={AppeasementLevel:"ORDER",Order:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey,OrderNo:this.model.orderModel.Order.OrderNo,DocumentType:this.model.orderModel.Order.DocumentType}};var r={};r.Note={};r.Note.TableKey=this.model.orderModel.Order.OrderHeaderKey;var t=[];t.push(p.getMashupRefObj(this,"customerAppeasement_getReasonCodes",{}));t.push(p.getMashupRefObj(this,"customerAppeasement_getProductReasonCodes",{}));t.push(p.getMashupRefObj(this,"getAppeasementOffersForStoreUE",e));t.push(p.getMashupRefObj(this,"getNoteList",r));p.callMashups(this,t,{}).then(this.handleInitAPICalls.bind(this),angular.noop)},handleInitAPICalls:function(e){this.handleGetAppeasementOffersForStoreUE(e);if(this.model.orderAppeaseReasons&&this.model.productAppeaseReasons){if(this.model.orderAppeaseReasons.CommonCodeList.CommonCode){this.ui.selectedOrderReason=this.model.orderAppeaseReasons.CommonCodeList.CommonCode[0];this.ui.selectedOrderReasonDesc=this.model.orderAppeaseReasons.CommonCodeList.CommonCode[0].CodeShortDescription}if(this.model.productAppeaseReasons.CommonCodeList.CommonCode){this.ui.selectedProductReason=this.model.productAppeaseReasons.CommonCodeList.CommonCode[0];this.ui.selectedProductReasonDesc=this.model.productAppeaseReasons.CommonCodeList.CommonCode[0].CodeShortDescription}}},handleGetAppeasementOffersForStoreUE:function(e){var r=this.model.orderModel.Order.PriceInfo.Currency;if(iscCore.isVoid(p.getMashupOutput(e,"getAppeasementOffersForStoreUE").InvokeUE.XMLData)){console.log("ERROR: getAppeasementOffersForStoreUE.InvokeUE.XMLData is empty");return}var t=p.getMashupOutput(e,"getAppeasementOffersForStoreUE").InvokeUE.XMLData;var s=angular.copy(t);this.uiTrimAppeasementOffersBasedOnPermission(s);var o=s.AppeasementOffers.AppeasementOffer;var n="";var a=0;for(var i=0;i<o.length;i++){n=o[i].OfferType;if(o[i].Preferred==="Y"){a=i}var d;if(n.includes("COUPON")){o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Coupon")}else if(n.includes("GIFT_CARD")){o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Gift_Card")}else if(n.includes("PERCENT_ORDER")){d=o[i].DiscountPercent;o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Percent_Current",{percent:d});o[i].FormattedOfferAmount=c("iscCurrency")(angular.copy(o[i].OfferAmount),r);o[i].isPercent=true}else if(n.includes("PERCENT_FUTURE_ORDER")){d=o[i].DiscountPercent;o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Percent_Future",{percent:d});o[i].FormattedOfferAmount=c("iscCurrency")(angular.copy(o[i].OfferAmount),r);o[i].isPercent=true}else if(n.includes("FLAT_AMOUNT_ORDER")){o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Amount_Current")}else if(n.includes("FLAT_AMOUNT_FUTURE_ORDER")){o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Amount_Future")}if(n.includes("PERCENT")){o[i].isPercent=true}if(n.includes("FUTURE")){o[i].isFuture=true}if(n.includes("FLAT")){o[i].isAmount=true}}this.model.orderAppeaseOptions=angular.copy(s);this.model.productAppeaseOptions=angular.copy(s);this.model.orderAppeaseOptionsUnchanged=angular.copy(s);this.ui.selectedOrderOption=this.model.orderAppeaseOptions.AppeasementOffers.AppeasementOffer[a];this.ui.selectedOrderOptionDesc=this.model.orderAppeaseOptions.AppeasementOffers.AppeasementOffer[a].OfferTypeDesc;this.ui.selectedProductOption=this.model.productAppeaseOptions.AppeasementOffers.AppeasementOffer[a];this.ui.selectedProductOptionDesc=this.model.productAppeaseOptions.AppeasementOffers.AppeasementOffer[a].OfferTypeDesc},uiPostNote:function(e){var r={};r.Order={};r.Order.OrderHeaderKey=this.model.orderModel.Order.OrderHeaderKey;var t="";if(this.ui.mainDisplaySelection==="ORDER"){t=this.ui.selectedOrderReason.CodeValue}else if(this.ui.mainDisplaySelection==="PRODUCT"){t=this.ui.selectedProductReason.CodeValue}r.Order.ModificationReasonCode=t;r.Order.Notes=e;var s=[];s.push(p.getMashupRefObj(this,"changeOrder",r));s.push(p.getMashupRefObj(this,"getNoteList",{Note:{TableKey:this.model.orderModel.Order.OrderHeaderKey}}));p.callMashups(this,s,{}).then(this.handlechangeOrder.bind(this),this.changeOrderAPIErrorCallBack.bind(this))},handlechangeOrder:function(e){r.$broadcast("clearNoteFields")},changeOrderAPIErrorCallBack:function(e){var r=e.Errors.Error[0].ErrorDescription;var t=e.Errors.Error[0].ErrorCode;if(O.hasKey("apierror."+t)){r=O.translate("apierror."+t);i.showErrorMessage(r,null,null)}else{i.showErrorMessage(r,null,null)}},uiDisplayOrder:function(){this.ui.mainDisplaySelection="ORDER";if(!iscCore.isVoid(this.model.orderAppeaseOptionsUnchanged)){this.model.orderAppeaseOptions=angular.copy(this.model.orderAppeaseOptionsUnchanged)}},uiDisplayProduct:function(){this.ui.mainDisplaySelection="PRODUCT";var e={};e.InvokeUE={DocumentType:this.model.orderModel.Order.DocumentType};e.InvokeUE.XMLData={};e.InvokeUE.XMLData.AppeasementOffers={AppeasementLevel:"PRODUCT",Order:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey,OrderNo:this.model.orderModel.Order.OrderNo,DocumentType:this.model.orderModel.Order.DocumentType}};var r={};r.OrderLine={};r.OrderLine.OrderHeaderKey=this.model.orderModel.Order.OrderHeaderKey;var t=[];t.push(p.getMashupRefObj(this,"getAppeasementOffersForStoreUE",e));t.push(p.getMashupRefObj(this,"getCompleteOrderLineList",r));if(iscCore.isVoid(this.model.productAppeaseOptionsUnchanged)){p.callMashups(this,t,{}).then(this.handleApiCallsForProductsTab.bind(this),angular.noop)}else{this.model.productAppeaseOptions=angular.copy(this.model.productAppeaseOptionsUnchanged)}},handleApiCallsForProductsTab:function(e){var r=p.getMashupOutput(e,"getAppeasementOffersForStoreUE").InvokeUE.XMLData;var t=this.model.orderModel.Order.PriceInfo.Currency;var s=angular.copy(r);var o=s.AppeasementOffers.AppeasementOffer;this.uiTrimAppeasementOffersBasedOnPermission(s);var n="";var a=0;for(var i=0;i<o.length;i++){n=o[i].OfferType;if(o[i].Preferred==="Y"){a=i}var d;if(n.includes("COUPON")){o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Coupon")}else if(n.includes("GIFT_CARD")){o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Gift_Card")}else if(n.includes("PERCENT_ORDER")){d=o[i].DiscountPercent;o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Percent_Product_Current",{percent:d});o[i].isPercent=true}else if(n.includes("PERCENT_FUTURE_ORDER")){d=o[i].DiscountPercent;o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Percent_Future",{percent:d});o[i].FormattedOfferAmount=c("iscCurrency")(angular.copy(o[i].OfferAmount),t);o[i].isPercent=true}else if(n.includes("FLAT_AMOUNT_ORDER")){o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Amount_Current_Product")}else if(n.includes("FLAT_AMOUNT_FUTURE_ORDER")){o[i].OfferTypeDesc=O.translate("customerappeasement.LABEL_Amount_Future")}if(n.includes("PERCENT")){o[i].isPercent=true}if(n.includes("FUTURE")){o[i].isFuture=true}if(n.includes("FLAT")){o[i].isAmount=true}}this.model.productAppeaseOptionsUnchanged=angular.copy(s);this.model.productAppeaseOptions=angular.copy(s);this.ui.selectedProductOption=this.model.productAppeaseOptions.AppeasementOffers.AppeasementOffer[a];this.ui.selectedProductOptionDesc=this.model.productAppeaseOptions.AppeasementOffers.AppeasementOffer[a].OfferTypeDesc},uiSubmit:function(){var e;var r;var t="";if(this.ui.mainDisplaySelection==="ORDER"){e=this.ui.selectedOrderOption;r=this.ui.selectedOrderReason}else if(this.ui.mainDisplaySelection==="PRODUCT"){if(this.ui.selectedProductOrderLines.length===0){i.showErrorMessage("customerappeasement.WarningMessage_SelectOrderLines",null,null);return}e=this.ui.selectedProductOption;r=this.ui.selectedProductReason}t=e.OfferType;var s={};s.InvokeUE={DocumentType:this.model.orderModel.Order.DocumentType};s.InvokeUE.XMLData={};if(t.includes("COUPON")){s.InvokeUE.XMLData.AppeasementOffers={Order:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey,OrderNo:this.model.orderModel.Order.OrderNo,DocumentType:this.model.orderModel.Order.DocumentType}};p.callMashup(this,"provideAppeasementAsCouponUE",s,{}).then(this.handleSaveAPICalls.bind(this),angular.noop)}else if(t.includes("GIFT_CARD")){s.InvokeUE.XMLData.AppeasementOffers={Order:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey,OrderNo:this.model.orderModel.Order.OrderNo,DocumentType:this.model.orderModel.Order.DocumentType}};p.callMashup(this,"provideAppeasementAsGiftCardUE",s,{}).then(this.handleSaveAPICalls.bind(this),angular.noop)}else if(t.includes("FUTURE")){this.callSendFutureUE(r,e,s)}else{s.InvokeUE.XMLData.AppeasementOffers={Order:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey,OrderNo:this.model.orderModel.Order.OrderNo,DocumentType:this.model.orderModel.Order.DocumentType}};this.callProvideAppeasementUE(r,e,s)}},callSendFutureUE:function(e,r,t){t.InvokeUE.XMLData={Order:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey,OrderNo:this.model.orderModel.Order.OrderNo,DocumentType:this.model.orderModel.Order.DocumentType}};if(!iscCore.isVoid(this.model.orderModel.Order.PersonInfoBillTo)){t.InvokeUE.XMLData.Order.PersonInfoBillTo={};t.InvokeUE.XMLData.Order.PersonInfoBillTo=this.model.orderModel.Order.PersonInfoBillTo}if(this.ui.mainDisplaySelection==="ORDER"){t.InvokeUE.XMLData.Order.AppeasementOffer={OfferType:r.OfferType,OfferAmount:r.OfferAmount,DiscountPercent:r.DiscountPercent,Preferred:r.Preferred}}else{t.InvokeUE.XMLData.Order.AppeasementOffer={OfferType:r.OfferType,OfferAmount:r.OfferAmount,DiscountPercent:r.DiscountPercent,Preferred:r.Preferred}}p.callMashup(this,"sendFutureOrderCustomerAppeasementUE",t,{}).then(this.handleSaveAPICalls.bind(this),angular.noop)},callProvideAppeasementUE:function(e,r,t){if(!iscCore.isVoid(this.model.orderModel.Order.PriceInfo)){t.InvokeUE.XMLData.AppeasementOffers.Order.PriceInfo={};t.InvokeUE.XMLData.AppeasementOffers.Order.PriceInfo=this.model.orderModel.Order.PriceInfo}if(!iscCore.isVoid(this.model.orderModel.Order.OverallTotals)){t.InvokeUE.XMLData.AppeasementOffers.Order.OverallTotals={GrandCharges:this.model.orderModel.Order.OverallTotals.GrandCharges,GrandDiscount:this.model.orderModel.Order.OverallTotals.GrandDiscount,GrandTax:this.model.orderModel.Order.OverallTotals.GrandTax,GrandTotal:this.model.orderModel.Order.OverallTotals.GrandTotal,HdrCharges:this.model.orderModel.Order.OverallTotals.HdrCharges,HdrDiscount:this.model.orderModel.Order.OverallTotals.HdrDiscount,HdrTax:this.model.orderModel.Order.OverallTotals.HdrTax,HdrTotal:this.model.orderModel.Order.OverallTotals.HdrTotal,LineSubTotal:this.model.orderModel.Order.OverallTotals.LineSubTotal}}if(this.ui.mainDisplaySelection==="ORDER"){t.InvokeUE.XMLData.AppeasementOffers.Order.Appeasement={AppeasementLevel:"ORDER",ReasonCode:e.CodeValue,OfferAmount:r.OfferAmount}}else{t.InvokeUE.XMLData.AppeasementOffers.Order.Appeasement={AppeasementLevel:"ORDERLINE",ReasonCode:e.CodeValue,OfferAmount:r.OfferAmount};t.InvokeUE.XMLData.AppeasementOffers.Order.OrderLines={};t.InvokeUE.XMLData.AppeasementOffers.Order.OrderLines.OrderLine=[];for(var s=0;s<this.ui.selectedProductOrderLines.length;s++){t.InvokeUE.XMLData.AppeasementOffers.Order.OrderLines.OrderLine[s]={OrderLineKey:this.ui.selectedProductOrderLines[s].OrderLineKey,OrderedQty:this.ui.selectedProductOrderLines[s].OrderedQty};t.InvokeUE.XMLData.AppeasementOffers.Order.OrderLines.OrderLine[s].LinePriceInfo={};t.InvokeUE.XMLData.AppeasementOffers.Order.OrderLines.OrderLine[s].LinePriceInfo=this.ui.selectedProductOrderLines[s].LinePriceInfo;t.InvokeUE.XMLData.AppeasementOffers.Order.OrderLines.OrderLine[s].LineOverallTotals=this.ui.selectedProductOrderLines[s].LineOverallTotals}}if(r.isPercent){t.InvokeUE.XMLData.AppeasementOffers.Order.Appeasement.DiscountPercent=r.DiscountPercent}p.callMashup(this,"provideAppeasementInStoreUE",t,{}).then(this.handleSaveAPICalls.bind(this),angular.noop)},uiOrderLineSelection:function(e){if(e.checked){this.ui.selectedProductOrderLines.push(e)}else{var r=this.ui.selectedProductOrderLines.indexOf(e);if(r>-1){this.ui.selectedProductOrderLines.splice(r,1)}}},uiToggleOrderChannelSelection:function(e){if(e.checked){this.ui.selectedProductOrderLines.push(e)}else{var r=this.ui.selectedProductOrderLines.indexOf(e);if(r>-1){this.ui.selectedProductOrderLines.splice(r,1)}}this.computeSelectedOrderLineTotal(e)},computeSelectedOrderLineTotal:function(e){var r=this.model.orderModel.Order.PriceInfo.Currency;var t=e.LineOverallTotals.LineTotal;var s=this.model.productAppeaseOptions.AppeasementOffers;if(s){var o=s.AppeasementOffer;for(var n=0;n<o.length;n++){var a=o[n];var i=a.OfferType;if(i==="PERCENT_ORDER"){if(e.checked){var d=t*a.DiscountPercent/100;this.ui.offerAmount=this.ui.offerAmount+d;var p=parseFloat(this.ui.offerAmount).toFixed(2);a.OfferAmount=p;a.FormattedOfferAmount=c("iscCurrency")(angular.copy(p),r);break}else{if(this.ui.offerAmount>0){var u=t*a.DiscountPercent/100;this.ui.offerAmount=this.ui.offerAmount-u;var l=parseFloat(this.ui.offerAmount).toFixed(2);a.OfferAmount=l;a.FormattedOfferAmount=c("iscCurrency")(angular.copy(l),r);break}}}}}},handleSaveAPICalls:function(e){var r={options:{headerText:"globals.LABEL_Success",action:[{actionName:"OK",actionLabel:"payment.ACTION_ViewOrderSummary"}]}};var t=O.translate("customerappeasement.MESSAGE_AppeasementSuccess");i.showSuccessMessage(t,r).then(function(e){s.goToPreviousState()},function(e){s.goToPreviousState()})},uiGetOrderLineListNext:function(){if(this.ui.oLineShownCount<=this.model.orderLineList.OrderLineList.OrderLine.length){this.ui.oLineShownCount+=4}},uiOLineScrollActionValidator:function(){return true},uiOnEnterInputField:function(e){},uiOnAmountFieldChange:function(){this.ui.selectedOrderOption.OfferAmount=angular.copy(this.ui.selectedOrderOption.FormattedOfferAmount);this.ui.selectedOrderOption.FormattedOfferAmount=c("iscCurrency")(angular.copy(this.ui.selectedOrderOption.FormattedOfferAmount),this.ui.Currency)},uiOnProductAmountFieldChange:function(){this.ui.selectedProductOption.OfferAmount=angular.copy(this.ui.selectedProductOption.FormattedOfferAmount);this.ui.selectedProductOption.FormattedOfferAmount=c("iscCurrency")(angular.copy(this.ui.selectedProductOption.FormattedOfferAmount),this.ui.Currency)},uiTrimAppeasementOffersBasedOnPermission:function(e){var r=e.AppeasementOffers;var t=r.AppeasementOffer;if(t){for(var s=0;s<t.length;s++){var o=t[s];var n=o.OfferType;if(n.includes("FLAT_AMOUNT_ORDER")||n.includes("FLAT_AMOUNT_FUTURE_ORDER")){if(!a.hasPermission("WSC000080")){t.splice(s)}}}}},uiIsOrderLineCancelled:function(e){var r=false;var t=e.OrderLineTranQuantity;if(t){var s=t.OrderedQty;if(s==0){r=true}}return r}})}]);
angular.module("store").controller("store.views.order.cancel.cancelorder",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscModal","iscAppContext","iscI18n",function(e,r,n,o,a,s,c,i,l,t){o.initializeModalScreen(e,{model:{cancelOrderReasonList:{}},mashupRefs:[{mashupRefId:"getCancelOrderReasonList",mashupId:"cancelorder_getCancelOrderReasonList",modelName:"cancelOrderReasonList"},{mashupRefId:"cancelOrder",mashupId:"cancelOrder"}],ui:{cancelOrderReason:""},initialize:function(){var e={};e.CommonCode={};e.CommonCode.DocumentType=a.documentType;s.callMashup(this,"getCancelOrderReasonList",e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(){if(iscCore.isVoid(this.ui.cancelOrderReason)){this.ui.cancelOrderReason=this.model.cancelOrderReasonList.CommonCodeList.CommonCode[0]}},uiClose:function(){n.dismiss("cancel")},uiSubmit:function(){if(this.ui.cancelOrderReason.CodeValue){var e={};e.Order={};e.Order.Notes={};e.Order.Notes.Note={};e.Order.Action="CANCEL";e.Order.ModificationReasonCode=this.ui.cancelOrderReason.CodeValue;e.Order.OrderHeaderKey=a.Order.OrderHeaderKey;var r=this.getCancellationDescription(this.ui.cancelOrderReason.CodeValue);var o=t.translate("ordersummary.OrderCancellationNote",{cancelReason:r,user:l.getFromContext("currentLoginID")});e.Order.Notes.Note.NoteText=o;s.callMashup(this,"cancelOrder",e,{}).then(this.cancelOrderAPICallBack.bind(this),this.cancelOrderAPIErrorCallBack.bind(this),angular.noop)}else{errorMsg=t.translate("ordersummary.OrderCancellationReasonNotFound");i.showErrorMessage(errorMsg,null,null);n.dismiss("No cancellation reason")}},getCancellationDescription:function(r){var o="";angular.forEach(this.model.cancelOrderReasonList.CommonCodeList.CommonCode,function(e){if(e.CodeValue==r){o=e.CodeShortDescription}});return o},cancelOrderAPICallBack:function(e){var r=s.getMashupOutput(e,"cancelOrder");var o={};o.cancelOrderAPIOutput={};if(r){o.cancelOrderAPIOutput.cancelledOrderNumber=r.Order.OrderNo;o.cancelOrderAPIOutput.cancelOrderAPISuccess=true;o.cancelOrderAPIOutput.order=r}n.close(o)},cancelOrderAPIErrorCallBack:function(e){var r=e.Errors.Error[0].ErrorDescription;var o=e.Errors.Error[0].ErrorCode;if(t.hasKey("apierror."+o)){r=t.translate("apierror."+o);i.showErrorMessage(r,null,null)}else{i.showErrorMessage(r,null,null)}n.dismiss(e)}})}]);
angular.module("store").controller("store.views.order.cancel.cancelorderline",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscModal","iscAppContext","iscI18n",function(e,r,i,n,o,a,s,c,t,l){n.initializeModalScreen(e,{model:{cancelOrderReasonList:{}},mashupRefs:[{mashupRefId:"getCancelOrderReasonList",mashupId:"cancelorder_getCancelOrderReasonList",modelName:"cancelOrderReasonList"},{mashupRefId:"store.views.order.cancel.cancelOrderLines",mashupId:"store.views.order.cancel.cancelOrderLines"}],ui:{cancelOrderReason:""},initialize:function(){var e={};e.CommonCode={};a.callMashup(this,"getCancelOrderReasonList",e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(){if(iscCore.isVoid(this.ui.cancelOrderReason)){this.ui.cancelOrderReason=this.model.cancelOrderReasonList.CommonCodeList.CommonCode[0]}},uiClose:function(){i.dismiss("cancel")},uiSubmit:function(){if(this.ui.cancelOrderReason.CodeValue){var e={};e.Order={};e.Order.OrderHeaderKey=o.orderHeaderKey;e.Order.Notes={};e.Order.Notes.Note={};e.Order.OrderLines={};e.Order.OrderLines.OrderLine={};e.Order.OrderLines.OrderLine.OrderLineKey=o.orderLine.OrderLineKey;var r=this.getCancellationDescription(this.ui.cancelOrderReason.CodeValue);var n=l.translate("editorderdetails.OrderLineCancellationNote",{cancelReason:r,itemId:o.orderLine.ItemDetails.ItemID,user:t.getFromContext("currentLoginID")});e.Order.Notes.Note.NoteText=n;a.callMashup(this,"store.views.order.cancel.cancelOrderLines",e,{}).then(this.cancelOrderLineAPICallBack.bind(this),this.cancelOrderLineAPIErrorCallBack.bind(this))}else{errorMsg=l.translate("editorderdetails.OrderLineCancellationReasonNotFound");c.showErrorMessage(errorMsg,null,null);i.dismiss("No cancellation reason")}},getCancellationDescription:function(r){var n="";angular.forEach(this.model.cancelOrderReasonList.CommonCodeList.CommonCode,function(e){if(e.CodeValue==r){n=e.CodeShortDescription}});return n},cancelOrderLineAPICallBack:function(e){var r=a.getMashupOutput(e,"store.views.order.cancel.cancelOrderLines");var n={};n.cancelOrderLineAPIOutput={};if(r){n.cancelOrderLineAPIOutput.cancelOrderLineAPISuccess=true;n.cancelOrderLineAPIOutput.order=r}i.close(n)},cancelOrderLineAPIErrorCallBack:function(e){var r=e.Errors.Error[0].ErrorDescription;var n=e.Errors.Error[0].ErrorCode;if(l.hasKey("apierror."+n)){r=l.translate("apierror."+n);c.showErrorMessage(r,null,null)}else{c.showErrorMessage(r,null,null)}i.dismiss(e)}})}]);
angular.module("store").controller("store.views.order.cart-details.cart-details",["$scope","$rootScope","iscScreen","iscWizard","$timeout","$filter","$locale","iscMashup","iscResourcePermission","iscModal","iscI18n","iscAppContext","iscOrder",function(d,r,e,h,n,o,s,f,i,m,c,a,L){h.initializeWizardPage(d,{model:{orderLineList:{},orderModel:{},giftModel:{},couponInput:{couponID:""},scanItemInput:{itemID:""},getRuleDetails_ChargeShipLines:{},customerDetails:{}},mashupRefs:[{mashupRefId:"viewcart_getCompleteOrderLineList",mashupId:"viewcart_getCompleteOrderLineList",modelName:"orderLineList"},{mashupRefId:"viewcart_getCompleteOrderDetails",mashupId:"viewcart_getCompleteOrderDetails",modelName:"getCompleteOrderDetails"},{mashupRefId:"getRuleDetails_ChargeShipLines",mashupId:"wsc_paymentCapture_getRuleDetails_ChargeShipLines",modelName:"getRuleDetails_ChargeShipLines"},{mashupRefId:"viewcart_ovp_modifyFulfillmentOptions",mashupId:"viewcart_ovp_modifyFulfillmentOptions"},{mashupRefId:"viewcart_customer_modifyFulfillmentOptions",mashupId:"viewcart_customer_modifyFulfillmentOptions"},{mashupRefId:"viewcart_getItemAvailabilityForStore",mashupId:"viewcart_getItemAvailabilityForStore"},{mashupRefId:"viewcart_modifyFulfillmentOptions",mashupId:"viewcart_modifyFulfillmentOptions"},{mashupRefId:"viewcart_translateBarcodeForCoupon",mashupId:"viewcart_translateBarcodeForCoupon"},{mashupRefId:"viewcart_changeOrderForGift",mashupId:"viewcart_changeOrderForGift"},{mashupRefId:"vc_modifyFulfillmentOptionsForDeletion",mashupId:"vc_modifyFulfillmentOptionsForDeletion"},{mashupRefId:"vc_getCompleteOrderLineList",mashupId:"vc_getCompleteOrderLineList"},{mashupRefId:"vc_updateSettledQtyOnAllLines",mashupId:"vc_updateSettledQtyOnAllLines"},{mashupRefId:"vc_getCompleteItemList",mashupId:"vc_getCompleteItemList"},{mashupRefId:"vc_getOrderFulfillmentDetails",mashupId:"vc_getOrderFulfillmentDetails",modelName:"getOrderFulfillmentDetails"}],ui:{showCouponScanField:false,isOrderGift:"",oLineQtyEditResourcePermission:false,oLineShownCount:5,applyCouponResourcePermission:false,activeTabIndex:-1,checkAvailability:true,availabilityInfoLoading:true},initialize:function(){r.$showBackButtonForStates=true;this.model.orderModel=h.getWizardModel("orderModel");this.model.giftModel=h.getWizardModel("giftOptionsForOrderModel");if(!iscCore.isVoid(this.model.giftModel)){this.ui.isOrderGift=this.model.giftModel.giftFlag}if(i.hasPermission("WSC000032")){this.ui.oLineQtyEditResourcePermission=true}this.model.customerDetails=h.getWizardModel("customerModel");var e=[];e.push(f.getMashupRefObj(this,"viewcart_getCompleteOrderLineList",{OrderLine:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey}}));e.push(f.getMashupRefObj(this,"viewcart_getCompleteOrderDetails",{Order:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey}}));e.push(f.getMashupRefObj(this,"getRuleDetails_ChargeShipLines",{}));f.callMashups(this,e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){var r=f.getMashupOutput(e,"viewcart_getCompleteOrderLineList");var i=[];i=r.OrderLineList.OrderLine;if(!iscCore.isVoid(i)){for(var t=0;t<i.length;t++){i[t].OrderLineTranQuantity.OrderedQty=o("number")(i[t].OrderLineTranQuantity.OrderedQty);i[t].OrderedQty=o("number")(i[t].OrderedQty)}}this.model.orderLineList=r;n(function(){f.callMashup(this,"vc_getOrderFulfillmentDetails",{Order:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey}},{showMask:false}).then(this.handleAvailabilityOfCart.bind(this),angular.noop)}.bind(this),0)},handleAvailabilityOfCart:function(e){this.ui.availabilityInfoLoading=false;var r=f.getMashupOutput(e,"vc_getOrderFulfillmentDetails");var i=[];i=r.Order.OrderLines.OrderLine;var t=[];if(!iscCore.isVoid(i)){for(var n=0;n<i.length;n++){if(i[n].HasAnyUnavailableQty=="Y"&&i[n].DeliveryMethod!="CARRY"){t.push(i[n].OrderLineKey)}}}if(t.length>0){this.updateOrderLineListWithAvailabilityInfo(t)}},updateOrderLineListWithAvailabilityInfo:function(e){var r=[];r=this.model.orderLineList.OrderLineList.OrderLine;for(var i=0;i<e.length;i++){for(var t=0;t<r.length;t++){if(r[t].OrderLineKey===e[i]){r[t].HasAnyUnavailableQty="Y";break}}}},uiOnQuantityFieldFocus:function(e,r){if(d.cartDetails.$valid)var i=s.NUMBER_FORMATS;var t=r.OrderLineTranQuantity.OrderedQty;if(!iscCore.isVoid(t)){t=t.replace(i.GROUP_SEP,"")}if(r.showQtyUpdate!=="Y"){e.oldQty=t}},uiCancel:function(){m.showConfirmationMessage(c.translate("order.WarningMessage_Cancel")).then(function(e){if(e==="YES"){h.closeWizard()}},function(e){})},uiGetItemDetailsForScan:function(e){if(!iscCore.isVoid(e)){var r={Item:{BarCode:{BarCodeData:e}}};r.Item.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;f.callMashup(this,"vc_getCompleteItemList",r,{}).then(this.handleItemScan.bind(this),angular.noop)}else{m.showErrorMessage(c.translate("viewcartdetails.MSG_InvalidBarCodeData"))}},uiOpenProductSearch:function(i){var t=this;var e=true;if(this.ui.isScreenDirty){m.showConfirmationMessage(c.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){if(!iscCore.isVoid(i)){var r={input:i};h.gotoCustomPage("productSearch",r,{removeCurrent:false,wizardPageCssClass:"fullscreen-modal"})}else{m.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}}else{t.model.searchInput=""}})}else{if(!iscCore.isVoid(i)){var r={input:i,searchContext:"scanInStore"};h.gotoCustomPage("addItems",r,{removeCurrent:false,wizardPageCssClass:"fullscreen-modal"})}else{m.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}}},handleItemScan:function(e){var r=f.getMashupOutput(e,"vc_getCompleteItemList");if(!iscCore.isVoid(r)&&!iscCore.isVoid(r.Order.OrderLines)){if(!(this.model.orderLineList.OrderLineList.TotalNumberOfRecords=="0")){L.updateOrderLines(r,this.model.orderLineList)}else{this.model.orderLineList.OrderLineList.OrderLine=[];this.model.orderLineList.OrderLineList.OrderLine=r.Order.OrderLines.OrderLine;this.model.orderLineList.OrderLineList.TotalNumberOfRecords=r.Order.OrderLines.TotalNumberOfRecords}this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);this.ui.oLineShownCount=this.model.orderLineList.OrderLineList.OrderLine.length;n(function(){var e=document.getElementById("orderLinesHolder");e.scrollTop=e.scrollHeight},0)}else{var i={input:this.model.scanItemInput.itemID,searchContext:"scanInStore"};h.gotoCustomPage("addItems",i,{removeCurrent:false,wizardPageCssClass:"fullscreen-modal"})}this.model.scanItemInput.itemID="";d.cartDetails.$setPristine()},uihandleScreenDirty:function(){m.showErrorMessage(c.translate("globals.MSG_SCREEN_ERRORS"))},handleWizardBack:function(){var e=h.isFirstPage();var r=d.cartDetails.$dirty;if(r){var i=null;if(e){i=c.translate("order.WarningMessage_Cancel");m.showConfirmationMessage(i).then(function(e){if(e==="YES"){h.closeWizard()}})}else{m.showConfirmationMessage(c.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){h.gotoPreviousPage(true)}})}return true}else if(e){i=c.translate("order.WarningMessage_Cancel");m.showConfirmationMessage(i).then(function(e){if(e==="YES"){h.closeWizard()}});return true}else{return false}},handleWizardExit:function(){var e=c.translate("order.WarningMessage_Cancel");m.showConfirmationMessage(e).then(function(e){if(e==="YES"){h.exitWizard()}},function(e){});return true},uiOpenConfirmationForGiftDelete:function(){var r=this;m.showConfirmationMessage("viewcartdetails.LABEL_GiftDeleteConfirmation").then(function(e){r.removeGiftOptionsForOrder(e)})},uiConfirmDeletion:function(r){var i=this;m.showConfirmationMessage("viewcartdetails.LABEL_OLineDeleteConfirmation").then(function(e){i.deleteOrderLine(e,r)})},deleteOrderLine:function(e,r){if(e==="YES"){var i={Order:{OrderHeaderKey:this.model.getCompleteOrderDetails.Order.OrderHeaderKey,OrderLines:[{OrderLine:{Action:"REMOVE",OrderLineKey:r.OrderLineKey}}]}};f.callMashup(this,"vc_modifyFulfillmentOptionsForDeletion",i,{}).then(this.updateOrderLineList.bind(this),angular.noop)}},updateOrderLineList:function(e){var r=f.getMashupOutput(e,"vc_modifyFulfillmentOptionsForDeletion");L.updateOrderLines(r,this.model.orderLineList);this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);var i=c.translate("viewcartdetails.aria_deleteOrderLineSuccessMessage");m.showA11YAlertMessage(i);if(this.model.orderLineList.OrderLineList.TotalNumberOfRecords==0){this.model.giftModel={};h.setWizardModel("giftOptionsForOrderModel",{});this.ui.isOrderGift=""}},removeGiftOptionsForOrder:function(e){if(e==="YES"){var r=this.model.orderLineList.OrderLineList.OrderLine;this.model.giftModel={};h.setWizardModel("giftOptionsForOrderModel",{});this.ui.isOrderGift="";var i=L.prepareChangeOrderInputForGiftRemoval(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r);f.callMashup(this,"viewcart_changeOrderForGift",i,{}).then(this.updateGiftMessageRemovalForOrder.bind(this),angular.noop)}},uiOpenGiftOptionsForOrder:function(){var r=this;var e=L.checkIfAnyOrderlineIsGift(this.model.orderLineList);if(e){m.showConfirmationMessage("viewcartdetails.LABEL_GiftOrderConfirmation").then(function(e){r.overRideGiftOptions(e)})}else{this.overRideGiftOptions("YES")}},uiOpenGiftOptionsForOrderLine:function(r){var i=this;var e=null;if(r.GiftFlag=="Y"){var t=L.getGiftInstructionForOrderLine(r);var n=null;if(t!==null){n=t.InstructionText}var d=null;if(r.PersonInfoMarkFor&&r.PersonInfoMarkFor.FirstName){d=r.PersonInfoMarkFor.FirstName}e={gift:{giftFlag:"Y",giftWrap:r.ItemDetails.PrimaryInformation.AllowGiftWrap,giftRecipient:d,giftMessage:n,giftWrapChecked:r.GiftWrap,showRemoveGift:"Y"}}}else{e={gift:{giftWrap:r.ItemDetails.PrimaryInformation.AllowGiftWrap,giftWrapChecked:"N"}}}var o={modalInput:function(){return e}};m.openModal("store.views.common.gift.giftoptions",o,{}).then(function(e){if(e.data!==null&&e.data!==undefined){i.applyGiftOptionsForOrderLine.call(i,e.data,r)}},angular.noop)},overRideGiftOptions:function(e){if(e==="YES"){var r=this;this.model.giftModel=h.getWizardModel("giftOptionsForOrderModel");var i={};i.gift={};if(!iscCore.isVoid(this.model.giftModel)){i.gift.giftRecipient=this.model.giftModel.giftRecipient;i.gift.giftMessage=this.model.giftModel.giftMessage;i.gift.giftWrapChecked=this.model.giftModel.giftWrapChecked}var t={modalInput:function(){return i}};m.openModal("store.views.common.gift.giftoptions",t,{}).then(function(e){if(e!==null&&e.data!==null&&e.data!==undefined){r.applyGiftOptionsForOrder.call(r,e.data)}},angular.noop)}},applyGiftOptionsForOrder:function(e){var r=[];r=this.model.orderLineList.OrderLineList.OrderLine;var i=angular.copy(e);var t=L.prepareChangeOrderInputForGift(e,this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r);f.callMashup(this,"viewcart_changeOrderForGift",t,{}).then(this.updateOrderWithGiftMessage.bind(this,i),angular.noop)},applyGiftOptionsForOrderLine:function(e,r){var i=[];i[0]=r;if(!iscCore.isVoid(e.removeGift)&&e.removeGift==="Y"){var t=L.prepareChangeOrderInputForGiftRemoval(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,i);f.callMashup(this,"viewcart_changeOrderForGift",t,{}).then(this.updateOrderLineAfterGiftRemoval.bind(this),angular.noop)}else{var t=L.prepareChangeOrderInputForGift(e,this.model.getCompleteOrderDetails.Order.OrderHeaderKey,i);f.callMashup(this,"viewcart_changeOrderForGift",t,{}).then(this.updateOrderLineWithGiftMessage.bind(this),angular.noop)}},updateOrderLineAfterGiftRemoval:function(e){var r=f.getMashupOutput(e,"viewcart_changeOrderForGift");L.updateOrderLines(r,this.model.orderLineList);if(this.model.orderLineList.OrderLineList.OrderLine.length===1){this.model.giftModel={};h.setWizardModel("giftOptionsForOrderModel",{});this.ui.isOrderGift=""}},updateOrderLineWithGiftMessage:function(e){var r=f.getMashupOutput(e,"viewcart_changeOrderForGift");L.updateOrderLines(r,this.model.orderLineList)},updateOrderWithGiftMessage:function(e,r){var i=f.getMashupOutput(r,"viewcart_changeOrderForGift");this.model.giftModel=e;h.setWizardModel("giftOptionsForOrderModel",e);if(!iscCore.isVoid(i.Order.OrderLines)&&!iscCore.isVoid(i.Order.OrderLines.OrderLine)){if(this.model.orderLineList.OrderLineList.OrderLine.length===i.Order.OrderLines.OrderLine.length){this.replaceCompleteOrderLineList(i)}else{L.updateOrderLines(i,this.model.orderLineList)}}this.ui.isOrderGift="Y"},updateGiftMessageRemovalForOrder:function(e){var r=f.getMashupOutput(e,"viewcart_changeOrderForGift");L.updateOrderLines(r,this.model.orderLineList);this.ui.isOrderGift=""},replaceCompleteOrderLineList:function(e){if(!iscCore.isVoid(e.Order.OrderLines)&&!iscCore.isVoid(e.Order.OrderLines.OrderLine)){delete this.model.orderLineList.OrderLineList["OrderLine"];this.model.orderLineList.OrderLineList.OrderLine=[];this.model.orderLineList.OrderLineList.OrderLine=e.Order.OrderLines.OrderLine}},uiCouponApplied:function(e){this.model.getCompleteOrderDetails=e;d.cartDetails.$setPristine()},uiValidateQuantityAndUpdate:function(e,r){var i=s.NUMBER_FORMATS;var t=r.OrderLineTranQuantity.OrderedQty;t=t.replace(i.GROUP_SEP,"");r.OrderLineTranQuantity.OrderedQty=t;if(e.oldQty!==t){e.oldQty=t;if(typeof t=="string")t=parseInt(t,10);if(t===0){m.showErrorMessage(c.translate("viewcartdetails.MSG_InvalidQty"));r.OrderLineTranQuantity.OrderedQty=r.OrderedQty;r.showQtyUpdate="N"}else{var n=L.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);n.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};n.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.OrderedQty=r.OrderLineTranQuantity.OrderedQty;var d=this.getItemAvailabilityForStoreApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r);d.Promise.modifyFulfillmentOptionsInput=n;f.callMashup(this,"viewcart_getItemAvailabilityForStore",d,{}).then(this.handleOrderLineQtyChange.bind(this),angular.noop)}}},uiShowUpdateButton:function(e,r){var i=s.NUMBER_FORMATS;var t=r.OrderLineTranQuantity.OrderedQty;if(!iscCore.isVoid(t))t=t.replace(i.GROUP_SEP,"");if(!iscCore.isVoid(t)&&e.oldQty!==t)r.showQtyUpdate="Y";else r.showQtyUpdate="N"},uiHideUpdateButton:function(e){e.showQtyUpdate="N"},getItemAvailabilityForStoreApiInput:function(e,r){var i={Promise:{OrderHeaderKey:e,OrderLineKey:r.OrderLineKey,PromiseLines:{PromiseLine:[{ItemID:r.ItemDetails.ItemID,UnitOfMeasure:r.ItemDetails.UnitOfMeasure,RequiredQty:r.OrderLineTranQuantity.OrderedQty,Quantity:r.OrderLineTranQuantity.OrderedQty,OrderLine:{OrderLineKey:r.OrderLineKey,DeliveryMethod:r.DeliveryMethod}}]}}};if(r.DeliveryMethod==="SHP"){i.Promise.ComputeShpAvl="Y"}else if(r.DeliveryMethod==="PICK"){i.Promise.ComputePickupAvl="Y";i.Promise.ShipNode=r.Shipnode.ShipNode}else if(r.DeliveryMethod==="CARRY"){i.Promise.ComputeCarryAvl="Y";i.Promise.ShipNode=r.Shipnode.ShipNode}return i},uiGetOrderLineListNext:function(){if(this.ui.oLineShownCount<=this.model.orderLineList.OrderLineList.OrderLine.length){this.ui.oLineShownCount+=5}},uiOLineScrollActionValidator:function(){return true},uiCheckDirtyStateBeforePayment:function(){var e=d.cartDetails.$dirty;if(e){var r=this;m.showConfirmationMessage(c.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){r.uiValidateOrderBeforePayment()}})}else{this.uiValidateOrderBeforePayment()}},uiValidateOrderBeforePayment:function(){var e={};e.Order={};e.Order.OrderLines={};e.Order.OrderLines.OrderLine=this.model.orderLineList.OrderLineList.OrderLine;if(L.orderHasOnlyCarryLines(e)){h.gotoCustomPage("paymentCapture",{},{})}else{var r=L.checkIfOrderHasShipLines(this.model.orderLineList.OrderLineList.OrderLine);var r=L.checkIfOrderHasShipLines(this.model.orderLineList.OrderLineList.OrderLine);var i=true;if(r){var t=this.model.getCompleteOrderDetails;if(iscCore.isVoid(t.Order.PersonInfoShipTo)){m.showErrorMessage(c.translate("viewcartdetails.NoShipToAddressOline"));i=false}}if(i){if(!L.orderHasMixedSettledLines(this.model.orderLineList.OrderLineList.OrderLine)){var n={};n.Order={};n.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;f.callMashup(this,"vc_getCompleteOrderLineList",n,{}).then(this.goToPaymentPage.bind(this),angular.noop)}else{var d={};d.Order={};d.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;var o={};o.Order={};o.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;o.Order.OrderLines={};o.Order.OrderLines.OrderLine=[];for(var s=0;s<this.model.orderLineList.OrderLineList.OrderLine.length;s++){var a=this.model.orderLineList.OrderLineList.OrderLine[s];if(a.OrderLineTranQuantity&&a.OrderLineTranQuantity.OrderedQty&&a.OrderLineTranQuantity.SettledQuantity&&a.OrderLineTranQuantity.OrderedQty!=a.OrderLineTranQuantity.SettledQuantity){var l=o.Order.OrderLines.OrderLine.length;o.Order.OrderLines.OrderLine[l]={};o.Order.OrderLines.OrderLine[l].OrderLineKey=a.OrderLineKey;o.Order.OrderLines.OrderLine[l].OrderLineTranQuantity={};o.Order.OrderLines.OrderLine[l].OrderLineTranQuantity.SettledQuantity=a.OrderLineTranQuantity.OrderedQty}}var O=f.getMashupRefObj(this,"vc_updateSettledQtyOnAllLines",o);var u=f.getMashupRefObj(this,"vc_getCompleteOrderLineList",d);var p=[O,u];f.callMashups(this,p,{}).then(this.goToPaymentPage.bind(this),angular.noop)}}}},goToPaymentPage:function(e){var r=f.getMashupOutput(e,"vc_getCompleteOrderLineList");if(r.OrderLineList.IsAnyLineUnAvailable=="N"){h.gotoCustomPage("paymentCapture",{},{})}else{m.showErrorMessage(c.translate("viewcartdetails.UnAvailbleLines"))}},uiGetItemDetails:function(e,r){if(!iscCore.isVoid(e)){var i={input:e};h.gotoCustomPage("addItems",i,{})}},uiAddOrEditAddress:function(e,r){var i=this;var t={};t.Mode=e;t.Context="showDefaultshipto";if(e=="Edit"){if(!iscCore.isVoid(r.PersonInfoShipTo)){t.PersonInfo=angular.copy(r.PersonInfoShipTo)}else{t.PersonInfo=angular.copy(this.model.getCompleteOrderDetails.Order.PersonInfoShipTo)}}if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo){t.hideShipaddress=true}else{if(e=="Add"){t.PersonInfo={}}t.PersonInfo.IsDefaultShippingAddress="N"}var n={modalInput:function(){return t}};m.openModal("store.views.common.orderaddress.orderaddresspopup",n,{}).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){i.onAddressAdditionOrEdit.call(i,e.data,r)}},angular.noop)},onAddressAdditionOrEdit:function(e,r){var i=angular.copy(e);delete i.IsDefaultShippingAddress;delete i.IsDefaultBillingAddress;var t=L.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.OrderedQty=r.OrderLineTranQuantity.OrderedQty;t.Order.OrderLines.OrderLine[0].PersonInfoShipTo={};t.Order.OrderLines.OrderLine[0].PersonInfoShipTo=i;if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo||e.IsDefaultShippingAddress==="Y"){t.Order.PersonInfoShipTo=i;if(!this.model.getCompleteOrderDetails.Order.BillToID){t.Order.CustomerFirstName=i.FirstName;t.Order.CustomerLastName=i.LastName;t.Order.CustomerEMailID=i.EMailID;t.Order.CustomerZipCode=i.ZipCode}}var n=this.getItemAvailabilityForStoreApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r);n.Promise.PromiseLines.PromiseLine[0].ShipToAddress=i;n.Promise.modifyFulfillmentOptionsInput=t;f.callMashup(this,"viewcart_getItemAvailabilityForStore",n,{}).then(this.handleShippingLineAddress.bind(this),angular.noop)},uiIdentifyCustomerPopup:function(e){var r={};var i=this;r.Mode="Identify";var t={modalInput:function(){return r}};m.openModal("store.views.common.customer.customerpopup",t,{}).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){i.onCustomerIdentification.call(i,e.data)}},angular.noop)},onCustomerIdentification:function(e){var r=e.customerModel;var i={};i.Order={};i.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;i.Order.BillToID=r.Customer.CustomerID;if(!iscCore.isVoid(e.addressSelected)){i.Order.PersonInfoShipTo={};i.Order.PersonInfoShipTo=angular.copy(e.addressSelected.PersonInfo);if(e.addressSelected.IsDefaultBillTo==="Y"){i.Order.PersonInfoBillTo={};i.Order.PersonInfoBillTo=angular.copy(e.addressSelected.PersonInfo)}}if(r.Customer.CustomerType==="02"||r.Customer.CustomerContactList&&r.Customer.CustomerContactList.CustomerContact&&r.Customer.CustomerContactList.CustomerContact.length===1){i.Order.CustomerContactID=r.Customer.CustomerContactList.CustomerContact[0].CustomerContactID;i.Order.CustomerFirstName=r.Customer.CustomerContactList.CustomerContact[0].FirstName;i.Order.CustomerLastName=r.Customer.CustomerContactList.CustomerContact[0].LastName;i.Order.CustomerEMailID=r.Customer.CustomerContactList.CustomerContact[0].EmailID;if(!iscCore.isVoid(e.addressSelected)){i.Order.CustomerZipCode=e.addressSelected.PersonInfo.ZipCode}}f.callMashup(this,"viewcart_customer_modifyFulfillmentOptions",i,{}).then(this.handleModifyFulfillmentOptionsForCustomer.bind(this),angular.noop)},uiEditAddressInCustomerPanel:function(){var r=this;var e={};e.Mode="Edit";e.PersonInfo=angular.copy(this.model.getCompleteOrderDetails.Order.PersonInfoShipTo);e.hideShipaddress=true;var i={modalInput:function(){return e}};m.openModal("store.views.common.orderaddress.orderaddresspopup",i,{}).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){r.handleEditAddressInCustomerPanel.call(r,e.data)}},angular.noop)},handleEditAddressInCustomerPanel:function(e){var r=angular.copy(e);delete r.IsDefaultShippingAddress;var i={};i.Order={};i.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;i.Order.PersonInfoShipTo={};i.Order.PersonInfoShipTo=r;if(!this.model.getCompleteOrderDetails.Order.BillToID){i.Order.CustomerFirstName=r.FirstName;i.Order.CustomerLastName=r.LastName;i.Order.CustomerEMailID=r.EMailID;i.Order.CustomerZipCode=r.ZipCode}f.callMashup(this,"viewcart_customer_modifyFulfillmentOptions",i,{}).then(this.handleModifyFulfillmentOptionsForCustomer.bind(this),angular.noop)},uiOpenOverridePriceModal:function(r){var i=this;var e={};e.price={};e.price.listPrice=r.LinePriceInfo.ListPrice;e.price.unitPrice=r.LinePriceInfo.UnitPrice;e.price.Currency=this.model.getCompleteOrderDetails.Order.PriceInfo.Currency;var t={modalInput:function(){return e}};m.openModal("store.views.common.priceoverride.priceoverride",t,{}).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){i.onPriceOverride.call(i,e.data,r)}},angular.noop)},onPriceOverride:function(e,r){var i=L.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);i.Order.OrderLines.OrderLine[0].LinePriceInfo={};i.Order.OrderLines.OrderLine[0].LinePriceInfo.ListPrice=r.LinePriceInfo.ListPrice;i.Order.OrderLines.OrderLine[0].LinePriceInfo.UnitPrice=e.newprice;i.Order.OrderLines.OrderLine[0].LinePriceInfo.IsPriceLocked="Y";L.addPriceOverrideDefaultNote(i,e.reason);f.callMashup(this,"viewcart_ovp_modifyFulfillmentOptions",i,{}).then(this.handlePriceOverrideApiCall.bind(this),angular.noop)},handlePriceOverrideApiCall:function(e){var r=f.getMashupOutput(e,"viewcart_ovp_modifyFulfillmentOptions");this.handleModifyFulfillmentOptionsApiOutput(r)},handleModifyFulfillmentOptionsForCustomer:function(e){var r=f.getMashupOutput(e,"viewcart_customer_modifyFulfillmentOptions");this.handleModifyFulfillmentOptionsApiOutput(r);n(function(){f.callMashup(this,"vc_getOrderFulfillmentDetails",{Order:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey}},{showMask:false}).then(this.handleAvailabilityOfCart.bind(this),angular.noop)}.bind(this),0)},handleModifyFulfillmentOptionsOutput:function(e){var r=f.getMashupOutput(e,"viewcart_modifyFulfillmentOptions");this.handleModifyFulfillmentOptionsApiOutput(r);this.model.couponInput.couponID=""},handleModifyFulfillmentOptionsApiOutput:function(e){L.updateOrderLines(e,this.model.orderLineList);this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(e,this.model.getCompleteOrderDetails)},handleOrderLineQtyChange:function(e){this.handleItemAvailabilityAndOrderModification(e);var r=c.translate("viewcartdetails.aria_updateOrderLineQtySuccessMessage");m.showA11YAlertMessage(r)},handleShippingLineAddress:function(e){this.handleItemAvailabilityAndOrderModification(e);n(function(){f.callMashup(this,"vc_getOrderFulfillmentDetails",{Order:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey}},{showMask:false}).then(this.handleAvailabilityOfCart.bind(this),angular.noop)}.bind(this),0)},handleItemAvailabilityAndOrderModification:function(e){var r=f.getMashupOutput(e,"viewcart_getItemAvailabilityForStore");if(!iscCore.isVoid(r.Promise)){if(r.Promise.IsItemQtyAvailable==="N"){m.showErrorMessage(c.translate("viewcartdetails.OrderLineQtyChangeError"));var i=r.Promise.OrderLineKey;var t=[];t=this.model.orderLineList.OrderLineList.OrderLine;for(var n=0;n<t.length;n++){if(t[n].OrderLineKey==i){t[n].OrderLineTranQuantity.OrderedQty=t[n].OrderedQty;t[n].showQtyUpdate="N";break}}}}else{L.updateOrderLines(r,this.model.orderLineList);this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);if(iscCore.isVoid(this.model.getCompleteOrderDetails.PromotionsApplied)){this.ui.showCouponScanField=false}d.cartDetails.$setPristine()}},uiOpenStoreSearch:function(r){var i=this;var e=a.getFromContext("storeAddress").ShipNodePersonInfo;var t={modalInput:function(){return{inputData:{callingMode:"CARTDETAILS",orderLine:r}}}};m.openModal("store.views.common.storesearch.storesearch",t,{}).then(function(e){i.afterStoreSelection.call(i,e.data,r)},angular.noop)},uiValidateQuantity:function(e,r,i,t){if(!iscCore.isVoid(r)&&r.iscDatatypeValidator)return e;else var n=!isNaN(t);if(!iscCore.isBooleanTrue(n)){e.booleanResponse=!isNaN(t);e.errorMesssage=c.translate("globals.ERROR_invalid_input")}return e},afterStoreSelection:function(e,r){var i=L.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);i.Order.OrderLines.OrderLine[0].ShipNode=e.selectedStore.ShipNode;f.callMashup(this,"viewcart_modifyFulfillmentOptions",i,{}).then(this.handleModifyFulfillmentOptionsOutput.bind(this),angular.noop)},uiChangeDeliveryMethod:function(r){var i=this;var e={modalInput:function(){return{inputData:{OrderHeaderKey:i.model.getCompleteOrderDetails.Order.OrderHeaderKey,orderLine:r,orderPersonInfoShipTo:i.model.getCompleteOrderDetails.Order.PersonInfoShipTo}}}};m.openModal("store.views.common.fulfillment.fulfillmentoptions",e,{}).then(function(e){i.handleDeliveryMethodChange.call(i,e.data,r)},angular.noop)},uiAddComments:function(){var r=this;var e=angular.copy(this.model.getCompleteOrderDetails);var i={modalInput:function(){return e}};m.openModal("store.views.order.comments.comments",i,{}).then(function(e){r.model.getCompleteOrderDetails.Order.Notes.NumberOfNotes=e.NoteList.TotalNumberOfRecords},angular.noop)},handleDeliveryMethodChange:function(e,r){var i=e.newDelMethod;var t=L.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);t.Order.OrderLines.OrderLine[0].DeliveryMethod=i;if(i=="PICK"){t.Order.OrderLines.OrderLine[0].ShipNode=e.selectedStore.ShipNode;t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.SettledQuantity="0";if(!iscCore.isVoid(e.selectedStore.Availability.AvailableDate)){t.Order.OrderLines.OrderLine[0].ReqShipDate=e.selectedStore.Availability.AvailableDate}}else if(i=="SHP"){if(this.model.getRuleDetails_ChargeShipLines&&this.model.getRuleDetails_ChargeShipLines.Rules&&this.model.getRuleDetails_ChargeShipLines.Rules.RuleSetValue=="N"){t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.SettledQuantity="0"}if(!iscCore.isVoid(e.EarliestShipDate)){t.Order.OrderLines.OrderLine[0].EarliestShipDate=e.EarliestShipDate}if(!iscCore.isVoid(e.personInfoShipTo)){t.Order.OrderLines.OrderLine[0].PersonInfoShipTo={};if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo||e.personInfoShipTo.IsDefaultShippingAddress==="Y"){t.Order.PersonInfoShipTo=e.personInfoShipTo;if(!this.model.getCompleteOrderDetails.Order.BillToID){t.Order.CustomerFirstName=e.personInfoShipTo.FirstName;t.Order.CustomerLastName=e.personInfoShipTo.LastName;t.Order.CustomerEMailID=e.personInfoShipTo.EMailID;t.Order.CustomerZipCode=e.personInfoShipTo.ZipCode}}delete e.personInfoShipTo.IsDefaultShippingAddress;delete e.personInfoShipTo.IsDefaultBillingAddress;t.Order.OrderLines.OrderLine[0].PersonInfoShipTo=e.personInfoShipTo;if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo){t.Order.PersonInfoShipTo=e.personInfoShipTo}}if(!iscCore.isVoid(e.selectedCarrier)){t.Order.OrderLines.OrderLine[0].CarrierServiceCode=e.selectedCarrier.CarrierServiceCode;t.Order.OrderLines.OrderLine[0].OrderDates={};t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate=[];t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[0]={};t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[0].CommittedDate=e.selectedCarrier.DeliveryStartDate;t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[0].DateTypeId="MIN_DELIVERY";t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[1]={};t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[1].CommittedDate=e.selectedCarrier.DeliveryEndDate;t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[1].DateTypeId="MAX_DELIVERY"}}else if(i=="CARRY"){t.Order.OrderLines.OrderLine[0].ShipNode=a.getFromContext("storeName");if(r.OrderLineTranQuantity.SettledQuantity==="0"){t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.SettledQuantity="0"}}if(!iscCore.isVoid(r.PersonInfoMarkFor)&&!iscCore.isVoid(r.PersonInfoMarkFor.PersonInfoKey)){t.Order.OrderLines.OrderLine[0].MarkForKey=r.PersonInfoMarkFor.PersonInfoKey}f.callMashup(this,"viewcart_modifyFulfillmentOptions",t,{}).then(this.handleModifyFulfillmentOptionsOutput.bind(this),angular.noop)}})}]);
angular.module("store").controller("store.views.order.comments.comments",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscModal","iscI18n",function(r,e,o,s,t,a,i,n,d){s.initializeModalScreen(r,{model:{noteList:{}},mashupRefs:[{mashupRefId:"getNoteList",mashupId:"store.views.order.comments.getNoteList",modelName:"noteList"},{mashupRefId:"changeOrder",mashupId:"store.views.order.comments.changeOrder"}],ui:{},initialize:function(){var e={};e.Note={};e.Note.TableKey=t.Order.OrderHeaderKey;a.callMashup(this,"getNoteList",e,{})},uiClose:function(){o.close(this.model.noteList)},uiPostComment:function(e){var r={};r.Order={};r.Order.OrderHeaderKey=t.Order.OrderHeaderKey;r.Order.Notes=e;var s=[];s.push(a.getMashupRefObj(this,"changeOrder",r));s.push(a.getMashupRefObj(this,"getNoteList",{Note:{TableKey:t.Order.OrderHeaderKey}}));a.callMashups(this,s,{}).then(this.handleChangeOrder.bind(this),this.changeOrderAPIErrorCallBack.bind(this))},handleChangeOrder:function(e){r.$broadcast("clearNoteFields")},changeOrderAPIErrorCallBack:function(e){var r=e.Errors.Error[0].ErrorDescription;var s=e.Errors.Error[0].ErrorCode;if(d.hasKey("apierror."+s)){r=d.translate("apierror."+s);n.showErrorMessage(r,null,null)}else{n.showErrorMessage(r,null,null)}o.dismiss(e)}})}]);
angular.module("store").controller("store.views.order.item-search.item-search",["$animate","$scope","$rootScope","iscScreen","iscWizard","iscState","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext",function(e,r,n,t,d,a,s,u,i,o,c,h){d.initializeWizardPage(r,{model:{searchProductsResult:{},searchCatalogIndexInput:{},orderDetails:{},customerDetails:{}},mashupRefs:[{mashupRefId:"searchProducts",mashupId:"itemSearch_searchCatalogIndex"},{mashupRefId:"getCompleteOrderDetails",mashupId:"itemSearch_getCompleteOrderDetails",modelName:"orderDetails"}],ui:{productSearchPageNo:"1",searchContext:"",searchInput:"",orderTotalQty:"0",pageSize:"",noOfSearchResults:0,searchInProgress:false,focusScanField:true,productSearchText:"",showMiniCart:false,hideActionsPanel:false},initialize:function(){this.ui.pageSize=h.getFromContext("defaultPageSize");this.ui.showItemSearch=this.ui.showMiniCart=true;var e=d.getWizardPageInput();var r=d.getWizardPageOptions();if(!iscCore.isVoid(r)&&!iscCore.isVoid(r.flowName)&&r.flowName=="CLIENTELING"){this.ui.hideActionsPanel=true}var t=e.operation;var a=e.input;var s=e.openBlankPage;this.model.customerDetails=d.getWizardModel("customerModel");var i=d.getWizardModel("orderModel");var o=e.searchContext;if(!iscCore.isVoid(o)&&o==="scanInStore"){n.$showBackButtonForStates=false;this.ui.searchContext="scanInStore"}if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.Order.OrderHeaderKey)){var c={Order:{OrderHeaderKey:i.Order.OrderHeaderKey}};u.callMashup(this,"getCompleteOrderDetails",c,{}).then(function(){i=this.model.orderDetails;d.setWizardModel("orderModel",this.model.orderDetails);this.ui.orderTotalQty=i.Order.OrderLines.TotalNumberOfRecords}.bind(this),angular.noop)}if(!iscCore.isVoid(e.CatalogSearch)){this.ui.productSearchPageNo=1;if(!iscCore.isVoid(e.SearchText)){this.model.searchCatalogIndexInput={CatalogSearch:{Terms:{Term:{Value:e.SearchText}}}}}this.handleSearchCatalogIndex(e)}else{if(!s){this.searchProduct("search",a)}else{d.gotoCustomPage("addItems",{openBlankPage:true},{removeCurrent:true})}}},uiOpenItemDetails:function(e){if(!iscCore.isVoid(e)){var r=d.getWizardPageInput();var t={input:e};var a=r.searchContext;if(!iscCore.isVoid(a)&&a==="scanInStore"){t.searchContext="scanInStore";d.gotoCustomPage("addItems",t,{removeCurrent:true,wizardPageCssClass:"fullscreen-modal"})}else{d.gotoCustomPage("addItems",t,{})}}else{i.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}},uiHandleCheckout:function(){d.gotoCustomPage("cartDetails",{},{})},uiCancel:function(){if(this.ui.searchContext=="scanInStore"){d.gotoPreviousPage(true)}else{var e=c.translate("order.WarningMessage_Cancel");if(this.ui.orderTotalQty<1){e=c.translate("addItems.WarningMessage_Cancel")}i.showConfirmationMessage(e).then(function(e){if(e==="YES"){d.closeWizard()}},function(e){})}},uiOpenProductSearch:function(e){if(iscCore.isVoid(e)){i.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}else{d.gotoCustomPage("productSearch",{input:e},{})}},uiSearchProductGetNextRecords:function(){if(this.ui.productSearchPageNo+1<=this.model.searchProductsResult.CatalogSearch.TotalPages){this.ui.productSearchPageNo++;this.searchProduct("Next")}},uiNextPageActionValidator:function(){if(!this.ui.searchInProgress){return true}else if(this.ui.searchInProgress){return false}},getOrderDetails:function(){var e=d.getWizardModel("orderModel");if(!iscCore.isVoid(e)){this.model.orderDetails=e;this.ui.orderTotalQty=e.Order.OrderLines.TotalNumberOfRecords}},searchProduct:function(e,r){if(e==="Next"){r=this.model.searchCatalogIndexInput.CatalogSearch.Terms.Term.Value}this.ui.searchInput=r;if(!iscCore.isVoid(r)){this.setSearchCatalogIndexInput(r);if(e==="newSearch"){this.model.searchProductsResult={};this.ui.productSearchPageNo=1}this.model.searchCatalogIndexInput.CatalogSearch.PageNumber=this.ui.productSearchPageNo;this.ui.searchInProgress=true;u.callMashup(this,"searchProducts",this.model.searchCatalogIndexInput,{}).then(function(e){var r=u.getMashupOutput(e,"searchProducts");this.handleSearchCatalogIndex(r)}.bind(this),angular.noop)}else{i.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}},setSearchCatalogIndexInput:function(e){this.model.searchCatalogIndexInput.CatalogSearch={PageSize:this.ui.pageSize,Terms:{Term:{Value:e}}};var r=d.getWizardModel("orderModel");if(!iscCore.isVoid(r)){var t=iscCore.getValueFromJsonPath(r,"Order.BillToID");if(!iscCore.isVoid(t)){this.model.searchCatalogIndexInput.CatalogSearch.Item={CustomerInformation:{CustomerID:t}}}}},handleSearchCatalogIndex:function(e){this.ui.searchInProgress=false;this.getOrderDetails();var r=e.CatalogSearch.ItemList.Item;this.ui.productSearchText=e.SearchText;this.ui.focusScanField=true;if(iscCore.isVoid(r)&&iscCore.isVoid(this.model.searchProductsResult)){this.ui.noProductsFound=true;this.ui.noOfSearchResults=0}else{this.ui.showSearchResults=true;this.ui.noProductsFound=false;this.ui.noOfSearchResults+=r.length;if(iscCore.isVoid(this.model.searchProductsResult)){this.model.searchProductsResult=e}else if(!iscCore.isVoid(r)){for(var t=0;t<r.length;t++){this.model.searchProductsResult.CatalogSearch.ItemList.Item.push(r[t])}}}},handleWizardBack:function(){var e=d.isFirstPage();if(e){this.uiCancel();return true}else{return false}},handleWizardExit:function(){var e=c.translate("order.WarningMessage_Cancel");if(this.ui.orderTotalQty<1){e=c.translate("addItems.WarningMessage_Cancel")}i.showConfirmationMessage(e).then(function(e){if(e==="YES"){d.exitWizard()}},function(e){});return true}})}]);
angular.module("store").controller("store.views.order.list.global-order-list",["$animate","$scope","$filter","$rootScope","iscScreen","iscState","iscWizard","iscStateParams","iscMashup","iscModal","iscOrder","iscObjectUtility","iscAppContext","iscReturn","iscResourcePermission","iscI18n","iscRule",function(e,r,t,i,s,d,o,u,n,a,l,O,h,c,p,m,f){s.initializeScreen(r,{model:{getOrderListApiInput:{},orderList:{}},mashupRefs:[{mashupRefId:"getOrderListByOrderNo",mashupId:"store.views.order.list.getOrderListByOrderNo"},{mashupRefId:"getOrderListByFilterCriteria",mashupId:"store.views.order.list.getOrderListByFilterCriteria"},{mashupRefId:"getItemThumbnails",mashupId:"store.views.common.getItemThumbnails"}],ui:{selectedOrderHeaderKey:"",orderShownCount:10,numOfOrders:-1,refineResults:"N",getFilterFromContext:false},initialize:function(){var e=[];if(!iscCore.isVoid(u.params)&&u.params.callAPI!="N"&&!iscCore.isVoid(u.params.input)){this.model.getOrderListApiInput.Order=u.params.input.Order;var r=this.model.getOrderListApiInput;if(u.options&&u.options.backButtonClicked){var t=h.getFromContext("orderListFilter");if(!iscCore.isVoid(t)&&t.input){r=t.input;this.ui.getFilterFromContext=true}}else{h.removeFromContext("orderListFilter")}e.push(n.getMashupRefObj(this,"getOrderListByFilterCriteria",r));n.callMashups(this,e,{}).then(this.processOrderList.bind(this),angular.noop)}else{this.ui.numOfOrders=0;this.model.orderList={}}},processOrderList:function(e){var r=n.getMashupOutput(e,"getOrderListByFilterCriteria");this.ui.numOfOrders=Number(r.OrderList.TotalNumberOfRecords);this.model.orderList=r;this.ui.selectedOrderHeaderKey=r.OrderList.Order[0].OrderHeaderKey},uiGetCssClassByOrderStatus:function(e){return l.getCssClassByOrderStatus(e.MaxOrderStatus)},uiSetDisplayStatus:function(e){e.DisplayStatus=l.getDisplayStatus(e)},uiViewOrderDetails:function(e){l.viewOrderFromList(e,true)},uiToggleViewProductsButton:function(e){if(!iscCore.isVoid(e)&&"Y"==e.DraftOrderFlag&&!p.hasPermission("WSC000031")){return true}else{return false}},uiSelectOrder:function(t){if(f.isRuleEnabled("ShowItemImage")&&iscCore.isVoid(t.ItemThumbnails)){var e={OrderLine:{OrderHeaderKey:t.OrderHeaderKey}};n.callMashup(this,"getItemThumbnails",e,{}).then(function(e){var r=n.getMashupOutput(e,"getItemThumbnails");t.ItemThumbnails=r;this.ui.selectedOrderHeaderKey=t.OrderHeaderKey}.bind(this),angular.noop)}else{this.ui.selectedOrderHeaderKey=t.OrderHeaderKey}},uiGetOrderListNext:function(){if(this.ui.orderShownCount==this.model.orderList.OrderList.Order.length){this.ui.refineResults="Y"}else if(this.ui.orderShownCount<=this.model.orderList.OrderList.Order.length){this.ui.orderShownCount+=5}},uiOrderListScrollActionValidator:function(){return true},getInputForOrderDetails:function(e){var r={};r.Order={};r.Order.EnterpriseCode=e.EnterpriseCode;r.Order.OrderHeaderKey=e.OrderHeaderKey;r.Order.AppContextInfo={};r.Order.AppContextInfo.Channel=e.EntryType;return r},uiApplyFilterOnOrderList:function(e){n.callMashup(this,"getOrderListByFilterCriteria",e,{}).then(this.handleOrderFilterResult.bind(this),angular.noop)},handleOrderFilterResult:function(e){var r=n.getMashupOutput(e,"getOrderListByFilterCriteria");this.ui.numOfOrders=Number(r.OrderList.TotalNumberOfRecords);if(this.ui.numOfOrders>0){this.model.orderList=l.stampDisplayStatusOnOrderList(r)}else{this.model.orderList=r}this.ui.refineResults="N"},uiCancel:function(){d.goToState("/home",{},{})}})}]);
angular.module("store").controller("store.views.order.modification.edit-order-details",["$scope","$rootScope","iscScreen","iscWizard","$timeout","$filter","$locale","iscMashup","iscResourcePermission","iscModal","iscI18n","iscAppContext","iscOrder",function(o,r,e,a,d,l,n,m,i,p,c,s,L){a.initializeWizardPage(o,{model:{orderLineList:{},orderEditModel:{},giftModel:{},couponInput:{couponID:""},scanItemInput:{itemID:""},getRuleDetails_ChargeShipLines:{},getRuleDetails_OrderAge:{}},mashupRefs:[{mashupRefId:"store.views.order.modification.getCompleteOrderDetails",mashupId:"store.views.order.modification.getCompleteOrderDetails",modelName:"getCompleteOrderDetails"},{mashupRefId:"getRuleDetails_ChargeShipLines",mashupId:"wsc_paymentCapture_getRuleDetails_ChargeShipLines",modelName:"getRuleDetails_ChargeShipLines"},{mashupRefId:"store.views.order.modification.changeQty.newLineChangeOrder",mashupId:"store.views.order.modification.changeQty.newLineChangeOrder"},{mashupRefId:"store.views.order.modification.changeQty.modifyFulfillmentOptions",mashupId:"store.views.order.modification.changeQty.modifyFulfillmentOptions"},{mashupRefId:"getRuleDetails_OrderAge",mashupId:"store.views.order.modification.getRuleDetails_OrderAge",modelName:"getRuleDetails_OrderAge"},{mashupRefId:"getRuleDetails_EditOrderAfterSchedule",mashupId:"store.views.order.modification.getRuleDetails_EditOrderAfterSchedule",modelName:"getRuleDetails_EditOrderAfterSchedule"},{mashupRefId:"store.views.order.modification.ovp_modifyFulfillmentOptions",mashupId:"store.views.order.modification.ovp_modifyFulfillmentOptions"},{mashupRefId:"store.views.order.modification.customer_modifyFulfillmentOptions",mashupId:"store.views.order.modification.customer_modifyFulfillmentOptions"},{mashupRefId:"store.views.order.modification.getItemAvailabilityForStore",mashupId:"store.views.order.modification.getItemAvailabilityForStore"},{mashupRefId:"store.views.order.modification.getItemAvailabilityForChangedQty",mashupId:"store.views.order.modification.getItemAvailabilityForChangedQty"},{mashupRefId:"store.views.order.modification.modifyFulfillmentOptions",mashupId:"store.views.order.modification.modifyFulfillmentOptions"},{mashupRefId:"store.views.order.modification.changeOrderForNewLines",mashupId:"store.views.order.modification.changeOrderForNewLines"},{mashupRefId:"store.views.order.modification.translateBarcodeForCoupon",mashupId:"store.views.order.modification.translateBarcodeForCoupon"},{mashupRefId:"store.views.order.modification.changeOrderForGift",mashupId:"store.views.order.modification.changeOrderForGift"},{mashupRefId:"vc_modifyFulfillmentOptionsForDeletion",mashupId:"vc_modifyFulfillmentOptionsForDeletion"},{mashupRefId:"store.views.order.modification.getCompleteOrderLineList_CheckAvailability",mashupId:"store.views.order.modification.getCompleteOrderLineList_CheckAvailability"},{mashupRefId:"vc_updateSettledQtyOnAllLines",mashupId:"vc_updateSettledQtyOnAllLines"},{mashupRefId:"vc_getCompleteItemList",mashupId:"vc_getCompleteItemList"},{mashupRefId:"store.views.order.modification.changeOrderSave",mashupId:"store.views.order.modification.changeOrderSave"},{mashupRefId:"store.views.order.modification.resetOrderPendingChanges",mashupId:"store.views.order.modification.resetOrderPendingChanges"},{mashupRefId:"store.views.order.modification.changeOrderToApplyPendingChanges",mashupId:"store.views.order.modification.changeOrderToApplyPendingChanges"},{mashupRefId:"store.views.order.modification.cancelNewOrderLines",mashupId:"store.views.order.modification.cancelNewOrderLines"},{mashupRefId:"store.views.order.modification.cancelOrderLines",mashupId:"store.views.order.modification.cancelOrderLines"}],ui:{showCouponScanField:false,isOrderGift:"",oLineQtyEditResourcePermission:false,oLineChangeFulfillmentOptionsPermission:false,oLineShownCount:5,orderHeaderKeyToEdit:"",orderLinesCountWizardLoad:0,orderAgeInDays:0,isRefund:"N",diffAmount:"",newOrderTotal:"",editOrderLockTemplate:"store/views/order/modification/edit-order-locked.tpl.html",deletedOrderLineKey:"",showPaymentButton:false,orderlineModel:{},chagePickupStore:false,saveOrderBeforeUnschedule:false,applyCouponResourcePermission:false,activeTabIndex:-1},initialize:function(){r.$showBackButtonForStates=true;this.ui.orderHeaderKeyToEdit=a.getWizardModel("orderHeaderKey");this.model.giftModel=a.getWizardModel("giftOptionsForOrderModel");if(!iscCore.isVoid(this.model.giftModel)){this.ui.isOrderGift=this.model.giftModel.giftFlag}if(i.hasPermission("WSC000032")){this.ui.oLineQtyEditResourcePermission=true}if(i.hasPermission("WSC000050")){this.ui.oLineChangeFulfillmentOptionsPermission=true}var e=[];e.push(m.getMashupRefObj(this,"store.views.order.modification.getCompleteOrderDetails",{Order:{OrderHeaderKey:this.ui.orderHeaderKeyToEdit}}));e.push(m.getMashupRefObj(this,"getRuleDetails_ChargeShipLines",{}));e.push(m.getMashupRefObj(this,"getRuleDetails_OrderAge",{}));e.push(m.getMashupRefObj(this,"getRuleDetails_EditOrderAfterSchedule",{}));m.callMashups(this,e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.getCompleteOrderDetails");a.setWizardModel("orderModel",r);a.setWizardModel("isOrgRoleNode",r.Order.isOrgRoleNode);var i=a.getWizardModel("OrderModificationModel");if(!iscCore.isVoid(i)){if(i.Order.OrderHasPendingChanges=="N"&&r.Order.HasPendingChanges==="N"){this.ui.showPaymentButton=true}}var t=m.getMashupOutput(e,"store.views.order.modification.getRuleDetails_OrderAge");this.ui.orderAgeInDays=L.getOrderAge(r.Order.OrderDate);var d=a.getWizardModel("orderLinesCountWizardLoad");if(!d){a.setWizardModel("orderLinesCountWizardLoad",r.Order.OrderLines.TotalNumberOfRecords)}this.ui.orderLinesCountWizardLoad=parseInt(a.getWizardModel("orderLinesCountWizardLoad"),10);var o={};o.OverallTotals={};if(!iscCore.isVoid(r)&&r.Order.HasPendingChanges==="Y"){o.OverallTotals=r.Order.OldOrder.OverallTotals;a.setWizardModel("orderPricingModel",o)}else{o.OverallTotals=r.Order.OverallTotals;a.setWizardModel("orderPricingModel",o)}this.setOrderTotalAfterModificationMsg(o,r);var n=[];n=r.Order.OrderLines.OrderLine;if(!iscCore.isVoid(n)){for(var s=0;s<n.length;s++){n[s].OrderLineTranQuantity.OrderedQty=l("number")(n[s].OrderLineTranQuantity.OrderedQty);n[s].OrderedQty=l("number")(n[s].OrderedQty);n[s].LineSeqNumber=n[s].LineSeqNo.split(".")[0];this.uiSetDisplayStatus(n[s])}}this.model.orderLineList.OrderLineList={};this.model.orderLineList.OrderLineList.TotalNumberOfRecords=r.Order.OrderLines.TotalNumberOfRecords;this.model.orderLineList.OrderLineList.OrderLine=[];this.model.orderLineList.OrderLineList.OrderLine=r.Order.OrderLines.OrderLine},setOrderTotalAfterModificationMsg:function(e,r){var i=e.OverallTotals.GrandTotal;var t=r.Order.OverallTotals.GrandTotal;if(typeof i=="string")i=parseFloat(i,10);if(typeof t=="string")t=parseFloat(t,10);this.ui.newOrderTotal=t;if(i>t){this.ui.isRefund="Y";this.ui.diffAmount=i-t}else{this.ui.isRefund="N";this.ui.diffAmount=t-i}},uiOnQuantityFieldFocus:function(e,r){if(o.editOrderDetails.$valid)var i=n.NUMBER_FORMATS;var t=r.OrderLineTranQuantity.OrderedQty;if(!iscCore.isVoid(t)){t=t.replace(i.GROUP_SEP,"")}if(r.showQtyUpdate!=="Y"){e.oldQty=t}},uiCancel:function(){var i=this.model.getCompleteOrderDetails;var e=c.translate("editorderdetails.MSG_CloseWithNoPendingChanges");if(!iscCore.isVoid(i)&&i.Order.HasPendingChanges==="Y"){e=c.translate("editorderdetails.MSG_OrderHasPendingChanges")}var t=this;p.showConfirmationMessage(e).then(function(e){if(e==="YES"){if(!iscCore.isVoid(i)&&i.Order.HasPendingChanges==="Y"){var r={Order:{OrderHeaderKey:t.ui.orderHeaderKeyToEdit}};m.callMashup(t,"store.views.order.modification.resetOrderPendingChanges",r,{}).then(t.handleOrderResetChanges.bind(t),angular.noop)}else{a.closeWizard()}}},function(e){})},handleOrderResetChanges:function(){a.closeWizard()},uiGetItemDetailsForScan:function(e){var r=0;var i=0;r=this.model.getRuleDetails_OrderAge.Rules.RuleSetValue;i=L.getOrderAge(this.model.getCompleteOrderDetails.Order.OrderDate);if(i>r){p.showErrorMessage(c.translate("orderModification.orderAgeErrorMsg",{orderAge:r}))}else{if(!iscCore.isVoid(e)){var t=a.getWizardModel("isOrgRoleNode");var d={Item:{BarCode:{BarCodeData:e}}};d.Item.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;d.Item.IsOrgRoleNode=t;d.Item.DraftOrderFlag=this.model.getCompleteOrderDetails.Order.DraftOrderFlag;d.Item.ShipNode=s.getFromContext("storeName");m.callMashup(this,"vc_getCompleteItemList",d,{}).then(this.handleItemScan.bind(this),angular.noop)}else{p.showErrorMessage(c.translate("viewcartdetails.MSG_InvalidBarCodeData"))}}},uiOpenProductSearch:function(i){var e=0;maxOrderAge=this.model.getRuleDetails_OrderAge.Rules.RuleSetValue;e=L.getOrderAge(this.model.getCompleteOrderDetails.Order.OrderDate);if(e>maxOrderAge){p.showErrorMessage(c.translate("orderModification.orderAgeErrorMsg",{orderAge:e}))}else{var t=this;var r=true;if(this.ui.isScreenDirty){p.showConfirmationMessage(c.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){if(!iscCore.isVoid(i)){var r={input:i};a.gotoCustomPage("productSearch",r,{wizardPageCssClass:"fullscreen-modal"})}else{p.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}}else{t.model.searchInput=""}})}else{if(!iscCore.isVoid(i)){var d={input:i,searchContext:"scanInStore"};a.gotoCustomPage("addItems",d,{wizardPageCssClass:"fullscreen-modal"})}else{p.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}}}},handleItemScan:function(e){var r=m.getMashupOutput(e,"vc_getCompleteItemList");if(!iscCore.isVoid(r)&&!iscCore.isVoid(r.Order.OrderLines)){if(!(this.model.orderLineList.OrderLineList.TotalNumberOfRecords=="0")){L.updateOrderLines(r,this.model.orderLineList)}else{this.model.orderLineList.OrderLineList.OrderLine=[];this.model.orderLineList.OrderLineList.OrderLine=r.Order.OrderLines.OrderLine;this.model.orderLineList.OrderLineList.TotalNumberOfRecords=r.Order.OrderLines.TotalNumberOfRecords}this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);this.setOrderTotalAfterModificationMsg(a.getWizardModel("orderPricingModel"),this.model.getCompleteOrderDetails);this.ui.oLineShownCount=this.model.orderLineList.OrderLineList.OrderLine.length;d(function(){var e=document.getElementById("orderLinesHolder");e.scrollTop=e.scrollHeight},0)}else{var i={input:this.model.scanItemInput.itemID,searchContext:"scanInStore"};a.gotoCustomPage("addItems",i,{wizardPageCssClass:"fullscreen-modal"})}this.model.scanItemInput.itemID="";o.editOrderDetails.$setPristine()},uihandleScreenDirty:function(){p.showErrorMessage(c.translate("globals.MSG_SCREEN_ERRORS"))},handleWizardBack:function(){var e=a.isFirstPage();var r=o.editOrderDetails.$dirty;var i=this.model.getCompleteOrderDetails;if(r||!iscCore.isVoid(i)&&i.Order.HasPendingChanges==="Y"){var t=null;if(e){t=c.translate("editorderdetails.MSG_OrderHasPendingChanges");var d=this;p.showConfirmationMessage(t).then(function(e){if(e==="YES"){if(!iscCore.isVoid(i)&&i.Order.HasPendingChanges==="Y"){var r={Order:{OrderHeaderKey:d.ui.orderHeaderKeyToEdit}};m.callMashup(d,"store.views.order.modification.resetOrderPendingChanges",r,{}).then(d.handleOrderResetChanges.bind(d),angular.noop)}else{a.closeWizard()}}})}else{p.showConfirmationMessage(c.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){a.gotoPreviousPage(true)}})}return true}else if(e){t=c.translate("editorderdetails.MSG_CloseWithNoPendingChanges");p.showConfirmationMessage(t).then(function(e){if(e==="YES"){a.closeWizard()}});return true}else{return false}},handleWizardExit:function(){var e=c.translate("order.WarningMessage_Cancel");p.showConfirmationMessage(e).then(function(e){if(e==="YES"){a.exitWizard()}},function(e){});return true},uiOpenConfirmationForGiftDelete:function(){var r=this;p.showConfirmationMessage("viewcartdetails.LABEL_GiftDeleteConfirmation").then(function(e){r.removeGiftOptionsForOrder(e)})},uiConfirmDeletion:function(i){var t=this;var e={modalInput:function(){return{orderLine:i,orderHeaderKey:t.model.getCompleteOrderDetails.Order.OrderHeaderKey}}};if(i.LineSeqNumber>this.ui.orderLinesCountWizardLoad){this.ui.deletedOrderLineKey=i.OrderLineKey;p.showConfirmationMessage(c.translate("miniCart.LABEL_Delete_line")).then(function(e){if(iscCore.isBooleanTrue(e)){var r={};r.Order={};r.Order.OrderHeaderKey=t.model.getCompleteOrderDetails.Order.OrderHeaderKey;r.Order.OrderLines={};r.Order.OrderLines.OrderLine={};r.Order.OrderLines.OrderLine.OrderLineKey=i.OrderLineKey;m.callMashup(t,"store.views.order.modification.cancelNewOrderLines",r,{}).then(t.cancelNewOrderLineAPICallBack.bind(t),t.cancelOrderLineAPIErrorCallBack.bind(t))}})}else{p.openModal("store.views.order.cancel.cancelorderline",e).then(function(e){if(e.cancelOrderLineAPIOutput.cancelOrderLineAPISuccess){var r=e.cancelOrderLineAPIOutput.order;if(!iscCore.isVoid(r)&&!iscCore.isVoid(r.Order.OrderLines)){if(!(this.model.orderLineList.OrderLineList.TotalNumberOfRecords=="0")){L.updateOrderLines(r,this.model.orderLineList)}this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);this.setOrderTotalAfterModificationMsg(a.getWizardModel("orderPricingModel"),this.model.getCompleteOrderDetails);this.ui.oLineShownCount=this.model.orderLineList.OrderLineList.OrderLine.length;d(function(){var e=document.getElementById("orderLinesHolder");e.scrollTop=e.scrollHeight},0)}}}.bind(this),angular.noop)}},cancelNewOrderLineAPICallBack:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.cancelNewOrderLines");if(!iscCore.isVoid(r)){if(!(this.model.orderLineList.OrderLineList.TotalNumberOfRecords=="0")){L.updateOrderLines(r,this.model.orderLineList)}this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);this.setOrderTotalAfterModificationMsg(a.getWizardModel("orderPricingModel"),this.model.getCompleteOrderDetails);this.ui.oLineShownCount=this.model.orderLineList.OrderLineList.OrderLine.length;d(function(){var e=document.getElementById("orderLinesHolder");e.scrollTop=e.scrollHeight},0)}for(var i=0;i<this.model.orderLineList.OrderLineList.OrderLine.length;i++){if(this.model.orderLineList.OrderLineList.OrderLine[i].OrderLineKey===this.ui.deletedOrderLineKey){this.model.orderLineList.OrderLineList.OrderLine.splice(i,1);this.model.orderLineList.OrderLineList.TotalNumberOfRecords-=1;break}}},cancelOrderLineAPICallBack:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.cancelOrderLines");if(!iscCore.isVoid(r)){if(!(this.model.orderLineList.OrderLineList.TotalNumberOfRecords=="0")){L.updateOrderLines(r,this.model.orderLineList)}this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);this.setOrderTotalAfterModificationMsg(a.getWizardModel("orderPricingModel"),this.model.getCompleteOrderDetails);this.ui.oLineShownCount=this.model.orderLineList.OrderLineList.OrderLine.length;d(function(){var e=document.getElementById("orderLinesHolder");e.scrollTop=e.scrollHeight},0)}for(var i=0;i<this.model.orderLineList.OrderLineList.OrderLine.length;i++){if(this.model.orderLineList.OrderLineList.OrderLine[i].OrderLineKey===this.ui.deletedOrderLineKey){this.model.orderLineList.OrderLineList.OrderLine.splice(i,1);this.model.orderLineList.OrderLineList.TotalNumberOfRecords-=1;break}}},cancelOrderLineAPIErrorCallBack:function(e){var r=e.Errors.Error[0].ErrorDescription;var i=e.Errors.Error[0].ErrorCode;if(c.hasKey("apierror."+i)){r=c.translate("apierror."+i);p.showErrorMessage(r,null,null)}else{p.showErrorMessage(r,null,null)}},deleteOrderLine:function(e,r){if(e==="YES"){var i={Order:{OrderHeaderKey:this.model.getCompleteOrderDetails.Order.OrderHeaderKey,OrderLines:[{OrderLine:{Action:"REMOVE",OrderLineKey:r.OrderLineKey}}]}};m.callMashup(this,"vc_modifyFulfillmentOptionsForDeletion",i,{}).then(this.updateOrderLineList.bind(this),angular.noop)}},updateOrderLineList:function(e){var r=m.getMashupOutput(e,"vc_modifyFulfillmentOptionsForDeletion");L.updateOrderLines(r,this.model.orderLineList);this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);var i=c.translate("viewcartdetails.aria_deleteOrderLineSuccessMessage");p.showA11YAlertMessage(i);if(this.model.orderLineList.OrderLineList.TotalNumberOfRecords==0){this.model.giftModel={};a.setWizardModel("giftOptionsForOrderModel",{});this.ui.isOrderGift=""}},removeGiftOptionsForOrder:function(e){if(e==="YES"){var r=this.model.orderLineList.OrderLineList.OrderLine;this.model.giftModel={};a.setWizardModel("giftOptionsForOrderModel",{});this.ui.isOrderGift="";var i=L.prepareChangeOrderInputForGiftRemoval(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r);m.callMashup(this,"store.views.order.modification.changeOrderForGift",i,{}).then(this.updateGiftMessageRemovalForOrder.bind(this),angular.noop)}},uiOpenGiftOptionsForOrder:function(){var r=this;var e=L.checkIfAnyOrderlineIsGift(this.model.orderLineList);if(e){p.showConfirmationMessage("viewcartdetails.LABEL_GiftOrderConfirmation").then(function(e){r.overRideGiftOptions(e)})}else{this.overRideGiftOptions("YES")}},uiOpenGiftOptionsForOrderLine:function(r){var i=this;var e=null;if(r.GiftFlag=="Y"){var t=L.getGiftInstructionForOrderLine(r);var d=null;if(t!==null){d=t.InstructionText}var o=null;if(r.PersonInfoMarkFor&&r.PersonInfoMarkFor.FirstName){o=r.PersonInfoMarkFor.FirstName}e={gift:{giftFlag:"Y",giftWrap:r.ItemDetails.PrimaryInformation.AllowGiftWrap,giftRecipient:o,giftMessage:d,giftWrapChecked:r.GiftWrap,showRemoveGift:"Y"}}}else{e={gift:{giftWrap:r.ItemDetails.PrimaryInformation.AllowGiftWrap,giftWrapChecked:"N"}}}var n={modalInput:function(){return e}};p.openModal("store.views.common.gift.giftoptions",n,{}).then(function(e){if(e.data!==null&&e.data!==undefined){i.applyGiftOptionsForOrderLine.call(i,e.data,r)}},angular.noop)},overRideGiftOptions:function(e){if(e==="YES"){var r=this;this.model.giftModel=a.getWizardModel("giftOptionsForOrderModel");var i={};i.gift={};if(!iscCore.isVoid(this.model.giftModel)){i.gift.giftRecipient=this.model.giftModel.giftRecipient;i.gift.giftMessage=this.model.giftModel.giftMessage;i.gift.giftWrapChecked=this.model.giftModel.giftWrapChecked}var t={modalInput:function(){return i}};p.openModal("store.views.common.gift.giftoptions",t,{}).then(function(e){if(e!==null&&e.data!==null&&e.data!==undefined){r.applyGiftOptionsForOrder.call(r,e.data)}},angular.noop)}},applyGiftOptionsForOrder:function(e){var r=[];r=this.model.orderLineList.OrderLineList.OrderLine;this.model.giftModel=e;a.setWizardModel("giftOptionsForOrderModel",e);this.ui.isOrderGift=e.giftFlag;var i=L.prepareChangeOrderInputForGift(e,this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r);m.callMashup(this,"store.views.order.modification.changeOrderForGift",i,{}).then(this.updateOrderWithGiftMessage.bind(this),angular.noop)},applyGiftOptionsForOrderLine:function(e,r){var i=[];i[0]=r;if(!iscCore.isVoid(e.removeGift)&&e.removeGift==="Y"){var t=L.prepareChangeOrderInputForGiftRemoval(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,i);t.Order.OrderLines.OrderLine[0].Instructions={};t.Order.OrderLines.OrderLine[0].Instructions.Reset="Y";m.callMashup(this,"store.views.order.modification.changeOrderForGift",t,{}).then(this.updateOrderLineAfterGiftRemoval.bind(this),angular.noop)}else{var t=L.prepareChangeOrderInputForGift(e,this.model.getCompleteOrderDetails.Order.OrderHeaderKey,i);m.callMashup(this,"store.views.order.modification.changeOrderForGift",t,{}).then(this.updateOrderLineWithGiftMessage.bind(this),angular.noop)}},updateOrderLineAfterGiftRemoval:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.changeOrderForGift");L.updateOrderLines(r,this.model.orderLineList);if(this.model.orderLineList.OrderLineList.OrderLine.length===1){this.model.giftModel={};a.setWizardModel("giftOptionsForOrderModel",{});this.ui.isOrderGift=""}},updateOrderLineWithGiftMessage:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.changeOrderForGift");L.updateOrderLines(r,this.model.orderLineList)},updateOrderWithGiftMessage:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.changeOrderForGift");if(!iscCore.isVoid(r.Order.OrderLines)&&!iscCore.isVoid(r.Order.OrderLines.OrderLine)){if(this.model.orderLineList.OrderLineList.OrderLine.length===r.Order.OrderLines.OrderLine.length){this.replaceCompleteOrderLineList(r)}else{L.updateOrderLines(r,this.model.orderLineList)}}this.ui.isOrderGift="Y"},updateGiftMessageRemovalForOrder:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.changeOrderForGift");L.updateOrderLines(r,this.model.orderLineList);this.ui.isOrderGift=""},replaceCompleteOrderLineList:function(e){if(!iscCore.isVoid(e.Order.OrderLines)&&!iscCore.isVoid(e.Order.OrderLines.OrderLine)){delete this.model.orderLineList.OrderLineList["OrderLine"];this.model.orderLineList.OrderLineList.OrderLine=[];this.model.orderLineList.OrderLineList.OrderLine=e.Order.OrderLines.OrderLine}},uiCouponApplied:function(e){this.model.getCompleteOrderDetails=e;o.editOrderDetails.$setPristine()},uiValidateQuantityAndUpdate:function(e,r){var i=n.NUMBER_FORMATS;var t=r.OrderLineTranQuantity.OrderedQty;t=t.replace(i.GROUP_SEP,"");r.OrderLineTranQuantity.OrderedQty=t;if(e.oldQty!==t){e.oldQty=t;if(typeof t=="string")t=parseInt(t,10);if(t===0){p.showErrorMessage(c.translate("viewcartdetails.MSG_InvalidQty"));r.OrderLineTranQuantity.OrderedQty=r.OrderedQty;r.showQtyUpdate="N"}else if(t<r.OrderedQty){if(t<=r.AvailableQtyForCancelAndStopDelivery){this.handleChangeQuantity(r,"decreaseQty")}else{p.showErrorMessage(c.translate("orderModification.MSG_QuantityCannotBeChanged"));r.OrderLineTranQuantity.OrderedQty=r.OrderedQty;r.showQtyUpdate="N"}}else if(t>r.OrderedQty){this.handleChangeQuantity(r,"increaseQty")}}},handleChangeQuantity:function(r,i){var e=this.getItemAvailabilityForStoreApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r);var t=this;m.callMashup(this,"store.views.order.modification.getItemAvailabilityForChangedQty",e,{}).then(function(e){t.handleItemAvailabilityForQtyChange(e,r,i)},angular.noop)},handleItemAvailabilityForQtyChange:function(e,r,i){var t=m.getMashupOutput(e,"store.views.order.modification.getItemAvailabilityForChangedQty");if(!iscCore.isVoid(t.Promise)){if(t.Promise.IsItemQtyAvailable==="N"){p.showErrorMessage(c.translate("viewcartdetails.OrderLineQtyChangeError"));var d=t.Promise.OrderLineKey;var o=[];o=this.model.orderLineList.OrderLineList.OrderLine;for(var n=0;n<o.length;n++){if(o[n].OrderLineKey==d){o[n].OrderLineTranQuantity.OrderedQty=o[n].OrderedQty;o[n].showQtyUpdate="N";break}}}else{var s=this.getChangeOrderWithPendingChangesInput(r,i,t);if(r.LineSeqNumber>this.ui.orderLinesCountWizardLoad){m.callMashup(this,"store.views.order.modification.changeQty.newLineChangeOrder",s,{}).then(this.handleOrderLineQtyChangeForNewLine.bind(this),angular.noop)}else{m.callMashup(this,"store.views.order.modification.changeQty.modifyFulfillmentOptions",s,{}).then(this.handleOrderLineQtyChange.bind(this),angular.noop)}}}},getChangeOrderWithPendingChangesInput:function(e,r,i){var t="";var d="";var o=L.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,e.OrderLineKey);o.Order.PendingChanges={RecordPendingChanges:"Y"};if(e.DeliveryMethod=="SHP"){o.Order.OrderLines.OrderLine[0].EarliestShipDate=i.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability.EarliestShipDate}if(e.DeliveryMethod=="PICK"){o.Order.OrderLines.OrderLine[0].ReqShipDate=i.Promise.PromiseLines.PromiseLine[0].Availabilities.Availability.ProductAvailDate}if(r==="decreaseQty"){t=c.translate("orderModification.MSG_QuantityDecreased",{itemId:e.ItemDetails.ItemID});d=L.addNote(t,"YCD_DECREASE_LINE_QTY")}else if(r==="increaseQty"){t=c.translate("orderModification.MSG_QuantityIncreased",{itemId:e.ItemDetails.ItemID});d=L.addNote(t,"YCD_INCREASE_LINE_QTY")}o.Order.Notes=[];o.Order.Notes.push(d);o.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};o.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.OrderedQty=e.OrderLineTranQuantity.OrderedQty;return o},uiShowUpdateButton:function(e,r){var i=n.NUMBER_FORMATS;var t=r.OrderLineTranQuantity.OrderedQty;if(!iscCore.isVoid(t))t=t.replace(i.GROUP_SEP,"");if(!iscCore.isVoid(t)&&e.oldQty!==t)r.showQtyUpdate="Y";else r.showQtyUpdate="N"},uiHideUpdateButton:function(e){e.showQtyUpdate="N"},getItemAvailabilityForStoreApiInput:function(e,r){var i={Promise:{OrderHeaderKey:e,OrderLineKey:r.OrderLineKey,PromiseLines:{PromiseLine:[{ItemID:r.ItemDetails.ItemID,UnitOfMeasure:r.ItemDetails.UnitOfMeasure,RequiredQty:r.OrderLineTranQuantity.OrderedQty,Quantity:r.OrderLineTranQuantity.OrderedQty,OrderLine:{OrderLineKey:r.OrderLineKey,DeliveryMethod:r.DeliveryMethod}}]}}};if(r.DeliveryMethod==="SHP"){i.Promise.ComputeShpAvl="Y"}else if(r.DeliveryMethod==="PICK"){i.Promise.ComputePickupAvl="Y";i.Promise.ShipNode=r.Shipnode.ShipNode}else if(r.DeliveryMethod==="CARRY"){i.Promise.ComputeCarryAvl="Y";i.Promise.ShipNode=r.Shipnode.ShipNode}return i},uiGetOrderLineListNext:function(){if(this.ui.oLineShownCount<=this.model.orderLineList.OrderLineList.OrderLine.length){this.ui.oLineShownCount+=5}},uiOLineScrollActionValidator:function(){return true},uiCheckDirtyStateBeforePayment:function(){var e=o.editOrderDetails.$dirty;if(e){var r=this;p.showConfirmationMessage(c.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){r.uiSavePendingChanges()}})}else{this.uiSavePendingChanges()}},uiValidateOrderBeforePayment:function(){var e={};e.Order={};e.Order.OrderLines={};e.Order.OrderLines.OrderLine=this.model.orderLineList.OrderLineList.OrderLine;if(L.orderHasOnlyCarryLines(e)){m.callMashup(this,"store.views.order.modification.changeOrderToApplyPendingChanges",{Order:{OrderHeaderKey:this.model.getCompleteOrderDetails.Order.OrderHeaderKey}},{}).then(this.showPendingChangesSuccess.bind(this),angular.noop)}else{var r=L.checkIfOrderHasShipLines(this.model.orderLineList.OrderLineList.OrderLine);var r=L.checkIfOrderHasShipLines(this.model.orderLineList.OrderLineList.OrderLine);var i=true;if(r){var t=this.model.getCompleteOrderDetails;if(iscCore.isVoid(t.Order.PersonInfoShipTo)){p.showErrorMessage(c.translate("viewcartdetails.NoShipToAddressOline"));i=false}}if(i){if(!L.orderHasMixedSettledLines(this.model.orderLineList.OrderLineList.OrderLine)){var d={};d.Order={};d.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;var o=m.getMashupRefObj(this,"store.views.order.modification.changeOrderToApplyPendingChanges",d);var n=m.getMashupRefObj(this,"store.views.order.modification.getCompleteOrderLineList_CheckAvailability",d);var s=[o,n];m.callMashups(this,s,{}).then(this.handleSavePendingChanges.bind(this),angular.noop)}else{var a={};a.Order={};a.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;var l={};l.Order={};l.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;l.Order.OrderLines={};l.Order.OrderLines.OrderLine=[];for(var O=0;O<this.model.orderLineList.OrderLineList.OrderLine.length;O++){var u=this.model.orderLineList.OrderLineList.OrderLine[O];if(u.OrderLineTranQuantity&&u.OrderLineTranQuantity.OrderedQty&&u.OrderLineTranQuantity.SettledQuantity&&u.OrderLineTranQuantity.OrderedQty!=u.OrderLineTranQuantity.SettledQuantity){var h=l.Order.OrderLines.OrderLine.length;l.Order.OrderLines.OrderLine[h]={};l.Order.OrderLines.OrderLine[h].OrderLineKey=u.OrderLineKey;l.Order.OrderLines.OrderLine[h].OrderLineTranQuantity={};l.Order.OrderLines.OrderLine[h].OrderLineTranQuantity.SettledQuantity=u.OrderLineTranQuantity.OrderedQty}}var o=m.getMashupRefObj(this,"store.views.order.modification.changeOrderToApplyPendingChanges",{Order:{OrderHeaderKey:this.model.getCompleteOrderDetails.Order.OrderHeaderKey}});var f=m.getMashupRefObj(this,"vc_updateSettledQtyOnAllLines",l);var n=m.getMashupRefObj(this,"store.views.order.modification.getCompleteOrderLineList_CheckAvailability",a);var s=[o,f,n];m.callMashups(this,s,{}).then(this.handleSavePendingChanges.bind(this),angular.noop)}}}},uiSavePendingChangesBeforeChangeDeliveryMethod:function(){var e={};e.Order={};e.Order.OrderLines={};e.Order.OrderLines.OrderLine=this.model.orderLineList.OrderLineList.OrderLine;if(L.orderHasOnlyCarryLines(e)){m.callMashup(this,"store.views.order.modification.changeOrderToApplyPendingChanges",{Order:{OrderHeaderKey:this.model.getCompleteOrderDetails.Order.OrderHeaderKey}},{}).then(this.showPendingChangesSuccess.bind(this),angular.noop)}else{var r=L.checkIfOrderHasShipLines(this.model.orderLineList.OrderLineList.OrderLine);var r=L.checkIfOrderHasShipLines(this.model.orderLineList.OrderLineList.OrderLine);var i=true;if(r){var t=this.model.getCompleteOrderDetails;if(iscCore.isVoid(t.Order.PersonInfoShipTo)){p.showErrorMessage(c.translate("viewcartdetails.NoShipToAddressOline"));i=false}}if(i){if(!L.orderHasMixedSettledLines(this.model.orderLineList.OrderLineList.OrderLine)){var d={};d.Order={};d.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;var o=m.getMashupRefObj(this,"store.views.order.modification.changeOrderToApplyPendingChanges",d);var n=m.getMashupRefObj(this,"store.views.order.modification.getCompleteOrderLineList_CheckAvailability",d);var s=[o,n];m.callMashups(this,s,{}).then(this.handleSavePendingChangesBeforeChangeDeliveryMethod.bind(this),angular.noop)}else{var a={};a.Order={};a.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;var l={};l.Order={};l.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;l.Order.OrderLines={};l.Order.OrderLines.OrderLine=[];for(var O=0;O<this.model.orderLineList.OrderLineList.OrderLine.length;O++){var u=this.model.orderLineList.OrderLineList.OrderLine[O];if(u.OrderLineTranQuantity&&u.OrderLineTranQuantity.OrderedQty&&u.OrderLineTranQuantity.SettledQuantity&&u.OrderLineTranQuantity.OrderedQty!=u.OrderLineTranQuantity.SettledQuantity){var h=l.Order.OrderLines.OrderLine.length;l.Order.OrderLines.OrderLine[h]={};l.Order.OrderLines.OrderLine[h].OrderLineKey=u.OrderLineKey;l.Order.OrderLines.OrderLine[h].OrderLineTranQuantity={};l.Order.OrderLines.OrderLine[h].OrderLineTranQuantity.SettledQuantity=u.OrderLineTranQuantity.OrderedQty}}var o=m.getMashupRefObj(this,"store.views.order.modification.changeOrderToApplyPendingChanges",{Order:{OrderHeaderKey:this.model.getCompleteOrderDetails.Order.OrderHeaderKey}});var f=m.getMashupRefObj(this,"vc_updateSettledQtyOnAllLines",l);var n=m.getMashupRefObj(this,"store.views.order.modification.getCompleteOrderLineList_CheckAvailability",a);var s=[o,f,n];m.callMashups(this,s,{}).then(this.handleSavePendingChangesBeforeChangeDeliveryMethod.bind(this),angular.noop)}}}},goToPaymentPage:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.getCompleteOrderLineList_CheckAvailability");if(r.OrderLineList.IsAnyLineUnAvailable=="N"){a.gotoCustomPage("paymentCapture",{},{})}else{p.showErrorMessage(c.translate("viewcartdetails.UnAvailbleLines"))}},uiGetItemDetails:function(e,r){if(!iscCore.isVoid(e)){var i={input:e};a.gotoCustomPage("addItems",i,{})}},uiAddOrEditAddress:function(e,r){var i=this;var t={};t.Mode=e;t.Context="showDefaultshipto";if(e=="Edit"){if(!iscCore.isVoid(r.PersonInfoShipTo)){t.PersonInfo=angular.copy(r.PersonInfoShipTo)}else{t.PersonInfo=angular.copy(this.model.getCompleteOrderDetails.Order.PersonInfoShipTo)}}if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo){t.hideShipaddress=true}else{if(e=="Add"){t.PersonInfo={}}t.PersonInfo.IsDefaultShippingAddress="N"}var d={modalInput:function(){return t}};p.openModal("store.views.common.orderaddress.orderaddresspopup",d,{}).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){i.onAddressAdditionOrEdit.call(i,e.data,r)}},angular.noop)},onAddressAdditionOrEdit:function(e,r){var i=angular.copy(e);delete i.IsDefaultShippingAddress;delete i.IsDefaultBillingAddress;var t=L.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.OrderedQty=r.OrderLineTranQuantity.OrderedQty;t.Order.OrderLines.OrderLine[0].PersonInfoShipTo={};t.Order.OrderLines.OrderLine[0].PersonInfoShipTo=i;if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo||e.IsDefaultShippingAddress==="Y"){t.Order.PersonInfoShipTo=i;if(!this.model.getCompleteOrderDetails.Order.BillToID){t.Order.CustomerFirstName=i.FirstName;t.Order.CustomerLastName=i.LastName;t.Order.CustomerEMailID=i.EMailID;t.Order.CustomerZipCode=i.ZipCode}}var d=this.getItemAvailabilityForStoreApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r);d.Promise.PromiseLines.PromiseLine[0].ShipToAddress=i;d.Promise.modifyFulfillmentOptionsInput=t;m.callMashup(this,"store.views.order.modification.getItemAvailabilityForStore",d,{}).then(this.handleShippingLineAddress.bind(this),angular.noop)},uiIdentifyCustomerPopup:function(e){var r={};var i=this;r.Mode="Identify";var t={modalInput:function(){return r}};p.openModal("store.views.common.customer.customerpopup",t,{}).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){i.onCustomerIdentification.call(i,e.data)}},angular.noop)},onCustomerIdentification:function(e){var r=e.customerModel;var i={};i.Order={};i.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;i.Order.BillToID=r.Customer.CustomerID;if(!iscCore.isVoid(e.addressSelected)){i.Order.PersonInfoShipTo={};i.Order.PersonInfoShipTo=angular.copy(e.addressSelected.PersonInfo)}if(r.Customer.CustomerType==="02"||r.Customer.CustomerContactList&&r.Customer.CustomerContactList.CustomerContact&&r.Customer.CustomerContactList.CustomerContact.length===1){i.Order.CustomerContactID=r.Customer.CustomerContactList.CustomerContact[0].CustomerContactID;i.Order.CustomerFirstName=r.Customer.CustomerContactList.CustomerContact[0].FirstName;i.Order.CustomerLastName=r.Customer.CustomerContactList.CustomerContact[0].LastName;i.Order.CustomerEMailID=r.Customer.CustomerContactList.CustomerContact[0].EMailID;if(!iscCore.isVoid(e.addressSelected)){i.Order.CustomerZipCode=e.addressSelected.PersonInfo.ZipCode}}m.callMashup(this,"store.views.order.modification.customer_modifyFulfillmentOptions",i,{}).then(this.handleModifyFulfillmentOptionsForCustomer.bind(this),angular.noop)},uiEditAddressInCustomerPanel:function(){var r=this;var e={};e.Mode="Edit";e.PersonInfo=angular.copy(this.model.getCompleteOrderDetails.Order.PersonInfoShipTo);e.hideShipaddress=true;var i={modalInput:function(){return e}};var t=this.model.getCompleteOrderDetails.Order.MaxOrderStatus;if(!iscCore.isVoid(t)){if(t.indexOf(".")>0){t=t.substring(0,t.indexOf("."))}if(t>=1500){p.showInfoMessage(c.translate("orderModification.MSG_NoOrderAddressChange"));return}}p.openModal("store.views.common.orderaddress.orderaddresspopup",i,{}).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){r.handleEditAddressInCustomerPanel.call(r,e.data)}},angular.noop)},handleEditAddressInCustomerPanel:function(e){var r=angular.copy(e);delete r.IsDefaultShippingAddress;var i={};i.Order={};i.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;i.Order.PersonInfoShipTo={};i.Order.PersonInfoShipTo=r;if(!this.model.getCompleteOrderDetails.Order.BillToID){i.Order.CustomerFirstName=r.FirstName;i.Order.CustomerLastName=r.LastName;i.Order.CustomerEMailID=r.EMailID;i.Order.CustomerZipCode=r.ZipCode}m.callMashup(this,"store.views.order.modification.customer_modifyFulfillmentOptions",i,{}).then(this.handleModifyFulfillmentOptionsForCustomer.bind(this),angular.noop)},uiOpenOverridePriceModal:function(r){var i=this;var e={};e.price={};e.price.listPrice=r.LinePriceInfo.ListPrice;e.price.unitPrice=r.LinePriceInfo.UnitPrice;e.price.Currency=this.model.getCompleteOrderDetails.Order.PriceInfo.Currency;var t={modalInput:function(){return e}};p.openModal("store.views.common.priceoverride.priceoverride",t,{}).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){i.onPriceOverride.call(i,e.data,r)}},angular.noop)},onPriceOverride:function(e,r){var i=L.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);i.Order.OrderLines.OrderLine[0].LinePriceInfo={};i.Order.OrderLines.OrderLine[0].LinePriceInfo.ListPrice=r.LinePriceInfo.ListPrice;i.Order.OrderLines.OrderLine[0].LinePriceInfo.UnitPrice=e.newprice;i.Order.OrderLines.OrderLine[0].LinePriceInfo.IsPriceLocked="Y";L.addPriceOverrideDefaultNote(i,e.reason);m.callMashup(this,"store.views.order.modification.ovp_modifyFulfillmentOptions",i,{}).then(this.handlePriceOverrideApiCall.bind(this),angular.noop)},handlePriceOverrideApiCall:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.ovp_modifyFulfillmentOptions");this.handleModifyFulfillmentOptionsApiOutput(r)},handleModifyFulfillmentOptionsForCustomer:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.customer_modifyFulfillmentOptions");this.handleModifyFulfillmentOptionsApiOutput(r)},handleModifyFulfillmentOptionsOutput:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.modifyFulfillmentOptions");this.handleModifyFulfillmentOptionsApiOutput(r);this.model.couponInput.couponID=""},handleChangeOrderForNewLinesOutput:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.changeOrderForNewLines");this.handleModifyFulfillmentOptionsApiOutput(r)},handleModifyFulfillmentOptionsApiOutput:function(e){L.updateOrderLines(e,this.model.orderLineList);this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(e,this.model.getCompleteOrderDetails);this.setOrderTotalAfterModificationMsg(a.getWizardModel("orderPricingModel"),this.model.getCompleteOrderDetails)},handleOrderLineQtyChange:function(e){this.handleItemAvailabilityAndOrderModification(e);var r=c.translate("viewcartdetails.aria_updateOrderLineQtySuccessMessage");p.showA11YAlertMessage(r)},handleOrderLineQtyChangeForNewLine:function(e){this.handleItemAvailabilityAndOrderModificationForNewLine(e);var r=c.translate("viewcartdetails.aria_updateOrderLineQtySuccessMessage");p.showA11YAlertMessage(r)},handleShippingLineAddress:function(e){this.handleItemAvailabilityAndOrderModification(e)},handleItemAvailabilityAndOrderModification:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.changeQty.modifyFulfillmentOptions");L.updateOrderLines(r,this.model.orderLineList);this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);if(iscCore.isVoid(this.model.getCompleteOrderDetails.PromotionsApplied)){this.ui.showCouponScanField=false}this.setOrderTotalAfterModificationMsg(a.getWizardModel("orderPricingModel"),this.model.getCompleteOrderDetails);o.editOrderDetails.$setPristine()},handleItemAvailabilityAndOrderModificationForNewLine:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.changeQty.newLineChangeOrder");L.updateOrderLines(r,this.model.orderLineList);this.model.getCompleteOrderDetails=L.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);if(iscCore.isVoid(this.model.getCompleteOrderDetails.PromotionsApplied)){this.ui.showCouponScanField=false}this.setOrderTotalAfterModificationMsg(a.getWizardModel("orderPricingModel"),this.model.getCompleteOrderDetails);o.editOrderDetails.$setPristine()},uiOpenStoreSearch:function(r){var i=this;var e=s.getFromContext("storeAddress").ShipNodePersonInfo;var t=this.model.getRuleDetails_EditOrderAfterSchedule.Rules.RuleSetValue;if(r.MaxLineStatus>="1500"&&r.MaxLineStatus<"3700"){if(t=="Y"){p.showConfirmationMessage("orderModification.MSG_ConfirmSaveAndUnschedule").then(function(e){if(e==="YES"){if(i.model.getCompleteOrderDetails.Order.HasPendingChanges==="Y"){i.ui.saveOrderBeforeUnschedule=true}i.ui.chagePickupStore=true;i.ui.orderlineModel=r;i.uiSavePendingChangesBeforeChangeDeliveryMethod()}else{return}})}else{p.showErrorMessage(c.translate("orderModification.MSG_CannotModifyLine"));return}}else if(r.MaxLineStatus>="3700"){p.showErrorMessage(c.translate("orderModification.MSG_CannotModifyLine"));return}else{i.ui.orderlineModel=r;i.openStoreSearchAfterSavingPendingChanges()}},openStoreSearchAfterSavingPendingChanges:function(){var r=this;if(r.ui.saveOrderBeforeUnschedule==true){r.ui.saveOrderBeforeUnschedule=false}var e={modalInput:function(){return{inputData:{callingMode:"CARTDETAILS",orderLine:r.ui.orderlineModel}}}};p.openModal("store.views.common.storesearch.storesearch",e,{}).then(function(e){r.afterStoreSelection.call(r,e.data,r.ui.orderlineModel)},angular.noop)},uiValidateQuantity:function(e,r,i,t){if(!iscCore.isVoid(r)&&r.iscDatatypeValidator)return e;else var d=!isNaN(t);if(!iscCore.isBooleanTrue(d)){e.booleanResponse=!isNaN(t);e.errorMesssage=c.translate("globals.ERROR_invalid_input")}return e},afterStoreSelection:function(e,r){var i=L.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);i.Order.OrderLines.OrderLine[0].ShipNode=e.selectedStore.ShipNode;m.callMashup(this,"store.views.order.modification.modifyFulfillmentOptions",i,{}).then(this.handleModifyFulfillmentOptionsOutput.bind(this),angular.noop)},uiChangeDeliveryMethod:function(r){var i=this;var e=this.model.getRuleDetails_EditOrderAfterSchedule.Rules.RuleSetValue;if(r.MaxLineStatus>="1500"&&r.MaxLineStatus<"3700"){if(e=="Y"){p.showConfirmationMessage("orderModification.MSG_ConfirmSaveAndUnschedule").then(function(e){if(e==="YES"){if(i.model.getCompleteOrderDetails.Order.HasPendingChanges==="Y"){i.ui.saveOrderBeforeUnschedule=true}i.ui.orderlineModel=r;i.uiSavePendingChangesBeforeChangeDeliveryMethod()}else{return}})}else{p.showErrorMessage(c.translate("orderModification.MSG_CannotModifyLine"));return}}else if(r.MaxLineStatus>="3700"){p.showErrorMessage(c.translate("orderModification.MSG_CannotModifyLine"));return}else{i.ui.orderlineModel=r;i.uiChangeDeliveryMethodForUnscheduledLines()}},uiChangeDeliveryMethodForUnscheduledLines:function(){var r=this;var e=false;if(r.ui.orderlineModel.LineSeqNumber>r.ui.orderLinesCountWizardLoad){e=true}var i={modalInput:function(){return{inputData:{OrderHeaderKey:r.model.getCompleteOrderDetails.Order.OrderHeaderKey,DraftOrderFlag:r.model.getCompleteOrderDetails.Order.DraftOrderFlag,orderLine:r.ui.orderlineModel,newOrderLine:e,orderPersonInfoShipTo:r.model.getCompleteOrderDetails.Order.PersonInfoShipTo}}}};p.openModal("store.views.common.fulfillment.fulfillmentoptions",i,{}).then(function(e){r.handleDeliveryMethodChange.call(r,e.data,r.ui.orderlineModel)},angular.noop)},uiAddComments:function(){var r=this;var e=angular.copy(this.model.getCompleteOrderDetails);var i={modalInput:function(){return e}};p.openModal("store.views.order.comments.comments",i,{}).then(function(e){r.model.getCompleteOrderDetails.Order.Notes.NumberOfNotes=e.NoteList.TotalNumberOfRecords},angular.noop)},uiChangeVariation:function(e){var r=this;var i=a.getWizardModel("orderModel");if(this.ui.isScreenDirty){p.showConfirmationMessage(c.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){}else{r.model.searchInput=""}})}else{if(!iscCore.isVoid(e)){var t={};t.OrderLine=e;var d={input:t,searchContext:"changeVariation"};a.gotoCustomPage("addItems",d,{wizardPageCssClass:"fullscreen-modal"})}else{p.showErrorMessage(c.translate("addItems.MSG_ProductSearchError"))}}},uiGetCssClassByOrderLineStatus:function(e){return L.getCssClassByOrderStatus(e)},uiSetDisplayStatus:function(e){e.DisplayStatus=L.getLineDisplayStatus(e)},handleDeliveryMethodChange:function(e,r){var i=e.newDelMethod;var t=L.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);t.Order.OrderLines.OrderLine[0].DeliveryMethod=i;if(i=="PICK"){t.Order.OrderLines.OrderLine[0].ShipNode=e.selectedStore.ShipNode;t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.SettledQuantity="0";if(!iscCore.isVoid(e.selectedStore.Availability.AvailableDate)){t.Order.OrderLines.OrderLine[0].ReqShipDate=e.selectedStore.Availability.AvailableDate}}else if(i=="SHP"){if(this.model.getRuleDetails_ChargeShipLines&&this.model.getRuleDetails_ChargeShipLines.Rules&&this.model.getRuleDetails_ChargeShipLines.Rules.RuleSetValue=="N"){t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.SettledQuantity="0"}if(!iscCore.isVoid(e.EarliestShipDate)){t.Order.OrderLines.OrderLine[0].EarliestShipDate=e.EarliestShipDate}if(!iscCore.isVoid(e.personInfoShipTo)){t.Order.OrderLines.OrderLine[0].PersonInfoShipTo={};if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo||e.personInfoShipTo.IsDefaultShippingAddress==="Y"){t.Order.PersonInfoShipTo=e.personInfoShipTo;if(!this.model.getCompleteOrderDetails.Order.BillToID){t.Order.CustomerFirstName=e.personInfoShipTo.FirstName;t.Order.CustomerLastName=e.personInfoShipTo.LastName;t.Order.CustomerEMailID=e.personInfoShipTo.EMailID;t.Order.CustomerZipCode=e.personInfoShipTo.ZipCode}}delete e.personInfoShipTo.IsDefaultShippingAddress;delete e.personInfoShipTo.IsDefaultBillingAddress;t.Order.OrderLines.OrderLine[0].PersonInfoShipTo=e.personInfoShipTo;if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo){t.Order.PersonInfoShipTo=e.personInfoShipTo}}if(!iscCore.isVoid(e.selectedCarrier)){t.Order.OrderLines.OrderLine[0].CarrierServiceCode=e.selectedCarrier.CarrierServiceCode;t.Order.OrderLines.OrderLine[0].OrderDates={};t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate=[];t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[0]={};t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[0].CommittedDate=e.selectedCarrier.DeliveryStartDate;t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[0].DateTypeId="MIN_DELIVERY";t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[1]={};t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[1].CommittedDate=e.selectedCarrier.DeliveryEndDate;t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[1].DateTypeId="MAX_DELIVERY"}t.Order.OrderLines.OrderLine[0].ShipNode=""}else if(i=="CARRY"){t.Order.OrderLines.OrderLine[0].ShipNode=s.getFromContext("storeName");if(r.OrderLineTranQuantity.SettledQuantity==="0"){t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.SettledQuantity="0"}}if(!iscCore.isVoid(r.PersonInfoMarkFor)&&!iscCore.isVoid(r.PersonInfoMarkFor.PersonInfoKey)){t.Order.OrderLines.OrderLine[0].MarkForKey=r.PersonInfoMarkFor.PersonInfoKey}if(r.LineSeqNumber>this.ui.orderLinesCountWizardLoad&&r.MaxLineStatus<"1500"){m.callMashup(this,"store.views.order.modification.changeOrderForNewLines",t,{}).then(this.handleChangeOrderForNewLinesOutput.bind(this),angular.noop)}else{m.callMashup(this,"store.views.order.modification.modifyFulfillmentOptions",t,{}).then(this.handleModifyFulfillmentOptionsOutput.bind(this),angular.noop)}},uiSavePendingChanges:function(){if(this.model.getCompleteOrderDetails.Order.HasPendingChanges==="Y"){this.uiValidateOrderBeforePayment()}else{var e=c.translate("orderModification.MSG_NoModificationsToSave");p.showInfoMessage(e,{})}},handleSavePendingChanges:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.getCompleteOrderLineList_CheckAvailability");if(r.OrderLineList.IsAnyLineUnAvailable=="N"){this.showPendingChangesSuccess()}else{p.showErrorMessage(c.translate("viewcartdetails.UnAvailbleLines"))}},handleSavePendingChangesBeforeChangeDeliveryMethod:function(e){var r=m.getMashupOutput(e,"store.views.order.modification.getCompleteOrderLineList_CheckAvailability");if(r.OrderLineList.IsAnyLineUnAvailable=="N"){if(this.ui.chagePickupStore==true){this.ui.chagePickupStore=false;this.openStoreSearchAfterSavingPendingChanges()}else{this.openChageDeliveryMethodPopup()}}else{p.showErrorMessage(c.translate("viewcartdetails.UnAvailbleLines"))}},openChageDeliveryMethodPopup:function(){var e=this;if(this.ui.saveOrderBeforeUnschedule==true){this.ui.saveOrderBeforeUnschedule=false}this.uiChangeDeliveryMethodForUnscheduledLines()},showPendingChangesSuccess:function(){var e={options:{action:[{actionName:"OK",actionLabel:"orderModification.ACTION_ProceedToPayment"}]}};if(this.ui.isRefund==="Y"){e.options.action[0].actionLabel="orderModification.ACTION_ProceedToRefund";var r=c.translate("orderModification.MSG_ProceedToRefund")}else{var r=c.translate("orderModification.MSG_ProceedToPayment")}var i=this;if(this.ui.saveOrderBeforeUnschedule==true){this.ui.saveOrderBeforeUnschedule=false}else{p.showSuccessMessage(r,e).then(function(e){a.gotoCustomPage("paymentCapture",{},{})})}},uiIsDeliveryLine:function(e){return e.DeliveryMethod=="DEL"?true:false},uiGoToPaymentPage:function(){a.gotoCustomPage("paymentCapture",{},{})}})}]);
angular.module("store").controller("store.views.order.order-summary.order-summary",["$scope","$rootScope","$filter","iscScreen","iscMashup","iscResourcePermission","iscState","iscStateParams","iscPrint","iscModal","iscOrder","iscPayment","iscPaymentinput","$timeout","iscI18n","iscAppContext",function(e,r,d,t,a,i,s,o,n,l,u,m,O,p,h,c){t.initializeScreen(e,{model:{orderLineList:{},orderModel:{},paymentSummary:{},getPaymentTypeList:{},getPaymentCardTypeList:{}},mashupRefs:[{mashupRefId:"ordersummary_getCompleteOrderLineList",mashupId:"ordersummary_getCompleteOrderLineList",modelName:"orderLineList"},{mashupRefId:"ordersummary_getCompleteOrderDetails",mashupId:"ordersummary_getCompleteOrderDetails",modelName:"getCompleteOrderDetails"},{mashupRefId:"ordersummary_prints",mashupId:"ordersummary_prints"},{mashupRefId:"orderSummary_sendEmail",mashupId:"orderSummary_sendEmail"},{mashupRefId:"getPaymentTypeList",mashupId:"wsc_paymentCapture_getPaymentTypeList",modelName:"getPaymentTypeList"},{mashupRefId:"getPaymentCardTypeList",mashupId:"wsc_paymentCapture_getRuleDetails_PaymentCardTypeConfLevel",modelName:"getPaymentCardTypeList"}],ui:{oLineShownCount:5,cancelOrderAPISuccess:false,cancelledOrderNumber:"",emailid:"",showEmailError:false,hasOnlyCarryLines:false,hasOnlyDelLines:false,emailSent:false,emailForm:{},showBackLink:"N",statusColor:"",displayStatus:"",orderLockedTemplate:"store/views/order/order-summary/order-locked.tpl.html",currentLoginId:"",activeTabIndex:-1},uiGetOrderLineListNext:function(){if(this.ui.oLineShownCount<=this.model.orderLineList.OrderLineList.OrderLine.length){this.ui.oLineShownCount+=5}},uiClose:function(){s.goToPreviousState()},uiShowHome:function(){s.goToState("/home",{},{})},uiOLineScrollActionValidator:function(){return true},uiPrintSummary:function(){var e={};e.Order={};var r=this.model.getCompleteOrderDetails.Order;e.Order.OrderHeaderKey=r.OrderHeaderKey;e.Order.ShipNode=r.SellerOrganizationCode;e.Order.Currency=r.PriceInfo.Currency;e.Order.OrganizationCode=r.EnterpriseCode;a.callMashup(this,"ordersummary_prints",e,{}).then(this.printCallBackHandler.bind(this),angular.noop)},initialize:function(){this.model.orderModel=o.params.orderInput;this.ui.currentLoginId=c.getFromContext("currentLoginID");if(o.params.showBackLink){this.ui.showBackLink="Y"}var e=[];e.push(a.getMashupRefObj(this,"ordersummary_getCompleteOrderLineList",{OrderLine:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey}}));e.push(a.getMashupRefObj(this,"ordersummary_getCompleteOrderDetails",{Order:{OrderHeaderKey:this.model.orderModel.Order.OrderHeaderKey}}));e.push(a.getMashupRefObj(this,"getPaymentTypeList",O.getPaymentTypeListInput(this.model.orderModel)));e.push(a.getMashupRefObj(this,"getPaymentCardTypeList",O.getPaymentCardTypeListInput(this.model.orderModel)));a.callMashups(this,e,{}).then(function(e){var r=a.getMashupOutput(e,"ordersummary_getCompleteOrderDetails");this.ui.statusColor=this.uiGetCssClassByOrderStatus(this.model.getCompleteOrderDetails.Order.MaxOrderStatus);this.ui.displayStatus=u.getDisplayStatus(this.model.getCompleteOrderDetails.Order);this.setPaymentDetails(r);this.setFlagForCancel(r);if(!iscCore.isVoid(r.Order.CustomerEMailID)){this.ui.emailid=r.Order.CustomerEMailID}var t=a.getMashupOutput(e,"ordersummary_getCompleteOrderLineList");var i=t.OrderLineList.OrderLine;for(var s=0;s<i.length;s++){if(i[s].DeliveryMethod=="CARRY"){this.ui.hasOnlyCarryLines=true}else{this.ui.hasOnlyCarryLines=false;break}}for(var s=0;s<i.length;s++){if(i[s].DeliveryMethod=="DEL"){this.ui.hasOnlyDelLines=true}else{this.ui.hasOnlyDelLines=false;break}}}.bind(this),angular.noop)},uiGetCssClassByOrderStatus:function(e){return u.getCssClassByOrderStatus(e)},uiSetDisplayStatus:function(e){e.DisplayStatus=u.getLineDisplayStatus(e)},setFlagForCancel:function(e){e.Order.IsCancellationAllowed="Y";e.Order.IsAppeasementAllowed="Y";if(e.Order.MaxOrderStatus=="9000"){e.Order.IsCancellationAllowed="N";e.Order.IsAppeasementAllowed="N";return}var r=this.model.orderLineList.OrderLineList.OrderLine;for(var t=0;t<r.length;t++){if(r[t].OrderedQty>0){if(r[t].OrderLineTranQuantity.AvailableQtyForCancelAndStopDelivery>0){continue}else{e.Order.IsCancellationAllowed="N";break}}}},uiAddComments:function(){var r=this;var e=angular.copy(this.model.getCompleteOrderDetails);var t={modalInput:function(){return e}};l.openModal("store.views.order.comments.comments",t,{}).then(function(e){r.model.getCompleteOrderDetails.Order.Notes.NumberOfNotes=e.NoteList.TotalNumberOfRecords},angular.noop)},setPaymentDetails:function(e){var r=e;var t=m.prepareSuccessMessagePopupData(r,this.model.getPaymentTypeList.PaymentTypeList,this.model.getPaymentCardTypeList.PaymentCardTypeList);this.model.paymentSummary.paymentDetails=t.paymentDetails;this.model.paymentSummary.paymentMethodsAvailable=t.paymentMethodsAvailable},printCallBackHandler:function(e){var r=a.getMashupOutput(e,"ordersummary_prints");n.printHtmlOutput(r)},uiCancelOrderSuccessHandler:function(e){if(e&&e.taskAPIOutput.cancelOrderAPISuccess){this.ui.cancelledOrderNumber=e.taskAPIOutput.cancelledOrderNumber;this.ui.cancelOrderAPISuccess=true;this.updateOrderAfterCancellation(e.taskAPIOutput.order)}},updateOrderAfterCancellation:function(e){if(e){this.model.getCompleteOrderDetails=e;this.ui.statusColor=this.uiGetCssClassByOrderStatus(this.model.getCompleteOrderDetails.Order.MaxOrderStatus);this.ui.displayStatus=u.getDisplayStatus(this.model.getCompleteOrderDetails.Order);this.mergeOrderLineList(e);this.setFlagForCancel(e);if(!iscCore.isVoid(e.Order.CustomerEMailID)){this.ui.emailid=e.Order.CustomerEMailID}}},mergeOrderLineList:function(e){if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Order)&&!iscCore.isVoid(e.Order.OrderLineList)){var r=d("number")(e.Order.OrderLineList.TotalNumberOfRecords);if(!isNaN(r)&&r>0){for(var t=0;t<e.Order.OrderLineList.OrderLine.length;t++){var i=e.Order.OrderLineList.OrderLine[t];if(!iscCore.isVoid(this.model.orderLineList)&&!iscCore.isVoid(this.model.orderLineList.OrderLineList)){var r=d("number")(this.model.orderLineList.OrderLineList.TotalNumberOfRecords);if(!isNaN(r)&&r>0){for(var s=0;s<this.model.orderLineList.OrderLineList.OrderLine.length;s++){var a=this.model.orderLineList.OrderLineList.OrderLine[s];if(a.OrderLineKey==i.OrderLineKey){a.MaxLineStatus=i.MaxLineStatus;a.OrderLineTranQuantity=i.OrderLineTranQuantity;a.MaxLineStatusDesc=i.MaxLineStatusDesc;a.OrderedQty=i.OrderedQty;a.MultipleStatusesExist=i.MultipleStatusesExist;a.Status=i.Status;this.uiSetDisplayStatus(a)}}}}}}}},uiSendEmail:function(){var t=this;p(function(){t.ui.emailForm.$setDirty();if(iscCore.isVoid(t.ui.emailid)||!t.ui.emailForm.$valid){t.ui.showEmailError=true;document.getElementById("ordersummary_emailId").focus()}else if(t.ui.emailForm.$valid){var e={};e.Order={};var r=t.model.getCompleteOrderDetails.Order;e.Order.OrderHeaderKey=r.OrderHeaderKey;e.Order.ShipNode=r.SellerOrganizationCode;e.Order.Currency=r.PriceInfo.Currency;e.Order.OrganizationCode=r.EnterpriseCode;e.Order.ToEmailID=t.ui.emailid;a.callMashup(t,"orderSummary_sendEmail",e,{}).then(t.emailCallBackHandler.bind(t),angular.noop)}},10)},uiResetEmailFlags:function(){var e=document.getElementById("ordersummary_emailId").value;if(!iscCore.isVoid(e)){this.ui.emailSent=false;this.ui.showEmailError=false}},emailCallBackHandler:function(e){var r=a.getMashupOutput(e,"orderSummary_sendEmail");if(r){this.ui.emailSent=true}},uiEditOrder:function(){if(this.model.getCompleteOrderDetails.Order.MaxOrderStatus>=3700||this.ui.hasOnlyCarryLines==true){l.showErrorMessage(h.translate("editorderdetails.MSG_EditNotAllowed"))}else{if(this.model.getCompleteOrderDetails.Order.HasPendingChanges==="Y"&&this.ui.currentLoginId!=this.model.getCompleteOrderDetails.Order.PendingChangesUserID){l.showWarningMessage(h.translate("editorderdetails.WarningMessage_OrderLockedByAnotherUser",{pendingChangesUserId:this.model.getCompleteOrderDetails.Order.PendingChangesUserID}))}else{s.goToState("ordermodification",{action:"EDITORDER",orderHeaderKey:this.model.getCompleteOrderDetails.Order.OrderHeaderKey},{})}}},uiShowCustomerProfile:function(){var e={action:"customerdetails",input:{Customer:{CustomerID:this.model.getCompleteOrderDetails.Order.BillToID,OrganizationCode:this.model.getCompleteOrderDetails.Order.EnterpriseCode}}};s.goToState("customerprofilewizard",e,{})}})}]);
angular.module("store").controller("store.views.order.payment.order-capture-payment",["$animate","$scope","$rootScope","iscScreen","iscWizard","$location","$filter","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscObjectUtility","iscPayment","iscPaymentinput","iscOrder",function(e,y,t,r,g,a,i,s,p,C,o,P,O,c,f,D){g.initializeWizardPage(y,{model:{getCountryList:{},getCurrencyList:{},getRulesDetails_ReatTimeAuth:{},getRulesDetails_PaymentAttrEncrypt:{},getRuleDetails_CCName:{},getRuleDetails_ChargeShipLines:{},getRuleDetails_PostponePickupPayment:{},getPaymentTypeList:{},getPaymentCardTypeList:{},getCompleteOrderDetails:{},capturePayment:{},newPaymentMethods:{}},mashupRefs:[{mashupRefId:"getCountryList",mashupId:"wsc_common_getCountryList",modelName:"getCountryList"},{mashupRefId:"getCurrencyList",mashupId:"wsc_paymentCapture_getCurrencyList",modelName:"getCurrencyList"},{mashupRefId:"getRulesDetails_ReatTimeAuth",mashupId:"wsc_paymentCapture_getRuleDetails_RealTimeAuthorization",modelName:"getRulesDetails_ReatTimeAuth"},{mashupRefId:"getRulesDetails_PaymentAttrEncrypt",mashupId:"wsc_paymentCapture_getRulesDetails_PaymentAttrEncrypt",modelName:"getRulesDetails_PaymentAttrEncrypt"},{mashupRefId:"getRuleDetails_CCName",mashupId:"wsc_paymentCapture_getRuleDetails_CCName",modelName:"getRuleDetails_CCName"},{mashupRefId:"getRuleDetails_ChargeShipLines",mashupId:"wsc_paymentCapture_getRuleDetails_ChargeShipLines",modelName:"getRuleDetails_ChargeShipLines"},{mashupRefId:"getRuleDetails_PostponePickupPayment",mashupId:"wsc_paymentCapture_getRuleDetails_PostponePickupPayment",modelName:"getRuleDetails_PostponePickupPayment"},{mashupRefId:"getPaymentTypeList",mashupId:"wsc_paymentCapture_getPaymentTypeList",modelName:"getPaymentTypeList"},{mashupRefId:"getPaymentCardTypeList",mashupId:"wsc_paymentCapture_getRuleDetails_PaymentCardTypeConfLevel",modelName:"getPaymentCardTypeList"},{mashupRefId:"getCompleteOrderDetails",mashupId:"wsc_paymentConfirmation_getCompleteOrderDetails",modelName:"getCompleteOrderDetails"},{mashupRefId:"capturePayment",mashupId:"wsc_paymentConfirmation_capturePayment",modelName:"capturePayment"},{mashupRefId:"deletePayment",mashupId:"wsc_paymentConfirmation_capturePayment",modelName:"capturePayment"},{mashupRefId:"resumePayment",mashupId:"wsc_paymentConfirmation_capturePayment",modelName:"capturePayment"},{mashupRefId:"oneClickCapturePayConfirm",mashupId:"wsc_orderCapture_oneClickCapturePayConfirm",modelName:"oneClickCapturePayConfirm"}],ui:{orderBillToKey:"",orderShipToKey:"",orderHeaderKey:"",wizardOrderModel:"",orderCurrency:"",personInfo:{},initcomplete:false,reInitPadss:"N",custDefaultPersonInfo:{},actionClicked:"",remainingAmount:0,orderHasAnyCarryLines:false,orderHasAnyShippingLines:false,orderHasAnyPickupLines:false,realTimeAuthEnabled:false,ccNameRuleEnabled:false,encryptEnabled:false,chargeShpLinesAtStoreRuleEnabled:false,postponePaymentForPickupAtStoreRuleEnabled:false,isInitDataReady:false,refundAmount:0,screentitle:"payment.TITLE_CapturePayment",paymentAction:"Pay"},initialize:function(){this.model.newPaymentMethods.newPaymentMethod=[];var e=g.getWizardPageInput();this.ui.wizardOrderModel=g.getWizardModel("orderModel");this.ui.orderHeaderKey=this.ui.wizardOrderModel.Order.OrderHeaderKey;this.getInitDetails(this.ui.orderHeaderKey,this.ui.wizardOrderModel)},getInitDetails:function(e,t){var r=p.getMashupRefObj(this,"getCountryList",f.getCountryListInput(t));var a=p.getMashupRefObj(this,"getCurrencyList",f.getCurrencyListInput(t));var i=p.getMashupRefObj(this,"getRulesDetails_ReatTimeAuth",f.getRuleDetailsInput(t));var s=p.getMashupRefObj(this,"getRulesDetails_PaymentAttrEncrypt",f.getRuleDetailsInput(t));var o=p.getMashupRefObj(this,"getRuleDetails_CCName",f.getRuleDetailsInput(t));var n=p.getMashupRefObj(this,"getRuleDetails_ChargeShipLines",f.getRuleDetailsInput(t));var l=p.getMashupRefObj(this,"getRuleDetails_PostponePickupPayment",f.getRuleDetailsInput(t));var m=p.getMashupRefObj(this,"getPaymentTypeList",f.getPaymentTypeListInput(t));var d=p.getMashupRefObj(this,"getPaymentCardTypeList",f.getPaymentCardTypeListInput(t));var u=p.getMashupRefObj(this,"getCompleteOrderDetails",f.getCompleteOrderDetailsInput(e));var h=[r,a,i,s,o,n,l,m,d,u];p.callMashups(this,h,{}).then(this.onSuccessOfInitDetails.bind(this),angular.noop)},getCapturePaymentInput:function(){var e={};e.Order={};e.Order.OrderHeaderKey=this.ui.wizardOrderModel.Order.OrderHeaderKey;e.Order.PaymentMethods={};e.Order.PaymentMethods.PaymentMethod=[];var t=0;for(var r=0;r<this.model.newPaymentMethods.newPaymentMethod.length;r++){e.Order.PaymentMethods.PaymentMethod[r]={};var a=this.model.newPaymentMethods.newPaymentMethod[r];if(!a.PaymentTypeGroup&&(a.PaymentType&&a.PaymentType.PaymentTypeGroup)){a.PaymentTypeGroup=a.PaymentType.PaymentTypeGroup;a.PaymentType=a.PaymentType.PaymentType}e.Order.PaymentMethods.PaymentMethod[r].PaymentType=a.PaymentType;e.Order.PaymentMethods.PaymentMethod[r].PaymentTypeGroup=a.PaymentTypeGroup;e.Order.PaymentMethods.PaymentMethod[r].RequestedAmount=a.RequestedAmount;if(a.NoProcessingRequired){e.Order.PaymentMethods.PaymentMethod[r].NoProcessingRequired=a.NoProcessingRequired}if(!this.ui.orderHasAnyCarryLines&&!(this.ui.orderHasAnyShippingLines&&this.ui.chargeShpLinesAtStoreRuleEnabled)){e.Order.PaymentMethods.PaymentMethod[r].Operation="Manage"}else{if(!a.Operation){e.Order.PaymentMethods.PaymentMethod[r].Operation="Manage"}else{e.Order.PaymentMethods.PaymentMethod[r].Operation=angular.copy(a.Operation)}}var i=f.prepareCapturePaymentInputForPaymentMethod(a,this.ui.realTimeAuthEnabled,this.ui.ccNameRuleEnabled,false);e.Order.PaymentMethods.PaymentMethod[r]=angular.extend(e.Order.PaymentMethods.PaymentMethod[r],i);t++}if(this.model.getCompleteOrderDetails.Order.PaymentMethods&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod){for(var s=0;s<this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod.length;s++){var a=this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod[s];var i=f.prepareCapturePaymentInputForSavedPaymentMethod(a,this.ui.realTimeAuthEnabled,this.ui.ccNameRuleEnabled,false);if(!O.isEmpty(i)){if(a.NoProcessingRequired){i.NoProcessingRequired=a.NoProcessingRequired}if(!this.ui.orderHasAnyCarryLines&&!(this.ui.orderHasAnyShippingLines&&this.ui.chargeShpLinesAtStoreRuleEnabled)){i.Operation="Manage"}else{if(!a.Operation){i.Operation="Manage"}else{i.Operation=angular.copy(a.Operation)}}var o=t;t++;e.Order.PaymentMethods.PaymentMethod[o]=i}}}return e},uiOneClickCapturePayConfirm:function(){var e=this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth;var t=0;if(this.model.getCompleteOrderDetails.Order.PaymentMethods&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod){for(var r=0;r<this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod.length;r++){var a=this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod[r];var i=a.RequestedAmount;var s=a.MaxChargeLimit;t+=parseFloat(i)-parseFloat(s)}}for(var o=0;o<this.model.newPaymentMethods.newPaymentMethod.length;o++){var a=this.model.newPaymentMethods.newPaymentMethod[o];var i=a.RequestedAmount;t+=parseFloat(i)}if(O.isGreaterThanZero(parseFloat(e)-parseFloat(t))){C.showErrorMessage(P.translate("payment.INSUFFICIENT_PAYMENT"))}else{var n=this.getCapturePaymentInput();n.Order.BillToKey=this.model.getCompleteOrderDetails.Order.BillToKey?this.model.getCompleteOrderDetails.Order.BillToKey:"";n.Order.ShipToKey=this.model.getCompleteOrderDetails.Order.ShipToKey?this.model.getCompleteOrderDetails.Order.ShipToKey:"";n.Order.BillToID=this.model.getCompleteOrderDetails.Order.BillToID?this.model.getCompleteOrderDetails.Order.BillToID:"";n.Order.EnterpriseCode=this.model.getCompleteOrderDetails.Order.EnterpriseCode;n.Order.CustomerContactID=this.model.getCompleteOrderDetails.Order.CustomerContactID?this.model.getCompleteOrderDetails.Order.CustomerContactID:"";n.Order.PaymentTypeList=this.model.getPaymentTypeList.PaymentTypeList;if(D.orderHasOnlyCarryLines(this.model.getCompleteOrderDetails)){n.Order.HasOnlyCarryLines="Y"}p.callMashup(this,"oneClickCapturePayConfirm",n,{}).then(this.onSuccessOfPayment.bind(this),this.onFailurePayment.bind(this))}},uiExpandPayment:function(e){e.expandPaymentMethodDetails()},uiCollapsePayment:function(e){e.collapsePaymentMethodDetails()},uiRemovePaymentPanel:function(r){var e="payment.LABEL_Delete_Payment";var a=this.model.newPaymentMethods.newPaymentMethod[r].RequestedAmount;var i=this;C.showConfirmationMessage(e).then(function(e){if(iscCore.isBooleanTrue(e)){i.model.newPaymentMethods.newPaymentMethod.splice(r,1);if(parseFloat(a)>0){var t=parseFloat(a)+parseFloat(i.ui.remainingAmount);i.ui.remainingAmount=t.toFixed(2)}}})},uiAddNewPaymentPanel:function(){var e=this.model.newPaymentMethods.newPaymentMethod.length;var t=this.getNewPaymentMethodObject();var r=0;if(this.ui.remainingAmount>0){r=r+parseFloat(this.ui.remainingAmount)}if(r>0){t.RequestedAmount=r.toFixed(2).toString();this.ui.remainingAmount=0}else{t.RequestedAmount="0"}this.model.newPaymentMethods.newPaymentMethod[e]=t;this.ui.actionClicked=""},uiCancel:function(){if(y.paymentCaptureForm.$dirty){C.showConfirmationMessage(P.translate("payment.MSG_DirtyCheckMessage")).then(function(e){if(e==="YES"){g.closeWizard()}},function(e){})}else{C.showConfirmationMessage(P.translate("order.WarningMessage_Cancel")).then(function(e){if(e==="YES"){g.closeWizard()}},function(e){})}},uiRemovePayment:function(l){var e="payment.LABEL_Delete_Payment";var m=this;C.showConfirmationMessage(e).then(function(e){if(iscCore.isBooleanTrue(e)){var t={};t.CapturePayment={};t.CapturePayment.OrderHeaderKey=m.ui.wizardOrderModel.Order.OrderHeaderKey;t.CapturePayment.PaymentMethods={};t.CapturePayment.PaymentMethods.PaymentMethod={};t.CapturePayment.PaymentMethods.PaymentMethod.PaymentKey=l.PaymentKey;t.CapturePayment.PaymentMethods.PaymentMethod.Operation="Delete";t.CapturePayment.PaymentMethods.PaymentMethod.IsCorrection="N";var r=[];r=[p.getMashupRefObj(m,"deletePayment",t)];var a=l.RequestedAmount;var i=l.TotalCharged;var s=l.TotalAuthorized;if(parseFloat(a)>0){var o=parseFloat(a)+parseFloat(m.ui.remainingAmount);m.ui.remainingAmount=o.toFixed(2)}if(parseFloat(i)>0||parseFloat(s)>0){if(parseFloat(i)>0){var n=parseFloat(m.ui.remainingAmount)-parseFloat(i);m.ui.remainingAmount=n.toFixed(2)}else if(parseFloat(s)>0){var n=parseFloat(m.ui.remainingAmount)-parseFloat(s);m.ui.remainingAmount=n.toFixed(2)}}p.callMashups(m,r,{}).then(m.onSuccessOfSavePayment.bind(m),angular.noop)}})},uiResumePayment:function(e){var t={};t.CapturePayment={};t.CapturePayment.OrderHeaderKey=this.ui.wizardOrderModel.Order.OrderHeaderKey;t.CapturePayment.PaymentMethods={};t.CapturePayment.PaymentMethods.PaymentMethod={};t.CapturePayment.PaymentMethods.PaymentMethod.PaymentKey=e.PaymentKey;t.CapturePayment.PaymentMethods.PaymentMethod.ResetSuspensionStatus="Y";t.CapturePayment.PaymentMethods.PaymentMethod.RequestedAmount="0";var r=[];r=[p.getMashupRefObj(this,"resumePayment",t)];this.ui.resumePaymentKey=e.PaymentKey;p.callMashups(this,r,{}).then(this.onSuccessOfSavePayment.bind(this),angular.noop)},uiSavePayment:function(){var e=[];var t=p.getMashupRefObj(this,"capturePayment",this.getCapturePaymentInput());e=[t];p.callMashups(this,e,{}).then(this.onSuccessOfSavePayment.bind(this),angular.noop)},uiFinishWizard:function(){g.finishWizard()},uihandleScreenInvalid:function(){this.ui.actionClicked="pay";y.$broadcast("callVerifyAddress",{callingScreeen:"order-capture-payment"});C.showErrorMessage(P.translate("payment.MSG_SCREEN_ERRORS"))},uiDoNothing:function(){return},onSuccessOfInitDetails:function(e){var t=e.MashupRefs.MashupRef;var r={};if(t!==null&&t!==undefined){var a=t.length;for(var i=0;i<a;i++){var s=t[i];if(s.mashupRefId==="getRulesDetails_ReatTimeAuth"){this.model.getRulesDetails_ReatTimeAuth=s.Output;if(this.model.getRulesDetails_ReatTimeAuth&&this.model.getRulesDetails_ReatTimeAuth.Rules&&this.model.getRulesDetails_ReatTimeAuth.Rules.RuleSetValue=="02"){this.ui.realTimeAuthEnabled=true}else{this.ui.realTimeAuthEnabled=false}}else if(s.mashupRefId==="getRuleDetails_ChargeShipLines"){this.model.getRuleDetails_ChargeShipLines=s.Output;if(this.model.getRuleDetails_ChargeShipLines&&this.model.getRuleDetails_ChargeShipLines.Rules&&this.model.getRuleDetails_ChargeShipLines.Rules.RuleSetValue=="Y"){this.ui.chargeShpLinesAtStoreRuleEnabled=true}else{this.ui.chargeShpLinesAtStoreRuleEnabled=false}}else if(s.mashupRefId==="getRuleDetails_PostponePickupPayment"){this.model.getRuleDetails_PostponePickupPayment=s.Output;if(this.model.getRuleDetails_PostponePickupPayment&&this.model.getRuleDetails_PostponePickupPayment.Rules&&this.model.getRuleDetails_PostponePickupPayment.Rules.RuleSetValue=="Y"){this.ui.postponePaymentForPickupAtStoreRuleEnabled=true}else{this.ui.postponePaymentForPickupAtStoreRuleEnabled=false}}else if(s.mashupRefId==="getRuleDetails_CCName"){this.model.getRuleDetails_CCName=s.Output;if(this.model.getRuleDetails_CCName&&this.model.getRuleDetails_CCName.Rules&&this.model.getRuleDetails_CCName.Rules.RuleSetValue=="Y"){this.ui.ccNameRuleEnabled=true}else{this.ui.ccNameRuleEnabled=false}}else if(s.mashupRefId==="getRulesDetails_PaymentAttrEncrypt"){this.model.getRulesDetails_PaymentAttrEncrypt=s.Output;if(this.model.getRulesDetails_PaymentAttrEncrypt&&this.model.getRulesDetails_PaymentAttrEncrypt.Rules&&this.model.getRulesDetails_PaymentAttrEncrypt.Rules.RuleSetValue=="Y"){this.ui.encryptEnabled=true}else{this.ui.encryptEnabled=false}}else if(s.mashupRefId==="getCompleteOrderDetails"){this.model.getCompleteOrderDetails=s.Output;this.ui.orderShipToKey=s.Output.Order.ShipToKey;if(s.Output.Order.BillToKey){this.ui.orderBillToKey=s.Output.Order.BillToKey}if(D.orderHasAnyCarryLines(this.model.getCompleteOrderDetails)){this.ui.orderHasAnyCarryLines=true}if(D.orderHasAnyShippingLines(this.model.getCompleteOrderDetails)){this.ui.orderHasAnyShippingLines=true}if(D.orderHasAnyPickupLines(this.model.getCompleteOrderDetails)){this.ui.orderHasAnyPickupLines=true}this.ui.orderHeaderKey=s.Output.Order.OrderHeaderKey;this.ui.orderCurrency=this.model.getCompleteOrderDetails.Order.PriceInfo.Currency;if(this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth>0){var o=this.model.newPaymentMethods.newPaymentMethod.length;r.RequestedAmount=c.calculateRemainingAmountToAdd(this.model.getCompleteOrderDetails,null);if(this.model.getCurrencyList.CurrencyList){for(var n=0;n<this.model.getCurrencyList.CurrencyList.Currency.length;n++){var l=this.model.getCurrencyList.CurrencyList.Currency[n];var m=l.Currency;if(this.ui.orderCurrency===m){r.CustomerAccountCurrency=this.model.getCurrencyList.CurrencyList.Currency[n]}}}if(this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo&&this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo.PersonInfo){this.ui.custDefaultPersonInfo=this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo.PersonInfo;r.PersonInfoBillTo=this.ui.custDefaultPersonInfo}if(O.trimString(this.model.getCompleteOrderDetails.Order.CustomerFirstName)&&O.trimString(this.model.getCompleteOrderDetails.Order.CustomerLastName)){r.FirstName=this.model.getCompleteOrderDetails.Order.CustomerFirstName;r.LastName=this.model.getCompleteOrderDetails.Order.CustomerLastName;r.CreditCardName=c.getFormattedName(r.FirstName,r.LastName)}}if(this.ui.orderShipToKey!=""&&this.ui.orderBillToKey&&this.ui.orderShipToKey===this.ui.orderBillToKey){r.useShpAddressForBill="Y"}else{r.useShpAddressForBill="N"}if(this.model.getCompleteOrderDetails.Order.PersonInfoBillTo){}else if(this.model.getCompleteOrderDetails.Order.BillToID&&this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo&&this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo.PersonInfo){}else{this.model.getCompleteOrderDetails.Order.PersonInfoBillTo={};if(O.trimString(this.model.getCompleteOrderDetails.Order.CustomerFirstName)&&O.trimString(this.model.getCompleteOrderDetails.Order.CustomerLastName)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.FirstName=this.model.getCompleteOrderDetails.Order.CustomerFirstName;this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.LastName=this.model.getCompleteOrderDetails.Order.CustomerLastName}if(O.trimString(this.model.getCompleteOrderDetails.Order.CustomerPhoneNo)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.DayPhone=this.model.getCompleteOrderDetails.Order.CustomerPhoneNo}if(O.trimString(this.model.getCompleteOrderDetails.Order.CustomerEMailID)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.EMailID=this.model.getCompleteOrderDetails.Order.CustomerEMailID}}this.ui.initcomplete=true}else if(s.mashupRefId==="getPaymentTypeList"){this.model.getPaymentTypeList=s.Output;var d=false;for(var n=0;n<this.model.getPaymentTypeList.PaymentTypeList.PaymentType.length;n++){var u=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[n];var h=u.PaymentType;var p=u.PaymentTypeGroup;if(p==="CREDIT_CARD"){r.PaymentType=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[n];d=true;break}}if(!d){r.PaymentType=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[0]}}else if(s.mashupRefId==="getPaymentCardTypeList"){this.model.getPaymentCardTypeList=s.Output;if(this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType&&this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType.length>0){r.CardType=this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType[0]}}else if(s.mashupRefId==="getCountryList"){this.model.getCountryList=s.Output}else if(s.mashupRefId==="getCurrencyList"){this.model.getCurrencyList=s.Output;if(this.orderCurrency&&this.orderCurrency!=""){for(var y=0;y<this.model.getCurrencyList.CurrencyList.Currency.length;y++){var l=this.model.getCurrencyList.CurrencyList.Currency[y];var m=l.Currency;if(this.ui.orderCurrency===m){r.CustomerAccountCurrency=this.model.getCurrencyList.CurrencyList.Currency[y]}}}else{r.CustomerAccountCurrency=this.model.getCurrencyList.CurrencyList.Currency[0]}}}}if(this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth>0){if(this.model.getCompleteOrderDetails.Order.PaymentMethods&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod.length>0){this.ui.remainingAmount=c.calculateRemainingAmountToAdd(this.model.getCompleteOrderDetails,null)}else{this.model.newPaymentMethods.newPaymentMethod[0]=r}}else{if(this.model.getCompleteOrderDetails.Order.DraftOrderFlag=="N"){this.ui.refundAmount=0-parseFloat(this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth,10);if(this.ui.refundAmount>0){this.ui.screentitle="payment.TITLE_Refund";this.ui.paymentAction="Refund"}}}this.ui.isInitDataReady=true;if(this.model.getCompleteOrderDetails.Order.DraftOrderFlag=="N"&&this.ui.refundAmount==0&&this.ui.remainingAmount==0){this.ui.paymentAction="Nochange"}},onFailurePayment:function(e){this.ui.actionClicked="";if(e.Errors&&e.Errors.Error){for(var t=0;t<e.Errors.Error.length;t++){if(e.Errors.Error[t]&&e.Errors.Error[t].ErrorCode&&e.Errors.Error[t].ErrorCode==="YFS10210"){break}}}if(e.Errors.OrderDetails&&e.Errors.OrderDetails.Order&&e.Errors.OrderDetails.Order.length>0){this.model.getCompleteOrderDetails.Order=e.Errors.OrderDetails.Order[0]}this.model.newPaymentMethods={};this.model.newPaymentMethods.newPaymentMethod=[];if(parseFloat(this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth)>0){var r=this.getNewPaymentMethodObject();this.model.newPaymentMethods.newPaymentMethod[0]=r}var a={options:{headerText:"payment.LABEL_PaymentFailure"},settings:{contentTemplate:"./store/views/order/payment/payment-error-content.tpl.html"},data:{contentData:{errors:e.Errors?e.Errors:{}}}};var i=P.translate("payment.MESSAGE_PaymentFailure");C.showErrorMessage(i,a)},onSuccessOfPayment:function(e){this.ui.actionClicked="";var t=e.MashupRefs.MashupRef;if(t!==null&&t!==undefined){var r=t.length;for(var a=0;a<r;a++){var i=t[a];if(i.mashupRefId==="oneClickCapturePayConfirm"){var s=i.Output.Order.ErrorFound;if(s==="Y"){if(i.Output.Order.ErrorInAddress&&i.Output.Order.ErrorInAddress==="Y"){y.$broadcast("callVerifyAddress",{callingScreeen:"order-capture-payment"})}else{var o=angular.copy(this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo);var n=angular.copy(this.model.getCompleteOrderDetails.Order.ShippingAddressList);this.model.getCompleteOrderDetails=i.Output;if(!this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo&&o){this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo=o}if(!this.model.getCompleteOrderDetails.Order.ShippingAddressList&&n){this.model.getCompleteOrderDetails.Order.ShippingAddressList=n}this.model.newPaymentMethods={};this.model.newPaymentMethods.newPaymentMethod=[];var l=i.Output.Order.ChargeTransactionDetails.RemainingAmountToAuth;if(parseFloat(l)>0){this.ui.remainingAmount=angular.copy(l);var m=c.getAwtAuthNChrgAmtOnSuspndedPmts(i.Output.Order.PaymentMethods,this.model.getCompleteOrderDetails.Order.DocumentType);if(m>0){this.ui.remainingAmount=parseFloat(this.ui.remainingAmount)+parseFloat(m);this.ui.remainingAmount=this.ui.remainingAmount.toFixed(2)}}var d={options:{headerText:"payment.LABEL_PaymentFailure"},settings:{contentTemplate:"./store/views/order/payment/payment-error-content.tpl.html"}};var u=P.translate("payment.MESSAGE_PaymentFailure");C.showErrorMessage(u,d)}}else{var o=angular.copy(this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo);var n=angular.copy(this.model.getCompleteOrderDetails.Order.ShippingAddressList);this.model.getCompleteOrderDetails=i.Output;if(!this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo&&o){this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo=o}if(!this.model.getCompleteOrderDetails.Order.ShippingAddressList&&n){this.model.getCompleteOrderDetails.Order.ShippingAddressList=n}this.model.newPaymentMethods={};this.model.newPaymentMethods.newPaymentMethod=[];var h=i.Output.Order.DraftOrderFlag;if(h==="N"){callConfirmDraftOrder=false;if(this.ui.paymentAction=="Refund"||this.ui.paymentAction=="Nochange"){g.finishWizard()}else{var p=c.prepareSuccessMessagePopupData(this.model.getCompleteOrderDetails,this.model.getPaymentTypeList.PaymentTypeList,this.model.getPaymentCardTypeList.PaymentCardTypeList,this.ui.realTimeAuthEnabled);var d={options:{headerText:"payment.LABEL_PaymentSuccess",action:[{actionName:"OK",actionLabel:"payment.ACTION_ViewOrderSummary"}]},settings:{contentTemplate:"./store/views/order/payment/payment-success-content.tpl.html"},data:{contentData:p}};var u=P.translate("payment.MESSAGE_PaymentSUCCESS");C.showSuccessMessage(u,d).then(function(e){g.finishWizard()},function(e){g.finishWizard()})}}else{var l=i.Output.Order.ChargeTransactionDetails.RemainingAmountToAuth;if(parseFloat(l)>0){callConfirmDraftOrder=false;this.ui.remainingAmount=angular.copy(l);var m=c.getAwtAuthNChrgAmtOnSuspndedPmts(i.Output.Order.PaymentMethods,this.model.getCompleteOrderDetails.Order.DocumentType);if(m>0){this.ui.remainingAmount=parseFloat(this.ui.remainingAmount)+parseFloat(m);this.ui.remainingAmount=this.ui.remainingAmount.toFixed(2)}C.showErrorMessage(P.translate("payment.INSUFFICIENT_PAYMENT"))}else{var d={options:{headerText:"payment.LABEL_PaymentFailure"},settings:{contentTemplate:"./store/views/order/payment/payment-error-content.tpl.html"},data:{contentData:{errors:e.Errors?e.Errors:{}}}};var u=P.translate("payment.MESSAGE_PaymentFailure");C.showErrorMessage(u,d)}}}}}}},onSuccessOfSavePayment:function(e){var t=e.MashupRefs.MashupRef;if(t!==null&&t!==undefined){var r=t.length;for(var a=0;a<r;a++){var i=t[a];if(i.mashupRefId==="capturePayment"){this.ui.initcomplete=false;this.ui.reInitPadss="Y";var s=angular.copy(this.model.getCompleteOrderDetails.Order.ShippingAddressList);this.model.getCompleteOrderDetails=i.Output;this.model.getCompleteOrderDetails.Order.ShippingAddressList=s;this.ui.orderShipToKey=i.Output.Order.ShipToKey;if(i.Output.Order.BillToKey!=undefined){this.ui.orderBillToKey=i.Output.Order.BillToKey}this.model.newPaymentMethods={};this.model.newPaymentMethods.newPaymentMethod=[];var o={};if(this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth>0){o=this.getNewPaymentMethodObject();this.model.newPaymentMethods.newPaymentMethod[0]=o}else{this.model.newPaymentMethods={};this.model.newPaymentMethods.newPaymentMethod=[]}this.ui.initcomplete=true}else if(i.mashupRefId==="deletePayment"||i.mashupRefId==="resumePayment"){var n=p.getMashupRefObj(this,"getCompleteOrderDetails",f.getCompleteOrderDetailsInput(i.Output.Order.OrderHeaderKey));var l=[n];p.callMashups(this,l,{}).then(this.onSuccessOfOrderDetails.bind(this),angular.noop)}}}},onSuccessOfOrderDetails:function(e){var t=e.MashupRefs.MashupRef;if(t!==null&&t!==undefined){var r=t.length;for(var a=0;a<r;a++){var i=t[a];if(i.mashupRefId==="getCompleteOrderDetails"){this.initScreenDetails(i.Output);if(this.ui.resumePaymentKey){var s=c.getPaymentMethodForKey(this.model.getCompleteOrderDetails,this.ui.resumePaymentKey);if(s&&!c.isPaymentMethodSuspended(s,this.model.getCompleteOrderDetails.Order.DocumentType)){var o=s.MaxChargeLimit;var n=0;var l=s.TotalCharged;var m=s.TotalAuthorized;if(parseFloat(l)>0||parseFloat(m)>0){if(parseFloat(l)>0){n=parseFloat(o)-parseFloat(l)}else if(parseFloat(m)>0){n=parseFloat(o)-parseFloat(m)}}else{n=o}if(parseFloat(n)>0){var d=parseFloat(this.ui.remainingAmount)-parseFloat(n);this.ui.remainingAmount=d.toFixed(2)}}this.ui.resumePaymentKey=null}this.ui.remainingAmount=c.calculateRemainingAmountToAdd(this.model.getCompleteOrderDetails,this.model.newPaymentMethods.newPaymentMethod)}}}},getNewPaymentMethodObject:function(){var e={};e.RequestedAmount=this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth;if(this.model.getCurrencyList.CurrencyList){if(this.ui.orderCurrency&&this.ui.orderCurrency!=""){for(var t=0;t<this.model.getCurrencyList.CurrencyList.Currency.length;t++){var r=this.model.getCurrencyList.CurrencyList.Currency[t];var a=r.Currency;if(this.ui.orderCurrency===a){e.CustomerAccountCurrency=this.model.getCurrencyList.CurrencyList.Currency[t]}}}else{e.CustomerAccountCurrency=this.model.getCurrencyList.CurrencyList.Currency[0]}}if(this.model.getCompleteOrderDetails.Order.PersonInfoBillTo&&!O.isEmpty(this.model.getCompleteOrderDetails.Order.PersonInfoBillTo)){e.PersonInfoBillTo=angular.copy(this.model.getCompleteOrderDetails.Order.PersonInfoBillTo)}else if(this.ui.custDefaultPersonInfo){e.PersonInfoBillTo=angular.copy(this.ui.custDefaultPersonInfo)}if(O.trimString(this.model.getCompleteOrderDetails.Order.CustomerFirstName)&&O.trimString(this.model.getCompleteOrderDetails.Order.CustomerLastName)){e.FirstName=this.model.getCompleteOrderDetails.Order.CustomerFirstName;e.LastName=this.model.getCompleteOrderDetails.Order.CustomerLastName;e.CreditCardName=c.getFormattedName(e.FirstName,e.LastName)}if(this.model.getPaymentTypeList.PaymentTypeList){var i=false;for(var t=0;t<this.model.getPaymentTypeList.PaymentTypeList.PaymentType.length;t++){var s=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[t];var o=s.PaymentType;var n=s.PaymentTypeGroup;if(n==="CREDIT_CARD"){e.PaymentType=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[t];i=true;break}}if(!i){e.PaymentType=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[0]}}if(this.ui.orderShipToKey!=""&&this.ui.orderBillToKey&&this.ui.orderShipToKey===this.ui.orderBillToKey){e.useShpAddressForBill="Y"}else{e.useShpAddressForBill="N"}if(this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType&&this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType.length>0){e.CardType=this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType[0]}return e},getTotalAmountAlreadyAdded:function(){var e=0;for(var t=0;t<this.model.newPaymentMethods.newPaymentMethod.length;t++){var r=this.model.newPaymentMethods.newPaymentMethod[t];var a=r.RequestedAmount;e=parseFloat(e)+parseFloat(a)}if(this.model.getCompleteOrderDetails.Order.PaymentMethods&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod.length>0){for(var t=0;t<this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod.length;t++){var r=this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod[t];var a=r.RequestedAmount;e=parseFloat(e)+parseFloat(a)}}return e},initScreenDetails:function(e){var t={};this.model.getCompleteOrderDetails=angular.copy(e);this.ui.orderShipToKey=e.Order.ShipToKey;if(e.Order.BillToKey){this.ui.orderBillToKey=e.Order.BillToKey}if(!this.model.getCompleteOrderDetails.Order.PersonInfoBillTo&&!(this.model.getCompleteOrderDetails.Order.BillToID&&this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo&&this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo.PersonInfo)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo={};if(O.trimString(this.model.getCompleteOrderDetails.Order.CustomerFirstName)&&O.trimString(this.model.getCompleteOrderDetails.Order.CustomerLastName)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.FirstName=this.model.getCompleteOrderDetails.Order.CustomerFirstName;this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.LastName=this.model.getCompleteOrderDetails.Order.CustomerLastName}if(O.trimString(this.model.getCompleteOrderDetails.Order.CustomerPhoneNo)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.DayPhone=this.model.getCompleteOrderDetails.Order.CustomerPhoneNo}if(O.trimString(this.model.getCompleteOrderDetails.Order.CustomerEMailID)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.EMailID=this.model.getCompleteOrderDetails.Order.CustomerEMailID}}this.ui.initcomplete=true},uiIsPaymentRequired:function(){return this.model.getCompleteOrderDetails&&this.model.getCompleteOrderDetails.Order?O.isGreaterThanZero(this.model.getCompleteOrderDetails.Order.OverallTotals.GrandTotal):false},handleWizardBack:function(){console.log("Screen is dirty");var r=this;if(y.paymentCaptureForm.$dirty){C.showConfirmationMessage("globals.MSG_BackClickDirtyMessage").then(function(e){if(e==="YES"){if(r.model.getCompleteOrderDetails.Order.DraftOrderFlag=="N"){var t={};t.Order={};t.Order.OrderHasPendingChanges="N";g.setWizardModel("OrderModificationModel",t)}g.gotoPreviousPage(true)}},function(){})}else{if(this.model.getCompleteOrderDetails.Order.DraftOrderFlag=="N"){var e={};e.Order={};e.Order.OrderHasPendingChanges="N";g.setWizardModel("OrderModificationModel",e)}g.gotoPreviousPage(true)}return true},handleWizardExit:function(){var e=P.translate("order.WarningMessage_Cancel");C.showConfirmationMessage(e).then(function(e){if(e==="YES"){g.exitWizard()}},function(e){});return true}})}]);
angular.module("store").controller("store.views.receiving.notes.shipment-notes",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscModal","iscI18n",function(t,e,s,i,n,o,r,a,h){i.initializeModalScreen(t,{model:{noteList:{}},mashupRefs:[{mashupRefId:"getNoteList",mashupId:"store.views.receiving.notes.getNoteList",modelName:"noteList"},{mashupRefId:"changeShipment",mashupId:"store.views.receiving.notes.changeShipment"}],ui:{},initialize:function(){var e={};e.Note={};e.Note.TableKey=n.Shipment.ShipmentKey;o.callMashup(this,"getNoteList",e,{})},uiClose:function(){s.close(this.model.noteList)},uiPostNote:function(e){var t={};t.Shipment={};t.Shipment.ShipmentKey=n.Shipment.ShipmentKey;t.Shipment.Notes=e;var i=[];i.push(o.getMashupRefObj(this,"changeShipment",t));i.push(o.getMashupRefObj(this,"getNoteList",{Note:{TableKey:n.Shipment.ShipmentKey}}));o.callMashups(this,i,{}).then(this.handlechangeShipment.bind(this),this.changeShipmentAPIErrorCallBack.bind(this))},handlechangeShipment:function(e){t.$broadcast("clearNoteFields")},changeShipmentAPIErrorCallBack:function(e){var t=e.Errors.Error[0].ErrorDescription;var i=e.Errors.Error[0].ErrorCode;if(h.hasKey("apierror."+i)){t=h.translate("apierror."+i);a.showErrorMessage(t,null,null)}else{a.showErrorMessage(t,null,null)}s.dismiss(e)}})}]);
angular.module("store").controller("store.views.receiving.receive-shipment.receive-shipment-finish",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscState",function(e,i,t,o,r,s,a){t.initializeWizardPage(e,{model:{},mashupRefs:[],ui:{},initialize:function(){if(t.getWizardAction()==="FINISH"){var e=t.getWizardModel("receivedShipment");a.goToState("receiveSummary",{input:e},{})}else if(t.getWizardAction()==="CLOSE"){a.goToPreviousState()}}})}]);
angular.module("store").controller("store.views.receiving.receive-shipment.receive-shipment-init",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams",function(e,i,n,s,t,a){n.initializeWizardPage(e,{model:{},mashupRefs:[{mashupRefId:"getShipmentDetailsForReceiving",mashupId:"store.views.receiving.getShipmentDetailsForReceiving"}],ui:{},initialize:function(){if(a.params.action==="receiveShipment"){this.validateShipmentForReceiving("receiveShipment",a.params)}},validateShipmentForReceiving:function(e,i){var t={Shipment:{ShipmentKey:i.input.Shipment.ShipmentKey}};s.callMashup(this,"getShipmentDetailsForReceiving",t,{}).then(this.processShipmentDetailsForReceiving.bind(this,e),angular.noop)},processShipmentDetailsForReceiving:function(e,i){var t=s.getMashupOutput(i,"getShipmentDetailsForReceiving");a.params.input=t;n.gotoCustomPage("receiveShipment",a.params,{})}})}]);
angular.module("store").controller("store.views.receiving.receive-shipment.receive-shipment",["$animate","$scope","$q","$filter","$rootScope","$timeout","iscScreen","iscState","iscWizard","$locale","iscStateParams","iscAppContext","iscMashup","iscModal","iscOrder","iscScrollUtility","iscObjectUtility","iscReturn","iscResourcePermission","iscI18n","iscRule",function(e,C,n,a,r,s,i,t,o,g,h,c,f,u,d,m,p,l,v,S,R){o.initializeWizardPage(C,{model:{shipmentDetails:{},shipmentLineList:{},shipmentContainerList:{},scanInput:{barCodeData:""}},mashupRefs:[{mashupRefId:"getReceivingShipmentContainerList",mashupId:"store.views.receiving.getReceivingShipmentContainerList"},{mashupRefId:"getReceivingShipmentLineList",mashupId:"store.views.receiving.getReceivingShipmentLineList"},{mashupRefId:"translateBarCodeForProductReceiving",mashupId:"store.views.receiving.translateBarCodeForProductReceiving"},{mashupRefId:"searchAndReceiveShipmentByItemId",mashupId:"store.views.receiving.getItemListForReceiving"},{mashupRefId:"getNotReceivedItems",mashupId:"store.views.receiving.getNotReceivedItems"},{mashupRefId:"getNotReceivedContainers",mashupId:"store.views.receiving.getNotReceivedContainers"},{mashupRefId:"unreceiveShipmentLine",mashupId:"store.views.receiving.unreceiveShipmentLine"},{mashupRefId:"receiveShipmentLine",mashupId:"store.views.receiving.receiveShipmentLine"},{mashupRefId:"recordDamageForShipmentLine",mashupId:"store.views.receiving.unreceiveAndReceiveShipmentLine"},{mashupRefId:"translateBarCodeForContainerReceiving",mashupId:"store.views.receiving.translateBarCodeForContainerReceiving"},{mashupRefId:"searchAndReceiveShipmentByContainer",mashupId:"store.views.receiving.searchAndReceiveShipmentByContainer"},{mashupRefId:"receiveContainer",mashupId:"store.views.receiving.receiveContainer"},{mashupRefId:"unreceiveContainer",mashupId:"store.views.receiving.unreceiveContainer"}],ui:{screenType:"RECEIVE_SHIPMENT",searchAndScannerLiteralKeys:{scanFieldLabelKey:"",searchIconLabelKey:""},receivedItemLineIndex:1,isReceivingAllowed:true,autoReceiveError:"",isShipmentContainerized:false,hasPermissionToReceiveWithoutScan:false,lastReceivedItemId:"",isAutoReceive:false,showReceiveMsg:false,receiveMsgBundleKey:"",shipmentLineCount:"0",shipmentContainerCount:"0",shipmentLineShownCount:10,packagesShownCount:10,currentlySelectedShipmentLine:"",currentlySelectedContainer:"",defaultDispCode:"",shpStatusBundleKey:"",shipmentPreviewTemplate:"store/views/receiving/receive-shipment/receive-shipment-popover-preview.tpl.html",shipmentNoteCount:"0"},initialize:function(){r.$showBackButtonForStates=true;if(v.hasPermission("WSC000045")){this.ui.hasPermissionToReceiveWithoutScan=true}var e=o.getWizardPageInput();if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.input)){console.log("Auto Receive Entity : ",e.autoReceive);this.model.shipmentDetails.Shipment=e.input.Shipment;if(e.input.Shipment.Notes.Note)this.ui.shipmentNoteCount=e.input.Shipment.Notes.NumberOfNotes;this.processShipmentDetails(this.model.shipmentDetails.Shipment);if(this.ui.isReceivingAllowed){this.setSearchAndScannerLiterals(this.model.shipmentDetails.Shipment.ShipmentContainerizedFlag);var i=this.ui.isShipmentContainerized?"getReceivingShipmentContainerList":"getReceivingShipmentLineList";var t=this.ui.isShipmentContainerized?{Container:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}:{ShipmentLine:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};if(!iscCore.isVoid(e.autoReceive)&&!iscCore.isVoid(e.autoReceive.AutoReceiveEntity)&&!iscCore.isVoid(e.autoReceive.TranslatedEntityValue)&&("PRODUCT"==e.autoReceive.AutoReceiveEntity&&!this.ui.isShipmentContainerized||"PACKAGE"==e.autoReceive.AutoReceiveEntity&&this.ui.isShipmentContainerized)){this.ui.isAutoReceive=true;var n=this.ui.isShipmentContainerized?"searchAndReceiveShipmentByContainer":"searchAndReceiveShipmentByItemId";var s=this.ui.isShipmentContainerized?{Container:{ContainerScm:e.autoReceive.TranslatedEntityValue,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType}}:{Item:{ItemID:e.autoReceive.TranslatedEntityValue,QuantityToReceive:e.autoReceive.AutoReceiveProductQuantity,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType}};var a={mashup:i,input:t,autoReceiveEntityValue:e.autoReceive.TranslatedEntityValue};f.callMashup(this,n,s,{}).then(this.onAutoReceiveSuccess.bind(this,a),this.onAutoReceiveError.bind(this,a))}else{f.callMashup(this,i,t,{}).then(this.handleInitApiCalls.bind(this,""),angular.noop)}}else{console.log("Shipment cannot be received !")}}},onAutoReceiveSuccess:function(e,i){var t=i;f.callMashup(this,e.mashup,e.input,{}).then(this.handleInitApiCalls.bind(this,t),angular.noop)},onAutoReceiveError:function(e,i){if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.Errors)&&!iscCore.isVoid(i.Errors.Error)&&!iscCore.isVoid(i.Errors.Error.length>0)){var t=i.Errors.Error[0];var n=t.ErrorCode;if("OMP10080"==n){this.ui.autoReceiveError=S.translate("apierror."+n,{itemId:e.autoReceiveEntityValue})}else{this.ui.autoReceiveError=t.ErrorDescription}}else{if(this.ui.isShipmentContainerized){this.ui.autoReceiveError=S.translate("MSG_FailedToAutoReceivePackage",{containerScm:e.autoReceiveEntityValue})}else{this.ui.autoReceiveError=S.translate("MSG_FailedToAutoReceiveProduct",{itemId:e.autoReceiveEntityValue})}}f.callMashup(this,e.mashup,e.input,{}).then(this.handleInitApiCalls.bind(this,""),angular.noop)},handleInitApiCalls:function(e,i){if(this.ui.isShipmentContainerized){this.model.shipmentContainerList=f.getMashupOutput(i,"getReceivingShipmentContainerList");this.ui.shipmentContainerCount=this.model.shipmentContainerList.Containers.TotalNumberOfRecords;this.ui.currentlySelectedContainer=this.model.shipmentContainerList.Containers.Container[0]}else{this.model.shipmentLineList=f.getMashupOutput(i,"getReceivingShipmentLineList");this.ui.shipmentLineCount=this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords;this.ui.currentlySelectedShipmentLine=this.model.shipmentLineList.ShipmentLines.ShipmentLine[0]}if(this.ui.autoReceiveError){u.showErrorMessage(this.ui.autoReceiveError);this.ui.autoReceiveError=""}else if(this.ui.isAutoReceive&&e){if(this.ui.isShipmentContainerized){this.handleProductSearchAndReceive("searchAndReceiveShipmentByContainer",e)}else{this.handleProductSearchAndReceive("searchAndReceiveShipmentByItemId",e)}}},processShipmentDetails:function(e){if(!iscCore.isVoid(e)){if(!iscCore.isVoid(e.ReceivingAllowed)&&"N"==e.ReceivingAllowed||"Y"==e.ReceiptClosed){this.ui.isReceivingAllowed=false}else{this.ui.isReceivingAllowed=true}var i="";if("0005"==e.DocumentType){i="defaultDispositionCodePO"}else if("0006"==e.DocumentType){i="defaultDispositionCodeTO"}this.ui.defaultDispCode=c.getFromContext(i);if("03"==e.ShipmentContainerizedFlag&&e.CaseContentEntryRequired=="N"){this.ui.isShipmentContainerized=true}else{this.ui.isShipmentContainerized=false}if(this.model.shipmentDetails.Shipment.Status){this.ui.shpStatusBundleKey="instorereceiving.LABEL_"+this.model.shipmentDetails.Shipment.Status.replace(/\./g,"_")}}},setSearchAndScannerLiterals:function(){if(!this.ui.isShipmentContainerized){this.ui.searchAndScannerLiteralKeys.scanFieldLabelKey="globals.LABEL_ScanProductCode";this.ui.searchAndScannerLiteralKeys.searchIconLabelKey="globals.ACTION_Search_product"}else{this.ui.searchAndScannerLiteralKeys.scanFieldLabelKey="globals.LABEL_ScanPackageId";this.ui.searchAndScannerLiteralKeys.searchIconLabelKey="globals.ACTION_Search_Package"}},uiBeforeOpeningRelatedTask:function(e){var i=n.defer();var t=C.receiveShipment.$dirty;if(t){u.showConfirmationMessage(S.translate("globals.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){i.resolve(true)}else{i.reject(false)}})}else{i.resolve(true)}return i.promise},uiGetContainerQuantityLabel:function(e,i){var t="instorereceiving.LABEL_",n="";if("Y"==e){if("Y"==i){t+="Damaged"}else{t+="Received"}}else{t+="Receive";n={count:"1"}}return S.translate(t,n)},uiCancel:function(){if(this.ui.isReceivingAllowed){var e=C.receiveShipment.$dirty;if(e){u.showConfirmationMessage(S.translate("globals.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){o.closeWizard()}})}else{u.showConfirmationMessage(S.translate("instorereceiving.WarningMessage_Cancel")).then(function(e){if(iscCore.isBooleanTrue(e)){o.closeWizard()}})}}else{t.goToState("/home",{},{})}},handleWizardBack:function(){var e=C.receiveShipment.$dirty;if(this.ui.isReceivingAllowed&&e){u.showConfirmationMessage(S.translate("globals.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){o.gotoPreviousPage(true)}})}else{u.showConfirmationMessage(S.translate("instorereceiving.WarningMessage_Cancel")).then(function(e){if(iscCore.isBooleanTrue(e)){o.gotoPreviousPage(true)}})}return true},uiGetShipmentLineListNext:function(){if(this.ui.shipmentLineShownCount<=this.model.shipmentLineList.ShipmentLines.ShipmentLine.length){this.ui.shipmentLineShownCount+=5}},uiShipmentLineScrollActionValidator:function(){return true},uiHandleReceiveShipment:function(){var i=this;var e=C.receiveShipment.$dirty;if(e){u.showConfirmationMessage(S.translate("globals.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){i.handleReceiveShipment()}})}else{this.handleReceiveShipment()}},handleReceiveShipment:function(){var e={ShipmentLine:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType}};var i="getNotReceivedItems";if(this.ui.isShipmentContainerized){e={Container:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType}};i="getNotReceivedContainers"}f.callMashup(this,i,e,{}).then(this.handleNotReceivedAPI.bind(this,i),angular.noop)},handleNotReceivedAPI:function(e,i){var t=f.getMashupOutput(i,e);var n=0;if(this.ui.isShipmentContainerized){n=t.Containers.TotalNumberOfRecords}else{n=t.ShipmentLines.TotalNumberOfRecords}if(parseInt(n)>0){this.openReceiveLaterShipmentPopup(t)}else{this.gotoSummary()}},gotoSummary:function(){var e={ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey};t.goToState("receivingShipmentSummary",e,{})},uiTranslateBarCode:function(e){if(!iscCore.isVoid(e)){var i={BarCode:{BarCodeData:e,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType}};var t=this.ui.isShipmentContainerized?"translateBarCodeForContainerReceiving":"translateBarCodeForProductReceiving";f.callMashup(this,t,i,{}).then(this.handleBarCodeTranslation.bind(this,t),this.handleReceivingAPIErrors.bind(this,t,e))}else{var n=this.ui.isShipmentContainerized?"globals.MSG_InvalidPackageBarCodeData":"globals.MSG_InvalidProductBarCodeData";u.showErrorMessage(S.translate(n))}},handleReceivingAPIErrors:function(e,i,t){if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.Errors)&&!iscCore.isVoid(t.Errors.Error)&&!iscCore.isVoid(t.Errors.Error.length>0)){var n=t.Errors.Error[0];var s=n.ErrorCode;var a="",r="";if("OMP10008"==s){r="apierror.ApiError_ProductNotPartOfShipment"}else if("OMP10080"==s){a={itemId:i};r="apierror."+s}else{r="apierror."+s}console.log("Receiving failed due - ",n.ErrorDescription);u.showErrorMessage(S.translate(r,a))}},handleBarCodeTranslation:function(e,i){var t=f.getMashupOutput(i,e);if(e=="translateBarCodeForProductReceiving"){if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.BarCode)&&!iscCore.isVoid(t.BarCode.ItemList)&&!iscCore.isVoid(t.BarCode.ItemList.ShipmentLine)){var n={ShipmentLine:t.BarCode.ItemList.ShipmentLine};this.updateShipmentLineListAfterReceiving(n);this.highlightLastReceivedProduct(n.ShipmentLine,"SCAN")}}else if(e=="translateBarCodeForContainerReceiving"){var s,a;if(t.BarCode.Receipt){s=t.BarCode.Receipt.Container;a="RECEIVED"}else{s=t.BarCode.Container;a="ALREADY_RECEIVED"}this.updateContainerAfterReceiving(s);this.highlightLastReceivedContainer(s,a)}if(t&&t.BarCode&&t.BarCode.ShipmentStatus){this.ui.shpStatusBundleKey="instorereceiving.LABEL_"+t.BarCode.ShipmentStatus.replace(/\./g,"_")}this.resetBarCodeData()},uiSearchById:function(e){if(!iscCore.isVoid(e)){var i=this.ui.isShipmentContainerized?{Container:{ContainerScm:e,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType}}:{Item:{ItemID:e,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType}};var t=this.ui.isShipmentContainerized?"searchAndReceiveShipmentByContainer":"searchAndReceiveShipmentByItemId";f.callMashup(this,t,i,{}).then(this.handleProductSearchAndReceive.bind(this,t),this.handleReceivingAPIErrors.bind(this,t,e))}else{var n=this.ui.isShipmentContainerized?"globals.MSG_InvalidPackageBarCodeData":"globals.MSG_InvalidProductBarCodeData";u.showErrorMessage(S.translate(n))}},handleProductSearchAndReceive:function(e,i){var t=f.getMashupOutput(i,e);if(e=="searchAndReceiveShipmentByItemId"){if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.ItemList)&&!iscCore.isVoid(t.ItemList.ShipmentLine)){if(t.ItemList.ShipmentStatus){this.ui.shpStatusBundleKey="instorereceiving.LABEL_"+t.ItemList.ShipmentStatus.replace(/\./g,"_")}var n={ShipmentLine:t.ItemList.ShipmentLine};this.updateShipmentLineListAfterReceiving(n);this.highlightLastReceivedProduct(n.ShipmentLine,"SEARCH")}}else if(e=="searchAndReceiveShipmentByContainer"){if(t.Containers.ShipmentStatus){this.ui.shpStatusBundleKey="instorereceiving.LABEL_"+t.Containers.ShipmentStatus.replace(/\./g,"_")}var s,a;if(t.Containers.Receipt){s=t.Containers.Receipt.Container;a="RECEIVED"}else{s=t.Containers.Container[0];a="ALREADY_RECEIVED"}this.updateContainerAfterReceiving(s);this.highlightLastReceivedContainer(s,a)}this.resetBarCodeData()},resetBarCodeData:function(){this.model.scanInput.barCodeData=""},updateShipmentLineListAfterReceiving:function(e){if(!iscCore.isVoid(this.model.shipmentLineList)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords)){var i=a("number")(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords);for(var t=0;t<i;t++){var n=this.model.shipmentLineList.ShipmentLines.ShipmentLine[t];this.ui.receivedItemLineIndex++;if(!iscCore.isVoid(n)&&n.ShipmentLineKey==e.ShipmentLine.ShipmentLineKey){this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].DamagedReceivedQty=a("number")(e.ShipmentLine.DamagedReceivedQty);this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].GoodReceivedQty=a("number")(e.ShipmentLine.GoodReceivedQty);this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].ReceivedQuantity=a("number")(e.ShipmentLine.ReceivedQuantity);this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].DisplayReceivedQuantity=a("number")(e.ShipmentLine.ReceivedQuantity);this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].EditableReceivedQuantity=a("number")(e.ShipmentLine.ReceivedQuantity);this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].ReceiptLines=e.ShipmentLine.ReceiptLines;break}}}},highlightLastReceivedProduct:function(e,i){if(this.ui.shipmentLineShownCount<this.ui.receivedItemLineIndex){this.ui.shipmentLineShownCount=this.ui.receivedItemLineIndex}var t=this;s(function(){m.scrollToElementWIthOffset(document.getElementById("listHolder"),document.getElementById(e.ShipmentLineKey),0,100)},0);this.ui.receivedItemLineIndex=1;if("SCAN"==i||"SEARCH"==i){this.ui.showReceiveMsg="Y";this.ui.lastReceivedItemId=e.ItemID;this.ui.receiveMsgBundleKey="instorereceiving.MSG_ItemReceived"}else if("EDIT"==i){this.ui.showReceiveMsg="Y";this.ui.lastReceivedItemId=e.ItemID;this.ui.receiveMsgBundleKey="instorereceiving.MSG_ItemReceivedQuantityUpdated"}this.uiShowEditButtons(e)},uiIsShipmentLineCompletelyReceivedWithoutDamage:function(e){var i=true;var t=a("number")(e.DisplayReceivedQuantity);var n=a("number")(e.Quantity);var s=a("number")(e.DamagedReceivedQty);if(Number(s)>0){i=false}else if(Number(t)>=Number(n)){i=true}else{i=false}return i},uiIsCompleteLineMissing:function(e){return false},uiShowEditButtons:function(e){this.ui.currentlySelectedShipmentLine=e},openReceiveLaterShipmentPopup:function(e){var i=this;var t={};t.shipmentDetails=this.model.shipmentDetails;t.isShipmentContainerized=this.ui.isShipmentContainerized;t.apiOutput=e;var n={modalInput:function(){return t}};u.openModal("store.views.receiving.receive-shipment.common.receive-later.receive-later",n,{}).then(function(e){if(e.data!==null&&e.data!==undefined){console.log("callBackData.data - ",e.data)}i.gotoSummary()},angular.noop)},uiOnQuantityFieldFocus:function(e,i){if(C.receiveShipment.$valid)var t=g.NUMBER_FORMATS;var n=i.EditableReceivedQuantity;if(!iscCore.isVoid(n)){n=n.replace(t.GROUP_SEP,"")}if(i.showQtyUpdate!=="Y"){e.oldQty=n}},uiValidateQuantity:function(e,i,t,n){if(!iscCore.isVoid(i)&&i.iscDatatypeValidator)return e;else var s=!isNaN(n);if(!iscCore.isBooleanTrue(s)||iscCore.isVoid(n)){e.booleanResponse=!isNaN(n)&&!iscCore.isVoid(n);e.errorMesssage=S.translate("globals.ERROR_invalid_input")}return e},uiShowUpdateButton:function(e,i){var t=g.NUMBER_FORMATS;var n=i.EditableReceivedQuantity;if(n)n=n.replace(t.GROUP_SEP,"");if(!iscCore.isVoid(n)&&e.oldQty!==n&&Number(i.ReceivedQuantity)!=Number(i.EditableReceivedQuantity))i.showQtyUpdate="Y";else i.showQtyUpdate="N"},uiHideUpdateButton:function(e){e.showQtyUpdate="N"},uiValidateQuantityAndUpdate:function(e,i){var t=this;var n=g.NUMBER_FORMATS;var s=i.EditableReceivedQuantity;if(s){s=s.replace(n.GROUP_SEP,"")}i.EditableReceivedQuantity=s;if(!iscCore.isVoid(s)&&e.oldQty!==s&&Number(i.EditableReceivedQuantity)!=Number(i.DisplayReceivedQuantity)){e.oldQty=s;if(typeof s=="string"){s=parseInt(s,10)}var a=Number(i.DamagedReceivedQty);var r=Number(i.EditableReceivedQuantity);var o=Number(i.GoodReceivedQty);var h=Number(i.DisplayReceivedQuantity);var c=Number(i.Quantity);var u="",d="",m="",p=false,l=0,v=0;if(a>0){if(o==0){if(r==0||r<a){p=true}else{l=r-a;m="receiveQuantity"}}else{if(r>h){l=r-h;m="receiveQuantity"}else{var S=h-r;if(S>o){p=true}else{m="unReceiveQuantity";v=S}}}}else{if(r>0){if(r>h){m="receiveQuantity";l=r-h}else{m="unReceiveQuantity";v=h-r}}else{m="unReceiveQuantity";v=h}}if(!p){if("receiveQuantity"==m){u="receiveShipmentLine";d=this.getReceiveShipmentLineInput(l,i)}else if("unReceiveQuantity"==m){u="unreceiveShipmentLine";d=this.getUnReceiveShipmentLineInput(v,i)}f.callMashup(this,u,d,{}).then(this.handleReceivedQuantityUpdate.bind(this,u),function(e){i.EditableReceivedQuantity=i.DisplayReceivedQuantity;C.receiveShipment.$setPristine();t.handleReceivingAPIErrors(u,i.ItemID,e)});i.showQtyUpdate="N"}else{var R=angular.copy(i);R.showUndoDamageQtyError="instorereceiving.MSG_DamageQuantityCannotBeUnreceived";this.uiRecordDamageForShipmentLine(R);i.EditableReceivedQuantity=i.DisplayReceivedQuantity;i.showQtyUpdate="N";C.receiveShipment.$setPristine()}}},getReceiveShipmentLineInput:function(e,i){var t="";if("0005"==i.DocumentType){t="defaultDispositionCodePO"}else if("0006"==i.DocumentType){t="defaultDispositionCodeTO"}var n={Receipt:{ShipmentKey:i.ShipmentKey,DocumentType:i.DocumentType,ReceiptLines:{ReceiptLine:{}},ShipmentLine:i}};n.Receipt.ReceiptLines.ReceiptLine={ItemID:i.ItemID,ShipmentLineKey:i.ShipmentLineKey,UnitOfMeasure:i.UnitOfMeasure,Quantity:e,DispositionCode:c.getFromContext(t)};return n},getUnReceiveShipmentLineInput:function(e,i){return{Receipt:{ShipmentLine:i,ReceiptLines:{ReceiptLine:{Quantity:e}},ReturnUpdatedShipmentLine:"Y"}}},handleReceivedQuantityUpdate:function(e,i){var t=f.getMashupOutput(i,e);if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.Receipt)&&!iscCore.isVoid(t.Receipt.ReceiptLines)&&!iscCore.isVoid(t.Receipt.ReceiptLines.ReceiptLine)&&!iscCore.isVoid(t.Receipt.ReceiptLines.ReceiptLine.length>0)){if(t.Receipt.ShipmentStatus){this.ui.shpStatusBundleKey="instorereceiving.LABEL_"+t.Receipt.ShipmentStatus.replace(/\./g,"_")}var n={ShipmentLine:t.Receipt.ReceiptLines.ReceiptLine[0].ShipmentLine};this.updateShipmentLineListAfterReceiving(n);this.highlightLastReceivedProduct(n.ShipmentLine,"EDIT");C.receiveShipment.$setPristine()}},uiRecordDamageForShipmentLine:function(e){var i={};var t=this;i.ShipmentLine=e;i.shipment=this.model.shipmentDetails;var n={modalInput:function(){return i}};u.openModal("store.views.receiving.receive-shipment.common.record-damage.record-damage",n,{}).then(function(e){if(e.data!==null&&e.data!==undefined){console.log("callBackData.data - ",e.data);if("NOUPDATE"!=e.data){t.postRecordDamage(e.data)}}if(e.shipmentStatus){t.ui.shpStatusBundleKey="instorereceiving.LABEL_"+e.shipmentStatus.replace(/\./g,"_")}},angular.noop)},postRecordDamage:function(e){this.updateShipmentLineListAfterReceiving(e);this.highlightLastReceivedProduct(e.ShipmentLine,"RECORD-DAMAGE")},uiReceiveAllSuccessHandler:function(e){console.log("Receive All - ",e);var i={ShipmentKey:e.taskAPIOutput.ShipmentKey};t.goToState("receivingShipmentSummary",i,{})},uiShowContainerDetails:function(e){var i={ShipmentContainerKey:e.ShipmentContainerKey};var t={modalInput:function(){return i}};u.openModal("store.views.receiving.receive-shipment.common.view-container.view-container",t,{})},uiReceiveContainer:function(e){var i={Receipt:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType,DispositionCode:this.ui.defaultDispCode,CaseId:e.ContainerScm,ShipmentContainerKey:e.ShipmentContainerKey}};f.callMashup(this,"receiveContainer",i,{}).then(this.handleReceiveContainerMashupOutput.bind(this,"receiveContainer"),angular.noop)},uiUndoReceiveAction:function(e){var i={Receipt:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType,CaseId:e.ContainerScm,ShipmentContainerKey:e.ShipmentContainerKey}};f.callMashup(this,"unreceiveContainer",i,{}).then(this.handleReceiveContainerMashupOutput.bind(this,"unreceiveContainer"),angular.noop)},handleReceiveContainerMashupOutput:function(e,i){var t=f.getMashupOutput(i,e);var n,s;if(e=="receiveContainer"){if(t.Receipt.ShipmentStatus){this.ui.shpStatusBundleKey="instorereceiving.LABEL_"+t.Receipt.ShipmentStatus.replace(/\./g,"_")}n=t.Receipt.Container;s="RECEIVED"}else if(e=="unreceiveContainer"){n=t.Container;s="UNRECEIVED"}this.updateContainerAfterReceiving(n);this.highlightLastReceivedContainer(n,s)},updateContainerAfterReceiving:function(e){if(!iscCore.isVoid(this.model.shipmentContainerList)&&!iscCore.isVoid(this.model.shipmentContainerList.Containers)&&!iscCore.isVoid(this.model.shipmentContainerList.Containers.Container)){for(var i=0;i<this.model.shipmentContainerList.Containers.Container.length;i++){var t=this.model.shipmentContainerList.Containers.Container[i];this.ui.receivedItemLineIndex++;if(!iscCore.isVoid(e)&&t.ShipmentContainerKey==e.ShipmentContainerKey){t.IsReceived=e.IsReceived;t.ReceivedAsDamaged=e.ReceivedAsDamaged;break}}}},highlightLastReceivedContainer:function(e,i){if(this.ui.shipmentLineShownCount<this.ui.receivedItemLineIndex){this.ui.shipmentLineShownCount=this.ui.receivedItemLineIndex}var t=this;s(function(){m.scrollToElementWIthOffset(document.getElementById("listHolder"),document.getElementById(e.ShipmentContainerKey),0,0)},0);this.ui.receivedItemLineIndex=1;this.ui.showReceiveMsg="Y";this.ui.lastReceivedItemId=e.ContainerScm;if("RECEIVED"==i){this.ui.receiveMsgBundleKey="instorereceiving.MSG_ContainerReceived"}else if("UNRECEIVED"==i){this.ui.receiveMsgBundleKey="instorereceiving.MSG_ContainerUnreceived"}else if("ALREADY_RECEIVED"==i){this.ui.receiveMsgBundleKey="instorereceiving.MSG_ContainerAlreadyReceived"}else if("RECEIVED_AS_DAMAGED"==i){this.ui.showReceiveMsg="N";this.ui.receiveMsgBundleKey=""}this.uiShowEditButtonsForContainer(e)},uiShowEditButtonsForContainer:function(e){this.ui.currentlySelectedContainer=e},uiRecordDamageAction:function(e){var i=this;var t={};var i=this;t.container=e;t.isShipmentContainerized=this.ui.isShipmentContainerized;t.shipment=this.model.shipmentDetails;var n={modalInput:function(){return t}};u.openModal("store.views.receiving.receive-shipment.common.record-damage.record-damage",n,{}).then(function(e){if(e.data!==null&&e.data!==undefined){if(e.data.container){i.updateContainerAfterReceiving(e.data.container);i.highlightLastReceivedContainer(e.data.container,"RECEIVED_AS_DAMAGED")}}if(e.shipmentStatus){i.ui.shpStatusBundleKey="instorereceiving.LABEL_"+e.shipmentStatus.replace(/\./g,"_")}},angular.noop)},uiAddNote:function(){var i=this;var e=angular.copy(this.model.shipmentDetails);var t={modalInput:function(){return e}};u.openModal("store.views.receiving.notes.shipment-notes",t,{}).then(function(e){i.ui.shipmentNoteCount=e.NoteList.TotalNumberOfRecords},angular.noop)}})}]);
angular.module("store").controller("store.views.receiving.receiving-shipment-list.receiving-shipment-list",["$scope","iscScreen","iscI18n","iscMashup","iscState","iscStateParams","iscAppInfo","iscAppContext","amAddFilter","amSubtractFilter",function(e,t,l,s,i,r,a,o,n,u){t.initializeScreen(e,{model:{returnDispositionList:{},incomingShipments:{},receivedShipments:{},delayedShipments:{},damagedShipments:{}},mashupRefs:[{mashupRefId:"common_getReturnDispositionList",mashupId:"common_getReturnDispositionList",modelName:"returnDispositionList"},{mashupRefId:"receivingShipmentList_getShipmentList_incoming",mashupId:"receivingShipmentList_getShipmentList_incoming",modelName:"incomingShipments",isPaginated:true,pageSize:30,append:true,appendPath:"Shipments.Shipment"},{mashupRefId:"receivingShipmentList_getReceiptList_received",mashupId:"receivingShipmentList_getReceiptList_received",modelName:"receivedShipments",isPaginated:true,pageSize:30,append:true,appendPath:"ReceiptList.Receipt"},{mashupRefId:"receivingShipmentList_getShipmentList_delayed",mashupId:"receivingShipmentList_getShipmentList_delayed",modelName:"delayedShipments",isPaginated:true,pageSize:30,append:true,appendPath:"Shipments.Shipment"},{mashupRefId:"receivingShipmentList_getReceiptList_damaged",mashupId:"receivingShipmentList_getReceiptList_damaged",modelName:"damagedShipments",isPaginated:true,pageSize:30,append:true,appendPath:"ReceiptList.Receipt"}],ui:{mashupCallInProgress:false,isInitCall:false,uiPageSize:10,selectedTabName:"incoming",activeTabIndex:0,tabList:[{name:"incoming",displayName:l.translate("instorereceiving.LABEL_Incoming"),shipmentDateLabel:l.translate("instorereceiving.TITLE_ETA"),filterConfig:{},isLastPage:false,actualData:{},countUIDisplayData:0,countActualData:0},{name:"received",displayName:l.translate("instorereceiving.LABEL_Received"),shipmentDateLabel:l.translate("instorereceiving.TITLE_ReceivedOn"),filterConfig:{},isLastPage:false,actualData:{},countUIDisplayData:0,countActualData:0},{name:"delayed",displayName:l.translate("instorereceiving.LABEL_Delayed"),shipmentDateLabel:l.translate("instorereceiving.TITLE_ETA"),filterConfig:{},isLastPage:false,actualData:{},countUIDisplayData:0,countActualData:0},{name:"damaged",displayName:l.translate("instorereceiving.LABEL_Damaged"),shipmentDateLabel:l.translate("instorereceiving.TITLE_ReceivedOn"),filterConfig:{},isLastPage:false,actualData:{},countUIDisplayData:0,countActualData:0}]},_fromDateReturnFormat:"YYYY-MM-DDT00:00:00",_toDateReturnFormat:"YYYY-MM-DDT23:59:59",_lastSelectedShipment:null,_getDateInRequiredFormatWithTime:function(e,t){var i=e>=0?n:u;var a=null;if(t){a=i(new Date,Math.abs(e),"days").format(this._toDateReturnFormat)}else{a=i(new Date,Math.abs(e),"days").format(this._fromDateReturnFormat)}return a},_getJsDateObjectFromDateString:function(e){if(e!=null&&e.indexOf("T23:59:59")!=-1){e=e.replace("T23:59:59","T00:00:00")}var t=new Date(e+"Z");var i=(new Date).getTimezoneOffset()*6e4;return new Date(t.getTime()+i)},initialize:function(){var e=o.getFromContext("inStoreReceiving_shipmentListConfigData");if(e==null&&!iscCore.isVoid(r.params)){this.ui.selectedTabName=r.params.defaultTab}else if(e==null&&iscCore.isVoid(r.params)){this.ui.selectedTabName="incoming";console.warn("store.views.receiving.receiving-shipment-list.receiving-shipment-list: unexpected scenario. Did not receive input about which tab to select. Selecting 'incoming' by default.")}this.initializeAllTabFilterConfigWithDefaults();if(e!=null){this.ui.selectedTabName=e["selectedTab"];var t=e["filterConfigByTabName"];for(var i=0;i<this.ui.tabList.length;i++){var a=this.ui.tabList[i];var n=a["name"];a["filterConfig"]=angular.copy(t[n])}}this.ui.isInitCall=true;this.uiUpdateSelection(this.ui.selectedTabName);var s=false;if(this.ui.selectedTabName!=="incoming"){s=true}this.invokeDispositionCodeListMashup(s)},initializeAllTabFilterConfigWithDefaults:function(){for(var e=0;e<this.ui.tabList.length;e++){var t=this.ui.tabList[e];var i=t["name"];var a=t["filterConfig"];var n=this._getDateInRequiredFormatWithTime(0,false);var s=this._getDateInRequiredFormatWithTime(0,true);if(i!=="delayed"){if(i==="incoming"){a.calleeId="shipmentDateFilter_incoming";n=this._getDateInRequiredFormatWithTime(0,false);s=this._getDateInRequiredFormatWithTime(6,true)}if(iscCore.isVoid(a.selectedFromShipmentDate)||iscCore.isVoid(a.selectedToShipmentDate)){a.selectedFromShipmentDate=n;a.selectedFromDate=this._getJsDateObjectFromDateString(n);a.selectedToShipmentDate=s;a.selectedToDate=this._getJsDateObjectFromDateString(s)}}}},persistDataInContext:function(){var e={};for(var t=0;t<this.ui.tabList.length;t++){var i=this.ui.tabList[t];e[i["name"]]=angular.copy(i["filterConfig"])}o.addToContext("inStoreReceiving_shipmentListConfigData",{selectedTab:this.ui.selectedTabName,filterConfigByTabName:e})},invokeDispositionCodeListMashup:function(e){this.ui.mashupCallInProgress=true;var t=this;s.callMashup(this,"common_getReturnDispositionList",{},{showMask:true}).then(this.invokeMashupForSelectedTab.bind(this,e,"START"),angular.noop)},invokeMashupForSelectedTab:function(e,t){this.ui.mashupCallInProgress=false;var i="";var a={};switch(this.ui.selectedTabName){case"received":i="receivingShipmentList_getReceiptList_received";a=this.addFilterDataToInput("received",this.ui.tabList[1]["filterConfig"]);break;case"delayed":i="receivingShipmentList_getShipmentList_delayed";a=this.addFilterDataToInput("delayed",this.ui.tabList[2]["filterConfig"]);break;case"damaged":i="receivingShipmentList_getReceiptList_damaged";a=this.addFilterDataToInput("damaged",this.ui.tabList[3]["filterConfig"]);break;default:i="receivingShipmentList_getShipmentList_incoming";a=this.addFilterDataToInput("incoming",this.ui.tabList[0]["filterConfig"])}if(e){var n=this.addFilterDataToInput("incoming",this.ui.tabList[0]["filterConfig"]);s.callPaginatedMashup(this,"receivingShipmentList_getShipmentList_incoming",n,"START",{showMask:false}).then(this.handleMashupOutput.bind(this,e),angular.noop)}if(a!=null){this.ui.mashupCallInProgress=true;s.callPaginatedMashup(this,i,a,t,{showMask:true}).then(this.handleMashupOutput.bind(this),angular.noop)}},addFilterDataToInput:function(e,t){var i=t.selectedFromShipmentDate;var a=t.selectedToShipmentDate;var n=t.selectedShipmentCarrier;var s=t.selectedShipmentSource;var r=t.selectedShipmentType;var l={Or:{Exp:[{Name:"DocumentType",Value:"0005"},{Name:"DocumentType",Value:"0006"}]}};var o={Shipment:{ComplexQuery:l}};if(e=="received"||e=="damaged"){o={Receipt:{Shipment:{},ComplexQuery:l}};if(e==="damaged"){o["Receipt"]["ReceiptLines"]={ReceiptLine:{ComplexQuery:{Or:{Exp:[]}}}};if(this.model.returnDispositionList.ReturnDispositionList!=null&&this.model.returnDispositionList.ReturnDispositionList.ReturnDisposition!=null&&this.model.returnDispositionList.ReturnDispositionList.ReturnDisposition.length>0){for(var u=0;u<this.model.returnDispositionList.ReturnDispositionList.ReturnDisposition.length;u++){var p=this.model.returnDispositionList.ReturnDispositionList.ReturnDisposition[u];o.Receipt.ReceiptLines.ReceiptLine.ComplexQuery.Or.Exp.push({Name:"DispositionCode",Value:p["DispositionCode"]})}}else{return null}}}o=this.addFilterDataToInput_dates(e,o,i,a);o=this.addFilterDataToInput_carrier(e,o,n);o=this.addFilterDataToInput_shipmentSource(e,o,s);o=this.addFilterDataToInput_shipmentType(e,o,r);return o},addFilterDataToInput_dates:function(e,t,i,a){if(!iscCore.isVoid(i)&&!iscCore.isVoid(a)){if(e=="received"||e=="damaged"){t["Receipt"]["FromReceiptDate"]=i;t["Receipt"]["ToReceiptDate"]=a}else{t["Shipment"]["FromExpectedDeliveryDate"]=i;t["Shipment"]["ToExpectedDeliveryDate"]=a;if(e==="delayed"){t["Shipment"]["CustomOnlyConsiderBetweenQryForDates"]="Y";t["Shipment"]["ExpectedDeliveryDateQryType"]="BETWEEN"}}}else{if(e==="delayed"){t["Shipment"]["ExpectedDeliveryDate"]=this._getDateInRequiredFormatWithTime(0,false);t["Shipment"]["CustomOnlyConsiderBetweenQryForDates"]="N";t["Shipment"]["ExpectedDeliveryDateQryType"]="LT"}}return t},addFilterDataToInput_carrier:function(e,t,i){if(!iscCore.isVoid(i)){if(e=="received"||e=="damaged"){t["Receipt"]["Shipment"]["SCAC"]=i}else{t["Shipment"]["SCAC"]=i}}return t},addFilterDataToInput_shipmentSource:function(e,t,i){if(!iscCore.isVoid(i)&&i!=="ALL"){var a="";var n="0005";var s={Or:{Exp:[{Name:"DocumentType",Value:n}]}};if(i==="STORE"){n="0006";a="Store"}else if(i==="WAREHOUSE"){n="0006";a="DC"}s["Or"]["Exp"][0]["Value"]=n;if(e=="received"||e=="damaged"){t["Receipt"]["Shipment"]["ShipNode"]={NodeType:a};t["Receipt"]["ComplexQuery"]=s}else{t["Shipment"]["ShipNode"]={NodeType:a};t["Shipment"]["ComplexQuery"]=s}}return t},addFilterDataToInput_shipmentType:function(e,t,i){if(!iscCore.isVoid(i)&&i!=="ALL"){var a=i==="SPECIAL_ORDER"?"NOTNULL":"ISNULL";var n={ShipmentLine:{OrderLine:{ChainedFromOrderHeaderKeyQryType:a}}};if(e=="received"||e=="damaged"){t["Receipt"]["Shipment"]["ShipmentLines"]=n}else{t["Shipment"]["ShipmentLines"]=n}}return t},handleMashupOutput:function(e,t){if(arguments!=null&&arguments.length==1){t=e;e=null;this.ui.mashupCallInProgress=false}if(t!=null&&t.MashupRefs.MashupRef[0]["mashupRefId"]==="receivingShipmentList_getShipmentList_incoming"){this.ui.tabList[0]["displayName"]=l.translate("instorereceiving.LABEL_Incoming_withValue",{incomingCount:this.model.incomingShipments.Page.Output.Shipments.TotalNumberOfRecords})}delete this.ui.isInitCall;if(!e){for(var i=0;i<this.ui.tabList.length;i++){var a=this.ui.tabList[i];if(a["name"]===this.ui.selectedTabName){var n=t.MashupRefs.MashupRef[0]["Output"]["Page"]["Output"];var s=t.MashupRefs.MashupRef[0]["Output"]["Page"]["IsLastPage"];var r=[];if(s!=null&&(s.toLowerCase()==="y"||s.toLowerCase()==="true"||s===true)){a["isLastPage"]=true}if(n["Shipments"]!=null&&n["Shipments"]["Shipment"]!=null){r=n["Shipments"]["Shipment"]}else if(n["ReceiptList"]!=null&&n["ReceiptList"]["Receipt"]!=null){r=n["ReceiptList"]["Receipt"]}if(a.countActualData>0){if(a["actualData"]!=null&&a["actualData"]["Shipments"]!=null&&a["actualData"]["Shipments"]["Shipment"]!=null){a.countActualData=a["actualData"]["Shipments"]["Shipment"].length}else if(a["actualData"]!=null&&a["actualData"]["ReceiptList"]!=null&&a["actualData"]["ReceiptList"]["Receipt"]!=null){a.countActualData=a["actualData"]["ReceiptList"]["Receipt"].length}}else{a["actualData"]=n;a.countActualData=r.length}if(a.countUIDisplayData+this.ui.uiPageSize>a.countActualData){a.countUIDisplayData=a.countActualData}else{a.countUIDisplayData=a.countUIDisplayData+this.ui.uiPageSize}break}}}},uiGetNextShipmentList:function(){for(var e=0;e<this.ui.tabList.length;e++){var t=this.ui.tabList[e];if(t["name"]===this.ui.selectedTabName){if(t.countUIDisplayData>=t.countActualData&&t["isLastPage"]===false){this.invokeMashupForSelectedTab(false,"NEXT")}else{if(t.countUIDisplayData+this.ui.uiPageSize>t.countActualData){t.countUIDisplayData=t.countActualData}else{t.countUIDisplayData=t.countUIDisplayData+this.ui.uiPageSize}}break}}},uiScrollActionValidator:function(){return!this.ui.mashupCallInProgress},uiUpdateSelection:function(e){for(var t=0;t<this.ui.tabList.length;t++){var i=this.ui.tabList[t];if(i["name"]===e){this.ui.activeTabIndex=t;this.clearModelAndListData(i);break}}this.ui.selectedTabName=e;if(!this.ui.isInitCall){this.invokeMashupForSelectedTab(false,"START")}},clearModelAndListData:function(e){this.model["incomingShipments"]={};this.model["receivedShipments"]={};this.model["delayedShipments"]={};this.model["damagedShipments"]={};e["isLastPage"]=false;e["actualData"]={};e["countUIDisplayData"]=0;e["countActualData"]=0;return e},uiOnApplyFilter:function(e){for(var t=0;t<this.ui.tabList.length;t++){var i=this.ui.tabList[t];if(i["name"]===this.ui.selectedTabName){i["filterConfig"]=e;this.clearModelAndListData(i);break}}this.invokeMashupForSelectedTab(false,"START")},uiNavigateToShipmentSummary:function(e){this.persistDataInContext();i.goToState("receivingShipmentSummary",{ShipmentKey:e},{})},uiNavigateToReceiveShipment:function(e){this.persistDataInContext();var t={Shipment:{ShipmentKey:e["ShipmentKey"],ShipmentContainerizedFlag:e["ShipmentContainerizedFlag"]}};i.goToState("receive-shipment",{action:"receiveShipment",input:t,autoReceive:""},{})},uiShowEditButton:function(e){if(this._lastSelectedShipment!=null&&e["ShipmentKey"]!=this._lastSelectedShipment["ShipmentKey"]){this._lastSelectedShipment._showEditButton=false;this._lastSelectedShipment=e}else if(this._lastSelectedShipment==null){this._lastSelectedShipment=e}e._showEditButton=true},uiReturnToHomePage:function(){i.goToState("/home",{},{})},uiClose:function(){i.goToState("/home",{},{})}})}]);
angular.module("store").controller("store.views.receiving.receiving-shipment-summary.receiving-shipment-summary",["$scope","$filter","iscScreen","iscI18n","iscMashup","iscState","iscStateParams","iscAppInfo","iscAppContext","iscModal",function(e,o,i,s,n,t,a,r,h,u){i.initializeScreen(e,{model:{shipmentDetails:{},shipmentLineList:{},shipmentContainerList:{}},mashupRefs:[{mashupRefId:"getShipmentDetails",mashupId:"store.views.receiving.getShipmentDetailsForReceiving",modelName:"shipmentDetails"},{mashupRefId:"getShipmentLineList",mashupId:"store.views.receiving.getReceivingShipmentLineList",modelName:"shipmentLineList"},{mashupRefId:"getShipmentContainerList",mashupId:"store.views.receiving.getReceivingShipmentContainerList",modelName:"shipmentContainerList"}],ui:{screenType:"RECEIVE_SUMMARY",shipmentNo:"",shipmentKey:"",isShipmentContainerized:false,shipmentLineCount:0,shipmentContainerCount:0,isReceiptClosed:false,isReceivingAllowed:false,screenTitle:s.translate("instorereceiving.TITLE_Receiving_Shipment_Summary",{shipmentNo:""}),shpStatusBundleKey:"",uiPageSize:10,currentDisplayCount:10,shipmentPreviewTemplate:"store/views/receiving/receive-shipment/receive-shipment-popover-preview.tpl.html",shipmentNoteCount:"0"},_lastSelectedLineOrContainer:null,initialize:function(){if(!iscCore.isVoid(a.params)){this.ui.shipmentKey=a.params.ShipmentKey;this.ui.screenTitle=s.translate("instorereceiving.TITLE_Receiving_Shipment_Summary",{shipmentNo:this.ui.shipmentNo})}else{console.error("store.views.receiving.receiving-shipment-summary.receiving-shipment-summary: unexpected scenario. Did not receive input shipmentNumber. Can not proceed!!");return}this.shipmentDetailsMashup()},shipmentDetailsMashup:function(){n.callMashup(this,"getShipmentDetails",{Shipment:{ShipmentKey:this.ui.shipmentKey}},{showMask:true}).then(this.handleDetailsMashupOutput.bind(this),angular.noop)},handleDetailsMashupOutput:function(){if(this.model.shipmentDetails.Shipment.Notes.Note)this.ui.shipmentNoteCount=this.model.shipmentDetails.Shipment.Notes.NumberOfNotes;if("03"==this.model.shipmentDetails.Shipment.ShipmentContainerizedFlag&&this.model.shipmentDetails.Shipment.CaseContentEntryRequired=="N"){this.ui.isShipmentContainerized=true}else{this.ui.isShipmentContainerized=false}if("Y"==this.model.shipmentDetails.Shipment.ReceiptClosed){this.ui.isReceiptClosed=true}else{this.ui.isReceiptClosed=false}this.ui.shpStatusBundleKey="shipmentsummary.LABEL_"+this.model.shipmentDetails.Shipment.Status.replace(/\./g,"_");var e="getShipmentLineList";var i={};if(this.ui.isShipmentContainerized){e="getShipmentContainerList";i={Container:{ShipmentKey:this.ui.shipmentKey}};console.log("Calling mashup for containerList")}else{i={ShipmentLine:{ShipmentKey:this.ui.shipmentKey}};console.log("Calling mashup for LineList")}var t=[];t.push(n.getMashupRefObj(this,e,i));n.callMashups(this,t,{}).then(this.handleListMashupOutput.bind(this),angular.noop)},handleListMashupOutput:function(){if(this.ui.isShipmentContainerized){this.ui.shipmentContainerCount=this.model.shipmentContainerList.Containers.TotalNumberOfRecords;console.log(this.model.shipmentDetails,this.model.shipmentContainerList)}else{this.ui.shipmentLineCount=this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords;console.log(this.model.shipmentDetails,this.model.shipmentLineList)}},uiScrollActionValidator:function(){return true},uiShipmentLineScrollActionValidator:function(){return true},uiGetNextList:function(){this.ui.currentDisplayCount=this.ui.currentDisplayCount+this.ui.uiPageSize},uiGetShipmentLineListNext:function(){this.ui.currentDisplayCount=this.ui.currentDisplayCount+this.ui.uiPageSize},uiShowEditButtons:function(e){},uiGotoHome:function(){t.goToState("/home",{},{})},uiGetContainerQuantityLabel:function(e,i){var t="instorereceiving.LABEL_",n="";if("Y"==e){if("Y"==i){t+="Damaged"}else{t+="Received"}}else{if(this.ui.isReceiptClosed){t+="Missing"}else{t+="NotReceived"}}return s.translate(t,n)},uiShowContainerDetails:function(e){var i={ShipmentContainerKey:e.ShipmentContainerKey};var t={modalInput:function(){return i}};u.openModal("store.views.receiving.receive-shipment.common.view-container.view-container",t,{})},uiIsShipmentLineCompletelyReceivedWithoutDamage:function(e){var i=true;var t=o("number")(e.DisplayReceivedQuantity);var n=o("number")(e.Quantity);var s=o("number")(e.DamagedReceivedQty);if(Number(s)>0){i=false}else if(Number(t)>=Number(n)){i=true}else{i=false}return i},uiIsCompleteLineMissing:function(e){var i=o("number")(e.DisplayReceivedQuantity);if(this.ui.isReceiptClosed&&Number(i)==0){return true}else{return false}},uiAddNote:function(){var i=this;var e=angular.copy(this.model.shipmentDetails);var t={modalInput:function(){return e}};u.openModal("store.views.receiving.notes.shipment-notes",t,{}).then(function(e){i.ui.shipmentNoteCount=e.NoteList.TotalNumberOfRecords},angular.noop)}})}]);
angular.module("store").controller("store.views.return.add-exch-item.add-exchange-item",["$animate","$scope","$rootScope","iscScreen","iscWizard","$location","$sce","$filter","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscItem",function(e,i,t,r,a,s,o,d,l,n,u,m,h,c,f){a.initializeWizardPage(i,{model:{getCompleteItemList:{},itemDetails:{},orderDetails:{},getItemAvailabilityForStore:{},getRuleDetails:{}},mashupRefs:[{mashupRefId:"getCompleteItemList",mashupId:"additems_getCompleteItemList",modelName:"getCompleteItemList"},{mashupRefId:"getRelatedItems",mashupId:"addItems_getRelatedItems",modelName:"relatedItemDetails"},{mashupRefId:"createOrder",mashupId:"exchange_createOrder",modelName:"orderDetails"},{mashupRefId:"modifyFulfillmentOptions",mashupId:"exchange_modifyFulfillmentOptions",modelName:"orderDetails"},{mashupRefId:"createOrderWithOvp",mashupId:"exchange_ovp_createOrder",modelName:"orderDetails"},{mashupRefId:"modifyFulfillmentOptionsWithOvp",mashupId:"exchange_ovp_modifyFulfillmentOptions",modelName:"orderDetails"},{mashupRefId:"getItemAvailabilityForStore",mashupId:"addItems_getItemAvailabilityForStore",modelName:"getItemAvailabilityForStore"},{mashupRefId:"getCompleteOrderDetails",mashupId:"addItems_getCompleteOrderDetails",modelName:"orderDetails"},{mashupRefId:"exchange_getRuleDetails",mashupId:"exchange_getRuleDetails",modelName:"getRuleDetails"},{mashupRefId:"getRealTimeItemAvailabilityForStore",mashupId:"exchange_getRealTimeItemAvailability"}],ui:{showItemDetails:false,noProductsFound:false,showItemDesc:true,showRelatedItems:false,defaultQty:1,orderTotalQty:0,deliveryMethod:"",searchInput:"",variantItemId:"",isScreenDirty:false,focusScanField:false,gift:{giftOptionsAvailable:true},priceOverride:{isPriceOverriden:false,priceOverrideReason:""},selectedShipNode:{shipNode:"",shipNodeDesc:""},availability:{itemShpAvailableDate:"",itemShpAvailableText:"",itemShpAvailable:false,itemShpAvailableToday:false,itemPickAvailable:false,itemPickAvailableText:"",itemPickAvailableDate:"",itemCarryAvailable:false,itemCarryAvailableDate:""},activeTabIndex:0},initialize:function(){t.$showBackButtonForStates=false;var e=a.getWizardPageInput();var i=e.input;this.ui.focusScanField=false;this.getCompleteItemDetails(i);a.setWizardModel("forReturnReasonPopup",{ExchangeOrderOpened:"Y"})},uiCancel:function(){a.gotoPreviousPage(true)},uiOpenProductSearch:function(t){var r=this;var e=true;if(this.ui.isScreenDirty){u.showConfirmationMessage(h.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){if(!iscCore.isVoid(t)){var i={input:t};a.gotoCustomPage("productSearch",i,{wizardPageCssClass:"fullscreen-modal"})}else{u.showErrorMessage(h.translate("addItems.MSG_ProductSearchError"))}}else{r.model.searchInput=""}})}else{if(!iscCore.isVoid(t)){var i={input:t};a.gotoCustomPage("productSearch",i,{wizardPageCssClass:"fullscreen-modal"})}else{u.showErrorMessage(h.translate("addItems.MSG_ProductSearchError"))}}},uiShowItemDesc:function(){this.ui.showItemDesc=true;this.ui.activeTabIndex=0;this.ui.showRelatedItems=false},uiShowRelatedItems:function(){if(iscCore.isVoid(this.model.relatedItemDetails)){this.showRelatedItems()}else{this.ui.showItemDesc=false;this.ui.activeTabIndex=1;this.ui.showRelatedItems=true}},uiHandleAddToCart:function(){this.ui.focusScanField=false;var e=this.getAddToCartInput();if(e!==-1){this.saveItemToCart(e)}},uiOpenItemDetails:function(i){var t=this;if(iscCore.isVoid(i)){u.showErrorMessage(h.translate("addItems.MSG_ProductSearchError"))}else if(this.ui.isScreenDirty){u.showConfirmationMessage(h.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){a.gotoCustomPage("addItems",{input:i},{removeCurrent:true,wizardPageCssClass:"fullscreen-modal"})}else{t.model.searchInput=""}})}else{a.gotoCustomPage("addItems",{input:i},{removeCurrent:true,wizardPageCssClass:"fullscreen-modal"})}},resetUIAttributes:function(){this.ui.noProductsFound=false;this.ui.showItemDesc=true;this.ui.activeTabIndex=0;this.ui.showRelatedItems=false;this.ui.defaultQty=1;this.ui.priceOverride.isPriceOverriden=false;this.ui.variantItemId="";this.ui.selectedShipNode={shipNode:"",shipNodeDesc:""};this.model.relatedItemDetails={};var e=f.getResetAvailabilityObjAndDeliveryMethod();this.ui.availability=e.availability;this.ui.deliveryMethod=e.deliveryMethod},showRelatedItems:function(){var e=this.getCompleteItemDetailsApiInput(this.model.itemDetails.ItemID,false);n.callMashup(this,"getRelatedItems",e,{}).then(function(){this.ui.showItemDesc=false;this.ui.activeTabIndex=1;this.ui.showRelatedItems=true}.bind(this),angular.noop)},getAddToCartInput:function(){var e={};e.Order={};var i=a.getWizardModel("exchangeOrderModel");var t=a.getWizardModel("returnOrder");if(!iscCore.isVoid(i)){e.Order.OrderHeaderKey=i.Order.OrderHeaderKey;if(iscCore.isVoid(i.Order.BillToID)&&!iscCore.isVoid(t.Order.BillToID)){e.Order.BillToID=t.Order.BillToID;e.Order.CustomerContactID=t.Order.CustomerContactID;e.Order.CustomerFirstName=t.Order.CustomerFirstName;e.Order.CustomerLastName=t.Order.CustomerLastName;e.Order.CustomerEMailID=t.Order.CustomerEMailID}if(iscCore.isVoid(i.Order.PersonInfoShipTo)&&!iscCore.isVoid(t.Order.PersonInfoShipTo)){e.Order.PersonInfoShipTo=t.Order.PersonInfoShipTo}if(iscCore.isVoid(i.Order.PersonInfoBillTo)&&!iscCore.isVoid(t.Order.PersonInfoBillTo)){e.Order.PersonInfoBillTo=t.Order.PersonInfoBillTo}}else{e.Order.ReturnOrderHeaderKeyForExchange=t.Order.OrderHeaderKey;if(!iscCore.isVoid(t.Order.PersonInfoShipTo)){e.Order.PersonInfoShipTo=t.Order.PersonInfoShipTo}if(!iscCore.isVoid(t.Order.PersonInfoBillTo)){e.Order.PersonInfoBillTo=t.Order.PersonInfoBillTo}if(!iscCore.isVoid(t.Order.BillToID)){e.Order.BillToID=t.Order.BillToID;e.Order.CustomerContactID=t.Order.CustomerContactID;e.Order.CustomerFirstName=t.Order.CustomerFirstName;e.Order.CustomerLastName=t.Order.CustomerLastName;e.Order.CustomerEMailID=t.Order.CustomerEMailID}e.Order.ExchangeType=this.model.getRuleDetails.Rules.RuleSetValue;e.Order.EntryType=c.getFromContext("storeEntryType");e.Order.DocumentType=c.getFromContext("salesOrderDocType")}e.Order.OrderLines={};e.Order.OrderLines.OrderLine=[{Item:{ItemID:this.model.itemDetails.ItemID,UnitOfMeasure:this.model.itemDetails.UnitOfMeasure},OrderLineTranQuantity:{OrderedQty:this.ui.defaultQty}}];if(this.ui.deliveryMethod!=""){if(this.ui.deliveryMethod==="CARRY"){e.Order.OrderLines.OrderLine[0].DeliveryMethod=this.ui.deliveryMethod}else if(this.ui.deliveryMethod==="PICK"){if(this.ui.selectedShipNode.shipNode===""){this.uiOpenStoreSearch("addToCart");return-1}else{e.Order.OrderLines.OrderLine[0].ShipNode=this.ui.selectedShipNode.shipNode;e.Order.OrderLines.OrderLine[0].DeliveryMethod=this.ui.deliveryMethod;e.Order.OrderLines.OrderLine[0].ReqShipDate=this.ui.availability.itemPickAvailableDate}}else if(this.ui.deliveryMethod==="SHP"){e.Order.OrderLines.OrderLine[0].DeliveryMethod=this.ui.deliveryMethod;var r=this.model.getCompleteItemList.ItemList.Item[0].Availabilities.IsAvailabilityRealTimeData;if(r==="Y"){e.Order.OrderLines.OrderLine[0].EarliestShipDate=this.ui.availability.itemShpAvailableDate;e.Order.OrderLines.OrderLine[0].ReqShipDate=this.ui.availability.itemShpAvailableDate}}}return e},setPriceOverrideInAddToCartInput:function(e){e.Order.OrderLines.OrderLine[0].LinePriceInfo={ListPrice:this.model.itemDetails.ComputedPrice.ListPrice,UnitPrice:this.model.itemDetails.ComputedPrice.UnitPrice,IsPriceLocked:"Y"};this.addPriceOverrideDefaultNote(e)},addPriceOverrideDefaultNote:function(e){var i=h.translate("addItems.MSG_PriceOverrideReason",{overrideReason:this.ui.priceOverride.priceOverrideReason});e.Order.OrderLines.OrderLine[0].Notes=[{Note:{NoteText:i,ReasonCode:"YCD_NEW_ITEM_INFO"}}]},saveItemToCart:function(e){var i="createOrder";if(e&&!iscCore.isVoid(e.Order)){if(this.ui.priceOverride.isPriceOverriden){this.setPriceOverrideInAddToCartInput(e);if(!iscCore.isVoid(e.Order.OrderHeaderKey)){i="modifyFulfillmentOptionsWithOvp"}else{i="createOrderWithOvp"}}else{if(!iscCore.isVoid(e.Order.OrderHeaderKey)){i="modifyFulfillmentOptions"}else{i="createOrder"}}}if((i==="modifyFulfillmentOptions"||i==="createOrder")&&e.Order.OrderLines.OrderLine[0].DeliveryMethod==="SHP"&&iscCore.isVoid(e.Order.OrderLines.OrderLine[0].EarliestShipDate)){var t=this.getItemAvailabilityForStoreApiInput(this.ui.defaultQty);t.Promise.addToCartInput=e;t.Promise.mashupToCall=i;n.callMashup(this,"getRealTimeItemAvailabilityForStore",t,{}).then(function(e){var i=e.MashupRefs.MashupRef[0].Output;a.setWizardModel("exchangeOrderModel",i);this.ui.orderTotalQty=i.Order.OrderLines.TotalNumberOfRecords;this.model.orderDetails=i;this.ui.focusScanField=false;this.resetOrderRelatedAttrs();var t=a.getWizardModel("returnOrder");a.gotoPreviousPage(true)}.bind(this),angular.noop)}else{n.callMashup(this,i,e,{}).then(function(e){var i=e.MashupRefs.MashupRef[0].Output;a.setWizardModel("exchangeOrderModel",i);this.ui.orderTotalQty=i.Order.OrderLines.TotalNumberOfRecords;this.model.orderDetails=i;this.ui.focusScanField=false;this.resetOrderRelatedAttrs();var t=a.getWizardModel("returnOrder");a.gotoPreviousPage(true)}.bind(this),angular.noop)}},getItemAvailabilityForStoreApiInput:function(e){var i=c.getFromContext("storeAddress").ShipNodePersonInfo;var t={Promise:{ShipToAddress:i,PromiseLines:[{PromiseLine:{ItemID:this.model.itemDetails.ItemID,UnitOfMeasure:this.model.itemDetails.UnitOfMeasure,ProductClass:this.model.itemDetails.ProductClass,RequiredQty:e}}]}};var r=a.getWizardModel("exchangeOrderModel");if(!iscCore.isVoid(r)&&!iscCore.isVoid(r.Order.OrderHeaderKey)){t.Promise.OrderHeaderKey=r.Order.OrderHeaderKey}return t},resetOrderRelatedAttrs:function(){this.ui.isScreenDirty=false;this.ui.priceOverride={isPriceOverriden:false,priceOverrideReason:""}},getCompleteItemDetails:function(e){if(iscCore.isVoid(e)){u.showErrorMessage(h.translate("addItems.MSG_ProductSearchError"))}else{var i=this.getCompleteItemDetailsApiInput(e,true);i.Item.DefaultPageSize=c.getFromContext("defaultPageSize");var t=[];t.push(n.getMashupRefObj(this,"getCompleteItemList",i));t.push(n.getMashupRefObj(this,"exchange_getRuleDetails",{Rules:{RuleSetFieldName:"YCD_DEFAULT_EXCHANGE_TYPE"}}));n.callMashups(this,t,{}).then(this.handleGetCompleteItemDetails.bind(this),angular.noop)}},handleGetCompleteItemDetails:function(e){var i=n.getMashupOutput(e,"getCompleteItemList");var t=i.ItemList.Item;if(!a.getWizardContext("findProductDone")&&c.isMobile()&&a.getWizardAction()=="NEXT"){a.setWizardContext("findProductDone","true");this.ui.focusScanField=false}else if(a.getWizardContext("findProductDone")&&c.isMobile()&&a.getWizardAction()=="PREVIOUS"){a.setWizardContext("findProductDone",false);this.ui.focusScanField=false}else{this.ui.focusScanField=true}var r=i.ItemList.SearchResult;if(iscCore.isVoid(t)&&iscCore.isVoid(r)){this.ui.noProductsFound=true;this.ui.showItemDetails=false}else if(!iscCore.isVoid(r)){a.gotoCustomPage("productSearch",r,{removeCurrent:true,wizardPageCssClass:"fullscreen-modal"})}else{this.ui.showItemDetails=true;this.resetUIAttributes();this.model.itemDetails=this.model.getCompleteItemList.ItemList.Item[0];if(this.model.itemDetails.PrimaryInformation.KitCode==="BUNDLE"||this.model.itemDetails.PrimaryInformation.KitCode==="PK"||this.model.itemDetails.PrimaryInformation.KitCode==="DPK"){u.showErrorMessage(h.translate("globals.MSG_Item_not_supported"));return}if(!iscCore.isVoid(this.model.itemDetails.ClassificationCodes)&&!iscCore.isVoid(this.model.itemDetails.ClassificationCodes.Model)){this.ui.variantItemId=this.model.itemDetails.ItemID}if(!iscCore.isVoid(this.model.itemDetails.Availabilities)){var s=f.handleItemAvailability(this.model.itemDetails.Availabilities,this.ui.selectedShipNode,this.model.itemDetails.PrimaryInformation.IsShippingAllowed,this.model.itemDetails.PrimaryInformation.IsPickupAllowed);this.ui.availability=s.availability;this.ui.deliveryMethod=s.deliveryMethod;if(s.selectedShipNode!=null){this.ui.selectedShipNode=s.selectedShipNode}}}},handleWizardBack:function(){var e=a.isFirstPage();if(this.ui.isScreenDirty){if(e){this.uiCancel()}else{u.showConfirmationMessage(h.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){a.gotoPreviousPage(true)}})}return true}else if(e){this.uiCancel();return true}else{return false}},handleWizardExit:function(){var e=h.translate("order.WarningMessage_Cancel");if(this.ui.orderTotalQty<1){e=h.translate("addItems.WarningMessage_Cancel")}u.showConfirmationMessage(e).then(function(e){if(e==="YES"){a.exitWizard()}},function(e){});return true},getCompleteItemDetailsApiInput:function(e,i){var t={Item:{ItemID:e}};var r=a.getWizardModel("orderModel");if(!iscCore.isVoid(r)){var s=iscCore.getValueFromJsonPath(r,"Order.BillToID");if(!iscCore.isVoid(s)){t.Item.CustomerInformation={CustomerID:s}}}if(i){t.Item.BarCode={BarCodeData:e}}return t},uiShareProductDetails:function(){var e=this;var i="";var t=a.getWizardModel("returnOrder");if(!iscCore.isVoid(t)){var r=iscCore.getValueFromJsonPath(t,"Order.BillToID");if(!iscCore.isVoid(r)){i=r}}var s={modalInput:function(){return{ItemDetails:{ItemID:e.model.itemDetails.ItemID,UnitOfMeasure:e.model.itemDetails.UnitOfMeasure,ItemKey:e.model.itemDetails.ItemKey},CustomerDetails:{CustomerID:i}}}};u.openModal("store.views.common.product.product-details-share",s,{}).then(angular.noop,angular.noop)}})}]);
angular.module("store").controller("store.views.return.add-return-item.add-return-item",["$animate","$scope","$rootScope","iscScreen","iscWizard","$location","$sce","$filter","$timeout","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscReturn",function(e,r,t,i,s,a,o,d,n,l,u,m,c,h,I,f){s.initializeWizardPage(r,{model:{getCompleteItemList:{},itemDetails:{},returnOrder:{},itemPreview:{},lookupConfig:{LookupType:"PRODUCT"}},mashupRefs:[{mashupRefId:"getCompleteItemList",mashupId:"blindreturns_getCompleteItemList",modelName:"getCompleteItemList"},{mashupRefId:"createOrder",mashupId:"blindreturns_createOrder",modelName:"returnOrder"},{mashupRefId:"changeOrder",mashupId:"blindreturns_changeOrder",modelName:"returnOrder"}],ui:{showItemDetails:false,noProductsFound:false,showItemDesc:true,defaultQty:1,orderTotalQty:0,variantItemId:"",hideSearch:"N",activeTabIndex:0,showProductShare:true},initialize:function(){var e=s.getWizardPageInput();var t=e.input;var i=e.callAPI;if(i){this.callGetCompleteItemListWithItemID(t)}else{this.updateItemDetailsModel(t)}f.setMiniCartParam(this);r.$on("uiSearchClose",function(e,t){if(t){r.ui.hideSearch="N"}})},uiRenderHtml:function(e){return o.trustAsHtml(e)},uiHandleSearchResult:function(e){var t={input:e.NextPage.model,callAPI:e.NextPage.callAPI};s.gotoCustomPage(e.NextPage.action,t,{})},uiHandleReviewReturn:function(){s.gotoCustomPage("returnsList",{input:this.model.returnOrder.Order.OrderHeaderKey},{})},uiOpenItemDetails:function(e){if(iscCore.isVoid(e)){m.showErrorMessage(h.translate("addItems.MSG_ProductSearchError"))}else{this.callGetCompleteItemListWithItemID(e)}},callGetCompleteItemListWithItemID:function(e){var t={Item:{ItemID:e}};var i=s.getWizardModel("returnOrder");if(!iscCore.isVoid(i)){var r=i.Order.BillToID;if(!iscCore.isVoid(r)){t.Item.CustomerInformation={CustomerID:r}}}u.callMashup(this,"getCompleteItemList",t,{}).then(function(e){var t=u.getMashupOutput(e,"getCompleteItemList");this.updateItemDetailsModel(t)}.bind(this),angular.noop)},uiShowItemDesc:function(){this.ui.showItemDesc=true;this.ui.activeTabIndex=0},uiHandleAddToCart:function(){var e=this.getAddToCartInput();this.saveItemToCart(e)},updateItemDetailsModel:function(e){this.model.getCompleteItemList=e;this.ui.showItemDetails=true;this.model.itemDetails=e.ItemList.Item[0];this.ui.headerProductId=e.ItemList.Item[0].ItemID;if(!iscCore.isVoid(this.model.itemDetails.ClassificationCodes)&&!iscCore.isVoid(this.model.itemDetails.ClassificationCodes.Model)){this.ui.variantItemId=this.model.itemDetails.ItemID}},getAddToCartInput:function(){var e={};e.Order={};if(!iscCore.isVoid(this.model.returnOrder)){e.Order.OrderHeaderKey=this.model.returnOrder.Order.OrderHeaderKey}else{e.Order.EntryType=I.getFromContext("storeEntryType")}e.Order.OrderLines={};e.Order.OrderLines.OrderLine=[{Item:{ItemID:this.model.itemDetails.ItemID,UnitOfMeasure:this.model.itemDetails.UnitOfMeasure},OrderLineTranQuantity:{OrderedQty:this.ui.defaultQty},LinePriceInfo:{UnitPrice:this.model.itemDetails.ComputedPrice.ReturnPrice}}];return e},saveItemToCart:function(e){var t="createOrder";if(!iscCore.isVoid(e.Order.OrderHeaderKey)){t="changeOrder"}u.callMashup(this,t,e,{}).then(this.handleCreateOrChangeOrder.bind(this),angular.noop)},handleCreateOrChangeOrder:function(e){var t=e.MashupRefs.MashupRef[0].Output;s.setWizardModel("returnOrder",t);this.ui.orderTotalQty=t.Order.OrderLines.TotalLinesInCart;this.model.returnOrder=t;this.showItemPreview();if(this.ui.defaultQty==1){var i=h.translate("returns.aria_cartAdditionSuccessMessage",{cartcount:this.ui.orderTotalQty})}if(this.ui.defaultQty>1){var i=h.translate("returns.aria_cartAdditionSuccessMessageMultipleProducts",{cartcount:this.ui.orderTotalQty,productsadded:this.ui.defaultQty})}m.showA11YAlertMessage(i)},showItemPreview:function(){this.model.itemPreview={};if(!iscCore.isVoid(this.model.itemDetails)&&!iscCore.isVoid(this.model.itemDetails.PrimaryInformation)){this.model.itemPreview.ImageURL=this.model.itemDetails.PrimaryInformation.ImageURL;this.model.itemPreview.ItemDetails={};this.model.itemPreview.ItemDetails.PrimaryInformation={};this.model.itemPreview.ItemDetails.PrimaryInformation.ExtendedDisplayDescription=this.model.itemDetails.PrimaryInformation.ExtendedDisplayDescription;this.model.itemPreview.ShowTick=false;this.model.itemPreview.ItemDetails.Quantity=this.ui.defaultQty;n(function(){var e=document.getElementById("itemPreviewSpan");if(!iscCore.isVoid(e)){r.$broadcast("itemPreviewSpanClicked",{data:r.ui.defaultQty})}},0)}},uiIncreaseQty:function(){this.ui.defaultQty++},uiDecreaseQty:function(){if(this.ui.defaultQty!==1){this.ui.defaultQty--}},uiCancel:function(){f.handleWizardExit(this.ui.orderTotalQty)},handleWizardBack:function(){return f.handleWizardBack(false,this.ui.orderTotalQty)},handleWizardExit:function(){return f.handleWizardExit(this.ui.orderTotalQty)},uiShareProductDetails:function(){var e=this;var t="";var i=s.getWizardModel("returnOrder");if(!iscCore.isVoid(i)){var r=iscCore.getValueFromJsonPath(i,"Order.BillToID");if(!iscCore.isVoid(r)){t=r}}var a={modalInput:function(){return{ItemDetails:{ItemID:e.model.itemDetails.ItemID,UnitOfMeasure:e.model.itemDetails.UnitOfMeasure,ItemKey:e.model.itemDetails.ItemKey},CustomerDetails:{CustomerID:t}}}};m.openModal("store.views.common.product.product-details-share",a,{}).then(angular.noop,angular.noop)}})}]);
angular.module("store").controller("store.views.return.customer-details.customer-details",["$animate","$timeout","$document","$scope","$rootScope","$filter","iscScreen","iscWizard","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscReturn","iscRule","iscOrder",function(e,t,r,i,s,o,a,u,n,d,l,h,m,c,p,f,O){var C=function(e){if(e.which===27&&!e.defaultPrevented){this.ui.showCustomerPreview=false;r.off("keydown",C);i.$apply()}};i.$on("$destroy",function(){r.off("keydown",C)});u.initializeWizardPage(i,{model:{customerDetails:{},orderList:{},returnOrder:{},lookupConfig:{LookupType:"CUSTOMER"}},mashupRefs:[{mashupRefId:"getOrderList",mashupId:"return_getCustomerOrders"},{mashupRefId:"getItemThumbnails",mashupId:"store.views.common.getItemThumbnails"}],ui:{orderTotalQty:"0",searchPageNo:"1",pageSize:5,recordShownCount:10,apiPageSize:50,noOfSearchResults:0,searchInProgress:false,hideSearch:"N",customerPreviewTemplate:"store/views/return/customer-details/customer-preview.tpl.html",showCustomerPreview:false,getFilterFromContext:false},initialize:function(){var e=u.getWizardPageInput();var t=e.input;var r=e.callAPI;if(r){}else{this.handleGetCustomerDetailsOutput(t,false)}p.setMiniCartParam(this);i.$on("uiSearchClose",function(e,t){if(t){i.ui.hideSearch="N"}})},uiShowCustomerPreview:function(){if(!this.ui.showCustomerPreview){this.ui.showCustomerPreview=true}else if(this.ui.showCustomerPreview){this.ui.showCustomerPreview=false;r.off("keydown",C)}},uiGetOrderListNext:function(){this.ui.recordShownCount=this.ui.recordShownCount+this.ui.pageSize},uiNextPageActionValidator:function(){return true},handleGetCustomerDetailsOutput:function(e){this.model.customerDetails=e;this.ui.headerCustomerId=m.translate("address.LABEL_Display_name",{firstname:this.model.customerDetails.Customer.CustomerContactList.CustomerContact[0].FirstName,lastname:this.model.customerDetails.Customer.CustomerContactList.CustomerContact[0].LastName});this.getCustomerOrders()},getCustomerOrders:function(){this.model.getOrderListInput={Order:{BillToID:this.model.customerDetails.Customer.CustomerID}};var e=this.model.getOrderListInput;var t=u.getWizardAction();if(t=="PREVIOUS"){var r=c.getFromContext("orderListFilter");if(!iscCore.isVoid(r)&&r.input){e=r.input;this.ui.getFilterFromContext=true}}else{c.removeFromContext("orderListFilter")}d.callMashup(this,"getOrderList",e,{}).then(function(e){var t=d.getMashupOutput(e,"getOrderList");this.updateOrderListModel(t)}.bind(this),angular.noop)},updateOrderListModel:function(e){this.model.orderList=e},uiViewOrderDetails:function(e){var t={};t.Order={};t.Order.EnterpriseCode=e.EnterpriseCode;t.Order.OrderHeaderKey=e.OrderHeaderKey;t.Order.AppContextInfo={};t.Order.AppContextInfo.Channel=e.EntryType;var r={input:t};u.gotoCustomPage("orderDetails",r,{})},uiHandleSearchResult:function(e){var t={input:e.NextPage.model,callAPI:e.NextPage.callAPI};u.gotoCustomPage(e.NextPage.action,t,{})},uiHandleReviewReturn:function(){u.gotoCustomPage("returnsList",{input:this.model.returnOrder.Order.OrderHeaderKey},{})},uiCancel:function(){p.handleWizardExit(this.ui.orderTotalQty)},handleWizardBack:function(){return p.handleWizardBack(false,this.ui.orderTotalQty)},handleWizardExit:function(){return p.handleWizardExit(this.ui.orderTotalQty)},uiApplyFilterOnOrderList:function(e){d.callMashup(this,"getOrderList",e,{}).then(function(e){var t=d.getMashupOutput(e,"getOrderList");var r=o("number")(t.OrderList.TotalNumberOfRecords);if(r>0){t=O.stampDisplayStatusOnOrderList(t)}this.updateOrderListModel(t)}.bind(this),angular.noop)},uiSelectOrder:function(r){if(f.isRuleEnabled("ShowItemImage")&&iscCore.isVoid(r.ItemThumbnails)){var e={OrderLine:{OrderHeaderKey:r.OrderHeaderKey}};d.callMashup(this,"getItemThumbnails",e,{}).then(function(e){var t=d.getMashupOutput(e,"getItemThumbnails");r.ItemThumbnails=t;this.ui.selectedOrderHeaderKey=r.OrderHeaderKey}.bind(this),angular.noop)}else{this.ui.selectedOrderHeaderKey=r.OrderHeaderKey}},uiGetCssClassByOrderStatus:function(e){return O.getCssClassByOrderStatus(e.MaxOrderStatus)},uiSetDisplayStatus:function(e){e.DisplayStatus=O.getDisplayStatus(e)}})}]);
angular.module("store").controller("store.views.return.customer-list.customer-list",["$scope","$rootScope","iscScreen","iscWizard","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscReturn",function(i,e,t,a,s,r,o,u,n,g,l){a.initializeWizardPage(i,{pageModel:{},model:{customerList:{},returnOrder:{},lookupConfig:{LookupType:"CUSTOMER"}},mashupRefs:[{mashupRefId:"getCustomerListPaginated",mashupId:"returnLookup_getCustomerList",isPaginated:true,pageSize:g.getFromContext("listApiPageSize"),append:true,appendPath:"CustomerList.Customer",modelName:"customerList"}],ui:{orderTotalQty:"0",pageSize:Number(g.getFromContext("masterDataPageSize")),recordShownCount:Number(g.getFromContext("masterDataPageSize")),apiPageSize:Number(g.getFromContext("listApiPageSize")),noOfSearchResults:0,searchInProgress:false,hideSearch:"N",isListPage:true},initialize:function(){var e=a.getWizardPageInput();var t=e.input;var s=e.callAPI;if(s){}else{this.handleGetCustomerListOutput(t,false)}l.setMiniCartParam(this);i.$on("uiSearchClose",function(e,t){if(t){i.ui.hideSearch="N"}})},uiOpenCustomerDetails:function(e){if(!iscCore.isVoid(e)){var t={};t.Customer=e;var s={input:t,callAPI:false};a.gotoCustomPage("customerDetails",s,{})}else{o.showErrorMessage(n.translate("return.MSG_CustomerNotFound"))}},uigetNextCustomerRecords:function(){var e=this.model.customerList.Page.Output.CustomerList;var t=e.Customer.length;console.log("numRecordsInModel="+t);if(t-this.ui.recordShownCount>=this.ui.pageSize){this.ui.recordShownCount+=this.ui.pageSize;console.log("Using existing model - doing client side pagination")}else{if(this.model.customerList.Page.IsLastPage!="Y"){var s=e.SearchText;var i={Customer:{CustomerContactList:{CustomerContact:{DayPhone:s}}}};console.log("calling API with input="+i);this.ui.searchInProgress=true;r.callPaginatedMashup(this,"getCustomerListPaginated",i,"NEXT",{}).then(function(e){this.ui.searchInProgress=false;this.uigetNextCustomerRecords()}.bind(this),angular.noop)}else{this.ui.recordShownCount=t;console.log("not calling API but painting numItemsInModel="+t+" items")}}},uiNextPageActionValidator:function(){if(!this.ui.searchInProgress){return true}else if(this.ui.searchInProgress){return false}},handleGetCustomerListOutput:function(e,t){this.ui.searchInProgress=false;if(t){var s=e.Page.Output.CustomerList.Customer;for(var i=0;i<s.length;i++){this.model.customerList.Page.Output.CustomerList.Customer.push(s[i])}this.model.customerList.Page.PageNumber=e.Page.PageNumber;this.model.customerList.Page.IsFirstPage=e.Page.IsFirstPage;this.model.customerList.Page.IsLastPage=e.Page.IsLastPage;this.uigetNextCustomerRecords()}else{this.model.customerList=e;this.ui.headerProductId=n.translate("returnHeader.LABEL_Customer_Search_Result",{count:this.model.customerList.Page.Output.CustomerList.TotalNumberOfRecords});this.pageModel.getCustomerListPaginated={};this.pageModel.getCustomerListPaginated["0"]={};this.pageModel.getCustomerListPaginated[e.Page.PageNumber]=e.Page.LastRecord;this.pageModel.getCustomerListPaginated.currentPageNumber=e.Page.PageNumber;this.pageModel.getCustomerListPaginated.IsLastPage=e.Page.IsLastPage;this.pageModel.getCustomerListPaginated.IsFirstPage=e.Page.IsFirstPage;this.pageModel.getCustomerListPaginated.IsValidPage=e.Page.IsValidPage}},uiHandleSearchResult:function(e){var t={input:e.NextPage.model,callAPI:e.NextPage.callAPI};a.gotoCustomPage(e.NextPage.action,t,{})},uiHandleReviewReturn:function(){a.gotoCustomPage("returnsList",{input:this.model.returnOrder.Order.OrderHeaderKey},{})},uiCancel:function(){l.handleWizardExit(this.ui.orderTotalQty)},handleWizardBack:function(){return l.handleWizardBack(false,this.ui.orderTotalQty)},handleWizardExit:function(){return l.handleWizardExit(this.ui.orderTotalQty)}})}]);
angular.module("store").controller("store.views.return.item-list.exchange-item-list",["$animate","$scope","$rootScope","iscScreen","iscWizard","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext",function(e,r,i,t,o,a,c,s,d,u,h){o.initializeWizardPage(r,{model:{searchProductsResult:{},searchCatalogIndexInput:{},orderDetails:{}},mashupRefs:[{mashupRefId:"searchProducts",mashupId:"itemSearch_searchCatalogIndex"},{mashupRefId:"getCompleteOrderDetails",mashupId:"itemSearch_getCompleteOrderDetails",modelName:"orderDetails"}],ui:{productSearchPageNo:"1",searchInput:"",orderTotalQty:"0",pageSize:"",noOfSearchResults:0,searchInProgress:false,focusScanField:true},initialize:function(){i.$showBackButtonForStates=false;this.ui.pageSize=h.getFromContext("defaultPageSize");var e=o.getWizardPageInput();var r=e.operation;var t=e.input;var a=o.getWizardModel("orderModel");if(!iscCore.isVoid(a)&&!iscCore.isVoid(a.Order.OrderHeaderKey)){var s={Order:{OrderHeaderKey:a.Order.OrderHeaderKey}};c.callMashup(this,"getCompleteOrderDetails",s,{}).then(function(){a=this.model.orderDetails;o.setWizardModel("orderModel",this.model.orderDetails);this.ui.orderTotalQty=a.Order.OrderLines.TotalNumberOfRecords}.bind(this),angular.noop)}if(!iscCore.isVoid(e.CatalogSearch)){this.ui.productSearchPageNo=1;if(!iscCore.isVoid(e.SearchText)){this.model.searchCatalogIndexInput={CatalogSearch:{Terms:{Term:{Value:e.SearchText}}}}}this.handleSearchCatalogIndex(e)}else{this.searchProduct("search",t)}},uiOpenItemDetails:function(e){if(!iscCore.isVoid(e)){o.gotoCustomPage("addItems",{input:e},{removeCurrent:true,wizardPageCssClass:"fullscreen-modal"})}else{s.showErrorMessage(u.translate("addItems.MSG_ProductSearchError"))}},uiHandleCheckout:function(){o.gotoCustomPage("cartDetails",{},{})},uiCancel:function(){o.gotoPreviousPage(true)},uiOpenProductSearch:function(e){if(iscCore.isVoid(e)){s.showErrorMessage(u.translate("addItems.MSG_ProductSearchError"))}else{o.gotoCustomPage("productSearch",{input:e},{})}},uiSearchProductGetNextRecords:function(){if(this.ui.productSearchPageNo+1<=this.model.searchProductsResult.CatalogSearch.TotalPages){this.ui.productSearchPageNo++;this.searchProduct("Next")}},uiNextPageActionValidator:function(){if(!this.ui.searchInProgress){return true}else if(this.ui.searchInProgress){return false}},getOrderDetails:function(){var e=o.getWizardModel("orderModel");if(!iscCore.isVoid(e)){this.model.orderDetails=e;this.ui.orderTotalQty=e.Order.OrderLines.TotalNumberOfRecords}},searchProduct:function(e,r){if(e==="Next"){r=this.model.searchCatalogIndexInput.CatalogSearch.Terms.Term.Value}this.ui.searchInput=r;if(!iscCore.isVoid(r)){this.setSearchCatalogIndexInput(r);if(e==="newSearch"){this.model.searchProductsResult={};this.ui.productSearchPageNo=1}this.model.searchCatalogIndexInput.CatalogSearch.PageNumber=this.ui.productSearchPageNo;this.ui.searchInProgress=true;c.callMashup(this,"searchProducts",this.model.searchCatalogIndexInput,{}).then(function(e){var r=c.getMashupOutput(e,"searchProducts");this.handleSearchCatalogIndex(r)}.bind(this),angular.noop)}else{s.showErrorMessage(u.translate("addItems.MSG_ProductSearchError"))}},setSearchCatalogIndexInput:function(e){this.model.searchCatalogIndexInput.CatalogSearch={PageSize:this.ui.pageSize,Terms:{Term:{Value:e}}};var r=o.getWizardModel("orderModel");if(!iscCore.isVoid(r)){var t=iscCore.getValueFromJsonPath(r,"Order.BillToID");if(!iscCore.isVoid(t)){this.model.searchCatalogIndexInput.CatalogSearch.Item={CustomerInformation:{CustomerID:t}}}}},handleSearchCatalogIndex:function(e){this.ui.searchInProgress=false;this.getOrderDetails();var r=e.CatalogSearch.ItemList.Item;this.ui.focusScanField=true;if(iscCore.isVoid(r)&&iscCore.isVoid(this.model.searchProductsResult)){this.ui.noProductsFound=true;this.ui.noOfSearchResults=0}else{this.ui.showSearchResults=true;this.ui.noProductsFound=false;this.ui.noOfSearchResults+=r.length;if(iscCore.isVoid(this.model.searchProductsResult)){this.model.searchProductsResult=e}else if(!iscCore.isVoid(r)){for(var t=0;t<r.length;t++){this.model.searchProductsResult.CatalogSearch.ItemList.Item.push(r[t])}}}},handleWizardBack:function(){var e=o.isFirstPage();if(e){this.uiCancel();return true}else{return false}},handleWizardExit:function(){var e=u.translate("order.WarningMessage_Cancel");if(this.ui.orderTotalQty<1){e=u.translate("addItems.WarningMessage_Cancel")}s.showConfirmationMessage(e).then(function(e){if(e==="YES"){o.exitWizard()}},function(e){});return true}})}]);
angular.module("store").controller("store.views.return.item-list.return-item-list",["$animate","$scope","$rootScope","iscScreen","iscWizard","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscReturn","iscState",function(e,i,t,a,o,r,s,u,n,l,c,h,d){o.initializeWizardPage(i,{model:{searchProductsResult:{},searchCatalogIndexInput:{},returnOrder:{},lookupConfig:{LookupType:"PRODUCT"}},mashupRefs:[{mashupRefId:"searchCatalogIndex",mashupId:"returnLookup_searchCatalogIndex"}],ui:{productSearchPageNo:"1",orderTotalQty:"0",pageSize:c.getFromContext("defaultPageSize"),itemShownCount:c.getFromContext("defaultPageSize"),apiPageSize:c.getFromContext("defaultPageSize"),searchInProgress:false,hideSearch:"N",isListPage:true},initialize:function(){var e=o.getWizardPageInput();var t=e.operation;var a=e.input;var r=e.callAPI;if(r){}else{this.handleSearchCatalogIndexOutput(a,false)}h.setMiniCartParam(this);i.$on("uiSearchClose",function(e,t){if(t){i.ui.hideSearch="N"}})},uiOpenItemDetails:function(e){if(!iscCore.isVoid(e)){var t={input:e,callAPI:true};o.gotoCustomPage("addReturnItem",t,{})}else{u.showErrorMessage(l.translate("addItems.MSG_ProductSearchError"))}},uiSearchProductGetNextRecords:function(){var e=this.model.searchProductsResult.CatalogSearch;var t=e.ItemList.Item.length;console.log("numItemsInModel="+t);if(t-this.ui.itemShownCount>=this.ui.pageSize){this.ui.itemShownCount+=this.ui.pageSize;console.log("Using existing model - doing client side pagination")}else{if(e.PageNumber<e.TotalPages){var a={CatalogSearch:{Terms:{Term:{Value:e.SearchText}}}};a.CatalogSearch.PageSize=this.ui.apiPageSize;a.CatalogSearch.PageNumber=+e.PageNumber+1;console.log("calling API with page number="+a.CatalogSearch.PageNumber);this.ui.searchInProgress=true;s.callMashup(this,"searchCatalogIndex",a,{}).then(function(e){var t=s.getMashupOutput(e,"searchCatalogIndex");this.handleSearchCatalogIndexOutput(t,true)}.bind(this),angular.noop)}else{this.ui.itemShownCount=t;console.log("not calling API but painting numItemsInModel="+t+" items")}}},uiNextPageActionValidator:function(){if(!this.ui.searchInProgress){return true}else if(this.ui.searchInProgress){return false}},handleSearchCatalogIndexOutput:function(e,t){this.ui.searchInProgress=false;if(t){var a=e.CatalogSearch.ItemList.Item;for(var r=0;r<a.length;r++){this.model.searchProductsResult.CatalogSearch.ItemList.Item.push(a[r])}this.model.searchProductsResult.CatalogSearch.PageNumber=e.CatalogSearch.PageNumber;this.uiSearchProductGetNextRecords()}else{if(!iscCore.isVoid(e.CatalogSearch)){this.model.searchProductsResult=e;this.ui.headerProductId=l.translate("returnHeader.LABEL_Product_Search_Result",{count:this.model.searchProductsResult.CatalogSearch.TotalHits})}else{this.ui.headerProductId="";this.ui.hideSearch="Y"}}},uiHandleSearchResult:function(e){var t={input:e.NextPage.model,callAPI:e.NextPage.callAPI};o.gotoCustomPage(e.NextPage.action,t,{})},uiHandleReviewReturn:function(){o.gotoCustomPage("returnsList",{input:this.model.returnOrder.Order.OrderHeaderKey},{})},uiCancel:function(){h.handleWizardExit(this.ui.orderTotalQty)},handleWizardBack:function(){if(!iscCore.isVoid(h.getReturnHeaderKeyFromWizard())){return h.handleWizardBack(false,this.ui.orderTotalQty)}else{return false}},handleWizardExit:function(){return h.handleWizardExit(this.ui.orderTotalQty)}})}]);
angular.module("store").controller("store.views.return.payment.return-payment",["$animate","$scope","$rootScope","iscScreen","iscWizard","$location","$filter","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscObjectUtility","iscPayment","iscPaymentinput","iscOrder","iscReturn",function(e,d,t,r,l,a,i,s,O,m,n,u,c,D,g,R,o){l.initializeWizardPage(d,{model:{getCountryList:{},getCurrencyList:{},getRulesDetails_ReatTimeAuth:{},getRulesDetails_PaymentAttrEncrypt:{},getRuleDetails_CCName:{},getRuleDetails_ChargeShipLines:{},getRuleDetails_PostponePickupPayment:{},getPaymentTypeList:{},getPaymentCardTypeList:{},getExchangePaymentCardTypeList:{},getCompleteOrderDetails:{},returnOrderDetails:{},exchangeOrderModel:{},capturePayment:{},computeRefundPayments:{},newPaymentMethods:{}},mashupRefs:[{mashupRefId:"getCountryList",mashupId:"wsc_common_getCountryList",modelName:"getCountryList"},{mashupRefId:"getCurrencyList",mashupId:"wsc_paymentCapture_getCurrencyList",modelName:"getCurrencyList"},{mashupRefId:"getRulesDetails_ReatTimeAuth",mashupId:"wsc_paymentCapture_getRuleDetails_RealTimeAuthorization",modelName:"getRulesDetails_ReatTimeAuth"},{mashupRefId:"getRulesDetails_PaymentAttrEncrypt",mashupId:"wsc_paymentCapture_getRulesDetails_PaymentAttrEncrypt",modelName:"getRulesDetails_PaymentAttrEncrypt"},{mashupRefId:"getRuleDetails_CCName",mashupId:"wsc_paymentCapture_getRuleDetails_CCName",modelName:"getRuleDetails_CCName"},{mashupRefId:"getRuleDetails_ChargeShipLines",mashupId:"wsc_paymentCapture_getRuleDetails_ChargeShipLines",modelName:"getRuleDetails_ChargeShipLines"},{mashupRefId:"getRuleDetails_PostponePickupPayment",mashupId:"wsc_paymentCapture_getRuleDetails_PostponePickupPayment",modelName:"getRuleDetails_PostponePickupPayment"},{mashupRefId:"getPaymentTypeList",mashupId:"wsc_paymentCapture_getPaymentTypeList",modelName:"getPaymentTypeList"},{mashupRefId:"getPaymentCardTypeList",mashupId:"wsc_paymentCapture_getRuleDetails_PaymentCardTypeConfLevel",modelName:"getPaymentCardTypeList"},{mashupRefId:"getExchangePaymentCardTypeList",mashupId:"wsc_paymentCapture_getRuleDetails_PaymentCardTypeConfLevel",modelName:"getExchangePaymentCardTypeList"},{mashupRefId:"getCompleteOrderDetails",mashupId:"wsc_paymentConfirmation_getCompleteReturnOrderDetails",modelName:"getCompleteOrderDetails"},{mashupRefId:"capturePayment",mashupId:"wsc_paymentConfirmation_capturePayment",modelName:"capturePayment"},{mashupRefId:"deletePayment",mashupId:"wsc_paymentConfirmation_capturePayment",modelName:"capturePayment"},{mashupRefId:"resumePayment",mashupId:"wsc_paymentConfirmation_capturePayment",modelName:"capturePayment"},{mashupRefId:"computeRefundPayments",mashupId:"wsc_paymentConfirmation_computeRefundPayments",modelName:"computeRefundPayments"},{mashupRefId:"oneClickCapturePayAndRefundConfirm",mashupId:"wsc_returnOrder_oneClickCapturePayAndRefundConfirm",modelName:"oneClickCapturePayAndRefundConfirm"}],ui:{orderBillToKey:"",orderShipToKey:"",orderHeaderKey:"",wizardOrderModel:"",orderCurrency:"",personInfo:{},initcomplete:false,reInitPadss:"N",custDefaultPersonInfo:{},actionClicked:"",remainingAmount:0,orderHasAnyCarryLines:false,orderHasAnyShippingLines:false,orderHasAnyPickupLines:false,realTimeAuthEnabled:false,ccNameRuleEnabled:false,encryptEnabled:false,chargeShpLinesAtStoreRuleEnabled:false,postponePaymentForPickupAtStoreRuleEnabled:false,isRefundMode:false,isExchangeOrderPresent:false,noReturnLinesPresent:false,noExchangeLinesPresent:false,isInitDataReady:false},initialize:function(){this.model.newPaymentMethods.newPaymentMethod=[];var e=l.getWizardPageInput();this.ui.wizardOrderModel=l.getWizardModel("returnOrder");this.model.exchangeOrderModel=l.getWizardModel("exchangeOrderModel");this.ui.orderHeaderKey=this.ui.wizardOrderModel.Order.OrderHeaderKey;this.getInitDetails(this.ui.orderHeaderKey,this.ui.wizardOrderModel)},getInitDetails:function(e,t){var r=O.getMashupRefObj(this,"getCountryList",g.getCountryListInput(t));var a=O.getMashupRefObj(this,"getCurrencyList",g.getCurrencyListInput(t));var i=O.getMashupRefObj(this,"getRulesDetails_ReatTimeAuth",g.getRuleDetailsInput(t));var s=O.getMashupRefObj(this,"getRulesDetails_PaymentAttrEncrypt",g.getRuleDetailsInput(t));var n=O.getMashupRefObj(this,"getRuleDetails_CCName",g.getRuleDetailsInput(t));var o=O.getMashupRefObj(this,"getRuleDetails_ChargeShipLines",g.getRuleDetailsInput(t));var d=O.getMashupRefObj(this,"getRuleDetails_PostponePickupPayment",g.getRuleDetailsInput(t));var l=O.getMashupRefObj(this,"getPaymentTypeList",g.getPaymentTypeListInput(t));var m=O.getMashupRefObj(this,"getPaymentCardTypeList",g.getPaymentCardTypeListInput(t));var u=O.getMashupRefObj(this,"computeRefundPayments",g.computeRefundPaymentsInput(e));var h=O.getMashupRefObj(this,"getCompleteOrderDetails",g.getCompleteOrderDetailsInput(e));var y=[];if(this.model.exchangeOrderModel){var p=O.getMashupRefObj(this,"getExchangePaymentCardTypeList",g.getPaymentCardTypeListInput(this.model.exchangeOrderModel));y=[r,a,i,s,n,o,d,l,m,p,u,h]}else{y=[r,a,i,s,n,o,d,l,m,u,h]}O.callMashups(this,y,{}).then(this.onSuccessOfInitDetails.bind(this),angular.noop)},getCapturePaymentInput:function(){var e={};e.Order={};e.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;var t=e.Order;var r=this.model.getCompleteOrderDetails.Order;if(this.ui.isExchangeOrderPresent){var a=e.Order.Return={};a.Order={};e.Order.Return.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.Return.Order.OrderHeaderKey;if(this.ui.isRefundMode){t=a.Order;r=this.model.getCompleteOrderDetails.Order.Return.Order}}t.PaymentMethods={};t.PaymentMethods.PaymentMethod=[];var i=0;for(var s=0;s<this.model.newPaymentMethods.newPaymentMethod.length;s++){t.PaymentMethods.PaymentMethod[s]={};var n=this.model.newPaymentMethods.newPaymentMethod[s];if(!n.PaymentTypeGroup&&(n.PaymentType&&n.PaymentType.PaymentTypeGroup)){n.PaymentTypeGroup=n.PaymentType.PaymentTypeGroup;n.PaymentType=n.PaymentType.PaymentType}t.PaymentMethods.PaymentMethod[s].PaymentType=n.PaymentType;t.PaymentMethods.PaymentMethod[s].PaymentTypeGroup=n.PaymentTypeGroup;t.PaymentMethods.PaymentMethod[s].RequestedAmount=n.RequestedAmount;if(n.NoProcessingRequired){t.PaymentMethods.PaymentMethod[s].NoProcessingRequired=n.NoProcessingRequired}if(this.ui.isRefundMode){t.PaymentMethods.PaymentMethod[s].Operation="Manage"}else{if(!this.ui.orderHasAnyCarryLines&&!(this.ui.orderHasAnyShippingLines&&this.ui.chargeShpLinesAtStoreRuleEnabled)){t.PaymentMethods.PaymentMethod[s].Operation="Manage"}else{if(!n.Operation){t.PaymentMethods.PaymentMethod[s].Operation="Manage"}else{t.PaymentMethods.PaymentMethod[s].Operation=angular.copy(n.Operation)}}}var o=g.prepareCapturePaymentInputForPaymentMethod(n,this.ui.realTimeAuthEnabled,this.ui.ccNameRuleEnabled,this.ui.isRefundMode);t.PaymentMethods.PaymentMethod[s]=angular.extend(t.PaymentMethods.PaymentMethod[s],o);i++}if(r.PaymentMethods&&r.PaymentMethods.PaymentMethod){for(var d=0;d<r.PaymentMethods.PaymentMethod.length;d++){var n=r.PaymentMethods.PaymentMethod[d];var o=g.prepareCapturePaymentInputForSavedPaymentMethod(n,this.ui.realTimeAuthEnabled,this.ui.ccNameRuleEnabled,this.ui.isRefundMode);if(!c.isEmpty(o)){if(n.NoProcessingRequired){o.NoProcessingRequired=n.NoProcessingRequired}if(this.ui.isRefundMode){o.Operation="Manage"}else{if(!this.ui.orderHasAnyCarryLines&&!(this.ui.orderHasAnyShippingLines&&this.ui.chargeShpLinesAtStoreRuleEnabled)){o.Operation="Manage"}else{if(!n.Operation){o.Operation="Manage"}else{o.Operation=angular.copy(n.Operation)}}}var l=i;i++;t.PaymentMethods.PaymentMethod[l]=o}}}return e},uiOneClickCaptureProcessRefund:function(){if(!this.ui.isRefundMode&&this.ui.isExchangeOrderPresent){var e=this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth;var t=0;if(this.model.getCompleteOrderDetails.Order.PaymentMethods&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod){for(var r=0;r<this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod.length;r++){var a=this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod[r];var i=a.RequestedAmount;var s=a.MaxChargeLimit;t+=parseFloat(i)-parseFloat(s)}}for(var n=0;n<this.model.newPaymentMethods.newPaymentMethod.length;n++){var a=this.model.newPaymentMethods.newPaymentMethod[n];var i=a.RequestedAmount;t+=parseFloat(i)}if(c.isGreaterThanZero(parseFloat(e)-parseFloat(t))){m.showErrorMessage(u.translate("payment.INSUFFICIENT_PAYMENT"));return}}else{var o=this.model.returnOrderDetails.Order.OverallTotals.GrandRefundTotal;var t=0;if(this.model.returnOrderDetails.Order.PaymentMethods&&this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod){for(var r=0;r<this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod.length;r++){var a=this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod[r];var i=a.RequestedAmount;t+=parseFloat(i)}}for(var n=0;n<this.model.newPaymentMethods.newPaymentMethod.length;n++){var a=this.model.newPaymentMethods.newPaymentMethod[n];var i=a.RequestedAmount;t+=parseFloat(i)}if(c.isGreaterThanZero(parseFloat(o)-parseFloat(t))){m.showErrorMessage(u.translate("payment.INSUFFICIENT_REFUND_PAYMENT"));return}if(c.isLessThanZero(parseFloat(o)-parseFloat(t))){m.showErrorMessage(u.translate("payment.EXCESS_REFUND_PAYMENT"));return}}var d=this.getCapturePaymentInput();d.Order.BillToKey=this.model.getCompleteOrderDetails.Order.BillToKey?this.model.getCompleteOrderDetails.Order.BillToKey:"";d.Order.ShipToKey=this.model.getCompleteOrderDetails.Order.ShipToKey?this.model.getCompleteOrderDetails.Order.ShipToKey:"";d.Order.BillToID=this.model.getCompleteOrderDetails.Order.BillToID?this.model.getCompleteOrderDetails.Order.BillToID:"";d.Order.EnterpriseCode=this.model.getCompleteOrderDetails.Order.EnterpriseCode;d.Order.DocumentType=this.model.getCompleteOrderDetails.Order.DocumentType;d.Order.CustomerContactID=this.model.getCompleteOrderDetails.Order.CustomerContactID?this.model.getCompleteOrderDetails.Order.CustomerContactID:"";d.Order.PaymentTypeList=this.model.getPaymentTypeList.PaymentTypeList;if(this.ui.isRefundMode){d.Order.RefundExpected="Y"}else{d.Order.RefundExpected="N"}d.Order.ReturnLinesPresent="Y";if(this.model.getCompleteOrderDetails.Order.Return&&this.model.getCompleteOrderDetails.Order.Return.Order){d.Order.Return.Order.BillToKey=this.model.getCompleteOrderDetails.Order.Return.Order.BillToKey?this.model.getCompleteOrderDetails.Order.Return.Order.BillToKey:"";d.Order.Return.Order.ShipToKey=this.model.getCompleteOrderDetails.Order.Return.Order.ShipToKey?this.model.getCompleteOrderDetails.Order.Return.Order.ShipToKey:"";d.Order.Return.Order.BillToID=this.model.getCompleteOrderDetails.Order.Return.Order.BillToID?this.model.getCompleteOrderDetails.Order.Return.Order.BillToID:"";d.Order.Return.Order.EnterpriseCode=this.model.getCompleteOrderDetails.Order.Return.Order.EnterpriseCode;d.Order.Return.Order.DocumentType=this.model.getCompleteOrderDetails.Order.Return.Order.DocumentType;d.Order.Return.Order.CustomerContactID=this.model.getCompleteOrderDetails.Order.Return.Order.CustomerContactID?this.model.getCompleteOrderDetails.Order.Return.Order.CustomerContactID:"";if(this.ui.noReturnLinesPresent){d.Order.ReturnLinesPresent="N"}}if(this.ui.isExchangeOrderPresent&&this.ui.noExchangeLinesPresent){d.Order.ExchangeLinesPresent="N"}O.callMashup(this,"oneClickCapturePayAndRefundConfirm",d,{}).then(this.onSuccessOfPayment.bind(this),this.onFailurePayment.bind(this))},uiExpandPayment:function(e){e.expandPaymentMethodDetails()},uiCollapsePayment:function(e){e.collapsePaymentMethodDetails()},uiRemovePaymentPanel:function(r){var e="payment.LABEL_Delete_Payment";var a=this.model.newPaymentMethods.newPaymentMethod[r].RequestedAmount;var i=this;m.showConfirmationMessage(e).then(function(e){if(iscCore.isBooleanTrue(e)){i.model.newPaymentMethods.newPaymentMethod.splice(r,1);if(parseFloat(a)>0){var t=parseFloat(a)+parseFloat(i.ui.remainingAmount);i.ui.remainingAmount=t.toFixed(2)}}})},uiAddNewPaymentPanel:function(){var e=this.model.newPaymentMethods.newPaymentMethod.length;var t=this.getNewPaymentMethodObject();var r=0;if(this.ui.remainingAmount>0){r=r+parseFloat(this.ui.remainingAmount)}if(r>0){t.RequestedAmount=r.toFixed(2).toString();this.ui.remainingAmount=0}else{t.RequestedAmount="0"}this.model.newPaymentMethods.newPaymentMethod[e]=t;this.ui.actionClicked=""},uiCancel:function(){o.handleWizardCancel(this.model.getCompleteOrderDetails.Order.OrderLines.TotalNumberOfRecords)},uiRemovePayment:function(d){var e="payment.LABEL_Delete_Payment";var l=this;m.showConfirmationMessage(e).then(function(e){if(iscCore.isBooleanTrue(e)){var t={};t.CapturePayment={};if(l.ui.isRefundMode){t.CapturePayment.OrderHeaderKey=l.ui.wizardOrderModel.Order.OrderHeaderKey}else{t.CapturePayment.OrderHeaderKey=l.model.getCompleteOrderDetails.Order.OrderHeaderKey}t.CapturePayment.PaymentMethods={};t.CapturePayment.PaymentMethods.PaymentMethod={};t.CapturePayment.PaymentMethods.PaymentMethod.PaymentKey=d.PaymentKey;t.CapturePayment.PaymentMethods.PaymentMethod.Operation="Delete";t.CapturePayment.PaymentMethods.PaymentMethod.IsCorrection="N";var r=[];r=[O.getMashupRefObj(l,"deletePayment",t)];var a=d.RequestedAmount;var i=d.TotalCharged;var s=d.TotalAuthorized;if(parseFloat(a)>0){var n=parseFloat(a)+parseFloat(l.ui.remainingAmount);l.ui.remainingAmount=n.toFixed(2)}if(!l.ui.isRefundMode&&parseFloat(i)>0||parseFloat(s)>0){if(parseFloat(i)>0){var o=parseFloat(l.ui.remainingAmount)-parseFloat(i);l.ui.remainingAmount=o.toFixed(2)}else if(parseFloat(s)>0){var o=parseFloat(l.ui.remainingAmount)-parseFloat(s);l.ui.remainingAmount=o.toFixed(2)}}O.callMashups(l,r,{}).then(l.onSuccessOfSavePayment.bind(l),angular.noop)}})},uiResumePayment:function(e){var t={};t.CapturePayment={};if(this.ui.isRefundMode){t.CapturePayment.OrderHeaderKey=this.ui.wizardOrderModel.Order.OrderHeaderKey}else{t.CapturePayment.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey}t.CapturePayment.PaymentMethods={};t.CapturePayment.PaymentMethods.PaymentMethod={};t.CapturePayment.PaymentMethods.PaymentMethod.PaymentKey=e.PaymentKey;t.CapturePayment.PaymentMethods.PaymentMethod.ResetSuspensionStatus="Y";t.CapturePayment.PaymentMethods.PaymentMethod.RequestedAmount="0";var r=[];r=[O.getMashupRefObj(this,"resumePayment",t)];this.ui.resumePaymentKey=e.PaymentKey;O.callMashups(this,r,{}).then(this.onSuccessOfSavePayment.bind(this),angular.noop)},uiSavePayment:function(){var e=[];var t=O.getMashupRefObj(this,"capturePayment",this.getCapturePaymentInput());e=[t];O.callMashups(this,e,{}).then(this.onSuccessOfSavePayment.bind(this),angular.noop)},uiFinishWizard:function(){l.finishWizard()},uihandleScreenInvalid:function(){this.ui.actionClicked="pay";d.$broadcast("callVerifyAddress",{callingScreeen:"return-capture-payment"});m.showErrorMessage(u.translate("payment.MSG_SCREEN_ERRORS"))},uiDoNothing:function(){return},onSuccessOfInitDetails:function(e){var t=e.MashupRefs.MashupRef;var r={};if(t!==null&&t!==undefined){var a=t.length;for(var i=0;i<a;i++){var s=t[i];if(s.mashupRefId==="getRulesDetails_ReatTimeAuth"){this.model.getRulesDetails_ReatTimeAuth=s.Output;if(this.model.getRulesDetails_ReatTimeAuth&&this.model.getRulesDetails_ReatTimeAuth.Rules&&this.model.getRulesDetails_ReatTimeAuth.Rules.RuleSetValue=="02"){this.ui.realTimeAuthEnabled=true}else{this.ui.realTimeAuthEnabled=false}}else if(s.mashupRefId==="getRuleDetails_ChargeShipLines"){this.model.getRuleDetails_ChargeShipLines=s.Output;if(this.model.getRuleDetails_ChargeShipLines&&this.model.getRuleDetails_ChargeShipLines.Rules&&this.model.getRuleDetails_ChargeShipLines.Rules.RuleSetValue=="Y"){this.ui.chargeShpLinesAtStoreRuleEnabled=true}else{this.ui.chargeShpLinesAtStoreRuleEnabled=false}}else if(s.mashupRefId==="getRuleDetails_PostponePickupPayment"){this.model.getRuleDetails_PostponePickupPayment=s.Output;if(this.model.getRuleDetails_PostponePickupPayment&&this.model.getRuleDetails_PostponePickupPayment.Rules&&this.model.getRuleDetails_PostponePickupPayment.Rules.RuleSetValue=="Y"){this.ui.postponePaymentForPickupAtStoreRuleEnabled=true}else{this.ui.postponePaymentForPickupAtStoreRuleEnabled=false}}else if(s.mashupRefId==="getRuleDetails_CCName"){this.model.getRuleDetails_CCName=s.Output;if(this.model.getRuleDetails_CCName&&this.model.getRuleDetails_CCName.Rules&&this.model.getRuleDetails_CCName.Rules.RuleSetValue=="Y"){this.ui.ccNameRuleEnabled=true}else{this.ui.ccNameRuleEnabled=false}}else if(s.mashupRefId==="getRulesDetails_PaymentAttrEncrypt"){this.model.getRulesDetails_PaymentAttrEncrypt=s.Output;if(this.model.getRulesDetails_PaymentAttrEncrypt&&this.model.getRulesDetails_PaymentAttrEncrypt.Rules&&this.model.getRulesDetails_PaymentAttrEncrypt.Rules.RuleSetValue=="Y"){this.ui.encryptEnabled=true}else{this.ui.encryptEnabled=false}}else if(s.mashupRefId==="getCompleteOrderDetails"){this.model.getCompleteOrderDetails=s.Output;this.model.exchangeOrderModel=null;if(this.model.getCompleteOrderDetails.Order.DocumentType==="0003"){this.model.returnOrderDetails=this.model.getCompleteOrderDetails;if(this.model.returnOrderDetails.Order.OverallTotals.GrandRefundTotal>0){this.ui.isRefundMode=true}}else if(this.model.getCompleteOrderDetails.Order.DocumentType==="0001"&&this.model.getCompleteOrderDetails.Order.ExchangeType&&!c.isEmpty(this.model.getCompleteOrderDetails.Order.ExchangeType)){this.ui.isExchangeOrderPresent=true;if(this.model.getCompleteOrderDetails.Order.Return&&this.model.getCompleteOrderDetails.Order.Return.Order){this.model.returnOrderDetails=this.model.getCompleteOrderDetails.Order.Return}if(this.model.returnOrderDetails.Order.OverallTotals.GrandRefundTotal>0){this.ui.isRefundMode=true}if(this.model.returnOrderDetails.Order.OrderLines.TotalNumberOfRecords<=0){this.ui.noReturnLinesPresent=true}if(this.model.getCompleteOrderDetails.Order.OrderLines.TotalNumberOfRecords<=0){this.ui.noExchangeLinesPresent=true}}this.ui.orderShipToKey=s.Output.Order.ShipToKey;if(this.ui.isRefundMode){this.ui.orderShipToKey=this.model.returnOrderDetails.Order.ShipToKey}if(s.Output.Order.BillToKey){this.ui.orderBillToKey=s.Output.Order.BillToKey;if(this.ui.isRefundMode){this.ui.orderBillToKey=this.model.returnOrderDetails.Order.BillToKey}}if(!this.ui.isRefundMode&&this.ui.isExchangeOrderPresent&&R.orderHasAnyCarryLines(this.model.getCompleteOrderDetails)){this.ui.orderHasAnyCarryLines=true}if(!this.ui.isRefundMode&&this.ui.isExchangeOrderPresent&&R.orderHasAnyShippingLines(this.model.getCompleteOrderDetails)){this.ui.orderHasAnyShippingLines=true}if(!this.ui.isRefundMode&&this.ui.isExchangeOrderPresent&&R.orderHasAnyPickupLines(this.model.getCompleteOrderDetails)){this.ui.orderHasAnyPickupLines=true}this.ui.orderCurrency=this.model.getCompleteOrderDetails.Order.PriceInfo.Currency;if(!this.ui.isRefundMode&&this.ui.isExchangeOrderPresent&&this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth>0){var n=this.model.newPaymentMethods.newPaymentMethod.length;r.RequestedAmount=D.calculateRemainingAmountToAdd(this.model.getCompleteOrderDetails,null);if(this.model.getCurrencyList.CurrencyList){for(var o=0;o<this.model.getCurrencyList.CurrencyList.Currency.length;o++){var d=this.model.getCurrencyList.CurrencyList.Currency[o];var l=d.Currency;if(this.ui.orderCurrency===l){r.CustomerAccountCurrency=this.model.getCurrencyList.CurrencyList.Currency[o]}}}if(this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo&&this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo.PersonInfo){this.ui.custDefaultPersonInfo=this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo.PersonInfo;r.PersonInfoBillTo=this.ui.custDefaultPersonInfo}if(c.trimString(this.model.getCompleteOrderDetails.Order.CustomerFirstName)&&c.trimString(this.model.getCompleteOrderDetails.Order.CustomerLastName)){r.FirstName=this.model.getCompleteOrderDetails.Order.CustomerFirstName;r.LastName=this.model.getCompleteOrderDetails.Order.CustomerLastName;r.CreditCardName=D.getFormattedName(r.FirstName,r.LastName)}if(this.ui.orderShipToKey!=""&&this.ui.orderBillToKey&&this.ui.orderShipToKey===this.ui.orderBillToKey){r.useShpAddressForBill="Y"}else{r.useShpAddressForBill="N"}if(this.model.getCompleteOrderDetails.Order.PersonInfoBillTo){}else if(this.model.getCompleteOrderDetails.Order.BillToID&&this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo&&this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo.PersonInfo){}else{this.model.getCompleteOrderDetails.Order.PersonInfoBillTo={};if(c.trimString(this.model.getCompleteOrderDetails.Order.CustomerFirstName)&&c.trimString(this.model.getCompleteOrderDetails.Order.CustomerLastName)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.FirstName=this.model.getCompleteOrderDetails.Order.CustomerFirstName;this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.LastName=this.model.getCompleteOrderDetails.Order.CustomerLastName}if(c.trimString(this.model.getCompleteOrderDetails.Order.CustomerPhoneNo)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.DayPhone=this.model.getCompleteOrderDetails.Order.CustomerPhoneNo}if(c.trimString(this.model.getCompleteOrderDetails.Order.CustomerEMailID)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.EMailID=this.model.getCompleteOrderDetails.Order.CustomerEMailID}}}if(!this.ui.isRefundMode&&this.ui.isExchangeOrderPresent&&this.model.getExchangePaymentCardTypeList&&this.model.getExchangePaymentCardTypeList.PaymentCardTypeList){this.model.getPaymentCardTypeList=this.model.getExchangePaymentCardTypeList}this.ui.initcomplete=true}else if(s.mashupRefId==="getPaymentTypeList"){this.model.getPaymentTypeList=s.Output;var m=false;for(var o=0;o<this.model.getPaymentTypeList.PaymentTypeList.PaymentType.length;o++){var u=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[o];var h=u.PaymentType;var y=u.PaymentTypeGroup;if(this.ui.isRefundMode){if(y==="STORED_VALUE_CARD"){r.PaymentType=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[o];m=true;break}}else{if(y==="CREDIT_CARD"){r.PaymentType=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[o];m=true;break}}}if(!m){r.PaymentType=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[0]}}else if(s.mashupRefId==="getPaymentCardTypeList"){this.model.getPaymentCardTypeList=s.Output;if(this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType&&this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType.length>0){r.CardType=this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType[0]}}else if(s.mashupRefId==="getExchangePaymentCardTypeList"){this.model.getExchangePaymentCardTypeList=s.Output;if(this.model.getExchangePaymentCardTypeList.PaymentCardTypeList.PaymentCardType&&this.model.getExchangePaymentCardTypeList.PaymentCardTypeList.PaymentCardType.length>0){if(!this.ui.isRefundMode){this.model.getPaymentCardTypeList=this.model.getExchangePaymentCardTypeList;r.CardType=this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType[0]}}}else if(s.mashupRefId==="getCountryList"){this.model.getCountryList=s.Output}else if(s.mashupRefId==="getCurrencyList"){this.model.getCurrencyList=s.Output;if(this.orderCurrency&&this.orderCurrency!=""){for(var p=0;p<this.model.getCurrencyList.CurrencyList.Currency.length;p++){var d=this.model.getCurrencyList.CurrencyList.Currency[p];var l=d.Currency;if(this.ui.orderCurrency===l){r.CustomerAccountCurrency=this.model.getCurrencyList.CurrencyList.Currency[p]}}}else{r.CustomerAccountCurrency=this.model.getCurrencyList.CurrencyList.Currency[0]}}}}if(!this.ui.isRefundMode&&this.ui.isExchangeOrderPresent&&this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth>0){if(this.model.getCompleteOrderDetails.Order.PaymentMethods&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod.length>0){this.ui.remainingAmount=D.calculateRemainingAmountToAdd(this.model.getCompleteOrderDetails,null)}else{this.model.newPaymentMethods.newPaymentMethod[0]=r}}else if(this.ui.isRefundMode){var O=this.model.returnOrderDetails.Order.OverallTotals.GrandRefundTotal;var g=0;if(this.model.returnOrderDetails.Order.PaymentMethods&&this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod){for(var P=0;P<this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod.length;P++){var r=this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod[P];var C=D.calculatePlannedRefundAmountToDisplay(r);if(c.isEmpty(C)){C="0.00"}g+=parseFloat(C)}}for(var f=0;f<this.model.newPaymentMethods.newPaymentMethod.length;f++){var r=this.model.newPaymentMethods.newPaymentMethod[f];var C=r.RequestedAmount;if(c.isEmpty(C)){C="0.00"}g+=parseFloat(C)}if(c.isGreaterThanZero(parseFloat(O)-parseFloat(g))){this.ui.remainingAmount=parseFloat(O)-parseFloat(g)}}this.ui.isInitDataReady=true},onFailurePayment:function(e){this.ui.actionClicked="";if(e.Errors&&e.Errors.Error){for(var t=0;t<e.Errors.Error.length;t++){if(e.Errors.Error[t]&&e.Errors.Error[t].ErrorCode&&e.Errors.Error[t].ErrorCode==="YFS10210"){break}}}this.model.newPaymentMethods={};this.model.newPaymentMethods.newPaymentMethod=[];if(e.Errors.OrderDetails&&e.Errors.OrderDetails.Order&&e.Errors.OrderDetails.Order.length>0){this.reInitScreenData(e.Errors.OrderDetails.Order[0])}var r={options:{headerText:"payment.LABEL_PaymentFailure"},settings:{contentTemplate:"./store/views/order/payment/payment-error-content.tpl.html"},data:{contentData:{errors:e.Errors?e.Errors:{}}}};var a=u.translate("payment.MESSAGE_PaymentFailure");m.showErrorMessage(a,r)},onSuccessOfPayment:function(e){this.ui.actionClicked="";var t=e.MashupRefs.MashupRef;if(t!==null&&t!==undefined){var r=t.length;for(var a=0;a<r;a++){var i=t[a];if(i.mashupRefId==="oneClickCapturePayAndRefundConfirm"){var s=i.Output.Order.ErrorFound;if(s==="Y"){if(i.Output.Order.ErrorInAddress&&i.Output.Order.ErrorInAddress==="Y"){d.$broadcast("callVerifyAddress",{callingScreeen:"return-capture-payment"})}else{this.model.newPaymentMethods={};this.model.newPaymentMethods.newPaymentMethod=[];this.reInitScreenData(i.Output.Order);var n={options:{headerText:"payment.LABEL_PaymentFailure"},settings:{contentTemplate:"./store/views/order/payment/payment-error-content.tpl.html"}};var o=u.translate("payment.MESSAGE_PaymentFailure");m.showErrorMessage(o,n)}}else{if(i.Output.Order.PaymentProcessSuccess&&i.Output.Order.PaymentProcessSuccess==="Y"){callConfirmDraftOrder=false;if(!this.ui.isRefundMode){l.setWizardModel("returnLinesModel",this.model.returnOrderDetails.Order.OrderLines);l.setWizardModel("exchangeOrderModel",this.model.getCompleteOrderDetails)}l.finishWizard()}else{this.model.newPaymentMethods={};this.model.newPaymentMethods.newPaymentMethod=[];callConfirmDraftOrder=false;this.reInitScreenData(i.Output.Order);if(this.ui.remainingAmount>0){m.showErrorMessage(u.translate("payment.INSUFFICIENT_PAYMENT"))}else{var n={options:{headerText:"payment.LABEL_PaymentFailure"},settings:{contentTemplate:"./store/views/order/payment/payment-error-content.tpl.html"},data:{contentData:{errors:e.Errors?e.Errors:{}}}};var o=u.translate("payment.MESSAGE_PaymentFailure");m.showErrorMessage(o,n)}}}}}}},onSuccessOfSavePayment:function(e){var t=e.MashupRefs.MashupRef;if(t!==null&&t!==undefined){var r=t.length;for(var a=0;a<r;a++){var i=t[a];if(i.mashupRefId==="capturePayment"){this.ui.initcomplete=false;this.ui.reInitPadss="Y";var s=angular.copy(this.model.getCompleteOrderDetails.Order.ShippingAddressList);this.model.getCompleteOrderDetails=i.Output;if(this.ui.isExchangeOrderPresent){this.model.returnOrderDetails=this.model.getCompleteOrderDetails.Order.Return}else{this.model.returnOrderDetails=this.model.getCompleteOrderDetails}this.model.getCompleteOrderDetails.Order.ShippingAddressList=s;this.ui.orderShipToKey=i.Output.Order.ShipToKey;if(i.Output.Order.BillToKey!=undefined){this.ui.orderBillToKey=i.Output.Order.BillToKey}this.model.newPaymentMethods={};this.model.newPaymentMethods.newPaymentMethod=[];var n={};if(!this.ui.isRefundMode&&this.ui.isExchangeOrderPresent){if(this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth>0){n=this.getNewPaymentMethodObject();this.model.newPaymentMethods.newPaymentMethod[0]=n}}else{this.model.newPaymentMethods={};this.model.newPaymentMethods.newPaymentMethod=[]}this.ui.initcomplete=true}else if(i.mashupRefId==="deletePayment"||i.mashupRefId==="resumePayment"){var o=O.getMashupRefObj(this,"getCompleteOrderDetails",g.getCompleteOrderDetailsInput(i.Output.Order.OrderHeaderKey));var d=[o];O.callMashups(this,d,{}).then(this.onSuccessOfOrderDetails.bind(this),angular.noop)}}}},onSuccessOfOrderDetails:function(e){var t=e.MashupRefs.MashupRef;if(t!==null&&t!==undefined){var r=t.length;for(var a=0;a<r;a++){var i=t[a];if(i.mashupRefId==="getCompleteOrderDetails"){this.initScreenDetails(i.Output);if(this.ui.isExchangeOrderPresent){this.model.returnOrderDetails=this.model.getCompleteOrderDetails.Order.Return}else{this.model.returnOrderDetails=this.model.getCompleteOrderDetails}if(!this.ui.isRefundMode&&this.ui.isExchangeOrderPresent){if(this.ui.resumePaymentKey){var s=D.getPaymentMethodForKey(this.model.getCompleteOrderDetails,this.ui.resumePaymentKey);if(s&&!D.isPaymentMethodSuspended(s,this.model.getCompleteOrderDetails.Order.DocumentType)){var n=s.MaxChargeLimit;var o=0;var d=s.TotalCharged;var l=s.TotalAuthorized;if(parseFloat(d)>0||parseFloat(l)>0){if(parseFloat(d)>0){o=parseFloat(n)-parseFloat(d)}else if(parseFloat(l)>0){o=parseFloat(n)-parseFloat(l)}}else{o=n}if(parseFloat(o)>0){var m=parseFloat(this.ui.remainingAmount)-parseFloat(o);this.ui.remainingAmount=m.toFixed(2)}}this.ui.resumePaymentKey=null}this.ui.remainingAmount=D.calculateRemainingAmountToAdd(this.model.getCompleteOrderDetails,this.model.newPaymentMethods.newPaymentMethod)}else{var u=this.model.returnOrderDetails.Order.OverallTotals.GrandRefundTotal;var h=0;if(this.model.returnOrderDetails.Order.PaymentMethods&&this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod){for(var y=0;y<this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod.length;y++){var p=this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod[y];var O=D.calculatePlannedRefundAmountToDisplay(p);if(c.isEmpty(O)){O="0.00"}h+=parseFloat(O)}}if(c.isGreaterThanZero(parseFloat(u)-parseFloat(h))){this.ui.remainingAmount=parseFloat(u)-parseFloat(h)}}}}}},getNewPaymentMethodObject:function(){var e={};if(!this.ui.isRefundMode&&this.ui.isExchangeOrderPresent){e.RequestedAmount=this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth}else{var t=this.model.returnOrderDetails.Order.OverallTotals.GrandRefundTotal;var r=0;if(this.model.returnOrderDetails.Order.PaymentMethods&&this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod){for(var a=0;a<this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod.length;a++){var i=this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod[a];var s=D.calculatePlannedRefundAmountToDisplay(i);if(c.isEmpty(s)){s="0.00"}r+=parseFloat(s)}}for(var n=0;n<this.model.newPaymentMethods.newPaymentMethod.length;n++){var i=this.model.newPaymentMethods.newPaymentMethod[n];var s=i.RequestedAmount;if(c.isEmpty(s)){s="0.00"}r+=parseFloat(s)}if(c.isGreaterThanZero(parseFloat(t)-parseFloat(r))){e.RequestedAmount=this.ui.remainingAmount=parseFloat(t)-parseFloat(r)}}if(this.model.getCurrencyList.CurrencyList){if(this.ui.orderCurrency&&this.ui.orderCurrency!=""){for(var o=0;o<this.model.getCurrencyList.CurrencyList.Currency.length;o++){var d=this.model.getCurrencyList.CurrencyList.Currency[o];var l=d.Currency;if(this.ui.orderCurrency===l){e.CustomerAccountCurrency=this.model.getCurrencyList.CurrencyList.Currency[o]}}}else{e.CustomerAccountCurrency=this.model.getCurrencyList.CurrencyList.Currency[0]}}if(this.model.getCompleteOrderDetails.Order.PersonInfoBillTo&&!c.isEmpty(this.model.getCompleteOrderDetails.Order.PersonInfoBillTo)){e.PersonInfoBillTo=angular.copy(this.model.getCompleteOrderDetails.Order.PersonInfoBillTo)}else if(this.ui.custDefaultPersonInfo){e.PersonInfoBillTo=angular.copy(this.ui.custDefaultPersonInfo)}if(c.trimString(this.model.getCompleteOrderDetails.Order.CustomerFirstName)&&c.trimString(this.model.getCompleteOrderDetails.Order.CustomerLastName)){e.FirstName=this.model.getCompleteOrderDetails.Order.CustomerFirstName;e.LastName=this.model.getCompleteOrderDetails.Order.CustomerLastName;e.CreditCardName=D.getFormattedName(e.FirstName,e.LastName)}if(this.model.getPaymentTypeList.PaymentTypeList){var m=false;for(var o=0;o<this.model.getPaymentTypeList.PaymentTypeList.PaymentType.length;o++){var u=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[o];var h=u.PaymentType;var y=u.PaymentTypeGroup;if(this.ui.isRefundMode){if(y==="STORED_VALUE_CARD"){e.PaymentType=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[o];m=true;break}}else{if(y==="CREDIT_CARD"){e.PaymentType=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[o];m=true;break}}}if(!m){e.PaymentType=this.model.getPaymentTypeList.PaymentTypeList.PaymentType[0]}}if(this.ui.orderShipToKey!=""&&this.ui.orderBillToKey&&this.ui.orderShipToKey===this.ui.orderBillToKey){e.useShpAddressForBill="Y"}else{e.useShpAddressForBill="N"}if(this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType&&this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType.length>0){e.CardType=this.model.getPaymentCardTypeList.PaymentCardTypeList.PaymentCardType[0]}return e},getTotalAmountAlreadyAdded:function(){var e=0;for(var t=0;t<this.model.newPaymentMethods.newPaymentMethod.length;t++){var r=this.model.newPaymentMethods.newPaymentMethod[t];var a=r.RequestedAmount;e=parseFloat(e)+parseFloat(a)}if(this.model.getCompleteOrderDetails.Order.PaymentMethods&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod&&this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod.length>0){for(var t=0;t<this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod.length;t++){var r=this.model.getCompleteOrderDetails.Order.PaymentMethods.PaymentMethod[t];var a=r.RequestedAmount;e=parseFloat(e)+parseFloat(a)}}return e},reInitScreenData:function(e){var t=angular.copy(this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo);var r=angular.copy(this.model.getCompleteOrderDetails.Order.ShippingAddressList);if(this.ui.isExchangeOrderPresent&&this.ui.isRefundMode){t=angular.copy(this.model.getCompleteOrderDetails.Order.Return.Order.CustomerDefaultBillTo);r=angular.copy(this.model.getCompleteOrderDetails.Order.Return.Order.ShippingAddressList)}this.model.getCompleteOrderDetails.Order=e;this.model.returnOrderDetails=this.ui.isExchangeOrderPresent?this.model.getCompleteOrderDetails.Order.Return?this.model.getCompleteOrderDetails.Order.Return:this.model.returnOrderDetails:this.model.getCompleteOrderDetails;if(this.ui.isExchangeOrderPresent&&this.ui.isRefundMode){if(!this.model.getCompleteOrderDetails.Order.Return.Order.CustomerDefaultBillTo&&t){this.model.getCompleteOrderDetails.Order.Return.Order.CustomerDefaultBillTo=t}if(!this.model.getCompleteOrderDetails.Order.Return.Order.ShippingAddressList&&r){this.model.getCompleteOrderDetails.Order.Return.Order.ShippingAddressList=r}}else{if(!this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo&&t){this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo=t}if(!this.model.getCompleteOrderDetails.Order.ShippingAddressList&&r){this.model.getCompleteOrderDetails.Order.ShippingAddressList=r}}if(!this.ui.isRefundMode&&this.ui.isExchangeOrderPresent&&parseFloat(this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth)>0){var a=this.model.getCompleteOrderDetails.Order.ChargeTransactionDetails.RemainingAmountToAuth;if(parseFloat(a)>0){this.ui.remainingAmount=angular.copy(a);var i=D.getAwtAuthNChrgAmtOnSuspndedPmts(this.model.getCompleteOrderDetails.Order.PaymentMethods,this.model.getCompleteOrderDetails.Order.DocumentType);if(i>0){this.ui.remainingAmount=parseFloat(this.ui.remainingAmount)+parseFloat(i);this.ui.remainingAmount=this.ui.remainingAmount.toFixed(2)}}}else if(this.ui.isRefundMode){var s=this.model.returnOrderDetails.Order.OverallTotals.GrandRefundTotal;var n=0;if(this.model.returnOrderDetails.Order.PaymentMethods&&this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod){for(var o=0;o<this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod.length;o++){var d=this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod[o];var l=d.RequestedAmount?d.RequestedAmount:D.calculatePlannedRefundAmountToDisplay(d);n+=parseFloat(l);if(d&&d.ProcessChargeTransactionDetail&&d.ProcessChargeTransactionDetail.ChargeTransactionDetail&&d.ProcessChargeTransactionDetail.ChargeTransactionDetail.PaymentTransactionErrorList&&d.ProcessChargeTransactionDetail.ChargeTransactionDetail.PaymentTransactionErrorList.PaymentTransactionError){this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod[o].IncompletePaymentType="Y";this.model.returnOrderDetails.Order.PaymentMethods.PaymentMethod[o].IncompleteDueToError="Y"}}}for(var m=0;m<this.model.newPaymentMethods.newPaymentMethod.length;m++){var d=this.model.newPaymentMethods.newPaymentMethod[m];var l=d.RequestedAmount;n+=parseFloat(l)}if(c.isGreaterThanZero(parseFloat(s)-parseFloat(n))){this.ui.remainingAmount=parseFloat(s)-parseFloat(n)}}},initScreenDetails:function(e){var t={};this.model.getCompleteOrderDetails=angular.copy(e);if(this.ui.isExchangeOrderPresent){this.model.returnOrderDetails=this.model.getCompleteOrderDetails.Order.Return}this.ui.orderShipToKey=e.Order.ShipToKey;if(e.Order.BillToKey){this.ui.orderBillToKey=e.Order.BillToKey}if(!this.model.getCompleteOrderDetails.Order.PersonInfoBillTo&&!(this.model.getCompleteOrderDetails.Order.BillToID&&this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo&&this.model.getCompleteOrderDetails.Order.CustomerDefaultBillTo.PersonInfo)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo={};if(c.trimString(this.model.getCompleteOrderDetails.Order.CustomerFirstName)&&c.trimString(this.model.getCompleteOrderDetails.Order.CustomerLastName)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.FirstName=this.model.getCompleteOrderDetails.Order.CustomerFirstName;this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.LastName=this.model.getCompleteOrderDetails.Order.CustomerLastName}if(c.trimString(this.model.getCompleteOrderDetails.Order.CustomerPhoneNo)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.DayPhone=this.model.getCompleteOrderDetails.Order.CustomerPhoneNo}if(c.trimString(this.model.getCompleteOrderDetails.Order.CustomerEMailID)){this.model.getCompleteOrderDetails.Order.PersonInfoBillTo.EMailID=this.model.getCompleteOrderDetails.Order.CustomerEMailID}}this.ui.initcomplete=true},uiIsPaymentRequired:function(){return!this.ui.isRefundMode&&this.model.getCompleteOrderDetails.Order.OverallTotals.GrandTotal!=this.model.returnOrderDetails.Order.OverallTotals.GrandTotal},handleWizardBack:function(){console.log("Screen is dirty");var t=this;if(d.paymentCaptureForm.$dirty){m.showConfirmationMessage("globals.MSG_BackClickDirtyMessage").then(function(e){if(e==="YES"){o.handleWizardBack(false,t.model.getCompleteOrderDetails.Order.OrderLines.TotalNumberOfRecords)}},function(){})}else{o.handleWizardBack(false,this.model.getCompleteOrderDetails.Order.OrderLines.TotalNumberOfRecords)}return true},handleWizardExit:function(){return o.handleWizardExit(this.model.getCompleteOrderDetails.Order.OrderLines.TotalNumberOfRecords)}})}]);
angular.module("store").controller("store.views.return.return-summary.return-summary",["$scope","$rootScope","iscScreen","iscMashup","iscResourcePermission","iscState","iscStateParams","iscPrint","iscPayment","iscPaymentinput","iscModal","iscI18n","$timeout",function(e,t,r,s,i,n,a,u,o,d,l,m,h){r.initializeScreen(e,{model:{returnLineList:{},exchangeOrderLineList:{},returnOrder:{},paymentSummary:{},getPaymentTypeList:{},getPaymentCardTypeList:{},getRulesDetails_ReatTimeAuth:{},dispositionList:{},exchangeOrder:{}},mashupRefs:[{mashupRefId:"getReturnOrderLines",mashupId:"returnsummary_getReturnOrderLines",modelName:"returnLineList"},{mashupRefId:"getReturnOrderDetails",mashupId:"returnsummary_getReturnOrderDetails",modelName:"returnOrder"},{mashupRefId:"returnsummary_prints",mashupId:"returnsummary_prints"},{mashupRefId:"getPaymentTypeList",mashupId:"wsc_paymentCapture_getPaymentTypeList",modelName:"getPaymentTypeList"},{mashupRefId:"getPaymentCardTypeList",mashupId:"wsc_paymentCapture_getRuleDetails_PaymentCardTypeConfLevel",modelName:"getPaymentCardTypeList"},{mashupRefId:"getRulesDetails_ReatTimeAuth",mashupId:"wsc_paymentCapture_getRuleDetails_RealTimeAuthorization",modelName:"getRulesDetails_ReatTimeAuth"},{mashupRefId:"sendEmail",mashupId:"returnsummary_sendEmail"},{mashupRefId:"getReturnDispositionList",mashupId:"returnsummary_getReturnDispositionList",modelName:"dispositionList"},{mashupRefId:"stampReturnDisposition",mashupId:"returnsummary_stampReturnDisposition"}],ui:{returnLineShownCount:5,exchangeLineShownCount:5,paymentMethodLabel:"returns.LABEL_Refund_Method",showEmailError:false,emailSent:false,showReturnlines:false,showExchangelines:false,disableReturnTab:false,closeAllAccordianTabs:true,emailForm:{}},initialize:function(){var e=a.params.input;var t={Order:{OrderHeaderKey:e.Order.OrderHeaderKey}};var r={OrderLine:{OrderHeaderKey:e.Order.OrderHeaderKey}};var i=[];i.push(s.getMashupRefObj(this,"getReturnOrderLines",r));i.push(s.getMashupRefObj(this,"getReturnOrderDetails",t));i.push(s.getMashupRefObj(this,"getRulesDetails_ReatTimeAuth",d.getRuleDetailsInput({})));i.push(s.getMashupRefObj(this,"getPaymentTypeList",d.getPaymentTypeListInput(e)));i.push(s.getMashupRefObj(this,"getPaymentCardTypeList",d.getPaymentCardTypeListInput(e)));i.push(s.getMashupRefObj(this,"getReturnDispositionList",{}));s.callMashups(this,i,{}).then(function(e){var t=s.getMashupOutput(e,"getReturnOrderDetails");this.updateReturnOrderDetails(t)}.bind(this),angular.noop)},updateReturnOrderDetails:function(e){this.model.returnOrder=e;if(!iscCore.isVoid(this.model.returnOrder.Order.CustomerEMailID)){this.ui.emailid=this.model.returnOrder.Order.CustomerEMailID}if(!iscCore.isVoid(e.Order.ExchangeOrders.ExchangeOrder)){this.model.exchangeOrderLineList.OrderLineList=e.Order.ExchangeOrders.ExchangeOrder[0].OrderLineList;this.model.exchangeOrder.Order=e.Order.ExchangeOrders.ExchangeOrder[0]}else{this.ui.closeAllAccordianTabs=false;this.ui.disableReturnTab=true;this.model.exchangeOrderLineList={OrderLineList:{TotalNumberOfRecords:0}};this.model.exchangeOrder.Order={PriceInfo:{Currency:this.model.returnOrder.Order.PriceInfo.Currency}}}var t={};if(e.Order.OverallTotals.GrandTotalDifference>0){t.Order=e.Order.ExchangeOrders.ExchangeOrder[0];this.ui.paymentMethodLabel="returns.LABEL_Payment_Method"}else{t=this.model.returnOrder}if(this.model.getRulesDetails_ReatTimeAuth&&this.model.getRulesDetails_ReatTimeAuth.Rules&&this.model.getRulesDetails_ReatTimeAuth.Rules.RuleSetValue=="02"){this.ui.realTimeAuthEnabled=true}if(e.Order.OverallTotals.GrandTotalDifference!=0){var r=o.prepareSuccessMessagePopupData(t,this.model.getPaymentTypeList.PaymentTypeList,this.model.getPaymentCardTypeList.PaymentCardTypeList,this.ui.realTimeAuthEnabled);console.log(r);this.model.paymentSummary.paymentDetails=r.paymentDetails;this.model.paymentSummary.paymentMethodsAvailable=r.paymentMethodsAvailable}else{this.model.paymentSummary.paymentDetails={};this.model.paymentSummary.paymentMethodsAvailable=false}if(this.model.returnLineList.OrderLineList.TotalNumberOfRecords==0){this.ui.showReturnlines=false;this.ui.showExchangelines=true}else{this.ui.showReturnlines=true;this.ui.showExchangelines=false}},uiGetReturnOrderLineListNext:function(){if(this.ui.returnLineShownCount<=this.model.returnLineList.OrderLineList.OrderLine.length){this.ui.returnLineShownCount+=5}},uiReturnOrderLineScrollActionValidator:function(){return true},uiGetExchOrderLineListNext:function(){if(this.ui.exchangeLineShownCount<=this.model.exchangeOrderLineList.OrderLineList.OrderLine.length){this.ui.exchangeLineShownCount+=5}},uiExchOrderLineScrollActionValidator:function(){return true},uiClose:function(){n.goToPreviousState()},handleWizardBack:function(){n.goToPreviousState()},gotoHome:function(){n.goToState("/home",{},{})},uiShowReturnDisposition:function(){if(this.model.dispositionList.ReturnDispositionList.TotalNumberOfRecords==0||this.model.returnLineList.OrderLineList.TotalNumberOfRecords==0){this.gotoHome()}else{this.openReturnDispositionPopup()}},openReturnDispositionPopup:function(){var t=this;var e={OrderHeaderKey:this.model.returnOrder.Order.OrderHeaderKey};e.returnLineList=this.model.returnLineList;e.dispositionList=this.model.dispositionList;var r={modalInput:function(){return e}};l.openModal("store.views.return.common.disposition.return-disposition",r,{}).then(function(e){if(e.data!==null&&e.data!==undefined){t.stampReturnDisposition.call(t,e.data)}},angular.noop)},stampReturnDisposition:function(e){var t=e.inputChangeOrder;s.callMashup(this,"stampReturnDisposition",t,{}).then(this.handleStampReturnDisposition.bind(this),angular.noop)},handleStampReturnDisposition:function(e){this.gotoHome()},uiCustomEmailValidator:function(e,t,r,i){if(t.required){e.booleanResponse=false;e.errorMesssage=m.translate("returns.MSG_EmailIsRequired")}else if(t.pattern){e.booleanResponse=false;e.errorMesssage=m.translate("datatype.EmailFormat")}return e},getPrintServiceInput:function(){var e={};e.Order={};var t=this.model.returnOrder.Order;e.Order.OrderHeaderKey=t.OrderHeaderKey;e.Order.ShipNode=t.SellerOrganizationCode;e.Order.Currency=t.PriceInfo.Currency;e.Order.OrganizationCode=t.EnterpriseCode;return e},uiPrintReceipt:function(){var e=this.getPrintServiceInput();s.callMashup(this,"returnsummary_prints",e,{}).then(this.printCallBackHandler.bind(this),angular.noop)},printCallBackHandler:function(e){var t=s.getMashupOutput(e,"returnsummary_prints");u.printHtmlOutput(t)},uiSendEmail:function(){var t=this;h(function(){t.ui.emailForm.$setDirty();if(iscCore.isVoid(t.ui.emailid)||!t.ui.emailForm.$valid){t.ui.showEmailError=true;document.getElementById("return_emailId").focus()}else if(t.ui.emailForm.$valid){var e=t.getPrintServiceInput();e.Order.ToEmailID=t.ui.emailid;s.callMashup(t,"sendEmail",e,{}).then(t.emailCallBackHandler.bind(t),angular.noop)}},10)},uiResetEmailFlags:function(){var e=document.getElementById("return_emailId").value;if(!iscCore.isVoid(e)){this.ui.emailSent=false;this.ui.showEmailError=false}},emailCallBackHandler:function(e){var t=s.getMashupOutput(e,"sendEmail");var r=this;this.ui.emailSent=true}})}]);
angular.module("store").controller("store.views.return.returns-list.returns-list",["$animate","$scope","$rootScope","$timeout","iscScreen","iscWizard","$locale","iscStateParams","iscMashup","iscModal","iscDomUtility","iscResourcePermission","$filter","iscReturn","iscI18n","iscOrder","iscState","iscAppContext","$interval",function(e,d,O,n,r,m,s,i,f,C,o,L,a,t,g,y,l,u,h){m.initializeWizardPage(d,{model:{orderLineList:{},getCompleteOrderDetails:{},returnOrderDetails:{},returnOrderLineList:{},addProductInput:{}},mashupRefs:[{mashupRefId:"getCompleteOrderLineList",mashupId:"returnsList_getCompleteOrderLineList"},{mashupRefId:"getCompleteOrderDetails",mashupId:"returnsList_getCompleteOrderDetails"},{mashupRefId:"recordApprovalForReturnOrderLines",mashupId:"returnOrder_recordApprovalForReturnOrderLines"},{mashupRefId:"viewcart_getCompleteOrderLineList",mashupId:"viewcart_getCompleteOrderLineList",modelName:"orderLineList"},{mashupRefId:"viewcart_getCompleteOrderDetails",mashupId:"viewcart_getCompleteOrderDetails",modelName:"getCompleteOrderDetails"},{mashupRefId:"getRuleDetails_ChargeShipLines",mashupId:"wsc_paymentCapture_getRuleDetails_ChargeShipLines",modelName:"getRuleDetails_ChargeShipLines"},{mashupRefId:"viewcart_ovp_modifyFulfillmentOptions",mashupId:"viewcart_ovp_modifyFulfillmentOptions"},{mashupRefId:"viewcart_getItemAvailabilityForStore",mashupId:"viewcart_getItemAvailabilityForStore"},{mashupRefId:"viewcart_modifyFulfillmentOptions",mashupId:"viewcart_modifyFulfillmentOptions"},{mashupRefId:"viewcart_changeOrderForGift",mashupId:"viewcart_changeOrderForGift"},{mashupRefId:"vc_modifyFulfillmentOptionsForDeletion",mashupId:"vc_modifyFulfillmentOptionsForDeletion"},{mashupRefId:"exchange_getCompleteOrderLineList",mashupId:"exchange_getCompleteOrderLineList"},{mashupRefId:"vc_updateSettledQtyOnAllLines",mashupId:"vc_updateSettledQtyOnAllLines"},{mashupRefId:"deleteReturnOrderLine",mashupId:"returnsList_modifyReturnOrderLines"},{mashupRefId:"applyReturnReasonToReturnOrderLine",mashupId:"returnsList_modifyReturnOrderLines"},{mashupRefId:"processReturnOrder",mashupId:"returnsList_processReturnOrder"},{mashupRefId:"returnsListLoad_processReturnOrder",mashupId:"returnsListLoad_processReturnOrder"},{mashupRefId:"updateCustomerInfoInReturnOrder",mashupId:"returnsList_updateCustomerInfoInReturnOrder"}],ui:{orderLineShownCount:5,returnOrderLinesCount:"0",oLineQtyEditResourcePermission:false,hasNonReturnableOrderLines:false,refundButtonActionKey:"",refundAmount:"0.00",paymentAmount:"0.00",comingFromExchange:false,oLineShownCount:5,showReturnlines:false,showExchangelines:false,OpenCustomerTabInMobile:false,currentAccordianTabOpen:"",closeAllAccordianTabs:true,activeTabIndex:null},initialize:function(){O.$showBackButtonForStates=true;var e=m.getWizardPageInput();var r="";if(L.hasPermission("WSC000032")){this.ui.oLineQtyEditResourcePermission=true}if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.input)){r=e.input}else{var i=m.getWizardModel("returnOrder");r=i.Order.OrderHeaderKey}var t={Order:{OrderHeaderKey:r}};var n={Order:{OrderHeaderKey:r}};var d={OrderLine:{OrderHeaderKey:r,SkipRuleAndViolation:"true"}};var s=[];var o=m.getWizardModel("forReturnReasonPopup");this.ui.comingFromExchange=!iscCore.isVoid(o)&&o.ExchangeOrderOpened=="Y";if(!this.ui.comingFromExchange){s.push(f.getMashupRefObj(this,"returnsListLoad_processReturnOrder",t));s.push(f.getMashupRefObj(this,"getCompleteOrderLineList",d));s.push(f.getMashupRefObj(this,"getCompleteOrderDetails",n))}var a=m.getWizardModel("exchangeOrderModel");if(!iscCore.isVoid(a)){s.push(f.getMashupRefObj(this,"viewcart_getCompleteOrderLineList",{OrderLine:{OrderHeaderKey:a.Order.OrderHeaderKey}}));s.push(f.getMashupRefObj(this,"viewcart_getCompleteOrderDetails",{Order:{OrderHeaderKey:a.Order.OrderHeaderKey}}))}if(s.length>0){f.callMashups(this,s,{}).then(this.handleInitApiCalls.bind(this),angular.noop)}else{var l=m.getWizardModel("ReturnOrderLines");var u=m.getWizardModel("ReturnOrderDetails");u.Order.OrderLines={TotalLinesInCart:l.OrderLineList.TotalNumberOfRecords};if(!iscCore.isVoid(u)){this.model.returnOrderDetails=angular.copy(u);m.setWizardModel("returnOrder",angular.copy(u))}if(!iscCore.isVoid(l)){this.model.returnOrderLineList=l;this.ui.returnOrderLinesCount=this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords}this.calculateRefundPaymentTotal()}},handleInitApiCalls:function(e){var r="",i="";if(!this.ui.comingFromExchange){i=f.getMashupOutput(e,"getCompleteOrderLineList");r=f.getMashupOutput(e,"getCompleteOrderDetails");r.Order.OrderLines={TotalLinesInCart:i.OrderLineList.TotalNumberOfRecords}}else{i=m.getWizardModel("ReturnOrderLines");r=m.getWizardModel("ReturnOrderDetails")}if(!iscCore.isVoid(r)){this.model.returnOrderDetails=angular.copy(r);m.setWizardModel("returnOrder",angular.copy(r))}if(!iscCore.isVoid(i)){this.model.returnOrderLineList=i;this.ui.returnOrderLinesCount=this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords}var t=f.getMashupOutput(e,"viewcart_getCompleteOrderLineList");if(!iscCore.isVoid(t)){var n=[];n=t.OrderLineList.OrderLine;if(!iscCore.isVoid(n)){for(var d=0;d<n.length;d++){n[d].OrderLineTranQuantity.OrderedQty=a("number")(n[d].OrderLineTranQuantity.OrderedQty);n[d].OrderedQty=a("number")(n[d].OrderedQty)}}this.model.orderLineList=t}else{this.ui.showReturnlines=true}var s=0;if(!iscCore.isVoid(this.model.orderLineList)&&!iscCore.isVoid(this.model.orderLineList.OrderLineList)&&!iscCore.isVoid(this.model.orderLineList.OrderLineList.OrderLine)&&!iscCore.isVoid(this.model.orderLineList.OrderLineList.OrderLine.length)){s=a("number")(this.model.orderLineList.OrderLineList.OrderLine.length)}if(s>0){this.ui.showExchangelines=this.ui.closeAllAccordianTabs=true;this.ui.currentAccordianTabOpen="EXCHANGE"}else{this.ui.closeAllAccordianTabs=false;this.ui.showExchangelines=this.ui.showReturnlines=true;this.ui.currentAccordianTabOpen=""}this.calculateRefundPaymentTotal();this.checkToOpenReturnReasonPopup()},checkToOpenReturnReasonPopup:function(){if(this.model.returnOrderLineList.OrderLineList.AllLinesHaveReturnReason!="Y"&&!this.ui.comingFromExchange){this.openMultipleReturnReasonPopup()}m.setWizardModel("forReturnReasonPopup",{ExchangeOrderOpened:"N"});this.ui.comingFromExchange=false;n(function(){o.setFocus(document.getElementById("itemBarCodeTextBox"))},0)},openMultipleReturnReasonPopup:function(){var r=this;var e={OrderHeaderKey:this.model.returnOrderDetails.Order.OrderHeaderKey};e.returnLineList=this.model.returnOrderLineList;var i={modalInput:function(){return e}};var t="store.views.return.common.reason.return-reason-multiple";if(this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords=="1"){t="store.views.return.common.reason.return-reason-oneline"}C.openModal(t,i,{}).then(function(e){if(e.data!==null&&e.data!==undefined){r.stampMultipleReturnReason.call(r,e.data)}},function(e){n(function(){o.setFocus(document.getElementById("itemBarCodeTextBox"))},0)})},stampMultipleReturnReason:function(e){var r=e.inputChangeOrder;f.callMashup(this,"applyReturnReasonToReturnOrderLine",r,{}).then(this.updateReturnOrderLineList.bind(this),angular.noop)},calculateRefundPaymentTotal:function(){var e=0,r=0;if(iscCore.isVoid(this.model.getCompleteOrderDetails)){this.model.getCompleteOrderDetails={Order:{PriceInfo:{Currency:this.model.returnOrderDetails.Order.PriceInfo.Currency}}}}if(!iscCore.isVoid(this.model.returnOrderDetails)&&!iscCore.isVoid(this.model.returnOrderDetails.Order.OverallTotals)){e=this.model.returnOrderDetails.Order.OverallTotals.GrandTotal;e=Number(e.replace(/[^0-9\.]+/g,""));if(isNaN(e))e=0}if(!iscCore.isVoid(this.model.getCompleteOrderDetails)&&!iscCore.isVoid(this.model.getCompleteOrderDetails.Order.OverallTotals)){r=this.model.getCompleteOrderDetails.Order.OverallTotals.GrandTotal;r=Number(r.replace(/[^0-9\.]+/g,""));if(isNaN(r))r=0}if(e>r){this.ui.refundButtonActionKey="returns.LABEL_Process_Refund";this.ui.refundAmount=e-r;this.ui.paymentAmount=0}else if(e<r){this.ui.refundButtonActionKey="returns.LABEL_Process_Payment";this.ui.refundAmount=0;this.ui.paymentAmount=r-e}else{this.ui.refundButtonActionKey="returns.LABEL_Process_Return";this.ui.paymentAmount="0.00";this.ui.refundAmount="0.00"}},uiOnAccordianClick:function(e){var r=0;if(!iscCore.isVoid(this.model.orderLineList)&&!iscCore.isVoid(this.model.orderLineList.OrderLineList)&&!iscCore.isVoid(this.model.orderLineList.OrderLineList.OrderLine)&&!iscCore.isVoid(this.model.orderLineList.OrderLineList.OrderLine.length)){r=a("number")(this.model.orderLineList.OrderLineList.OrderLine.length)}this.ui.closeAllAccordianTabs=true;if(e=="EXCHANGE"){if(e==this.ui.currentAccordianTabOpen||iscCore.isVoid(this.ui.currentAccordianTabOpen)){this.ui.showExchangelines=false;this.ui.currentAccordianTabOpen="RETURN"}else{this.ui.showExchangelines=true;this.ui.showReturnlines=false;this.ui.currentAccordianTabOpen="EXCHANGE"}}else if(e=="RETURN"){if(e==this.ui.currentAccordianTabOpen||iscCore.isVoid(this.ui.currentAccordianTabOpen)){this.ui.showReturnlines=false;this.ui.currentAccordianTabOpen="EXCHANGE"}else{this.ui.showReturnlines=true;this.ui.showExchangelines=false;this.ui.currentAccordianTabOpen="RETURN"}}},uiCouponApplied:function(e){this.model.getCompleteOrderDetails=e;d.cartDetails.$setPristine();this.calculateRefundPaymentTotal()},uiGetReturnOrderLineListNext:function(){if(this.ui.orderLineShownCount<=this.model.returnOrderLineList.OrderLineList.OrderLine.length){this.ui.orderLineShownCount+=5}},uiReturnOrderLineScrollActionValidator:function(){return true},uiAddReturnReasonForOrderLine:function(e){this.openReturnReasonModal({},e.OrderLineKey)},uiEditReturnReasonForOrderLine:function(e){var r={};r.returnReasonCode=e.ReturnReason;r.dispositionCode=e.DispositionCode;r.dispositionNoteText=e.DispositionNoteText;var i={modalInput:function(){return r}};this.openReturnReasonModal(i,e.OrderLineKey)},uiToggleReturnsButton:function(){var e=true;var r=null,i=null;if(!iscCore.isVoid(this.model.returnOrderLineList)&&!iscCore.isVoid(this.model.returnOrderLineList.OrderLineList)){r=a("number")(this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords)}if(!iscCore.isVoid(this.model.orderLineList)&&!iscCore.isVoid(this.model.orderLineList.OrderLineList)){i=a("number")(this.model.orderLineList.OrderLineList.TotalNumberOfRecords)}if(!iscCore.isVoid(i)&&i>0||!iscCore.isVoid(r)&&r>0){e=false}return e},uiIdentifyCustomerPopup:function(){var e={};var r=this;e.Mode="Identify";var i={modalInput:function(){return e}};C.openModal("store.views.common.customer.customerpopup",i,{}).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){r.onCustomerIdentification.call(r,e.data)}},angular.noop)},onCustomerIdentification:function(e){var r=e.customerModel;var i={};i.Order={};i.Order.OrderHeaderKey=this.model.returnOrderDetails.Order.OrderHeaderKey;i.Order.BillToID=r.Customer.CustomerID;i.Order.PersonInfoBillTo={};i.Order.PersonInfoBillTo=angular.copy(e.addressSelected.PersonInfo);i.Order.PersonInfoShipTo={};i.Order.PersonInfoShipTo=angular.copy(e.addressSelected.PersonInfo);if(r.Customer.CustomerType==="02"||r.Customer.CustomerContactList&&r.Customer.CustomerContactList.CustomerContact&&r.Customer.CustomerContactList.CustomerContact.length===1){i.Order.CustomerContactID=r.Customer.CustomerContactList.CustomerContact[0].CustomerContactID;i.Order.CustomerFirstName=r.Customer.CustomerContactList.CustomerContact[0].FirstName;i.Order.CustomerLastName=r.Customer.CustomerContactList.CustomerContact[0].LastName;i.Order.CustomerEMailID=r.Customer.CustomerContactList.CustomerContact[0].EMailID;if(!iscCore.isVoid(e.addressSelected)){i.Order.CustomerZipCode=e.addressSelected.PersonInfo.ZipCode}}f.callMashup(this,"updateCustomerInfoInReturnOrder",i,{}).then(this.afterCustomerUpdateToOrder.bind(this),angular.noop)},afterCustomerUpdateToOrder:function(e){var r=f.getMashupOutput(e,"updateCustomerInfoInReturnOrder");if(!iscCore.isVoid(r)&&!iscCore.isVoid(r.Order)){if(!iscCore.isVoid(r.Order.ExchangeOrder)){this.model.getCompleteOrderDetails=r.Order.ExchangeOrder;m.setWizardModel("exchangeOrderModel",this.model.getCompleteOrderDetails)}this.model.returnOrderDetails=angular.copy(r);this.model.returnOrderDetails.Order.OrderLines={TotalLinesInCart:this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords};delete this.model.returnOrderDetails.Order["ExchangeOrder"];m.setWizardModel("returnOrder",this.model.returnOrderDetails)}},uiEditAddressInCustomerPanel:function(){var r=this;var e={};e.Mode="Edit";e.PersonInfo=angular.copy(this.model.returnOrderDetails.Order.PersonInfoBillTo);e.hideShipaddress=true;var i={modalInput:function(){return e}};C.openModal("store.views.common.orderaddress.orderaddresspopup",i,{}).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){r.handleEditAddressInCustomerPanel.call(r,e.data)}},angular.noop)},handleEditAddressInCustomerPanel:function(e){var r=angular.copy(e);delete r.IsDefaultShippingAddress;var i={};i.Order={};i.Order.OrderHeaderKey=this.model.returnOrderDetails.Order.OrderHeaderKey;i.Order.PersonInfoBillTo={};i.Order.PersonInfoBillTo=angular.copy(r);i.Order.PersonInfoShipTo={};i.Order.PersonInfoShipTo=angular.copy(r);if(!this.model.returnOrderDetails.Order.BillToID){i.Order.CustomerFirstName=r.FirstName;i.Order.CustomerLastName=r.LastName;i.Order.CustomerEMailID=r.EMailID;i.Order.CustomerZipCode=r.ZipCode}f.callMashup(this,"updateCustomerInfoInReturnOrder",i,{}).then(this.afterCustomerUpdateToOrder.bind(this),angular.noop)},openReturnReasonModal:function(e,r){var i=this;C.openModal("store.views.return.common.reason.return-reason-single",e,{}).then(function(e){if(e.data!==null&&e.data!==undefined){i.applyOverrideForOrderLine.call(i,e.data,r)}},angular.noop)},applyOverrideForOrderLine:function(e,r){var i={};if(e.applyToAll){i={Order:{OrderHeaderKey:this.model.returnOrderDetails.Order.OrderHeaderKey,ApplyToAll:"Y",ReturnReason:e.returnReason}}}else{i={Order:{OrderHeaderKey:this.model.returnOrderDetails.Order.OrderHeaderKey,OrderLines:[{OrderLine:{ReturnReason:e.returnReason,OrderLineKey:r}}]}}}f.callMashup(this,"applyReturnReasonToReturnOrderLine",i,{}).then(this.updateReturnOrderLineList.bind(this),angular.noop)},updateReturnOrderLineList:function(e){var r=f.getMashupOutput(e,"applyReturnReasonToReturnOrderLine");this.updateReturnOrderLines(r);n(function(){o.setFocus(document.getElementById("itemBarCodeTextBox"))},0)},uiConfirmOrderLineDeletion:function(r){var i=this;C.showConfirmationMessage("returns.MSG_DeleteOrderLine").then(function(e){i.deleteReturnOrderLine(e,r)})},deleteReturnOrderLine:function(e,r){if(e==="YES"){var i={Order:{OrderHeaderKey:this.model.returnOrderDetails.Order.OrderHeaderKey,OrderLines:[{OrderLine:{Action:"REMOVE",OrderLineKey:r.OrderLineKey}}]}};f.callMashup(this,"deleteReturnOrderLine",i,{}).then(this.updateReturnOrderLineListAfterDelete.bind(this,r.OrderLineKey),angular.noop)}},updateReturnOrderLineListAfterDelete:function(e,r){var i=f.getMashupOutput(r,"deleteReturnOrderLine");this.updateReturnOrderLines(i);this.updateReturnOrderDetails(i);this.calculateRefundPaymentTotal();this.updateReturnOrderModelInWizard(e)},updateReturnOrderLines:function(e){if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Order)&&!iscCore.isVoid(e.Order.OrderLineList)){this.model.returnOrderLineList={};this.ui.hasNonReturnableOrderLines=false;this.model.returnOrderLineList.OrderLineList=e.Order.OrderLineList;this.ui.returnOrderLinesCount=this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords}},updateReturnOrderDetails:function(e){this.model.returnOrderDetails=e},updateReturnOrderModelInWizard:function(e){var r=m.getWizardModel("returnOrder");if(!iscCore.isVoid(r)&&!iscCore.isVoid(r.Order)&&!iscCore.isVoid(r.Order.OrderLines)){var i=a("number")(r.Order.OrderLines.TotalNumberOfRecords);var t=r.Order.OrderLines.OrderLine;if(!isNaN(i)&&i>0&&!iscCore.isVoid(r.Order.OrderLines.OrderLine)){for(var n=0;n<r.Order.OrderLines.OrderLine.length;n++){var d=r.Order.OrderLines.OrderLine[n];if(!iscCore.isVoid(d)&&d.OrderLineKey==e){t.splice(n,1);break}}}}r.Order.OrderLines.TotalNumberOfRecords=this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords;r.Order.OrderLines.TotalLinesInCart=this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords;m.setWizardModel("returnOrder",r)},uiViewPolicyViolation:function(e){var r=this;var i={};i.orderLineModel=e;i.viewMode="Y";var t={modalInput:function(){return i}};C.openModal("store.views.return.common.override.override-policy-violation",t,{})},uiCheckDirtyStateBeforeRefund:function(){var e=d.cartDetails.$dirty;if(e){var r=this;C.showConfirmationMessage(g.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){r.uiValidateOrderBeforeRefund()}})}else{this.uiValidateOrderBeforeRefund()}},uiValidateOrderBeforeRefund:function(){var e=this;var r=false;if(!iscCore.isVoid(this.model.returnOrderDetails.Order)&&iscCore.isVoid(this.model.returnOrderDetails.Order.BillToID)||!iscCore.isVoid(this.model.getCompleteOrderDetails.Order)&&!iscCore.isVoid(this.model.getCompleteOrderDetails.Order.OrderHeaderKey)&&iscCore.isVoid(this.model.getCompleteOrderDetails.Order.BillToID)){this.ui.OpenCustomerTabInMobile=true;this.ui.activeTabIndex=0;this.uiIdentifyCustomerPopup()}else if(!this.isReturnReasonAssignedToAllReturnOrderLines()){C.showErrorMessage(g.translate("returns.MSG_AssignReturnReasonToAllLines"))}else{var i=m.getWizardModel("exchangeOrderModel");if(!iscCore.isVoid(i)){var t={};t.Order={};t.Order.OrderLines={};t.Order.OrderLines.OrderLine=this.model.orderLineList.OrderLineList.OrderLine;if(y.orderHasOnlyCarryLines(t)){r=true}else{var n=this.model.getCompleteOrderDetails;var d=y.checkIfOrderHasShipLines(this.model.orderLineList.OrderLineList.OrderLine);var s=true;if(d){if(iscCore.isVoid(n.Order.PersonInfoShipTo)){C.showErrorMessage(g.translate("viewcartdetails.NoShipToAddressOline"));s=false}}if(s){if(!y.orderHasMixedSettledLines(this.model.orderLineList.OrderLineList.OrderLine)){var o={};o.Order={};o.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;f.callMashup(this,"exchange_getCompleteOrderLineList",o,{}).then(this.handleProcessReturnOrderWithExchangeLines.bind(this),angular.noop)}else{var a={};a.Order={};a.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;var l={};l.Order={};l.Order.OrderHeaderKey=this.model.getCompleteOrderDetails.Order.OrderHeaderKey;l.Order.OrderLines={};l.Order.OrderLines.OrderLine=[];for(var u=0;u<this.model.orderLineList.OrderLineList.OrderLine.length;u++){var O=this.model.orderLineList.OrderLineList.OrderLine[u];if(O.OrderLineTranQuantity&&O.OrderLineTranQuantity.OrderedQty&&O.OrderLineTranQuantity.SettledQuantity&&O.OrderLineTranQuantity.OrderedQty!=O.OrderLineTranQuantity.SettledQuantity){var L=l.Order.OrderLines.OrderLine.length;l.Order.OrderLines.OrderLine[L]={};l.Order.OrderLines.OrderLine[L].OrderLineKey=O.OrderLineKey;l.Order.OrderLines.OrderLine[L].OrderLineTranQuantity={};l.Order.OrderLines.OrderLine[L].OrderLineTranQuantity.SettledQuantity=O.OrderLineTranQuantity.OrderedQty}}var h=f.getMashupRefObj(this,"vc_updateSettledQtyOnAllLines",l);var p=f.getMashupRefObj(this,"exchange_getCompleteOrderLineList",a);var c=[h,p];f.callMashups(this,c,{}).then(this.handleProcessReturnOrderWithExchangeLines.bind(this),angular.noop)}}}}else{r=true}}if(r){this.callProcessReturnOrder()}},handleProcessReturnOrderWithExchangeLines:function(e){var r=f.getMashupOutput(e,"exchange_getCompleteOrderLineList");if(!iscCore.isVoid(r)&&!iscCore.isVoid(r.OrderLineList)&&!iscCore.isVoid(r.OrderLineList.ReturnOrder)){this.processViolationsOnReturnOrder(r.OrderLineList.ReturnOrder)}else{this.gotoPaymentPage()}},callProcessReturnOrder:function(){var e="",r="null";if(!iscCore.isVoid(this.model.returnOrderDetails)&&!iscCore.isVoid(this.model.returnOrderDetails.Order)){e=this.model.returnOrderDetails.Order.OrderHeaderKey;if(!iscCore.isVoid(this.model.returnOrderDetails.Order.EntryType)){r=this.model.returnOrderDetails.Order.EntryType}}var i={Order:{OrderHeaderKey:e,AppContextInfo:{Channel:r}}};f.callMashup(this,"processReturnOrder",i,{}).then(this.handleProcessReturnOrder.bind(this),angular.noop)},processViolationsOnReturnOrder:function(e){var r=e.Order.ShowOverridePopup;var i=e.Order.ShowOverriddenLabel;if(r=="Y"){this.openOverridePopUpForViolatedOrderLines(e)}else if(i=="Y"){C.showErrorMessage(g.translate("returns.MSG_DeleteNonReturnableLines"))}if(i=="Y"){this.markReturnLinesAsCannotBeOverridden(e)}if(r=="N"&&i=="N"){this.gotoPaymentPage()}},handleProcessReturnOrder:function(e){var r=f.getMashupOutput(e,"processReturnOrder");if(!iscCore.isVoid(r)&&!iscCore.isVoid(r.Order)){this.processViolationsOnReturnOrder(r)}else{this.gotoPaymentPage()}},markReturnLinesAsCannotBeOverridden:function(e){if(!iscCore.isVoid(this.model.returnOrderLineList)&&!iscCore.isVoid(this.model.returnOrderLineList.OrderLineList)){var r=a("number")(this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords);if(!isNaN(r)&&r>0){for(var i=0;i<this.model.returnOrderLineList.OrderLineList.OrderLine.length;i++){var t=this.model.returnOrderLineList.OrderLineList.OrderLine[i];if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Order)&&!iscCore.isVoid(e.Order.OrderLines)){var n=a("number")(e.Order.OrderLines.TotalNumberOfRecords);if(!isNaN(n)&&n>0){for(var d=0;d<e.Order.OrderLines.OrderLine.length;d++){var s=e.Order.OrderLines.OrderLine[d];if(t.OrderLineKey==s.OrderLineKey){t.ReturnPolicyViolations={};t.ReturnPolicyViolations=s.ReturnPolicyViolations;this.ui.hasNonReturnableOrderLines=true}}}}}}}},openOverridePopUpForViolatedOrderLines:function(e){var r=this;var i={};i.openOverride=true;i.viewMode="N";i.multipleOrderLines="Y";i.orderModel=this.getReturnOrderModelForOverridePopup(e);i.returnOrder=e;var t={modalInput:function(){return i}};C.openModal("store.views.return.common.override.override-policy-violation",t,{}).then(function(e){if(e.data!==null&&e.data!==undefined){r.applyOverrideForViolatedOrderLines.call(r,e.data)}},angular.noop)},getReturnOrderModelForOverridePopup:function(e){if(!iscCore.isVoid(this.model.returnOrderLineList)&&!iscCore.isVoid(this.model.returnOrderLineList.OrderLineList)){var r=a("number")(this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords);if(!isNaN(r)&&r>0){for(var i=0;i<this.model.returnOrderLineList.OrderLineList.OrderLine.length;i++){var t=this.model.returnOrderLineList.OrderLineList.OrderLine[i];if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Order)&&!iscCore.isVoid(e.Order.OrderLines)){var r=a("number")(e.Order.OrderLines.TotalNumberOfRecords);if(!isNaN(r)&&r>0){for(var n=0;n<e.Order.OrderLines.OrderLine.length;n++){var d=e.Order.OrderLines.OrderLine[n];if(t.OrderLineKey==d.OrderLineKey){d.VariationAttrs=t.VariationAttrs;if(!iscCore.isVoid(t.LineOverallTotals)){d.LineOverallTotals={};d.LineOverallTotals=t.LineOverallTotals}break}}}}}}}return e},applyOverrideForViolatedOrderLines:function(e){this.postRecordApprovalofReturnOrder(e.response)},postRecordApprovalofReturnOrder:function(e){if(!this.ui.hasNonReturnableOrderLines){this.gotoPaymentPage()}},gotoPaymentPage:function(){var e={Order:{OrderHeaderKey:this.model.returnOrderDetails.Order.OrderHeaderKey}};m.gotoCustomPage("payment",e,{})},isReturnReasonAssignedToAllReturnOrderLines:function(){var e=true;if(!iscCore.isVoid(this.model.returnOrderLineList)&&!iscCore.isVoid(this.model.returnOrderLineList.OrderLineList)){var r=a("number")(this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords);if(!isNaN(r)&&r>0){for(var i=0;i<this.model.returnOrderLineList.OrderLineList.OrderLine.length;i++){var t=this.model.returnOrderLineList.OrderLineList.OrderLine[i];if(iscCore.isVoid(t.ReturnReason)){e=false;break}}}}return e},getTotalOrderLinesCount:function(){var e=0,r=0;if(!iscCore.isVoid(this.model.returnOrderLineList)&&!iscCore.isVoid(this.model.returnOrderLineList.OrderLineList)){e=a("number")(this.model.returnOrderLineList.OrderLineList.TotalNumberOfRecords)}if(!iscCore.isVoid(this.model.orderLineList)&&!iscCore.isVoid(this.model.orderLineList.OrderLineList)){r=a("number")(this.model.orderLineList.OrderLineList.TotalNumberOfRecords)}return Number(e)+Number(r)},handleWizardExit:function(){return t.handleWizardExit(this.getTotalOrderLinesCount())},uiCancel:function(){t.handleWizardCancel(this.getTotalOrderLinesCount())},handleWizardBack:function(){var e=m.isFirstPage();var r=d.cartDetails.$dirty;if(r){var i=null;if(e){i=g.translate("order.WarningMessage_Cancel");C.showConfirmationMessage(i).then(function(e){if(e==="YES"){m.closeWizard()}})}else{C.showConfirmationMessage(g.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){m.gotoPreviousPage(true)}})}return true}else if(e){i=g.translate("order.WarningMessage_Cancel");C.showConfirmationMessage(i).then(function(e){if(e==="YES"){m.closeWizard()}});return true}else{return false}},uihandleScreenDirty:function(){C.showErrorMessage(g.translate("globals.MSG_SCREEN_ERRORS"))},uiOnQuantityFieldFocus:function(e,r){if(d.cartDetails.$valid)var i=s.NUMBER_FORMATS;var t=r.OrderLineTranQuantity.OrderedQty;if(!iscCore.isVoid(t)){t=t.replace(i.GROUP_SEP,"")}if(r.showQtyUpdate!=="Y"){e.oldQty=t}},uiConfirmDeletion:function(r){var i=this;C.showConfirmationMessage("viewcartdetails.LABEL_OLineDeleteConfirmation").then(function(e){i.deleteOrderLine(e,r)})},deleteOrderLine:function(e,r){if(e==="YES"){var i={Order:{OrderHeaderKey:this.model.getCompleteOrderDetails.Order.OrderHeaderKey,OrderLines:[{OrderLine:{Action:"REMOVE",OrderLineKey:r.OrderLineKey}}]}};f.callMashup(this,"vc_modifyFulfillmentOptionsForDeletion",i,{}).then(this.updateOrderLineList.bind(this),angular.noop)}},updateOrderLineList:function(e){var r=f.getMashupOutput(e,"vc_modifyFulfillmentOptionsForDeletion");y.updateOrderLines(r,this.model.orderLineList);this.model.getCompleteOrderDetails=y.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);this.calculateRefundPaymentTotal()},uiOpenGiftOptionsForOrderLine:function(e){y.openGiftOptionsForOrderLinePopup(e,this,"applyGiftOptionsForOrderLine")},applyGiftOptionsForOrderLine:function(e,r){var i=[];i[0]=r;if(!iscCore.isVoid(e.removeGift)&&e.removeGift==="Y"){var t=y.prepareChangeOrderInputForGiftRemoval(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,i);f.callMashup(this,"viewcart_changeOrderForGift",t,{}).then(this.updateOrderLineAfterGiftRemoval.bind(this),angular.noop)}else{var t=y.prepareChangeOrderInputForGift(e,this.model.getCompleteOrderDetails.Order.OrderHeaderKey,i);f.callMashup(this,"viewcart_changeOrderForGift",t,{}).then(this.updateOrderLineWithGiftMessage.bind(this),angular.noop)}},updateOrderLineAfterGiftRemoval:function(e){var r=f.getMashupOutput(e,"viewcart_changeOrderForGift");y.updateOrderLines(r,this.model.orderLineList);if(this.model.orderLineList.OrderLineList.OrderLine.length===1){this.model.giftModel={};m.setWizardModel("giftOptionsForOrderModel",{});this.ui.isOrderGift=""}},updateOrderLineWithGiftMessage:function(e){var r=f.getMashupOutput(e,"viewcart_changeOrderForGift");y.updateOrderLines(r,this.model.orderLineList)},replaceCompleteOrderLineList:function(e){if(!iscCore.isVoid(e.Order.OrderLines)&&!iscCore.isVoid(e.Order.OrderLines.OrderLine)){delete this.model.orderLineList.OrderLineList["OrderLine"];this.model.orderLineList.OrderLineList.OrderLine=[];this.model.orderLineList.OrderLineList.OrderLine=e.Order.OrderLines.OrderLine}},uiValidateQuantity:function(e,r,i,t){if(!iscCore.isVoid(r)&&r.iscDatatypeValidator)return e;else var n=!isNaN(t);if(!iscCore.isBooleanTrue(n)){e.booleanResponse=!isNaN(t);e.errorMesssage=g.translate("globals.ERROR_invalid_input")}return e},uiValidateQuantityAndUpdate:function(e,r){var i=s.NUMBER_FORMATS;var t=r.OrderLineTranQuantity.OrderedQty;t=t.replace(i.GROUP_SEP,"");r.OrderLineTranQuantity.OrderedQty=t;if(e.oldQty!==t){e.oldQty=t;if(typeof t=="string")t=parseInt(t,10);if(t===0){C.showErrorMessage(g.translate("viewcartdetails.MSG_InvalidQty"));r.OrderLineTranQuantity.OrderedQty=r.OrderedQty;r.showQtyUpdate="N"}else{var n=y.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);n.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};n.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.OrderedQty=r.OrderLineTranQuantity.OrderedQty;var d=y.prepareGetItemAvailabilityForStoreApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r);d.Promise.modifyFulfillmentOptionsInput=n;f.callMashup(this,"viewcart_getItemAvailabilityForStore",d,{}).then(this.handleOrderLineQtyChange.bind(this),angular.noop)}}},uiShowUpdateButton:function(e,r){var i=s.NUMBER_FORMATS;var t=r.OrderLineTranQuantity.OrderedQty;t=t.replace(i.GROUP_SEP,"");if(!iscCore.isVoid(t)&&e.oldQty!==t)r.showQtyUpdate="Y";else r.showQtyUpdate="N"},uiHideUpdateButton:function(e){e.showQtyUpdate="N"},uiGetOrderLineListNext:function(){if(this.ui.oLineShownCount<=this.model.orderLineList.OrderLineList.OrderLine.length){this.ui.oLineShownCount+=5}},uiOLineScrollActionValidator:function(){return true},uiOpenOverridePriceModal:function(e){var r=this.model.getCompleteOrderDetails.Order.PriceInfo.Currency;y.openOverridePriceModal(e,r,this,"onPriceOverride")},onPriceOverride:function(e,r){var i=y.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);i.Order.OrderLines.OrderLine[0].LinePriceInfo={};i.Order.OrderLines.OrderLine[0].LinePriceInfo.ListPrice=r.LinePriceInfo.ListPrice;i.Order.OrderLines.OrderLine[0].LinePriceInfo.UnitPrice=e.newprice;i.Order.OrderLines.OrderLine[0].LinePriceInfo.IsPriceLocked="Y";y.addPriceOverrideDefaultNote(i,e.reason);f.callMashup(this,"viewcart_ovp_modifyFulfillmentOptions",i,{}).then(this.handlePriceOverrideApiCall.bind(this),angular.noop)},handlePriceOverrideApiCall:function(e){var r=f.getMashupOutput(e,"viewcart_ovp_modifyFulfillmentOptions");this.handleModifyFulfillmentOptionsApiOutput(r)},handleOrderLineQtyChange:function(e){var r=f.getMashupOutput(e,"viewcart_getItemAvailabilityForStore");if(!iscCore.isVoid(r.Promise)){if(r.Promise.IsItemQtyAvailable==="N"){C.showErrorMessage(g.translate("viewcartdetails.OrderLineQtyChangeError"));var i=r.Promise.OrderLineKey;var t=[];t=this.model.orderLineList.OrderLineList.OrderLine;for(var n=0;n<t.length;n++){if(t[n].OrderLineKey==i){t[n].OrderLineTranQuantity.OrderedQty=t[n].OrderedQty;break}}}}else{y.updateOrderLines(r,this.model.orderLineList);this.model.getCompleteOrderDetails=y.updateOrderHeaderDetails(r,this.model.getCompleteOrderDetails);this.calculateRefundPaymentTotal();if(iscCore.isVoid(this.model.getCompleteOrderDetails.PromotionsApplied)){this.ui.showCouponScanField=false}d.cartDetails.$setPristine()}},uiChangeDeliveryMethod:function(r){var i=this;var e={modalInput:function(){return{inputData:{OrderHeaderKey:i.model.getCompleteOrderDetails.Order.OrderHeaderKey,orderLine:r,orderPersonInfoShipTo:i.model.getCompleteOrderDetails.Order.PersonInfoShipTo}}}};C.openModal("store.views.common.fulfillment.fulfillmentoptions",e,{}).then(function(e){i.handleDeliveryMethodChange.call(i,e.data,r)},angular.noop)},handleModifyFulfillmentOptionsApiOutput:function(e){y.updateOrderLines(e,this.model.orderLineList);this.model.getCompleteOrderDetails=y.updateOrderHeaderDetails(e,this.model.getCompleteOrderDetails);this.calculateRefundPaymentTotal()},handleModifyFulfillmentOptionsOutput:function(e){var r=f.getMashupOutput(e,"viewcart_modifyFulfillmentOptions");this.handleModifyFulfillmentOptionsApiOutput(r)},handleDeliveryMethodChange:function(e,r){var i=e.newDelMethod;var t=y.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);t.Order.OrderLines.OrderLine[0].DeliveryMethod=i;if(i=="PICK"){t.Order.OrderLines.OrderLine[0].ShipNode=e.selectedStore.ShipNode;t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.SettledQuantity="0";if(!iscCore.isVoid(e.selectedStore.Availability.AvailableDate)){t.Order.OrderLines.OrderLine[0].ReqShipDate=e.selectedStore.Availability.AvailableDate}}else if(i=="SHP"){if(this.model.getRuleDetails_ChargeShipLines&&this.model.getRuleDetails_ChargeShipLines.Rules&&this.model.getRuleDetails_ChargeShipLines.Rules.RuleSetValue=="N"){t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.SettledQuantity="0"}if(!iscCore.isVoid(e.EarliestShipDate)){t.Order.OrderLines.OrderLine[0].EarliestShipDate=e.EarliestShipDate}if(!iscCore.isVoid(e.personInfoShipTo)){t.Order.OrderLines.OrderLine[0].PersonInfoShipTo={};if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo||e.personInfoShipTo.IsDefaultShippingAddress==="Y"){t.Order.PersonInfoShipTo=e.personInfoShipTo;if(!this.model.getCompleteOrderDetails.Order.BillToID){t.Order.CustomerFirstName=e.personInfoShipTo.FirstName;t.Order.CustomerLastName=e.personInfoShipTo.LastName;t.Order.CustomerEMailID=e.personInfoShipTo.EMailID;t.Order.CustomerZipCode=e.personInfoShipTo.ZipCode}}delete e.personInfoShipTo.IsDefaultShippingAddress;delete e.personInfoShipTo.IsDefaultBillingAddress;t.Order.OrderLines.OrderLine[0].PersonInfoShipTo=e.personInfoShipTo;if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo){t.Order.PersonInfoShipTo=e.personInfoShipTo}}if(!iscCore.isVoid(e.selectedCarrier)){t.Order.OrderLines.OrderLine[0].CarrierServiceCode=e.selectedCarrier.CarrierServiceCode;t.Order.OrderLines.OrderLine[0].OrderDates={};t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate=[];t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[0]={};t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[0].CommittedDate=e.selectedCarrier.DeliveryStartDate;t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[0].DateTypeId="MIN_DELIVERY";t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[1]={};t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[1].CommittedDate=e.selectedCarrier.DeliveryEndDate;t.Order.OrderLines.OrderLine[0].OrderDates.OrderDate[1].DateTypeId="MAX_DELIVERY"}}else if(i=="CARRY"){t.Order.OrderLines.OrderLine[0].ShipNode=u.getFromContext("storeName");if(r.OrderLineTranQuantity.SettledQuantity==="0"){t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.SettledQuantity="0"}}if(!iscCore.isVoid(r.PersonInfoMarkFor)&&!iscCore.isVoid(r.PersonInfoMarkFor.PersonInfoKey)){t.Order.OrderLines.OrderLine[0].MarkForKey=r.PersonInfoMarkFor.PersonInfoKey}f.callMashup(this,"viewcart_modifyFulfillmentOptions",t,{}).then(this.handleModifyFulfillmentOptionsOutput.bind(this),angular.noop)},uiAddOrEditAddress:function(e,r){var i=this;var t={};t.Mode=e;t.Context="showDefaultshipto";if(e=="Edit"){if(!iscCore.isVoid(r.PersonInfoShipTo)){t.PersonInfo=angular.copy(r.PersonInfoShipTo)}else{t.PersonInfo=angular.copy(this.model.getCompleteOrderDetails.Order.PersonInfoShipTo)}}if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo){t.hideShipaddress=true}else{if(e=="Add"){t.PersonInfo={}}t.PersonInfo.IsDefaultShippingAddress="N"}var n={modalInput:function(){return t}};C.openModal("store.views.common.orderaddress.orderaddresspopup",n,{}).then(function(e){if(e!=null&&e.data!=null&&e.data!=undefined){i.onAddressAdditionOrEdit.call(i,e.data,r)}},angular.noop)},onAddressAdditionOrEdit:function(e,r){var i=angular.copy(e);delete i.IsDefaultShippingAddress;delete i.IsDefaultBillingAddress;var t=y.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity={};t.Order.OrderLines.OrderLine[0].OrderLineTranQuantity.OrderedQty=r.OrderLineTranQuantity.OrderedQty;t.Order.OrderLines.OrderLine[0].PersonInfoShipTo={};t.Order.OrderLines.OrderLine[0].PersonInfoShipTo=i;if(!this.model.getCompleteOrderDetails.Order.PersonInfoShipTo||e.IsDefaultShippingAddress==="Y"){t.Order.PersonInfoShipTo=i;if(!this.model.getCompleteOrderDetails.Order.BillToID){t.Order.CustomerFirstName=i.FirstName;t.Order.CustomerLastName=i.LastName;t.Order.CustomerEMailID=i.EMailID;t.Order.CustomerZipCode=i.ZipCode}}var n=y.prepareGetItemAvailabilityForStoreApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r);n.Promise.PromiseLines.PromiseLine[0].ShipToAddress=i;n.Promise.modifyFulfillmentOptionsInput=t;f.callMashup(this,"viewcart_getItemAvailabilityForStore",n,{}).then(this.handleOrderLineQtyChange.bind(this),angular.noop)},uiOpenAddItems:function(e){if(!iscCore.isVoid(this.model.addProductInput.value)){m.setWizardModel("ReturnOrderLines",angular.copy(this.model.returnOrderLineList));m.setWizardModel("ReturnOrderDetails",angular.copy(this.model.returnOrderDetails));var r={input:this.model.addProductInput.value};if(e==="SEARCH"){m.gotoCustomPage("productSearch",r,{wizardPageCssClass:"fullscreen-modal"})}if(e==="SCAN"){m.gotoCustomPage("addItems",r,{wizardPageCssClass:"fullscreen-modal"})}}else{C.showErrorMessage(g.translate("addItems.MSG_ProductSearchError"))}},uiOpenStoreSearch:function(e){y.openStoreSearchModal(e,this,"afterStoreSelection","CARTDETAILS")},afterStoreSelection:function(e,r){var i=y.prepareModifyFulfillmentOptionsApiInput(this.model.getCompleteOrderDetails.Order.OrderHeaderKey,r.OrderLineKey);i.Order.OrderLines.OrderLine[0].ShipNode=e.selectedStore.ShipNode;f.callMashup(this,"viewcart_modifyFulfillmentOptions",i,{}).then(this.handleModifyFulfillmentOptionsOutput.bind(this),angular.noop)}})}]);
angular.module("store").controller("store.views.return.sales-order-details.sales-order-details",["$animate","$document","$scope","$rootScope","$timeout","iscScreen","iscWizard","iscStateParams","iscMashup","iscModal","iscResourcePermission","$filter","iscI18n","iscScrollUtility","iscReturn","iscDomUtility","iscAppContext",function(e,r,s,i,d,t,a,o,O,n,l,u,h,m,L,c,f){var v=function(e){if(e.which===27&&!e.defaultPrevented){this.ui.showOrderPreview=false;r.off("keydown",v);s.$apply()}};s.$on("$destroy",function(){r.off("keydown",v)});a.initializeWizardPage(s,{subscribers:[{event:"refreshSalesOrderLine",handler:"refreshOrderLine"}],model:{orderDetails:{},orderLineList:{},returnOrder:{},itemPreview:{},lookupConfig:{LookupType:"ORDER"}},mashupRefs:[{mashupRefId:"getCompleteOrderDetails",mashupId:"orderDetails_getCompleteOrderDetails"},{mashupRefId:"getCompleteReturnOrderDetails",mashupId:"orderDetails_getCompleteReturnOrderDetails"},{mashupRefId:"validateOverrideCode",mashupId:"returnOrder_validateOverrideCode"},{mashupRefId:"getSortedCompleteOrderLineList",mashupId:"orderDetails_getSortedCompleteOrderLineList"},{mashupRefId:"getOverrideViolationReasonList",mashupId:"orderDetails_getCommonCodeListForOverrideViolationReason"},{mashupRefId:"createReturnOrder",mashupId:"orderDetails_createReturnOrder"},{mashupRefId:"changeReturnOrder",mashupId:"orderDetails_changeReturnOrder"},{mashupRefId:"createReturnOrderWithPolicyOverride",mashupId:"orderDetails_createReturnOrderWithPolicyOverride"},{mashupRefId:"changeReturnOrderWithPolicyOverride",mashupId:"orderDetails_changeReturnOrderWithPolicyOverride"},{mashupRefId:"translateBarCodeByItemId",mashupId:"orderDetails_translateBarcodeForItem"}],ui:{orderTotalQty:"0",scannedItemLineIndex:1,overrideResourcePermission:false,selectedOrderLineKey:"",headerOrderNo:"",showProductCount:"N",orderLineShownCount:5,hideSearch:"N",showOrderNoAsLink:true,orderPreviewTemplate:"store/views/return/sales-order-details/sales-order-preview.tpl.html",showOrderPreview:false,isOrderLineOverridden:false},initialize:function(){L.setMiniCartParam(this);if(l.hasPermission("WSC000034")){this.ui.overrideResourcePermission=true}var e=a.getWizardPageInput();var r={};r.Order={};r.Order.AppContextInfo={};r.Order.OrderHeaderKey=e.input.Order.OrderHeaderKey;r.Order.EnterpriseCode=e.input.Order.EnterpriseCode;var i=this.getEntryTypeForSalesOrder(e.input);r.Order.AppContextInfo.Channel=i;var d={OrderLine:{OrderHeaderKey:r.Order.OrderHeaderKey,AppContextInfo:{Channel:i}}};var t=[];t.push(O.getMashupRefObj(this,"getCompleteOrderDetails",r));t.push(O.getMashupRefObj(this,"getSortedCompleteOrderLineList",d));var o=a.getWizardModel("returnOrder");if(!iscCore.isVoid(o)&&!iscCore.isVoid(o.Order)&&!iscCore.isVoid(o.Order.OrderHeaderKey)){var n={Order:{OrderHeaderKey:o.Order.OrderHeaderKey}};t.push(O.getMashupRefObj(this,"getCompleteReturnOrderDetails",n))}O.callMashups(this,t,{}).then(this.handleInitApiCalls.bind(this),angular.noop);s.$on("uiSearchClose",function(e,r){if(r){s.ui.hideSearch="N"}})},getEntryTypeForSalesOrder:function(e){var r="";if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Order)&&!iscCore.isVoid(e.Order.AppContextInfo)&&iscCore.isVoid(e.Order.AppContextInfo.Channel)){r="null"}else{r=e.Order.AppContextInfo.Channel}return r},handleInitApiCalls:function(e){var r=O.getMashupOutput(e,"getCompleteOrderDetails");this.model.orderDetails=r;this.ui.headerOrderNo=r.Order.OrderNo;if(!iscCore.isVoid(this.model.orderDetails.Order.ReturnOrder)){this.model.returnOrder={Order:this.model.orderDetails.Order.ReturnOrder};this.ui.orderTotalQty=this.model.returnOrder.Order.OrderLines.TotalLinesInCart;a.setWizardModel("returnOrder",this.model.returnOrder);if(!iscCore.isVoid(this.model.returnOrder.Order.ExchangeOrders)&&!iscCore.isVoid(this.model.returnOrder.Order.ExchangeOrders.ExchangeOrder[0])){var i={Order:{OrderHeaderKey:this.model.returnOrder.Order.ExchangeOrders.ExchangeOrder[0].OrderHeaderKey}};a.setWizardModel("exchangeOrderModel",i)}}else if(this.model.orderDetails.Order.IsOrderReturnable=="N"){n.showWarningMessage(h.translate("orderDetails.MSG_OrderNotReturnable"))}r=O.getMashupOutput(e,"getSortedCompleteOrderLineList");if(!iscCore.isVoid(r)){this.model.orderLineList=r}r=O.getMashupOutput(e,"getCompleteReturnOrderDetails");if(iscCore.isVoid(this.model.returnOrder)&&!iscCore.isVoid(r)){this.model.returnOrder=r}d(function(){c.setFocus(document.getElementById("itemScanTextbox"))},0)},uiTogglePurchasedQtyDisplay:function(e){var r=Number(this.uiGetReturnedQuantity(e));var i=Number(e.ReturnableQty);var d=Number(e.OrderedQty);return r+i==d?false:true},uiGetTotalReturnableQty:function(e){var r=Number(this.uiGetReturnedQuantity(e))+Number(e.ReturnableQty);if(this.uiGetReturnableQuantityNumber(e)==0&&!this.uiIsOrderLineAddedToReturned(e)&&e.ReturnPolicyViolations.CannotBeOverridden=="N"){r=e.OrderedQty}return r},uiShowOrderPreview:function(){if(!this.ui.showOrderPreview){this.ui.showOrderPreview=true;d(function(){r.off("keydown",v)},3e3)}else if(this.ui.showOrderPreview){this.ui.showOrderPreview=false;r.off("keydown",v)}},uiHandleSearchResult:function(e){a.gotoCustomPage(e.NextPage.action,{input:e.NextPage.model},{})},uiHandleAddToReturn:function(e){var r=this.getAddToReturnInput(e);if(r!==-1){this.saveItemToReturn(r)}},uiSetSelectedLine:function(e){this.ui.selectedOrderLineKey=e},uiViewPolicyViolation:function(e){var r=this;var i={};i.orderLineModel=e;i.viewMode="Y";var d={modalInput:function(){return i}};n.openModal("store.views.return.common.override.override-policy-violation",d,{})},uiAddItemToRetrurnCart:function(e){var r=this.getAddItemToCartInput("",e);if(!iscCore.isVoid(r)){this.saveItemToCart(r,false)}},uiOverridePolicyViolation:function(r,e){var i=this;var d={};d.openOverride=e?true:false;d.viewMode="N";d.orderLineModel=r;d.overrideInput=this.getAddItemToCartInput("",r);var t={modalInput:function(){return d}};n.openModal("store.views.return.common.override.override-policy-violation",t,{}).then(function(e){if(e.data!==null&&e.data!==undefined){i.applyOverrideForOrderLine.call(i,e.data,r)}},function(e){if(e.data!==null&&e.data!==undefined){if(iscCore.isVoid(i.model.returnOrder)){i.model.returnOrder=e.data.returnOrder;a.setWizardModel("returnOrder",i.model.returnOrder)}}})},applyOverrideForOrderLine:function(e,r){this.postSaveItemToCart(e.response)},getAddItemToCartInput:function(e,r){var i={};i.Order={};i.Order.AppContextInfo={};i.Order.OrderLines={};i.Order.OrderLines.OrderLine={};i.Order.AppContextInfo.Channel="Store";if(!iscCore.isVoid(this.model.returnOrder)){i.Order.OrderHeaderKey=this.model.returnOrder.Order.OrderHeaderKey;if(iscCore.isVoid(this.model.returnOrder.Order.BillToID)&&!iscCore.isVoid(this.model.orderDetails.Order.BillToID)){i.Order.BillToID=this.model.orderDetails.Order.BillToID;i.Order.CustomerContactID=this.model.orderDetails.Order.CustomerContactID;i.Order.CustomerFirstName=this.model.orderDetails.Order.CustomerFirstName;i.Order.CustomerLastName=this.model.orderDetails.Order.CustomerLastName;i.Order.CustomerEMailID=this.model.orderDetails.Order.CustomerEMailID;i.Order.PersonInfoShipTo=this.model.orderDetails.Order.PersonInfoShipTo;i.Order.PersonInfoBillTo=this.model.orderDetails.Order.PersonInfoBillTo}}else{if(!iscCore.isVoid(this.model.orderDetails.Order.BillToID)){i.Order.BillToID=this.model.orderDetails.Order.BillToID;i.Order.CustomerContactID=this.model.orderDetails.Order.CustomerContactID;i.Order.CustomerFirstName=this.model.orderDetails.Order.CustomerFirstName;i.Order.CustomerLastName=this.model.orderDetails.Order.CustomerLastName;i.Order.CustomerEMailID=this.model.orderDetails.Order.CustomerEMailID;i.Order.PersonInfoShipTo=this.model.orderDetails.Order.PersonInfoShipTo;i.Order.PersonInfoBillTo=this.model.orderDetails.Order.PersonInfoBillTo}i.Order.PriceInfo={};i.Order.PriceInfo.Currency=this.model.orderDetails.Order.PriceInfo.Currency}if(!iscCore.isVoid(this.model.returnOrder)){var d=this.findMatchingReturnOrderLine(r.OrderLineKey);if(!iscCore.isVoid(d)){i.Order.OrderLines.OrderLine.OrderLineKey=d.OrderLineKey;i.Order.OrderLines.OrderLine.OrderedQty=Number(d.OrderedQty)+Number("1")}else{i.Order.OrderLines.OrderLine.OrderedQty="1"}}else{i.Order.OrderLines.OrderLine.OrderedQty="1"}if(iscCore.isVoid(i.Order.OrderLines.OrderLine.OrderLineKey)){i.Order.OrderLines.OrderLine.DerivedFrom={};i.Order.OrderLines.OrderLine.DerivedFrom.OrderNo=this.model.orderDetails.Order.OrderNo;i.Order.OrderLines.OrderLine.DerivedFrom.OrderLineKey=r.OrderLineKey;i.Order.OrderLines.OrderLine.DerivedFrom.DocumentType="0001"}else{i.Order.OrderLines.OrderLine.DerivedFromOrderLineKey=r.OrderLineKey}if(!iscCore.isVoid(e)){i.Order.OrderLines.OrderLine.OverrideCode=e.overrideCode;i.Order.OrderLines.OrderLine.Notes={};i.Order.OrderLines.OrderLine.Notes.Note={};if(e.value=="Other"){i.Order.OrderLines.OrderLine.Notes.Note.NoteText=e.otherText}else{i.Order.OrderLines.OrderLine.Notes.Note.NoteText=e.value}}return i},uiGetReturnedQuantity:function(e){var r=0;var i=this.findMatchingReturnOrderLine(e.OrderLineKey);if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.OrderedQty)){r=i.OrderedQty}return r},uiGetReturnableQuantityNumber:function(e){var r=0;r=Number(e.ReturnableQty);if(isNaN(r)){r=0}return r},uiIsOrderLineAddedToReturned:function(e){var r=false;if(!iscCore.isVoid(this.model.returnOrder)&&!iscCore.isVoid(this.model.returnOrder.Order)&&!iscCore.isVoid(this.model.returnOrder.Order.OrderLines)){var i=u("number")(this.model.returnOrder.Order.OrderLines.TotalNumberOfRecords);if(!isNaN(i)&&i>0){for(var d=0;d<this.model.returnOrder.Order.OrderLines.OrderLine.length;d++){var t=this.model.returnOrder.Order.OrderLines.OrderLine[d];if(e.OrderLineKey==t.DerivedFromOrderLineKey&&Number(t.OrderedQty)>0){r=true;break}}}}return r},uiIsOrderLineCompletelyReturned:function(e){var r=false;if(!iscCore.isVoid(this.model.returnOrder)&&!iscCore.isVoid(this.model.returnOrder.Order)&&!iscCore.isVoid(this.model.returnOrder.Order.OrderLines)){var i=u("number")(this.model.returnOrder.Order.OrderLines.TotalNumberOfRecords);if(!isNaN(i)&&i>0){for(var d=0;d<this.model.returnOrder.Order.OrderLines.OrderLine.length;d++){var t=this.model.returnOrder.Order.OrderLines.OrderLine[d];if(e.OrderLineKey==t.DerivedFromOrderLineKey&&Number(e.OrderedQty)==Number(t.OrderedQty)){r=true;break}}}}return r},findMatchingReturnOrderLine:function(e){var r="";if(!iscCore.isVoid(this.model.returnOrder)&&!iscCore.isVoid(this.model.returnOrder.Order)&&!iscCore.isVoid(this.model.returnOrder.Order.OrderLines)){var i=u("number")(this.model.returnOrder.Order.OrderLines.TotalNumberOfRecords);if(!isNaN(i)&&i>0){for(var d=0;d<this.model.returnOrder.Order.OrderLines.OrderLine.length;d++){var t=this.model.returnOrder.Order.OrderLines.OrderLine[d];if(e==t.DerivedFromOrderLineKey){r=t;break}}}}return r},saveItemToCart:function(e,r){var i=r?"createReturnOrderWithPolicyOverride":"createReturnOrder";if(e&&!iscCore.isVoid(e.Order)){if(!iscCore.isVoid(e.Order.OrderHeaderKey)){i=r?"changeReturnOrderWithPolicyOverride":"changeReturnOrder"}}O.callMashup(this,i,e,{}).then(this.postSaveItemToCart.bind(this),angular.noop)},postSaveItemToCart:function(e){var r=e.MashupRefs.MashupRef[0].Output;this.ui.orderTotalQty=r.Order.OrderLines.TotalLinesInCart;var i="";if(!iscCore.isVoid(r.Order.OrderLines)&&!iscCore.isVoid(r.Order.OrderLines.SalesOrderLine)){i=r.Order.OrderLines.SalesOrderLine;this.updateOrderLineForSalesOrder(i);this.showItemPreview(i,false);delete r.Order.OrderLines["SalesOrderLine"]}a.setWizardModel("returnOrder",r);this.model.returnOrder=r},showItemPreview:function(e,r){this.model.itemPreview=e;this.model.itemPreview.ShowTick=r;if(r){this.model.itemPreview.ItemDetails.Quantity=null}else{this.model.itemPreview.ItemDetails.Quantity=1}d(function(){var e=document.getElementById("itemPreviewSpan");if(!iscCore.isVoid(e)){s.$broadcast("itemPreviewSpanClicked",{data:1})}},0)},updateOrderLineForSalesOrder:function(e){for(var r=0;r<this.model.orderLineList.OrderLineList.OrderLine.length;r++){var i=this.model.orderLineList.OrderLineList.OrderLine[r];this.ui.scannedItemLineIndex++;if(e.OrderLineKey==i.OrderLineKey){this.model.orderLineList.OrderLineList.OrderLine[r]=e;break}}},uiGetOrderLineListNext:function(){if(this.ui.orderLineShownCount<=this.model.orderLineList.OrderLineList.OrderLine.length){this.ui.orderLineShownCount+=5}},uiOrderLineScrollActionValidator:function(){return true},refreshOrderLine:function(e,r){console.log("Within RefreshOrderLne");var i=r;if(i){var d=this;var t=angular.copy(i.data);for(var o=0;o<d.model.orderLineList.OrderLineList.OrderLine.length;o++){var n=d.model.orderLineList.OrderLineList.OrderLine[o];if(t.OrderLineKey==n.OrderLineKey){d.model.orderLineList.OrderLineList.OrderLine[o].ReturnableQty=t.ReturnableQty;if(u("number")(t.ReturnableQty)>0){d.model.orderLineList.OrderLineList.OrderLine[o].IsOrderLineReturnable="Y"}else{d.model.orderLineList.OrderLineList.OrderLine[o].IsOrderLineReturnable="N"}break}}}},getAddToReturnInput:function(e){var r={};r.Order={};if(!iscCore.isVoid(this.model.returnOrder)){r.Order.OrderHeaderKey=this.model.returnOrder.Order.OrderHeaderKey}r.Order.EntryType=f.getFromContext("storeEntryType");r.Order.OrderLines={};r.Order.OrderLines.OrderLine=[{Item:{ItemID:e.ItemDetails.ItemID,UnitOfMeasure:e.ItemDetails.UnitOfMeasure},OrderLineTranQuantity:{OrderedQty:e.OrderedQty},LinePriceInfo:{UnitPrice:e.LinePriceInfo.UnitPrice}}];if(e.DeliveryMethod!=""){if(e.DeliveryMethod==="CARRY"){r.Order.OrderLines.OrderLine[0].DeliveryMethod=e.DeliveryMethod}else if(e.DeliveryMethod==="PICK"){if(e.ShipNode===""){this.uiOpenStoreSearch("addToCart");return-1}else{r.Order.OrderLines.OrderLine[0].ShipNode=e.ShipNode;r.Order.OrderLines.OrderLine[0].DeliveryMethod=e.DeliveryMethod}}else if(e.DeliveryMethod==="SHP"){r.Order.OrderLines.OrderLine[0].DeliveryMethod=e.DeliveryMethod}}r.Order.OrderLines.OrderLine[0].test=e.OrderLineKey;return r},saveItemToReturn:function(i){var e="createReturnOrder";if(i&&!iscCore.isVoid(i.Order)){if(!iscCore.isVoid(i.Order.OrderHeaderKey)){e="modifyFulfillmentOptionsForReturns"}else{e="createReturnOrder"}}O.callMashup(this,e,i,{}).then(function(e){var r=e.MashupRefs.MashupRef[0].Output;a.setWizardModel("returnOrder",r);this.ui.returnOrderLineKeyList.push(i.Order.OrderLines.OrderLine[0].test);console.log(this.ui.returnOrderLineKeyList);console.log(this.ui.returnOrderLineKeyList.indexOf(i.Order.OrderLines.OrderLine[0].test));this.ui.orderTotalQty=r.Order.OrderLines.TotalLinesInCart;this.model.returnOrder=r;this.resetOrderRelatedAttrs()}.bind(this),angular.noop)},uiGetItemDetailsForScan:function(e){if(!iscCore.isVoid(e)){var r={BarCode:{BarCodeData:e}};r.BarCode.OrderHeaderKey=this.model.orderDetails.Order.OrderHeaderKey;var i=this.model.orderDetails.Order.EntryType;if(iscCore.isVoid(i)){i="null"}r.BarCode.EntryType=i;var d=a.getWizardModel("returnOrder");if(!iscCore.isVoid(d)&&!iscCore.isVoid(d.Order)){r.BarCode.ReturnOrderHeaderKey=d.Order.OrderHeaderKey}O.callMashup(this,"translateBarCodeByItemId",r,{}).then(this.handleItemScan.bind(this),angular.noop)}else{n.showErrorMessage(h.translate("viewcartdetails.MSG_InvalidBarCodeData"))}},handleItemScan:function(e){var r=O.getMashupOutput(e,"translateBarCodeByItemId");console.log("Item Scan ",r);var i=r.BarCode.ScanStatus;if(i==="LINE_HAS_VIOLATION"){if(this.ui.overrideResourcePermission){var d=r.BarCode.OrderContextualInfo.OrderLineKeyWithViolation;this.showOverridePopupForOrderLine(d);this.model.scanItemInput.itemID=""}else{n.showErrorMessage(h.translate("orderDetails.MSG_NoPermissionToOverride"))}}else if(i==="LINE_ADDED_TO_RETURN"){var t=r.BarCode.OrderContextualInfo.SalesOrderLine;this.model.itemPreviewModel=t;this.updateOrderLineForSalesOrder(t);this.showLastScannedProduct(t.OrderLineKey);var o={};o.Order={};o.Order=r.BarCode.OrderContextualInfo.Order;delete o.Order.OrderLines["SalesOrderLine"];this.ui.orderTotalQty=o.Order.OrderLines.TotalLinesInCart;a.setWizardModel("returnOrder",o);this.model.returnOrder=o;this.model.scanItemInput.itemID="";this.showItemPreview(t,true)}else{this.showTranslationErrorMessage(i)}},showLastScannedProduct:function(e){if(this.ui.orderLineShownCount<this.ui.scannedItemLineIndex){this.ui.orderLineShownCount=this.ui.scannedItemLineIndex}var r=this;d(function(){m.scrollToElementWIthOffset(document.getElementById("orderLinesHolder"),document.getElementById(e),0,0)},0);this.ui.scannedItemLineIndex=1},showTranslationErrorMessage:function(e){var r="orderDetails.MSG_"+e;if(iscCore.isVoid(e)){r="orderDetails.MSG_NO_ITEM_FOUND"}n.showErrorMessage(h.translate(r))},showOverridePopupForOrderLine:function(e){var r="";for(var i=0;i<this.model.orderLineList.OrderLineList.OrderLine.length;i++){var d=this.model.orderLineList.OrderLineList.OrderLine[i];if(e==d.OrderLineKey){r=d;break}}this.uiOverridePolicyViolation(r,false)},handleWizardExit:function(){return L.handleWizardExit(this.ui.orderTotalQty)},uiHandleReviewReturn:function(){a.gotoCustomPage("returnsList",{input:this.model.returnOrder.Order.OrderHeaderKey},{})},uiCancel:function(){L.handleWizardCancel(this.ui.orderTotalQty)},handleWizardBack:function(){return L.handleWizardBack(false,this.ui.orderTotalQty)},uiOpenItemDetails:function(e){var r={};r.orderline=e;var i={modalInput:function(){return r}};n.openModal("store.views.common.product.product-details",i,{})}})}]);
angular.module("store").controller("store.views.return.sales-order-list.sales-order-list",["$animate","$scope","$filter","$rootScope","iscScreen","iscState","iscWizard","iscStateParams","iscMashup","iscModal","iscOrder","iscReturn","iscResourcePermission","iscI18n","iscAppContext","iscRule",function(e,s,t,r,i,d,a,u,n,o,l,h,O,c,m,p){a.initializeWizardPage(s,{model:{getOrderListInput:{},orderList:{},returnOrder:{},lookupConfig:{LookupType:"ORDER"}},mashupRefs:[{mashupRefId:"getOrderListByOrderNo",mashupId:"orderList_getOrderListByOrderNo"},{mashupRefId:"getOrderListByFilterCriteria",mashupId:"store.views.return.sales-order-list.getOrderListByFilterCriteria"},{mashupRefId:"getItemThumbnails",mashupId:"store.views.common.getItemThumbnails"}],ui:{headerOrderNo:"",orderTotalQty:"0",selectedOrderHeaderKey:"",orderShownCount:10,hideSearch:"N",showCustomerName:true,refineResults:"N",numOfOrders:-1,getFilterFromContext:false,getOrderListInitializeMashupName:"getOrderListByOrderNo"},initialize:function(){h.setMiniCartParam(this);var e=a.getWizardPageInput();this.model.getOrderListInput=e.input;var r=this.model.getOrderListInput;var t=a.getWizardAction();if(t=="PREVIOUS"){var i=m.getFromContext("returnOrderListFilter");if(!iscCore.isVoid(i)&&i.input){r=i.input;this.ui.getFilterFromContext=true;this.ui.getOrderListInitializeMashupName="getOrderListByFilterCriteria"}}else{m.removeFromContext("returnOrderListFilter")}n.callMashup(this,this.ui.getOrderListInitializeMashupName,r,{}).then(this.processOrderList.bind(this),angular.noop);s.$on("uiSearchClose",function(e,r){if(r){s.ui.hideSearch="N"}})},processOrderList:function(e){var r=n.getMashupOutput(e,this.ui.getOrderListInitializeMashupName);this.ui.numOfOrders=t("number")(r.OrderList.TotalNumberOfRecords);if(!this.ui.getFilterFromContext&&this.ui.numOfOrders==1){a.gotoCustomPage("orderDetails",{input:this.getInputForOrderDetails(r.OrderList.Order[0])},{})}this.ui.selectedOrderHeaderKey=r.OrderList.Order[0].OrderHeaderKey;this.model.orderList=r},uiGetCssClassByOrderStatus:function(e){return l.getCssClassByOrderStatus(e.MaxOrderStatus)},uiSetDisplayStatus:function(e){e.DisplayStatus=l.getDisplayStatus(e)},uiHandleSearchResult:function(e){a.gotoCustomPage(e.NextPage.action,{input:e.NextPage.model},{})},uiViewOrderDetails:function(e){a.gotoCustomPage("orderDetails",{input:this.getInputForOrderDetails(e)},{})},uiSelectOrder:function(t){if(p.isRuleEnabled("ShowItemImage")&&iscCore.isVoid(t.ItemThumbnails)){var e={OrderLine:{OrderHeaderKey:t.OrderHeaderKey}};n.callMashup(this,"getItemThumbnails",e,{}).then(function(e){var r=n.getMashupOutput(e,"getItemThumbnails");t.ItemThumbnails=r;this.ui.selectedOrderHeaderKey=t.OrderHeaderKey}.bind(this),angular.noop)}else{this.ui.selectedOrderHeaderKey=t.OrderHeaderKey}},uiGetOrderListNext:function(){if(this.ui.orderShownCount==this.model.orderList.OrderList.Order.length){this.ui.refineResults="Y"}else if(this.ui.orderShownCount<=this.model.orderList.OrderList.Order.length){this.ui.orderShownCount+=10}},uiOrderListScrollActionValidator:function(){return true},getInputForOrderDetails:function(e){var r={};r.Order={};r.Order.EnterpriseCode=e.EnterpriseCode;r.Order.OrderHeaderKey=e.OrderHeaderKey;r.Order.AppContextInfo={};r.Order.AppContextInfo.Channel=e.EntryType;return r},uiApplyFilterOnOrderList:function(e){n.callMashup(this,"getOrderListByFilterCriteria",e,{}).then(this.handleOrderFilterResult.bind(this),angular.noop)},handleOrderFilterResult:function(e){var r=n.getMashupOutput(e,"getOrderListByFilterCriteria");this.ui.numOfOrders=t("number")(r.OrderList.TotalNumberOfRecords);if(this.ui.numOfOrders>0){this.model.orderList=l.stampDisplayStatusOnOrderList(r)}else{this.model.orderList=r}this.ui.refineResults="N"},handleWizardExit:function(){return h.handleWizardExit(this.ui.orderTotalQty)},uiCancel:function(){h.handleWizardCancel(this.ui.orderTotalQty)},handleWizardBack:function(){return h.handleWizardBack(false,this.ui.orderTotalQty)}})}]);
angular.module("store").controller("store.views.shipment.batchpick.batchpick-finish",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscState",function(i,e,t,r,a,o,s){t.initializeWizardPage(i,{model:{},mashupRefs:[],ui:{},initialize:function(){if(t.getWizardAction()==="FINISH"){var i=t.getWizardModel("returnOrder");var e=t.getWizardModel("returnLinesModel");s.goToState("returnsummary",{input:i},{})}else if(t.getWizardAction()==="CLOSE"){s.goToPreviousState()}}})}]);
angular.module("store").controller("store.views.shipment.batchpick.batchpick-init",["$scope","$rootScope","iscWizard","iscMashup","iscI18n","iscResourcePermission","iscRule","iscStateParams",function(t,a,i,e,s,o,c,n){i.initializeWizardPage(t,{model:{},mashupRefs:[],ui:{},initialize:function(){console.log(n);if(n.params.action==="batchList"){i.gotoCustomPage("batchList",n.params,{})}else if(n.params.action==="skipbatchList"){var t=n.params.input.batch;if(s.translate("batchpick.BATCH_OPEN")===t.Status){t.callBatchListApi="Y";if(t.BatchType=="SORT_WHILE_PICK"){i.gotoCustomPage("swpPicking",t,{})}else{i.gotoCustomPage("sapPicking",t,{})}}else if(s.translate("batchpick.BATCH_PICK_COMPLETE_NOT_STAGED")===t.Status&&c.getRuleSetValue("enableStagingLocation")=="Y"){var a={StoreBatch:{StoreBatchKey:t.StoreBatchKey,BatchNo:t.BatchNo}};if(t.BatchType=="SORT_WHILE_PICK"){i.gotoCustomPage("swpStaging",a,{})}else{i.gotoCustomPage("sapStaging",a,{})}}}}})}]);
angular.module("store").controller("store.views.shipment.confirm.shipment-confirm-list",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscStateParams","iscAppContext","iscWizard","iscResourcePermission","iscPrint","$timeout","iscShipment","$filter",function(i,e,t,a,o,r,s,n,h,c,l,u,m,p){e.initializeScreen(i,{model:{shipmentList:{},packagesList:{}},mashupRefs:[{mashupRefId:"getPackagesListAndCount",mashupId:"store.views.home.order-fulfillment.getPackagesCount",modelName:"packagesList"},{mashupRefId:"getShipmentList",mashupId:"store.views.shipment.confirm.confirmShipment_getShipmentListByScac",modelName:"getShipmentList"}],ui:{selectedCarrier:"",showSuccessMsg:false,length:0},initialize:function(){var i=s.params.input;if(i){this.ui.showSuccessMsg=i.ShowSuccessMsg}var e={};e.Container={};e.Container.Shipment={};r.callMashup(this,"getPackagesListAndCount",e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(i){var e=r.getMashupOutput(i,"getPackagesListAndCount");var t=e.Containers;var s=t.Carriers;if(s){var n=s.Carrier;var a=n.length;this.ui.length=a;if(a>0){this.uiSelectPackage(n[0])}}},uiSelectPackage:function(i){this.ui.selectedCarrier=i.SCAC},uiViewContainerDetails:function(i){t.goToState("shipmentConfirmDetails",{input:{Carrier:{SCAC:i.SCAC,SCACDesc:i.DisplaySCAC}}},{})},uiConfirmShipment:function(i){var e={};e.Shipment={};e.Shipment.SCAC=i.SCAC;r.callMashup(this,"getShipmentList",e,{}).then(this.handleConfirmShipmentOutput.bind(this),undefined)},handleConfirmShipmentOutput:function(i){var e=this;var t="";var s="";var n=iscCore.getValueFromJsonPath(this.model.getShipmentList,"FailedContainers.TotalFailures");if(!isNaN(n)){if(n>0){t="ThereAreFewFailedContainers"}else if(n==0){if(iscCore.getValueFromJsonPath(this.model.getShipmentList,"FailedContainers.CloseManifestSuccess")=="Y"){this.initialize();this.ui.showSuccessMsg=true}else{t="ShipmentConfirmedFailed"}}}else{n=iscCore.getValueFromJsonPath(this.model.getShipmentList,"Shipments.TotalFailures");if(!isNaN(n)){if(n>0){t="ShipmentConfirmedFailed"}else if(n==0){this.initialize();this.ui.showSuccessMsg=true}}}if(!iscCore.isVoid(t)){a.showErrorMessage(o.translate("packagelist.MSG_"+t)).then(function(i){if(i){e.initialize()}})}else if(!iscCore.isVoid(s)){this.initialize();this.ui.showSuccessMsg=true}},uiOrderListScrollActionValidator:function(){return true},uiUpdateSelection:function(i){},uiClose:function(){t.goToState("/home",{},{})}})}]);
angular.module("store").controller("store.views.shipment.confirm.shipment-confirm",["$scope","$rootScope","$timeout","iscScreen","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscState","iscShipment","$filter",function(e,i,t,n,s,u,a,o,r,h,m,p,c){n.initializeScreen(e,{model:{getShipmentContainerList:{}},mashupRefs:[{mashupRefId:"getShipmentContainerList",mashupId:"store.views.shipment.confirm.confirmShipment_getShipmentContainerDetailsByScac",modelName:"getShipmentContainerList"},{mashupRefId:"getShipmentList",mashupId:"store.views.shipment.confirm.confirmShipment_getShipmentListByScac",modelName:"getShipmentList"}],ui:{selectedCarrier:null,count:20,apiInput:null},initialize:function(){this.ui.apiInput={};this.ui.apiInput.Container={};this.ui.apiInput.Container.Shipment={};var e=s.params.input.Carrier;this.ui.apiInput.Container.Shipment.SCAC=e.SCAC;this.ui.selectedCarrier=e.SCAC;var i=e.SCACDesc;u.callMashup(this,"getShipmentContainerList",this.ui.apiInput,{}).then(this.handleSuccess.bind(this,i),undefined)},handleSuccess:function(e,i){var t=u.getMashupOutput(i,"getShipmentContainerList");var n=t.Containers;n.SCACDesc=e;var s=n.Container;var a=s.length;for(var o=0;o<a;o++){var r=s[o];var h=r.Shipment;h.FormattedShipDate=c("date")(h.ExpectedShipmentDate,"mediumDate")}},uiClose:function(){e.$emit("$backButtonClicked")},uiHandleConfirmShipment:function(){u.callMashup(this,"getShipmentList",this.getInputForConfirmShipmentCall(),{}).then(this.handleConfirmShipmentOutput.bind(this),undefined)},getInputForConfirmShipmentCall:function(){return{Shipment:{SCAC:this.ui.selectedCarrier}}},handleConfirmShipmentOutput:function(e){var i="";var t="";var n=iscCore.getValueFromJsonPath(this.model.getShipmentList,"FailedContainers.TotalFailures");if(!isNaN(n)){if(n>0){i="ThereAreFewFailedContainers"}else if(n==0){if(iscCore.getValueFromJsonPath(this.model.getShipmentList,"FailedContainers.CloseManifestSuccess")=="Y"){m.goToState("shipmentConfirmList",{input:{ShowSuccessMsg:true}},{})}else{i="ShipmentConfirmedFailed"}}}else{n=iscCore.getValueFromJsonPath(this.model.getShipmentList,"Shipments.TotalFailures");if(!isNaN(n)){if(n>0){i="ShipmentConfirmedFailed"}else if(n==0){m.goToState("shipmentConfirmList",{input:{ShowSuccessMsg:true}},{})}}}if(!iscCore.isVoid(i)){a.showErrorMessage(r.translate("packagelist.MSG_"+i)).then(function(e){if(e){u.callMashup(this,"getShipmentContainerList",this.ui.apiInput,{}).then(this.handleSuccess.bind(this,scacDesc),undefined)}})}else if(!iscCore.isVoid(t)){m.goToState("shipmentConfirmList",{input:{ShowSuccessMsg:true}},{})}},uiNextPageActionValidator:function(){if(this.ui.count<=this.model.getShipmentContainerList.Containers.TotalNumberOfRecords){return true}return false},uiSearchProductGetNextRecords:function(){if(this.ui.count<=this.model.getShipmentContainerList.Containers.TotalNumberOfRecords){this.ui.count+=10}}})}]);
angular.module("store").controller("store.views.shipment.containerpack.containerpack-finish",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscState",function(i,e,o,a,s,t,c){o.initializeWizardPage(i,{model:{},mashupRefs:[],ui:{},initialize:function(){if(o.getWizardAction()==="CLOSE"){c.goToPreviousState()}}})}]);
angular.module("store").controller("store.views.shipment.containerpack.containerpack-init",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscModal","iscI18n","iscState","$filter","iscStateParams",function(t,e,h,p,i,a,s,n,o,r){h.initializeWizardPage(t,{model:{shipmentDetails:{}},mashupRefs:[{mashupRefId:"validateShipmentForContainerPack",mashupId:"store.views.shipment.containerpack.validateShipmentForContainerPack"},{mashupRefId:"changeShipmentForAssignToUser",mashupId:"store.views.shipment.containerpack.changeShipment"},{mashupRefId:"changeShipmentStatus",mashupId:"store.views.shipment.containerpack.changeShipmentStatus"},{mashupRefId:"unpackShipment",mashupId:"store.views.shipment.containerpack.unpackShipment"}],ui:{stateParams:{action:"",params:""}},initialize:function(){this.validateShipmentForContainerPack()},validateShipmentForContainerPack:function(){var t=r.params.input;var e={Shipment:{ShipmentKey:t.Shipment.ShipmentKey,Action:"Pack"}};p.callMashup(this,"validateShipmentForContainerPack",e,{}).then(this.processShipmentDetailsForContainerPack.bind(this))},processShipmentDetailsForContainerPack:function(t){var e=p.getMashupOutput(t,"validateShipmentForContainerPack");this.model.shipmentDetails=e;if(e.Shipment.Error){this.handleShipmentValidationError(e)}else{h.gotoCustomPage("packProducts",r.params.input,{})}},gotoCustomPage:function(){h.gotoCustomPage(this.ui.stateParams.action,this.ui.stateParams.params,{})},gotoShipmentSummary:function(t){n.goToState("shipmentsummary",{input:t},{})},exitContainerPackWizard:function(){h.setWizardModel("shipmentDetails",this.model.shipmentDetails);h.closeWizard()},handleShipmentValidationError:function(t){var e=t.Shipment.Error.ErrorDescription;var i=t.Shipment.Error.action;var n=this;if(e=="AssignedToUserIsDifferent"){this.openAssingedToDifferentUserPopup(t)}else if(e=="InvalidShipmentShipNode"){a.showErrorMessage(s.translate("containerPack.MSG_"+e)).then(function(t){if(t){n.exitContainerPackWizard()}})}else if(e.indexOf("InvalidTransactionAllowed_")>-1){this.showCustomErrorModal(s.translate("containerPack.MSG_"+e),t)}},showCustomErrorModal:function(t,i){var n=this;var e={options:{headerText:"modal.TITLE_Error",headerIconCss:"app-glyphicons app-icon-error_30",action:[{actionName:"goBack",actionLabel:"backroomPick.ACTION_GoBack"},{actionName:"gotoSummary",actionLabel:"backroomPick.ACTION_GotoShipmentSummary"}]},settings:{size:"md",type:"error"}};a.showConfirmationMessage(t,e).then(function(t){if(t=="goBack"){n.exitContainerPackWizard()}else if(t=="gotoSummary"){var e={Shipment:{ShipmentKey:i.Shipment.ShipmentKey}};n.gotoShipmentSummary(e)}})},openAssingedToDifferentUserPopup:function(t){var e=this;var i={};i.shipmentDetails=t;i.flowName="PACK";var n={modalInput:function(){return i}};a.openModal("store.views.shipment.common.abandon-shipment.abandon-shipment",n,{}).then(function(t){if(t.data!==null&&t.data!==undefined){e.handleAbandonShipmentPopupResponse(t.data)}},function(){e.exitContainerPackWizard()})},handleAbandonShipmentPopupResponse:function(t){var e={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};var i={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};var n=this;var a="";if(typeof String.prototype.startsWith!="function"){String.prototype.startsWith=function(t){return this.substring(0,t.length)===t}}if(!iscCore.isVoid(this.model.shipmentDetails.Shipment.DocumentType)){if(this.model.shipmentDetails.Shipment.DocumentType=="0001"){e={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,TransactionId:"PACK_SHIPMENT_COMPLETE"}}}else{e={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,TransactionId:"PACK_SHIPMENT_COMPLETE.0006"}}}}if(t=="START_OVER"){var s=[];if(!(Number(this.model.shipmentDetails.Shipment.ShipmentContainerizedFlag)===1)){var o={Container:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};s.push(p.getMashupRefObj(this,"unpackShipment",o))}if(!this.model.shipmentDetails.Shipment.Status.Status.startsWith("1100.70.06.70")){s.push(p.getMashupRefObj(this,"changeShipmentStatus",e))}s.push(p.getMashupRefObj(this,"changeShipmentForAssignToUser",i));p.callMashups(this,s,{}).then(function(t){h.gotoCustomPage("packProducts",e,{})})}else if(t=="CONTINUE"){var s=[];if(!this.model.shipmentDetails.Shipment.Status.Status.startsWith("1100.70.06.70")){s.push(p.getMashupRefObj(this,"changeShipmentStatus",e))}s.push(p.getMashupRefObj(this,"changeShipmentForAssignToUser",i));p.callMashups(this,s,{}).then(function(t){h.gotoCustomPage("packProducts",e,{})})}}})}]);
angular.module("store").controller("store.views.shipment.containerpack.extn-pack-search-list",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscAppContext","$timeout","iscExtnShipment","$filter",function(e,t,i,a,s,n,o,r,p,u){t.initializeScreen(e,{model:{shipmentList:{},itemPackRule:{Rules:{RuleSetValue:"N"}},scanInput:{value:""}},mashupRefs:[{mashupRefId:"getReadyForPackingShipmentList",mashupId:"store.views.shipment.containerpack.getReadyForPackingShipmentList",modelName:"shipmentList",isPaginated:true,pageSize:15,append:true,appendPath:"Shipments.Shipment"},{mashupRefId:"translateBarCodeForShipmentPack",mashupId:"store.views.home.getShipmentFromItemId"},{mashupRefId:"getRuleForItemPack",mashupId:"store.views.home.getRuleForItemPack",modelName:"itemPackRule"}],ui:{apiCallInProgress:false,showAdvanceSearch:false,selectedShipmentKey:"",recordShownCount:15},initialize:function(){var e=[];e.push(n.getMashupRefObj(this,"getReadyForPackingShipmentList",{}));e.push(n.getMashupRefObj(this,"getRuleForItemPack",{}));n.callMashups(this,e,{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)},processPaginatedShipmentList:function(e){this.ui.apiCallInProgress=false;var t=n.getMashupOutput(e,"getReadyForPackingShipmentList");this.ui.noOfSearchResults=u("number")(t.Page.Output.Shipments.TotalNumberOfRecords);if(t.Page.Output.Shipments.Shipment){this.processShipment(t.Page.Output.Shipments)}console.log(t.Page.Output.Shipments);if(this.ui.noOfSearchResults==1){i.goToState("packwizard",{},{})}else{}},processShipment:function(e){for(var t=0;t<e.Shipment.length;t++){var i=e.Shipment[t];i.OrderNoToDisplay=p.getDisplayOrderNumber(i.DisplayOrderNo,"|",", ",true);i.ImageUrlToDisplay=p.getFullURLForImage(i.ImageUrl);i.SLAStylingClass=this._getSLAStyling(i.ImageUrl);i.StatusDescriptionToDisplay=p.getShipmentStatusDescription(i)}},_getSLAStyling:function(e){if(!iscCore.isVoid(e)&&e.lastIndexOf("/")!=-1){var t=e.substring(e.lastIndexOf("/")+1,e.indexOf("."));if(!iscCore.isVoid(t)){console.log("cssClass="+t);return t}}},uiScanBarCodeData:function(){if(!iscCore.isVoid(this.model.scanInput.value)){var e={BarCode:{BarCodeData:this.model.scanInput.value}};n.callMashup(this,"translateBarCodeForShipmentPack",e,{}).then(this.processBarCodeTranslation.bind(this),angular.noop);this.model.scanInput.value=""}else{a.showErrorMessage(s.translate("extn_packportlet.MSG_InvalidBarCodeData"))}},processBarCodeTranslation:function(e){var t=n.getMashupOutput(e,"translateBarCodeForShipmentPack");if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.BarCode.ErrorCode)){a.showErrorMessage("apierror."+t.BarCode.ErrorCode)}else{i.goToState("extn_containerpack",{input:{Shipment:t.BarCode.Shipment}},{})}},uiViewPackOrderDetails:function(e){var t={Shipment:{}};t.Shipment=e;i.goToState("extn_containerpack",{input:{Shipment:e}},{})},uiCancel:function(){i.goToPreviousState()},uiNextPageActionValidator:function(){var e=true;if(this.ui.apiCallInProgress){e=false}return e},uiGetNextPackingRecords:function(){if(this.model.shipmentList.Page.IsLastPage!=="N"){return}this.ui.apiCallInProgress=true;n.callPaginatedMashup(this,"getReadyForPackingShipmentList",{},"NEXT",{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)},uiOpenShipmentSummary:function(e){i.goToState("extn-shipment-summary",{input:{Shipment:{ShipmentKey:e}}},{})}})}]);
angular.module("store").controller("store.views.shipment.containerunpack.container-unpack-reason",["$scope","$rootScope","$uibModalInstance","iscScreen","iscWizard","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal","$timeout",function(e,o,s,i,n,t,a,c,d,u,r,m){i.initializeModalScreen(e,{model:{reasonList:{}},mashupRefs:[{mashupRefId:"getReasonCodes",mashupId:"store.views.shipment.containerunpack.unpack_getReasonCodes",modelName:"reasonList"}],ui:{reasonCode:""},initialize:function(){c.callMashup(this,"getReasonCodes",{},{}).then(function(e){m(function(){if(Number(this.model.reasonList.CommonCodeList.TotalNumberOfRecords)>0){this.ui.reasonCode=this.model.reasonList.CommonCodeList.CommonCode[0].CodeValue}}.bind(this),0)}.bind(this))},uiClose:function(){s.dismiss({data:"CANCEL"})},uiApply:function(){s.close({data:"APPLY",reasonCode:this.ui.reasonCode})}})}]);
angular.module("store").controller("store.views.shipment.customer-pickup.customer-pickup-finish",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscModal","iscI18n","iscState",function(i,e,t,s,o,a,n,r,c){t.initializeWizardPage(i,{model:{},mashupRefs:[],ui:{},initialize:function(){if(t.getWizardAction()==="FINISH"){var i=t.getWizardModel("shipmentDetails");var e=i.Shipment.ShipmentKey;c.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:e},flowName:"CustomerPickup"}},{})}else if(t.getWizardAction()==="CLOSE"){c.goToPreviousState()}}})}]);
angular.module("store").controller("store.views.shipment.customer-pickup.customer-pickup-init",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscModal","iscI18n","iscState","$filter","iscStateParams",function(i,t,e,s,a,o,r,n,p,m){e.initializeWizardPage(i,{model:{shipmentDetails:{}},mashupRefs:[{mashupRefId:"validateShipmentForCustomerPickup",mashupId:"store.views.shipment.customer-pickup.ValidateShipmentForCustomerPickup"}],ui:{stateParams:{params:""}},initialize:function(){this.ui.stateParams.params=m.params;this.validateShipmentForCustomerPickup()},validateShipmentForCustomerPickup:function(){var i=this.ui.stateParams.params.input;var t={Shipment:{ShipmentKey:i.Shipment.ShipmentKey,Action:"CustomerPick"}};s.callMashup(this,"validateShipmentForCustomerPickup",t,{}).then(this.processShipmentDetailsForCustomerPickup.bind(this),angular.noop)},processShipmentDetailsForCustomerPickup:function(i){var t=s.getMashupOutput(i,"validateShipmentForCustomerPickup");this.model.shipmentDetails=t;if(t.Shipment.Error){this.handleShipmentValidationError(t)}else{e.setWizardModel("shipmentDetails",this.model.shipmentDetails);e.startCustomWizard("singlepagepickup",this.ui.stateParams.params,{})}},handleShipmentValidationError:function(i){var t=i.Shipment.Error.ErrorDescription;var e=i.Shipment.Error.action;var s=this;if(t=="InvalidShipmentShipNode"||t.indexOf("InvalidTransactionAllowed_")>-1){this.showCustomErrorModal(r.translate("customerpickup.MESSAGE_"+t),i)}},showCustomErrorModal:function(i,t){var e=this;var s={options:{headerText:"modal.TITLE_Error",headerIconCss:"app-glyphicons app-icon-error_30",action:[{actionName:"goBack",actionLabel:"customerpickup.ACTION_Go_back"},{actionName:"gotoSummary",actionLabel:"customerpickup.ACTION_Goto_shipment_summary"}]},settings:{size:"md",type:"error"}};o.showConfirmationMessage(i,s).then(function(i){if(i=="goBack"){e.closeCustomerPickupWizard()}else if(i=="gotoSummary"){n.goToState("shipmentsummary",{input:t},{})}})},closeCustomerPickupWizard:function(){e.setWizardModel("shipmentDetails",this.model.shipmentDetails);e.closeWizard()}})}]);
angular.module("store").controller("store.views.shipment.customer-pickup.customer-pickup-page",["$scope","$rootScope","iscScreen","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscState","iscAppInfo","iscShipment","$timeout","iscPrint","iscWizard","$locale","$filter","iscObjectUtility","iscScrollUtility","iscCustomerPickup",function(i,e,t,s,o,r,n,a,h,u,p,m,c,l,d,S,L,g,f,C){d.initializeWizardPage(i,{model:{shipmentDetails:{},shipmentLineList:{},custVeriMethodList:{}},mashupRefs:[{mashupRefId:"getShipmentDetails",mashupId:"store.views.shipment.customer-pickup.getShipmentSummaryDetails",modelName:"shipmentDetails"},{mashupRefId:"getShipmentLineList",mashupId:"store.views.shipment.customer-pickup.getShipmentLineDetails",modelName:"shipmentLineList"},{mashupRefId:"getCustomerVerficationMethodList",mashupId:"store.views.shipment.customer-pickup.getCustomerVerficationMethodList",modelName:"custVeriMethodList"},{mashupRefId:"registerBarCodeForCustomerPickup",mashupId:"store.views.shipment.customer-pickup.registerBarCodeForCustomerPickup",modelName:"lastScannedProduct"},{mashupRefId:"pickAllShipmentLines",mashupId:"store.views.shipment.customer-pickup.pickupAllShipmentLines"},{mashupRefId:"getUpdatedShipmentLineDetails",mashupId:"store.views.shipment.customer-pickup.getShipmentLineDetailsPostChangeShipment"},{mashupRefId:"updatePickedupQuantityForShipmentLine",mashupId:"store.views.shipment.customer-pickup.updatePickedupQuantityForShipmentLine"},{mashupRefId:"recordShortageForShipmentLine",mashupId:"store.views.shipment.customer-pickup.recordShortageForShipmentLine"},{mashupRefId:"recordShortageForAllShipmentLines",mashupId:"store.views.shipment.customer-pickup.recordShortageForAllShipmentLines"},{mashupRefId:"recordCustomerPickup",mashupId:"store.views.shipment.customer-pickup.recordCustomerPickup"},{mashupRefId:"getStagingLocationRequiredRuleDetails",mashupId:"store.views.shipment.getStagingLocationRequiredRuleDetails"}],ui:{showCustomerPickupUI:false,shipmentKey:"",customerVerificationMethod:"",showCustomerVerificationMethodError:false,customerVerificationMethodErrorDesc:a.translate("customerpickup.MESSAGE_CustomerVerificationMethodNotFound"),recordShownCount:h.isMobile()?6:10,selectedShipmentLineKey:"",currentlySelectedShipmentLine:"",focusOnFirstLine:true,productListIndex:0,selectedCustomerContact:"",isStagingLocationRuleEnabled:true,hasStagingLocation:false},initialize:function(){var e=s.params.input.Shipment.ShipmentKey;this.ui.shipmentKey=e;var t={};t.Shipment={};t.Shipment.ShipmentKey=e;var i={};i.ShipmentLine={};i.ShipmentLine.ShipmentKey=e;var n=[];n.push(o.getMashupRefObj(this,"getShipmentDetails",t));n.push(o.getMashupRefObj(this,"getCustomerVerficationMethodList",{}));n.push(o.getMashupRefObj(this,"getShipmentLineList",i));n.push(o.getMashupRefObj(this,"getStagingLocationRequiredRuleDetails",{Rule:{}}));o.callMashups(this,n,{}).then(this.handleInitMashupOutput.bind(this),angular.noop)},handleInitMashupOutput:function(e){this.ui.showCustomerPickupUI=true;var t=o.getMashupOutput(e,"getShipmentDetails");if(t&&t.Shipment){t.Shipment.DisplayOrderNoDesc=m.getDisplayOrderNumber(t.Shipment.DisplayOrderNo,"|",", ",false)}this.ui.hasStagingLocation=!iscCore.isVoid(t.Shipment.HoldLocation);this.ui.selectedCustomerContact=t.Shipment.CustomerContacts.CustomerContact[0];this.model.shipmentLineList=o.getMashupOutput(e,"getShipmentLineList");if(!iscCore.isVoid(this.model.shipmentLineList)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords)){this.ui.numberOfPickableProducts=L("number")(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords);this.ui.shipmentFullyPicked=this.ui.numberOfPickableProducts==0?true:false;if(this.ui.focusOnFirstLine&&this.ui.numberOfPickableProducts>0){this.ui.currentlySelectedShipmentLine=this.model.shipmentLineList.ShipmentLines.ShipmentLine[0];this.ui.selectedShipmentLineKey=this.ui.currentlySelectedShipmentLine.ShipmentLineKey;this.uiStampCustomerPickupQuantityAttrs(this.ui.currentlySelectedShipmentLine)}}var i=t.Shipment.ImageUrl;if(i){this.ui.slaImageFullURL=m.getFullURLForImage(i)}var n=o.getMashupOutput(e,"getStagingLocationRequiredRuleDetails");this.ui.isStagingLocationRuleEnabled=n&&n.Rules.RuleSetValue=="Y"?true:false},uiOpenOrder:function(){if(this.model.shipmentDetails){var e=this.model.shipmentDetails.Shipment;if(e.ShipmentLines&&e.ShipmentLines.ShipmentLine&&e.ShipmentLines.ShipmentLine.length>0){var t={Order:e.ShipmentLines.ShipmentLine[0].Order};u.goToState("ordersummary",{orderInput:t,showBackLink:true},{})}}},uiGetNextShipmentLineRecords:function(){if(this.ui.recordShownCount<=this.model.shipmentLineList.ShipmentLines.ShipmentLine.length){this.ui.recordShownCount+=6}},uiCancel:function(){this.handleWizardExitAndClose("close")},handleWizardExit:function(){return this.handleWizardExitAndClose("exit")},handleWizardBack:function(){var e=i.customerPickupForm.$dirty;return d.handleWizardBack(e,"customerpickup.MESSAGE_CancelWarningMessage")},handleWizardExitAndClose:function(e){var t=i.customerPickupForm.$dirty;return d.handleWizardExitAndClose(e,t,"customerpickup.MESSAGE_CancelWarningMessage")},uiScanBarCodeData:function(){if(!iscCore.isVoid(this.model.barCodeData)){var t=this;this.model.barCodeData=g.trimString(this.model.barCodeData);var e={BarCode:{BarCodeData:this.model.barCodeData,ShipmentContextualInfo:{}}};e.BarCode.ShipmentContextualInfo.ShipmentKey=this.model.shipmentDetails.Shipment.ShipmentKey;e.BarCode.ShipmentContextualInfo.SellerOrganizationCode=this.model.shipmentDetails.Shipment.SellerOrganizationCode;o.callMashup(this,"registerBarCodeForCustomerPickup",e,{}).then(this.processRegisterBarCodeOutput.bind(this),function(e){t.handleMashupErrors(e)})}else{r.showErrorMessage(a.translate("customerpickup.MESSAGE_InvalidBarCodeData"))}},handleMashupErrors:function(e){var t=this;var i=e.Errors.Error[0].ErrorDescription;var n=e.Errors.Error[0].ErrorCode;if(a.hasKey("apierror."+n)){i=a.translate("apierror."+n);r.showErrorMessage(i,null,null).then(function(e){t.resetData()})}else{r.showErrorMessage(i,null,null).then(function(e){t.resetData()})}},processRegisterBarCodeOutput:function(e){var t=o.getMashupOutput(e,"registerBarCodeForCustomerPickup");this.updateShipmentLineListModel(t.BarCode.Shipment.ShipmentLine);this.highlightLastPickedProduct(t.BarCode.Shipment.ShipmentLine);this.resetData()},uiUpdateShipmentLineQuantity:function(e,t){var i=[];i.push(o.getMashupRefObj(this,"updatePickedupQuantityForShipmentLine",C.getQuantityUpdateInput(this.ui.shipmentKey,e.ShipmentLineKey,t)));i.push(o.getMashupRefObj(this,"getUpdatedShipmentLineDetails",C.getShipmentLineDetailsInput(this.ui.shipmentKey,e.ShipmentLineKey)));o.callMashups(this,i,{}).then(this.postPickupQuantityUpdate.bind(this))},postPickupQuantityUpdate:function(e){var t=o.getMashupOutput(e,"getUpdatedShipmentLineDetails");if(t.ShipmentLines.ShipmentLine){this.updateShipmentLineListModel(t.ShipmentLines.ShipmentLine[0])}this.resetData()},resetData:function(){this.model.barCodeData="";if(i.customerPickupForm){i.customerPickupForm.$setPristine()}if(i.quantityForm){i.quantityForm.$setPristine()}},updateShipmentLineListModel:function(e){if(!iscCore.isVoid(this.model.shipmentLineList)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords)){var t=L("number")(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords);for(var i=0;i<t;i++){var n=this.model.shipmentLineList.ShipmentLines.ShipmentLine[i];this.ui.productListIndex++;if(!iscCore.isVoid(n)&&n.ShipmentLineKey==e.ShipmentLineKey){var n=this.model.shipmentLineList.ShipmentLines.ShipmentLine[i];n.CustomerPickedQuantity=L("number")(e.CustomerPickedQuantity);n.EditableCustomerPickedQuantity=n.CustomerPickedQuantity;n.Quantity=L("number")(e.Quantity);n.ShortageQty=L("number")(e.ShortageQty);n.ShortageResolutionReason=e.ShortageResolutionReason;n.ShortageResolutionReasonDesc=e.ShortageResolutionReasonDesc;n.CancelReason=e.CancelReason;n.CancelReasonDesc=e.CancelReasonDesc;n.IsCustomerPickComplete=e.IsCustomerPickComplete;this.uiStampCustomerPickupQuantityAttrs(this.model.shipmentLineList.ShipmentLines.ShipmentLine[i]);break}}}},highlightLastPickedProduct:function(e){if(this.ui.recordShownCount<this.ui.productListIndex){this.ui.recordShownCount=this.ui.productListIndex}var t=this;c(function(){f.scrollToElementWIthOffset(document.getElementById("shipmentDetials"),document.getElementById(e.ShipmentLineKey),0,100)},0);this.ui.productListIndex=1;this.uiSelectShipmentLine(e)},uiSelectShipmentLine:function(e){this.ui.selectedShipmentLineKey=e.ShipmentLineKey;this.uiStampCustomerPickupQuantityAttrs(e);this.ui.currentlySelectedShipmentLine=e;this.ui.focusOnFirstLine=false},uiStampCustomerPickupQuantityAttrs:function(e){var t=0,i=0;if(e.CustomerPickedQuantity){e.EditableCustomerPickedQuantity=angular.copy(e.CustomerPickedQuantity)}else{e.EditableCustomerPickedQuantity="0";e.CustomerPickedQuantity="0"}var n=angular.isNumber(Number(e.Quantity))?Number(e.Quantity):i;var s=angular.isNumber(Number(e.CustomerPickedQuantity))?Number(e.CustomerPickedQuantity):i;var o=e.ShortageResolutionReason;if(o){t=n-s}e.ComputedShortageQty=t;e.showQtyUpdate="N";e.IsLineCompletelyPickup=e.CustomerPickedQuantity===e.Quantity;e.IsLineShorted=!iscCore.isVoid(e.ShortageResolutionReason);e.canLineBeShorted=iscCore.isVoid(e.ShortageResolutionReason)&&e.Quantity!=0&&e.CustomerPickedQuantity!=e.Quantity;e.IsCompletelyShortedInBackroom=e.OriginalQuantity==e.ShortageQty&&iscCore.isVoid(e.ShortageResolutionReason)?true:false},uiOpenRecordShortagePopup:function(t){var e=0;var i={};i.codeType="YCD_SHORT_RESOLU";i.shipmentLine=angular.copy(t);var n=angular.isNumber(Number(t.CustomerPickedQuantity))?Number(t.CustomerPickedQuantity):e;var s=angular.isNumber(Number(t.Quantity))?Number(t.Quantity):e;i.shipmentLine.DisplayQty=n;i.shipmentLine.DisplayTotalQty=s;i.shipmentLine.OrderLine=t.OrderLine;i.shipmentLine.DisplayShortQty=s-n;var o={modalInput:function(){return i}};r.openModal("store.views.shipment.common.record-shortage.record-shortage",o,{}).then(function(e){if(e.data!==null&&e.data!==undefined){this.recordShortageForShipment(e.data,t)}}.bind(this),angular.noop)},recordShortageForShipment:function(e,t){if(e.RecordShortage.MarkAllLines==true){var i=C.getShortAllRemainingInput(this.ui.shipmentKey,this.model.shipmentLineList,e.RecordShortage.ShortageReasonCode,e.RecordShortage.CancellationReason);o.callMashup(this,"recordShortageForAllShipmentLines",i,{}).then(this.postRecordShortageForShipment.bind(this,"recordShortageForAllShipmentLines"),angular.noop)}else{var n=[];n.push(o.getMashupRefObj(this,"recordShortageForAllShipmentLines",C.getShortageLineInput(this.ui.shipmentKey,t.ShipmentLineKey,e.RecordShortage.ShortageReasonCode,e.RecordShortage.CancellationReason)));n.push(o.getMashupRefObj(this,"getUpdatedShipmentLineDetails",C.getShipmentLineDetailsInput(this.ui.shipmentKey,t.ShipmentLineKey)));o.callMashups(this,n,{}).then(this.postRecordShortageForShipment.bind(this,"getUpdatedShipmentLineDetails"),angular.noop)}},postRecordShortageForShipment:function(e,t){if(e=="recordShortageForAllShipmentLines"){var i=o.getMashupOutput(t,"recordShortageForAllShipmentLines");if(iscCore.getValueFromJsonPath(i,"Shipment.ShipmentLines.ShipmentLine")){for(var n=0;n<i.Shipment.ShipmentLines.ShipmentLine.length;n++){this.updateShipmentLineListModel(i.Shipment.ShipmentLines.ShipmentLine[n])}this.ui.selectedShipmentLineKey=""}r.showConfirmationMessage(a.translate("customerpickup.MESSAGE_ShortAllRemainingLinesMessage")).then(function(e){if(e==="YES"){this.invokeFinish(false)}else{}}.bind(this))}else{var s=o.getMashupOutput(t,e);this.updateShipmentLineListModel(s.ShipmentLines.ShipmentLine[0]);this.resetData()}},uiPickupAll:function(){var e={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,ShipmentLines:{}}};o.callMashup(this,"pickAllShipmentLines",C.getPickAllInput(this.model.shipmentDetails.Shipment.ShipmentKey,this.model.shipmentLineList),{}).then(this.handlePickupAll.bind(this),angular.noop)},handlePickupAll:function(e){var t=o.getMashupOutput(e,"pickAllShipmentLines");if(iscCore.getValueFromJsonPath(t,"Shipment.ShipmentLines.ShipmentLine")){for(var i=0;i<t.Shipment.ShipmentLines.ShipmentLine.length;i++){this.updateShipmentLineListModel(t.Shipment.ShipmentLines.ShipmentLine[i])}this.ui.selectedShipmentLineKey="";this.checkForScanComplete()}},checkForScanComplete:function(){if(C.isAllLinesComplete(this.model.shipmentLineList)){var e=a.translate("customerpickup.MESSAGE_ScanComplete");var t=this;r.showConfirmationMessage(e).then(function(e){if(e==="YES"){t.invokeFinish(false)}},function(e){})}},invokeFinish:function(e){var t=e?C.isAllLinesComplete(this.model.shipmentLineList):true;var i=!iscCore.isVoid(this.ui.custVerificationMethod);if(!i){r.showErrorMessage(a.translate("customerpickup.MESSAGE_Customer_verification_not_done"))}else if(t){this.recordCustomerPickup()}else{r.showErrorMessage(a.translate("customerpickup.MESSAGE_PartiallyPickedUp"))}},uiInvokeFinish:function(){this.invokeFinish(true)},recordCustomerPickup:function(){var e={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,Notes:[{Note:{}}]}};e.Shipment.Notes[0].Note=this.getCustomerVerificationDetails();o.callMashup(this,"recordCustomerPickup",e,{}).then(this.handleRecordCustomerPickup.bind(this),angular.noop)},getCustomerVerificationDetails:function(){var e=this.ui.selectedCustomerContact;var t=a.translate("address.LABEL_Display_name",{firstname:e.FirstName,lastname:e.LastName});return{ContactUser:h.getFromContext("currentLoginID"),NoteText:a.translate("customerpickup.MESSAGE_Verfication_note",{customerName:t,verificationmethod:this.ui.custVerificationMethod.CodeShortDescription,user:h.getFromContext("currentLoginID")}),ReasonCode:"YCD_CUSTOMER_VERIFICATION"}},handleRecordCustomerPickup:function(e){var t=o.getMashupOutput(e,"recordCustomerPickup").Shipment.Status;if(!iscCore.isVoid(t)){if(t.indexOf("9000")>-1){r.showInfoMessage("customerpickup.MESSAGE_Pickup_order_cancelled").then(function(e){d.finishWizard()}.bind(this))}else if(t.indexOf("1400")>-1){r.showInfoMessage("customerpickup.MESSAGE_Pickup_success").then(function(e){d.finishWizard()}.bind(this))}}else{r.showInfoMessage("customerpickup.MESSAGE_Pickup_not_processed").then(function(e){d.finishWizard()}.bind(this))}},uiOpenItemDetails:function(e){m.openProductDetail(e)}})}]);
angular.module("store").controller("store.views.shipment.global-shipment-search.global-shipment-search",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscAppContext","$timeout","iscShipment","$filter","iscShipmentStatus","iscStateParams",function(t,i,e,n,s,p,u,a,r,o,h,m){i.initializeScreen(t,{model:{shipmentList:{},filterOptions:{}},mashupRefs:[{mashupRefId:"getShipmentList",mashupId:"store.views.shipment.global-shipment-search.getShipmenSearchResultList",modelName:"shipmentList",isPaginated:true,pageSize:15,append:true,appendPath:"Shipments.Shipment"}],subscribers:[{event:"$beforeStateChange",handler:"_handleBeforeStateChange"}],ui:{apiCallInProgress:false,selectedShipmentKey:"",recordShownCount:15,numOfOrders:-1,origApiInput:{},apiInput:{},inputStatusArray:[],inputDocumentTypeArray:[],sortOptions:""},initialize:function(){var t=m.params;var i=m.options;this.ui.origApiInput=t.input;this.ui.inputStatusArray=i.statusList?i.statusList:!t.status&&!this.ui.origApiInput.Shipment.Status?angular.copy(h.getShipmentStatusCodeList("All")):!this.ui.origApiInput.Shipment.Status?t.status:[this.ui.origApiInput.Shipment.Status];delete this.ui.origApiInput.Shipment.Status;this.ui.inputDocumentTypeArray=["0001","0006"];if(this.ui.origApiInput.Shipment.DocumentType){this.ui.inputDocumentTypeArray=[this.ui.origApiInput.Shipment.DocumentType]}else if(t.documentTypes){this.ui.inputDocumentTypeArray=t.documentTypes}else if(t.ignoreDocumentType){for(var e=0;e<this.ui.inputDocumentTypeArray.length;e++){if(this.ui.inputDocumentTypeArray[e]==t.ignoreDocumentType){this.ui.inputDocumentTypeArray.splice(e,1);break}}}delete this.ui.origApiInput.Shipment.DocumentType;var n=angular.copy(h.getShipmentStatusConfig("All"));var s=n.StatusList.Status;for(var p=0;p<s.length;p++){for(var e=0;e<this.ui.inputStatusArray.length;e++){if(s[p].StatusCode==this.ui.inputStatusArray[e]){s[p].Checked="Y"}}}this.model.filterOptions=n;this.ui.sortOptions=!i.sortOptions?"N":i.sortOptions;this._startShipmentPagination()},_startShipmentPagination:function(){this.model.shipmentList={};this.ui.apiInput=r.prepareShipmentListApiInput(this.ui.origApiInput,this.ui.inputStatusArray,this.ui.inputDocumentTypeArray,"",this.ui.sortOptions);p.callPaginatedMashup(this,"getShipmentList",this.ui.apiInput,"START",{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)},processPaginatedShipmentList:function(t){this.ui.apiCallInProgress=false;var i=p.getMashupOutput(t,"getShipmentList");this.ui.numOfOrders=o("number")(i.Page.Output.Shipments.TotalNumberOfRecords);if(i.Page.Output.Shipments.Shipment){if(iscCore.isVoid(this.ui.selectedShipmentKey)){this.ui.selectedShipmentKey=i.Page.Output.Shipments.Shipment[0].ShipmentKey}this.processShipment(i.Page.Output.Shipments)}},processShipment:function(t){for(var i=0;i<t.Shipment.length;i++){var e=t.Shipment[i];e.OrderNoToDisplay=r.getDisplayOrderNumber(e.DisplayOrderNo,"|",", ",true);e.StatusDescriptionToDisplay=r.getShipmentStatusDescription(e);this.setNextActionForShipment(e)}},setNextActionForShipment:function(t){var i=t.Status.Status;if(i.indexOf("1100.70.06.10")!=-1){t.shipmentNextactionKey="pickorderlist.ACTION_PickOrder"}else if(i.indexOf("1100.70.06.20")!=-1){t.shipmentNextactionKey="pickorderlist.ACTION_ContinuePick"}else if(i.indexOf("1100.70.06.30")!=-1){t.shipmentNextactionKey="customerpickorderlist.LABEL_Start_Customerpick"}else if(i.indexOf("1100.70.06.50")!=-1){t.shipmentNextactionKey="packorderlist.ACTION_PackOrder"}else if(i.indexOf("1100.70.06.70")!=-1){t.shipmentNextactionKey="packorderlist.ACTION_ContinuePack"}},uiPickOrPackOrder:function(t){var i=t.Status.Status;if(i.indexOf("1100.70.06.10")!=-1||i.indexOf("1100.70.06.20")!=-1){e.goToState("backroomPickWizard",{input:{Shipment:{ShipmentKey:t.ShipmentKey}}},{})}else if(i.indexOf("1100.70.06.50")!=-1||i.indexOf("1100.70.06.70")!=-1){e.goToState("containerpack",{input:{Shipment:{ShipmentKey:t.ShipmentKey}}},{})}else if(i.indexOf("1100.70.06.30")!=-1){e.goToState("customer-pickup",{input:{Shipment:{ShipmentKey:t.ShipmentKey}}},{})}},uiSelectShipment:function(t){this.ui.selectedShipmentKey=t.ShipmentKey},uiOrderListScrollActionValidator:function(){if(this.model.shipmentList.Page.IsLastPage!=="N"||this.ui.apiCallInProgress){return false}else return true},uiGetNextSearchResultRecords:function(){if(this.model.shipmentList.Page.IsLastPage!=="N"){return}this.ui.apiCallInProgress=true;p.callPaginatedMashup(this,"getShipmentList",this.ui.apiInput,"NEXT",{}).then(this.processPaginatedShipmentList.bind(this))},uiGoToShipmentSummary:function(t){e.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:t.ShipmentKey}}},{})},uiOnApplyFilter:function(t){this.model.filterOptions=t;var i=t.StatusList.Status;this.ui.inputStatusArray=[];for(var e=0;e<i.length;e++){if(i[e].Checked=="Y"){this.ui.inputStatusArray.push(i[e].StatusCode)}}this._startShipmentPagination()},uiApplySortOptions:function(t){if(t.sortOption=="NEW_TO_OLD"){this.ui.sortOptions="Y"}else if(t.sortOption=="OLD_TO_NEW"){this.ui.sortOptions="N"}this._startShipmentPagination()},uiClose:function(){e.goToState("/home",{},{})},_handleBeforeStateChange:function(t,i){if(!e.currentState.options)e.currentState.options={};e.currentState.options.statusList=angular.copy(this.ui.inputStatusArray);e.currentState.options.sortOptions=angular.copy(this.ui.sortOptions)}})}]);
angular.module("store").controller("store.views.shipment.list.shipment-list",["$scope","iscScreen","iscI18n","iscMashup","iscState","iscStateParams","iscAppInfo","iscAppContext","iscDialChartD3Pvdr","iscDialChartD3Service","iscManagerDashboardService",function(t,e,s,a,i,n,o,r,u,h,l){e.initializeScreen(t,{model:{shipmentList_SLA:{},shipmentList_OS:{},shipmentCount_SLA:{},shipmentCount_OS:{}},mashupRefs:[{mashupRefId:"sla_getShipmentListByStatus",mashupId:"shipmentList_getShipmentListByStatus_sla",modelName:"shipmentList_SLA",isPaginated:true,pageSize:15,append:false,appendPath:"Shipments.Shipment"},{mashupRefId:"orderstatus_getShipmentListByStatus",mashupId:"shipmentList_getShipmentListByStatus_orderstatus",modelName:"shipmentList_OS",isPaginated:true,pageSize:15,append:false,appendPath:"Shipments.Shipment"},{mashupRefId:"sla_getShipmentCountForGivenStatuses",mashupId:"sla_getShipmentCountForGivenStatuses",modelName:"shipmentCount_SLA"},{mashupRefId:"orderstatus_getShipmentCountForGivenStatuses",mashupId:"orderstatus_getShipmentCountForGivenStatuses",modelName:"shipmentCount_OS"}],ui:{current_fulfillmentMethod:"",current_view:"",current_selectedStatus:"",apiCallInProgress:false,isNextPageLoadCall:false,isLastPage:false,noRecordsFound:false,isReqdCommonCodeSLAConfigValid:true,pageAction:"START",dataToDisplay:{activeTabIndex:0,pageTitle:"shipmentList.LABEL_BOPUSOrders",total_shipmentCount:0,headerLabel:s.translate("managerDashboard.LABEL_Orders"),tabHeaderFulfillmentModeCss:"manager-dashboard-bopus-theme",tabData:[]}},_waitForShipmentCount:false,initialize:function(){this.commonCodeListData=l.getCommonCodeListData();if(this.commonCodeListData==null){console.error("store.views.shipment.list.shipment-list: unexpected scenario. Could not get common codes for SLA. Not proceeding further.");return}this.mgrDashboardConfig=u.getManagerDashboardConfig();if(!iscCore.isVoid(n.params)){this.ui.current_fulfillmentMethod=n.params.fulfillmentMethod;this.ui.current_view=n.params.view;this.ui.current_selectedStatus=n.params.selectedStatus}else{console.error("store.views.shipment.list.shipment-list: unexpected scenario. Did not receive input about which tab to open and other relevant data. Not proceeding further.");return}this.initializeUIJson();this.callRequiredMashups()},initializeUIJson:function(){if(this.ui.current_fulfillmentMethod==="sfs"){this.ui.dataToDisplay["pageTitle"]="shipmentList.LABEL_SFSOrders";this.ui.dataToDisplay["tabHeaderFulfillmentModeCss"]="manager-dashboard-sfs-theme"}if(this.ui.current_view=="sla"){this.ui.dataToDisplay["headerLabel"]=s.translate("managerDashboard.LABEL_OrdersBySLA");this.ui.dataToDisplay["tabHeaderFulfillmentModeCss"]=""}this.ui.dataToDisplay["tabData"]=h.getLegendJsonConfigArray(this.ui.current_fulfillmentMethod,this.ui.current_view,null);for(var t=0;t<this.ui.dataToDisplay["tabData"].length;t++){this.ui.dataToDisplay["tabData"][t]["shipmentList"]=[];var e=this.ui.dataToDisplay["tabData"][t];if(this.ui.current_selectedStatus===e.statusName){this.ui.dataToDisplay.activeTabIndex=t}}},callRequiredMashups:function(t){this.ui.isReqdCommonCodeSLAConfigValid=l.validateCommonCodeListDataForFulfillmentMethod(this.ui.current_fulfillmentMethod);this.ui.noRecordsFound=false;if(t!=null){this.ui.current_selectedStatus=t}var e="orderstatus_getShipmentCountForGivenStatuses";var s="orderstatus_getShipmentListByStatus";if(this.ui.current_view==="sla"){e="sla_getShipmentCountForGivenStatuses";s="sla_getShipmentListByStatus"}this.ui.apiCallInProgress=true;if(this.ui.pageAction!=="NEXT"){var i=[a.getMashupRefObj(this,e,this.getShipmentCountInputJson())];a.callMashups(this,i,{showMask:true}).then(this.handleMashupOutput_count.bind(this),angular.noop)}if(this.ui.isReqdCommonCodeSLAConfigValid){a.callPaginatedMashup(this,s,this.getShipmentListInputJson(),this.ui.pageAction,{showMask:true}).then(this.handleMashupOutput_list.bind(this),angular.noop)}},getShipmentCountInputJson:function(){var t=this._getRequiredAttributesJson();var e=l.getInputJson(t.reqd_mgrDashboardConfigJson_sla,t.reqd_mgrDashboardConfigJson_shipmentStatus,this.ui.current_fulfillmentMethod,this.ui.current_view);e["Shipment"]["DeliveryMethod"]=t.fulfillmentMethod_code;return e},getShipmentListInputJson:function(){var t=[];var e=this._getRequiredAttributesJson();var s={Shipment:{StatusName:this.ui.current_selectedStatus,DeliveryMethod:e.fulfillmentMethod_code,ComplexQuery:{And:{Or:{Exp:[]}}},CommonCodeList:{CommonCode:l.getCommonCodeListDataAccordingToStatuses(e.reqd_mgrDashboardConfigJson_sla.displayStatuses,this.ui.current_fulfillmentMethod),DeliveryMethod:e.fulfillmentMethod_code}}};if(this.ui.current_view==="sla"){var i=l.getStringOfAllActualOrderStatusesExceptExcludedInSla(e.reqd_mgrDashboardConfigJson_shipmentStatus,e.reqd_mgrDashboardConfigJson_sla);t=i.split(",");s["Shipment"]["Mode"]="sla";for(var a=0;a<e.reqd_mgrDashboardConfigJson_sla.displayStatuses.length;a++){var n=e.reqd_mgrDashboardConfigJson_sla.displayStatuses[a];if(n["statusName"]===this.ui.current_selectedStatus){s["Shipment"]["ThresholdTimeLimit"]=l.getThresholdTimeLimitForStatus(e.reqd_mgrDashboardConfigJson_sla.displayStatuses,this.ui.current_fulfillmentMethod,n["statusName"]);break}}}else{for(var a=0;a<e.reqd_mgrDashboardConfigJson_shipmentStatus.displayStatuses.length;a++){var n=e.reqd_mgrDashboardConfigJson_shipmentStatus.displayStatuses[a];if(n["statusName"]===this.ui.current_selectedStatus){t=n["combinedStatusArray"];break}}}for(var a=0;a<t.length;a++){s["Shipment"]["ComplexQuery"]["And"]["Or"]["Exp"].push({Name:"Status",QryType:"FLIKE",Value:t[a]})}return s},handleMashupOutput_count:function(){if(this._waitForShipmentCount===true){this._waitForShipmentCount=false;this.handleMashupOutput_list()}},handleMashupOutput_list:function(){this.ui.dataToDisplay["total_shipmentCount"]=0;var t="N";var e=this.model.shipmentList_OS;var s=this.model.shipmentCount_OS;var i="OrderStatus";if(this.ui.current_view==="sla"){e=this.model.shipmentList_SLA;s=this.model.shipmentCount_SLA;i="SLA"}if(s.Shipment==null){this._waitForShipmentCount=true;return}this._waitForShipmentCount=false;t=iscCore.getValueFromJsonPath(e,"Page.IsLastPage");e=iscCore.getValueFromJsonPath(e,"Page.Output.Shipments.Shipment");if(t!=null&&(t.toLowerCase()==="y"||t.toLowerCase()==="true"||t===true)){this.ui.isLastPage=true}if(e==null||e!=null&&(e.length==null||e.length===0)){e=[];this.ui.noRecordsFound=true}e=h.addIconClassAttrAndStatusCssToShipmentArray(e,this.ui.current_fulfillmentMethod,this.ui.current_view,this.ui.current_selectedStatus);for(var a=0;a<this.ui.dataToDisplay["tabData"].length;a++){var n=this.ui.dataToDisplay["tabData"][a];if(this.ui.dataToDisplay.activeTabIndex===a&&this.ui.current_selectedStatus===n.statusName){if(this.ui.isNextPageLoadCall){this.ui.dataToDisplay["tabData"][a]["shipmentList"]=this.ui.dataToDisplay["tabData"][a]["shipmentList"].concat(e)}else{this.ui.dataToDisplay["tabData"][a]["shipmentList"]=e}}else{this.ui.dataToDisplay["tabData"][a]["shipmentList"]=[]}n["value"]=this._getShipmentCountFromArray(s.Shipment[i].DisplayStatusList.DisplayStatus,n["statusName"]);this.ui.dataToDisplay["total_shipmentCount"]+=n["value"]}this.ui.apiCallInProgress=false;this.ui.isNextPageLoadCall=false},_getShipmentCountFromArray:function(t,e){var s=-1;for(var i=0;i<t.length;i++){if(t[i]["StatusName"].toLowerCase()===e.toLowerCase()){s=+t[i]["Count"];break}}return s},_getRequiredAttributesJson:function(){var t="PICK";var e=this.commonCodeListData["bopus"];var s=this.mgrDashboardConfig["pickupInStore"];if(this.ui.current_fulfillmentMethod==="sfs"){t="SHP";e=this.commonCodeListData["sfs"];s=this.mgrDashboardConfig["shipFromStore"]}return{fulfillmentMethod_code:t,reqd_mgrDashboardConfigJson:s,reqd_mgrDashboardConfigJson_sla:s["sla"],reqd_mgrDashboardConfigJson_shipmentStatus:s["shipmentStatus"],commonCodeListData:e}},uiCallRequiredMashups:function(t){if(this.ui.apiCallInProgress){return}this.ui.isLastPage=false;this.ui.pageAction="START";this.ui.isNextPageLoadCall=false;this.callRequiredMashups(t)},uiShowManagerDashboard:function(){i.goToState("/manager-dashboard",{},{})},uiGetShipmentListNext:function(){if(this.ui.isLastPage){return}this.ui.pageAction="NEXT";this.ui.isNextPageLoadCall=true;this.callRequiredMashups()},uiNextPageActionValidator:function(){var t=true;if(this.ui.apiCallInProgress){t=false}return t}})}]);
angular.module("store").controller("store.views.shipment.search.shipment-search",["$scope","$rootScope","iscScreen","iscMashup","iscResourcePermission","iscState","iscStateParams","iscPrint","iscAppContext","iscI18n","iscModal","iscObjectUtility","iscShipment",function(t,e,i,a,s,h,r,n,o,u,c,S,p){i.initializeScreen(t,{model:{shipmentList:{}},mashupRefs:[{mashupRefId:"getShipmentList",mashupId:"shipmentSearch_getShipmentList_custom",modelName:"shipmentList",handler:"massageShipmentListOutput"},{mashupRefId:"getShipmentListPaginated",mashupId:"shipmentSearch_getShipmentList_custom_paginated",modelName:"shipmentList",isPaginated:true,pageSize:o.isMobile()?5:20,append:true,appendPath:"Shipments.Shipment",handler:"massageShipmentListPaginatedOutput"}],subscribers:[{event:"$handleBackButton",handler:"_handleBackButton"},{event:"$beforeStateChange",handler:"_handleBeforeStateChange"}],ui:{showResults:false,currentStore:o.getFromContext("storeName"),search:{OrderBy:{Attribute:{Name:"ExpectedShipmentDate",Desc:"Y"}},deliveryMethod:"",barCodeData:"",searchStatus:"",action:"",mode:"CustomerPickup"},barCodeType:"StoreCoupon1",serachInBackContext:false,oLineShownCount:o.isMobile()?10:20,oPageSize:o.isMobile()?5:10,oIsServerSidePaginatedSearch:true,oPaginationAction:"START",fetchNextRecords:true},initialize:function(){if(r.params){if(r.params.searchStatus){this.ui.search.searchStatus=r.params.searchStatus}if(r.params.deliveryMethod){this.ui.search.deliveryMethod=r.params.deliveryMethod}if(r.params.mode){this.ui.search.mode=r.params.mode}if(r.params.orderNo){this.ui.search.OrderNo=r.params.orderNo;this.uiGetShipmentListForSearch()}}if(r.options&&r.options.backOptions){this.ui.serachInBackContext=true;this.ui.search=angular.copy(r.options.backOptions);delete r.options.backOptions;if(this.ui.search.barCodeData)this.ui.search.OrderNo=this.ui.search.barCodeData;this.fireSearchOnBackOrNext()}},resetBackAndPaginationAttributes:function(){this.ui.showResults=false;this.ui.serachInBackContext=false;this.ui.oLineShownCount=o.isMobile()?10:20;this.ui.oPageSize=o.isMobile()?4:5;this.ui.oPaginationAction="START";this.ui.fetchNextRecords=true;this.model.shipmentList={}},massageShipmentListOutput:function(t){if(iscCore.getValueFromJsonPath(t,"Shipments.Shipment")){for(var e=0;e<t.Shipments.Shipment.length;e++){var i=t.Shipments.Shipment[e];i.StatusDisplayDescription=p.getShipmentStatusDescription(i)}}return t},massageShipmentListPaginatedOutput:function(t){if(iscCore.getValueFromJsonPath(t,"Page.Output")){t.Page.Output=this.massageShipmentListOutput(t.Page.Output)}return t},fireSearchOnBackOrNext:function(){var t=this.ui.search.action;if(t){if(t==="search")this.uiGetShipmentListForSearch();else if(t==="scan")this.uiGetShipmentListForScan()}},uiGetShipmentListForSearch:function(t){if(t){this.resetBackAndPaginationAttributes()}var e=this;this.ui.search.action="search";this.ui.search.barCodeData="";var i=this.getSearchCriteria("search");this.invokeListMashup(i,{},"handleSearch")},uiGetShipmentListForScan:function(t){if(t){this.resetBackAndPaginationAttributes()}if(!iscCore.isVoid(this.ui.search.OrderNo))this.ui.search.OrderNo=S.trimString(this.ui.search.OrderNo);if(iscCore.isVoid(this.ui.search.OrderNo)){c.showErrorMessage(u.translate("shipmentsearch.MSG_InvalidBarCodeData"))}else{this.ui.search.action="scan";this.ui.search.barCodeData=this.ui.search.OrderNo;var e=this.getSearchCriteria("scan");e.Shipment.BarCode={BarCodeData:this.ui.search.OrderNo,BarCodeType:this.ui.barCodeType};this.invokeListMashup(e,{},"handleScan")}},getSearchCriteria:function(t){var e={};if(t!="scan"){e={Shipment:{ShipmentNo:this.ui.search.ShipmentNo,ShipNode:this.ui.search.inlcudeOtherShipnodes?"":o.getFromContext("storeName"),DeliveryMethod:!this.ui.search.deliveryMethod||this.ui.search.deliveryMethod=="BOTH"?"":this.ui.search.deliveryMethod,BillToAddress:this.ui.search.BillToAddress,OrderBy:this.ui.search.OrderBy,ShipmentLines:{ShipmentLine:{OrderNo:this.ui.search.OrderNo,OrderNoQryType:"FLIKE"}}}}}else{e={Shipment:{ShipNode:this.ui.search.inlcudeOtherShipnodes?"":o.getFromContext("storeName"),DeliveryMethod:!this.ui.search.deliveryMethod||this.ui.search.deliveryMethod=="BOTH"?"":this.ui.search.deliveryMethod,OrderBy:this.ui.search.OrderBy}}}if(this.ui.search.searchStatus){e.Shipment.Status=this.ui.search.searchStatus}else{}return e},invokeListMashup:function(t,e,i,s){if(!this.ui.oIsServerSidePaginatedSearch){a.callMashup(this,"getShipmentList",t,e).then(this[i].bind(this),angular.noop)}else{if(this.ui.fetchNextRecords===true){a.callPaginatedMashup(this,"getShipmentListPaginated",t,this.ui.oPaginationAction,e).then(this[i].bind(this),angular.noop);this.ui.fetchNextRecords=false}}},handleScan:function(t){this.ui.search.OrderNo="";this.handleSearch(t)},handleSearch:function(t){this.ui.fetchNextRecords=true;var e={},i=[];if(!this.ui.oIsServerSidePaginatedSearch){e=a.getMashupOutput(t,"getShipmentList");i=iscCore.getValueFromJsonPath(e,"Shipments.Shipment")?e.Shipments.Shipment:[];this.handleResults(i)}else{e=a.getMashupOutput(t,"getShipmentListPaginated");i=iscCore.getValueFromJsonPath(e,"Page.Output.Shipments.Shipment")?e.Page.Output.Shipments.Shipment:[];if(this.ui.oPaginationAction==="START"){this.handleResults(i)}}},handleResults:function(t){if(t.length>0){if(t.length===1&&!this.ui.serachInBackContext){if(this.ui.search.mode==="CustomerPickup"&&S.stringStartsWith(t[0].Status.Status,"1100.70.06.30")&&s.hasPermission("WSC000001"))this.startCustomerPickup(t[0].ShipmentKey);else this.ui.showResults=true}else{this.ui.showResults=true}}else{this.showError()}},showError:function(){c.showErrorMessage(u.translate("shipmentsearch.SHIPMENT_NOT_FOUND"))},uiFetchNextRecords:function(){return this.ui.fetchNextRecords},uiGetShipmentListNext:function(){if(!this.ui.oIsServerSidePaginatedSearch){if(this.ui.oLineShownCount<=this.model.shipmentList.Shipments.Shipment.length){this.ui.oLineShownCount+=this.ui.oPageSize}}else{this.ui.oPaginationAction="NEXT";this.fireSearchOnBackOrNext()}},getShipmentStatusList:function(t){var e;if(!t||t===" "||t===""||t==="BOTH"){e={StatusList:{Status:[{StatusCode:"1100.70.06.10"},{StatusCode:"1100.70.06.20"},{StatusCode:"1100.70.06.30"},{StatusCode:"1100.70.06.50"},{StatusCode:"1100.70.06.70"},{StatusCode:"1300"},{StatusCode:"1400"}]}};return e}else if(t==="SHP"){e={StatusList:{Status:[{StatusCode:"1100.70.06.10"},{StatusCode:"1100.70.06.20"},{StatusCode:"1100.70.06.50"},{StatusCode:"1100.70.06.70"},{StatusCode:"1300"},{StatusCode:"1400"}]}};return e}else if(t==="PICK"){e={StatusList:{Status:[{StatusCode:"1100.70.06.10"},{StatusCode:"1100.70.06.20"},{StatusCode:"1100.70.06.30"},{StatusCode:"1400"}]}};return e}},uiInvokeNextAction:function(t,e){if(e==="TASK_CustomerPickup")this.startCustomerPickup(t.ShipmentKey)},startCustomerPickup:function(t){h.goToState("customerpickup",{ShipmentKey:t},{})},uiOpenShipmentSummary:function(t,e){h.goToState("shipmentsummary",{ShipmentKey:t},{})},uiShowSearch:function(){this.ui.showResults=false},_handleBackButton:function(t,e){if(this.ui.showResults){t.preventDefault();this.uiShowSearch()}},_handleBeforeStateChange:function(t,e){if(!h.currentState.options)h.currentState.options={};h.currentState.options.backOptions=angular.copy(this.ui.search)}})}]);
angular.module("store").controller("store.views.shipment.summary.shipment-summary",["$scope","$rootScope","iscScreen","iscMashup","iscResourcePermission","iscState","iscStateParams","iscPrint","iscAppContext","iscI18n","iscModal","iscShipment","iscAppInfo","iscPayment","iscPaymentinput","$timeout",function(e,t,i,s,n,a,o,h,m,r,p,u,l,d,S,c){i.initializeScreen(e,{model:{paymentSummary:{}},mashupRefs:[{mashupRefId:"getShipmentDetails",mashupId:"store.views.shipment.summary.getShipmentDetails",modelName:"shipmentModel"},{mashupRefId:"getShipmentAdditionalDetails",mashupId:"store.views.shipment.summary.getShipmentAdditionalDetails",modelName:"shipmentAdditionalDetailsModel"},{mashupRefId:"getShipmentLineList",mashupId:"store.views.shipment.summary.getShipmentLineList",modelName:"shipmentLinesModel"},{mashupRefId:"getShipmentContainerList",mashupId:"store.views.shipment.summary.getShipmentContainerList",modelName:"shipmentContainersModel"},{mashupRefId:"reprintCarrierLabel",mashupId:"store.views.shipment.containerpack.StoreLabelReprint_94"},{mashupRefId:"deleteContainerProducts",mashupId:"store.views.shipment.containerpack.deleteContainer"},{mashupRefId:"reprintPackSlip",mashupId:"store.views.shipment.containerpack.print_packSlip"},{mashupRefId:"getContainerShipmentLines",mashupId:"store.views.shipment.summary.getContainerShipmentLines"},{mashupRefId:"getPaymentTypeList",mashupId:"store.views.shipment.summary.getPaymentTypeList",modelName:"getPaymentTypeList"},{mashupRefId:"getPaymentCardTypeList",mashupId:"store.views.shipment.summary.PaymentCardTypeConfLevel",modelName:"getPaymentCardTypeList"},{mashupRefId:"getShipmentPaymentDetails",mashupId:"store.views.shipment.summary.getShipmentPaymentDetails",modelName:"getShipmentPaymentDetails"}],ui:{shipmentKey:"",StatusBundleKey:"",showBackRoomPickButton:false,showPackButton:false,showCustomerPickButton:false,showHoldLocation:false,slaImageFullURL:"",showProductAccordion:true,currentAccordianTabOpen:"PRODUCT",closeAllAccordianTabs:true,showAnotherStoreWarningMessage:false,showOrderSLA:false,isPickupShipment:false,pageSize:10,shipmentLinesShownCount:20,packagesShownCount:20,flowName:"",detailedShipmentInfoShown:false,shipmentPreviewTemplate:"store/views/shipment/summary/shipment-summary-popover-preview.tpl.html",showSuccessMessagePanel:false,successPanelMessage:"",isShipmentCancelled:false,isShipmentShipped:false,isInProgressStatus:false,isInReadyForPickingStatus:false,isShipmentPacked:false,showPackageContent:true},initialize:function(){var e=o.params.input.Shipment.ShipmentKey;this.ui.shipmentKey=e;this.callInitMashups(this.ui.shipmentKey)},callInitMashups:function(e){var t={};t.Shipment={};t.Shipment.ShipmentKey=e;var i={};i.Shipment={};i.Shipment.ShipmentKey=e;i.Shipment.isTrackingURLRequired="Yes";var n=[];n.push(s.getMashupRefObj(this,"getShipmentDetails",t));n.push(s.getMashupRefObj(this,"getShipmentAdditionalDetails",t));n.push(s.getMashupRefObj(this,"getShipmentLineList",t));n.push(s.getMashupRefObj(this,"getShipmentContainerList",i));s.callMashups(this,n,{}).then(this.handleInitMashupOutput.bind(this))},handleInitMashupOutput:function(e){if(!iscCore.isVoid(this.model.shipmentModel.Shipment.Status)&&!iscCore.isVoid(this.model.shipmentModel.Shipment.Status.Status)){var t=this.model.shipmentModel.Shipment.Status.Status;this.model.shipmentModel.Shipment.Status.StatusBundleKey=t.replace(/\./g,"_");if(t.indexOf("1400")==0){this.model.shipmentModel.Shipment.Status.StatusBundleKey=this.model.shipmentModel.Shipment.Status.StatusBundleKey+"_"+this.model.shipmentModel.Shipment.DeliveryMethod;this.ui.isShipmentShipped=true}if(t.indexOf("9000")==0){this.ui.isShipmentCancelled=true}if(t.indexOf("1100.70.06.20")==0||t.indexOf("1100.70.06.70")==0){this.ui.isInProgressStatus=true}if(t.indexOf("1100.70.06.10")==0){this.ui.isInReadyForPickingStatus=true}if(t.indexOf("1300")==0){this.ui.isShipmentPacked=true}if(r.hasKey("shipmentsummary.LABEL_"+this.model.shipmentModel.Shipment.Status.StatusBundleKey)){this.model.shipmentModel.Shipment.Status.StatusDisplay=r.translate("shipmentsummary.LABEL_"+this.model.shipmentModel.Shipment.Status.StatusBundleKey)}else{this.model.shipmentModel.Shipment.Status.StatusDisplay=this.model.shipmentModel.Shipment.Status.Description}}this.ui.showPackageContent=true;this.showDifferentStoreWarningMessage();this.showHoldLocationOrNot();u.generateProductImageURL(this.model.shipmentLinesModel);this.formatProductQuantity();this.setSLAImageURL();if(this.model.shipmentModel.Shipment.DeliveryMethod=="PICK")this.ui.isPickupShipment=true;var i={};i.Shipment={};i.Shipment.ShipmentKey=this.model.shipmentModel.Shipment.ShipmentKey;var n=[];n.push(s.getMashupRefObj(this,"getShipmentPaymentDetails",i));n.push(s.getMashupRefObj(this,"getPaymentTypeList",S.getPaymentTypeListInputForShipment(this.model.shipmentModel)));n.push(s.getMashupRefObj(this,"getPaymentCardTypeList",S.getPaymentCardTypeListInputForShipment(this.model.shipmentModel)));s.callMashups(this,n,{}).then(function(e){this.setPaymentDetails(e)}.bind(this),angular.noop)},setPaymentDetails:function(e){var t=s.getMashupOutput(e,"getShipmentPaymentDetails");var i=d.prepareShipmentPaymentData(t,this.model.getPaymentTypeList.PaymentTypeList,this.model.getPaymentCardTypeList.PaymentCardTypeList);this.model.paymentSummary.paymentDetails=i.paymentDetails;this.model.paymentSummary.paymentMethodsAvailable=i.paymentMethodsAvailable},setSLAImageURL:function(){var e=this.model.shipmentModel.Shipment.ImageUrl;if(e){this.ui.slaImageFullURL=window.location.protocol+"//"+window.location.host+l.getApplicationContext()+"/"+e}var t=this.model.shipmentModel.Shipment.Status.Status?this.model.shipmentModel.Shipment.Status.Status:this.model.shipmentModel.Shipment.Status;this.ui.showOrderSLA=u.isStatusPresentInList_showSLA(t)},showHoldLocationOrNot:function(){var e=this.model.shipmentModel.Shipment.Status.Status?this.model.shipmentModel.Shipment.Status.Status:this.model.shipmentModel.Shipment.Status;var t=this.model.shipmentModel.Shipment.HoldLocation;if(!iscCore.isVoid(t)&&u.isStatusPresentInList_holdLocation(e)){this.ui.showHoldLocation=true}},showDifferentStoreWarningMessage:function(){var e=m.getFromContext("storeName");var t=this.model.shipmentModel.Shipment.ShipNode.ShipNode;if(e!=t){this.ui.showAnotherStoreWarningMessage=true}},formatProductQuantity:function(){var e=this.model.shipmentModel;var t=this.model.shipmentLinesModel;var i="1100.70.06.70";var n="1300";var s="1400";var a="1100.70.06.20";var o="1100.70.06.50";var h="1100.70.06.30";for(var m=0;m<t.ShipmentLines.ShipmentLine.length;m++){var r=t.ShipmentLines.ShipmentLine[m];r.showPackedQuantity=r.showPickedQuantity=false;var p=e.Shipment.Status.Status;if(r.ShortageQty&&r.ShortageQty>0){r.showShortedQuantity=true}if(p.match(i)||p.match(n)){if(r.PlacedQuantity&&r.PlacedQuantity>0){r.showPackedQuantity=true}}else if(p.match(s)){r.showShortedQuantity=false;r.isShippedStatus=true}else if(p.match(a)||p.match(o)||p.match(h)){if(r.BackroomPickedQuantity&&r.BackroomPickedQuantity>0){r.showPickedQuantity=true}}}},uiOpenTrackingURL:function(e){var t="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight;var i="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth;var n="width="+i+", height="+t;var s=n+",status=yes,toolbar=no,menubar=no,location=no,resizable=yes,scrollbars=yes";var a=window.open(e,"Product_name",s);a.focus()},uiGoToBackroomPickFlow:function(){a.goToState("backroomPickWizard",{input:{Shipment:{ShipmentKey:this.ui.shipmentKey}}},{})},uiOpenProductDetail:function(e){u.openProductDetail(e)},uiGetContainerShipmentLines:function(t){var e={ShipmentLine:{ShipmentContainerKey:t.ShipmentContainerKey,ShipmentKey:t.ShipmentKey,ContainerDetails:{ContainerDetail:{Container:{ShipmentContainerKey:t.ShipmentContainerKey,ShipmentKey:t.ShipmentKey}}}}};s.callMashup(this,"getContainerShipmentLines",e,{}).then(function(e){t.shipmentContainerLineDetails=s.getMashupOutput(e,"getContainerShipmentLines")}.bind(this),angular.noop)},uiIsReprintCarrierLabelDisabled:function(e){var t=iscCore.isVoid(e.TrackingNo);if(t){e.isReprintCarrierLabelDisabled=true;return true}else{e.isReprintCarrierLabelDisabled=false;return false}},uiIsUnpackDisabled:function(e){var t=m.getFromContext("storeName");var i=this.model.shipmentModel.Shipment.ShipNode.ShipNode;var n=this.model.shipmentModel.Shipment.Status.Status?this.model.shipmentModel.Shipment.Status.Status:this.model.shipmentModel.Shipment.Status;if(t==i&&e.IsManifested!="Y"&&!n.match("1400")){e.isUnpackDisabled=false;return false}else{e.isUnpackDisabled=true;return true}},uiIsRePrintPackSlipDisabled:function(e){var t=m.getFromContext("storeName");var i=this.model.shipmentModel.Shipment.ShipNode.ShipNode;var n=this.model.shipmentModel.Shipment.Status.Status?this.model.shipmentModel.Shipment.Status.Status:this.model.shipmentModel.Shipment.Status;if(t==i&&n.match("1300")){e.isReprintPackSlipDisabled=false;return false}else{e.isReprintPackSlipDisabled=true;return true}},uiReprintContainerLabel:function(t){if(t.isReprintCarrierLabelDisabled){return}else{if(!iscCore.isVoid(t.TrackingNo)){var e={Container:{ShipmentContainerKey:t.ShipmentContainerKey,ShipmentKey:t.ShipmentKey}};s.callMashup(this,"reprintCarrierLabel",e,{}).then(function(e){this.handleReprintLabel(e,t)}.bind(this))}}},handleReprintLabel:function(e,t){var i=s.getMashupOutput(e,"reprintCarrierLabel");if(!iscCore.isVoid(i.Output.out)){u.decodeShippingLabelURL(i);c(function(){h.printHtmlOutput(i)},0)}else{p.showErrorMessage("shipmentsummary.MSG_PrintFailure")}},uiUnpackContainerProducts:function(i){if(i.isUnpackDisabled){return}else{var n=this;p.openModal("store.views.shipment.containerunpack.container-unpack-reason",{},{}).then(function(e){if(!iscCore.isVoid(e.data)&&e.data==="APPLY"&&!iscCore.isVoid(e.reasonCode)){var t={};t.Shipment={};t.Shipment.ShipmentKey=i.ShipmentKey;t.Shipment.Containers={};t.Shipment.Containers.Container={};t.Shipment.Containers.Container.ShipmentContainerKey=i.ShipmentContainerKey;s.callMashup(n,"deleteContainerProducts",t,{}).then(function(e){n.handleDeleteContainerProducts(e,i.ContainerNo)}.bind(n),angular.noop)}}.bind(this))}},handleDeleteContainerProducts:function(e,t){this.resetSummaryScreen(t)},resetSummaryScreen:function(e){this.ui.shipmentLinesShownCount=20;this.ui.packagesShownCount=20;this.ui.showPackageContent=false;this.ui.isShipmentPacked=false;this.callInitMashups(this.ui.shipmentKey);var t=e;this.ui.successPanelMessage=r.translate("containerunpack.MSG_ContainerDeletedSuccessfully",{containerNumber:t});this.ui.showSuccessMessagePanel=true},uiReprintPackSlip:function(e){if(e.isReprintPackSlipDisabled){return}else{var t={Shipment:{ShipmentKey:this.model.shipmentModel.Shipment.ShipmentKey,ShipmentContainerKey:e.ShipmentContainerKey}};s.callMashup(this,"reprintPackSlip",t,{}).then(function(e){var t=s.getMashupOutput(e,"reprintPackSlip");if(!iscCore.isVoid(t.Output.out)){c(function(){h.printHtmlOutput(t)},0)}else{p.showErrorMessage("shipmentsummary.MSG_PrintFailure")}},angular.noop)}},uiGetShipmentLineListNext:function(){this.ui.shipmentLinesShownCount=this.ui.shipmentLinesShownCount+this.ui.pageSize},uiShipmentLineScrollActionValidator:function(){if(this.model.shipmentLinesModel.ShipmentLines.ShipmentLine.length<=this.ui.shipmentLinesShownCount)return false;return true},uiGetContainerListNext:function(){this.ui.packagesShownCount=this.ui.packagesShownCount+this.ui.pageSize},uiContainerScrollActionValidator:function(){if(this.model.shipmentContainersModel.Containers.Container.length<=this.ui.packagesShownCount)return false;return true},uiToggleInfo:function(){this.ui.detailedShipmentInfoShown=!this.ui.detailedShipmentInfoShown},uiHandleRelatedTask:function(e){},uiGetFormattedOrderNo:function(e){return u.getDisplayOrderNumber(e,"|",", ",false)}})}]);
angular.module("store").controller("store.views.appointments.common.add-view-notes.add-view-notes",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscModal","iscI18n",function(r,e,o,s,t,a,i,n,d){s.initializeModalScreen(r,{model:{noteList:{}},mashupRefs:[{mashupRefId:"getNoteList",mashupId:"store.views.appointments.common.add-view-notes.getNoteList",modelName:"noteList"},{mashupRefId:"changeOrder",mashupId:"store.views.appointments.common.add-view-notes.changeOrder"}],ui:{},initialize:function(){var e={};e.Note={};e.Note.TableKey=t.Order.OrderHeaderKey;a.callMashup(this,"getNoteList",e,{})},uiClose:function(){o.close(this.model.noteList)},uiPostComment:function(e){var r={};r.Order={};r.Order.OrderHeaderKey=t.Order.OrderHeaderKey;r.Order.Notes=e;var o=[];o.push(a.getMashupRefObj(this,"changeOrder",r));o.push(a.getMashupRefObj(this,"getNoteList",{Note:{TableKey:t.Order.OrderHeaderKey}}));a.callMashups(this,o,{}).then(this.handleChangeOrder.bind(this),this.changeOrderAPIErrorCallBack.bind(this))},handleChangeOrder:function(e){r.$broadcast("clearNoteFields")},changeOrderAPIErrorCallBack:function(e){var r=e.Errors.Error[0].ErrorDescription;var o=e.Errors.Error[0].ErrorCode;if(d.hasKey("apierror."+o)){r=d.translate("apierror."+o);n.showErrorMessage(r,null,null)}else{n.showErrorMessage(r,null,null)}}})}]);
angular.module("store").controller("store.views.appointments.common.appointment-list.appointment-list",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscAppContext","iscTimezone","iscStateParams","iscResourcePermission","$timeout","iscWizard","iscShipment","iscAppointmentStatus","iscInStoreAppointment","$filter",function(t,e,r,i,o,p,s,a,n,d,m,u,O,l,A,h){e.initializeScreen(t,{model:{workOrderAppointmentList:{},customerDetails:{},filterOptions:{}},mashupRefs:[{mashupRefId:"getWorkOrderAppointmentList",mashupId:"store.views.appointments.common.appointment-list.getWorkOrderAppointmentList",modelName:"workOrderAppointmentList",isPaginated:true,pageSize:15,append:true,appendPath:"WorkOrderAppointments.WorkOrderAppointment"},{mashupRefId:"getWorkOrderAppointmentListWithFilters",mashupId:"store.views.appointments.common.appointment-list.getWorkOrderAppointmentListWithFilters",modelName:"workOrderAppointmentList",isPaginated:true,pageSize:15,append:true,appendPath:"WorkOrderAppointments.WorkOrderAppointment"}],ui:{selectedWorkOrderApptKey:"",apiPageSize:15,inputStatusArray:[],apiCallInProgress:false,filterOptions:{}},initialize:function(){var t=n.params;this.model.customerDetails=t.input.customerDetails;var e=angular.copy(l.getAppointmentStatusConfig());var r=e.StatusList.Status;for(var i=0;i<r.length;i++){if(r[i].StatusCode=="OPEN"){r[i].Checked="Y"}else{r[i].Checked="N"}}this.ui.filterOptions.WorkOrderAppointment={};this.ui.filterOptions.WorkOrderAppointment.StatusList=e.StatusList;this.model.filterOptions=e;var o=this.prepareGetWorkOrderListInputWithFilters();p.callMashup(this,"getWorkOrderAppointmentListWithFilters",o,{}).then(this.processPaginatedWorkOrderAppointmentList.bind(this),angular.noop)},prepareGetWorkOrderListInputWithFilters:function(){var t={};t.WorkOrderAppointment={};t.WorkOrderAppointment.WorkOrder={};t.WorkOrderAppointment.WorkOrder.Order={};t.WorkOrderAppointment.WorkOrder.Order.BillToID=this.model.customerDetails.Customer.CustomerID;var e=s.getFromContext("storeLocaleTimeZone");var r=a.getTimezoneOffset(e);if(!iscCore.isVoid(this.ui.filterOptions.WorkOrderAppointment)&&!iscCore.isVoid(this.ui.filterOptions.WorkOrderAppointment.PromisedApptStartDate)&&!iscCore.isVoid(this.ui.filterOptions.WorkOrderAppointment.PromisedApptEndDate)){t.WorkOrderAppointment.PromisedApptStartDate=this.ui.filterOptions.WorkOrderAppointment.PromisedApptStartDate+r;t.WorkOrderAppointment.PromisedApptEndDate=this.ui.filterOptions.WorkOrderAppointment.PromisedApptEndDate+r}if(!iscCore.isVoid(this.ui.filterOptions.WorkOrderAppointment.StatusList)){var i=this.ui.filterOptions.WorkOrderAppointment.StatusList.Status;this.ui.inputStatusArray=[];for(var o=0;o<i.length;o++){if(i[o].Checked=="Y"){this.ui.inputStatusArray.push(i[o].StatusCode)}}var p=iscCore.getValueFromJsonPath(t.WorkOrderAppointment,"ComplexQuery.And",true);p.Or=[];p.Or[0]={};p.Or[0].Exp=[];for(var n=0;n<this.ui.inputStatusArray.length;n++){p.Or[0].Exp[n]={Name:"ApptStatus",QryType:"FLIKE",Value:this.ui.inputStatusArray[n]}}}if(!iscCore.isVoid(this.ui.filterOptions.WorkOrderAppointment)&&!iscCore.isVoid(this.ui.filterOptions.WorkOrderAppointment.WorkOrder)&&!iscCore.isVoid(this.ui.filterOptions.WorkOrderAppointment.WorkOrder.NodeKey)){t.WorkOrderAppointment.WorkOrder.NodeKey=this.ui.filterOptions.WorkOrderAppointment.WorkOrder.NodeKey}return t},processPaginatedWorkOrderAppointmentList:function(t){this.ui.apiCallInProgress=false;var e=p.getMashupOutput(t,"getWorkOrderAppointmentList");if(iscCore.isVoid(e)){var e=p.getMashupOutput(t,"getWorkOrderAppointmentListWithFilters")}if(e.Page.Output.WorkOrderAppointments.WorkOrderAppointment){if(iscCore.isVoid(this.ui.selectedWorkOrderApptKey)){this.ui.selectedWorkOrderApptKey=e.Page.Output.WorkOrderAppointments.WorkOrderAppointment[0].WorkOrderApptKey}var r=[];r=e.Page.Output.WorkOrderAppointments.WorkOrderAppointment;for(var i=0;i<r.length;i++){var o=r[i];this.updateWorkOrderAttr(o)}}},uiWorkOrderListScrollActionValidator:function(){if(this.model.workOrderAppointmentList.Page.IsLastPage!=="N"||this.ui.apiCallInProgress){return false}else return true},uiGetNextWorkOrderRecords:function(){if(this.model.workOrderAppointmentList.Page.IsLastPage!=="N"){return}this.ui.apiCallInProgress=true;if(iscCore.isVoid(this.ui.filterOptions)){var t=angular.copy(l.getAppointmentStatusConfig());var e=t.StatusList.Status;for(var r=0;r<e.length;r++){e[r].Checked="Y"}this.model.filterOptions=t;p.callPaginatedMashup(this,"getWorkOrderAppointmentList",i,"NEXT",{}).then(this.processPaginatedWorkOrderAppointmentList.bind(this))}else{var i=this.prepareGetWorkOrderListInputWithFilters();p.callPaginatedMashup(this,"getWorkOrderAppointmentListWithFilters",i,"NEXT",{}).then(this.processPaginatedWorkOrderAppointmentList.bind(this))}},updateWorkOrderAttr:function(t){t.isToday=moment(t.PromisedApptStartDate).isSame(moment(),"day");if(t.isToday){t.appointmentToday=o.translate("appointmentsummary.LABEL_Appointment_today",{date:h("date")(t.PromisedApptStartDate,"longDate")})}var e={OPEN:"app-icon-clock_30",COMPLETE:"app-icon-success_ok_30",CANCELED:"app-icon-error_30 icon-font app_alert_icon"};t.ApptStatusIcon=e[t.ApptStatus];t.appointmentScheduledTime=moment(t.PromisedApptStartDate).fromNow()},uiClose:function(){r.goToState("/home",{},{})},uiOpenAppointmentSummary:function(t){var e={Order:{OrderHeaderKey:t.WorkOrder[0].Order.OrderHeaderKey,WorkOrderKey:t.WorkOrder[0].WorkOrderKey}};A.openAppointmentSummary(e)},uiSelectAppointment:function(t){this.ui.selectedWorkOrderApptKey=t.WorkOrderApptKey},uiCreateAppointment:function(){var t={Customer:{CustomerKey:this.model.customerDetails.Customer.CustomerKey}};A.openCreateAppointmentWizard({input:t})},uiApplyFilterOnAppointmentList:function(t){this.ui.filterOptions={};this.ui.filterOptions=t;this.model.workOrderAppointmentList={};var e=this.prepareGetWorkOrderListInputWithFilters();p.callMashup(this,"getWorkOrderAppointmentListWithFilters",e,{}).then(this.processPaginatedWorkOrderAppointmentList.bind(this),angular.noop)}})}]);
angular.module("store").controller("store.views.appointments.common.appointment-summary.appointment-summary",["$scope","$rootScope","iscScreen","iscMashup","iscResourcePermission","iscState","iscStateParams","iscAppContext","iscI18n","iscModal","iscShipment","iscAppInfo","$timeout","iscMedia","$filter",function(e,t,s,i,n,o,r,a,p,m,c,u,d,l,S){s.initializeScreen(e,{model:{appointmentDetails:{}},mashupRefs:[{mashupRefId:"getAppointmentDetails",mashupId:"store.views.appointments.common.appointment-summary.getAppointmentDetails",modelName:"appointmentDetails"}],ui:{showSuccessMessagePanel:false,successPanelMessage:"",showInfo:true,recordShownCount:l.isMediaEnabled("lte-480")?3:6,showContent:false},initialize:function(){this.ui.showContent=false;var e={Order:{OrderHeaderKey:r.params.input.Order.Order.OrderHeaderKey}};i.callMashup(this,"getAppointmentDetails",e,{}).then(function(e){this.ui.showContent=true}.bind(this),angular.noop);if(!iscCore.isVoid(r.params.message)){if(r.params.message==="CREATED_SUCCESS"){this.ui.showSuccessMessagePanel=true;this.ui.successPanelMessage=p.translate("appointmentsummary.MESSAGE_Appointment_created_success")}else if(r.params.message==="EDIT_SUCCESS"){this.ui.showSuccessMessagePanel=true;this.ui.successPanelMessage=p.translate("appointmentsummary.MESSAGE_Appointment_edit_success")}}},uiGetNextAppointmentRecords:function(){if(this.ui.recordShownCount<=this.model.appointmentDetails.Order.WorkOrders.WorkOrder.length){this.ui.recordShownCount+=l.isMediaEnabled("lte-480")?3:6}},uiFilterSystemCancelledWorkOrders:function(e){return e.Status.Status.match("1600")&&iscCore.isVoid(e.WorkOrderServiceLines.WorkOrderServiceLine)?false:true},uiUpdateWorkOrderAttr:function(e){e.isToday=moment(e.WorkOrderAppointments.WorkOrderAppointment[0].PromisedApptStartDate).isSame(moment(),"day");if(e.isToday){e.appointmentToday=p.translate("appointmentsummary.LABEL_Appointment_today",{date:S("date")(e.WorkOrderAppointments.WorkOrderAppointment[0].PromisedApptStartDate,"longDate")})}var t={OPEN:"app-icon-clock_30",COMPLETE:"app-icon-success_ok_30",CANCELED:"app-icon-error_30 icon-font app_alert_icon"};e.WorkOrderAppointments.WorkOrderAppointment[0].ApptStatusIcon=t[e.WorkOrderAppointments.WorkOrderAppointment[0].ApptStatus];e.appointmentScheduledTime=moment(e.WorkOrderAppointments.WorkOrderAppointment[0].PromisedApptStartDate).fromNow()},uiHandleRelatedTask:function(e){if(e&&(e.taskAPIOutput.markAsCompleteSuccess||e.taskAPIOutput.markAsCancelSuccess)){this.initialize()}}})}]);
angular.module("store").controller("store.views.appointments.common.cancel-appointment.cancel-appointment",["$scope","$rootScope","$uibModalInstance","iscScreen","iscWizard","modalInput","$filter","iscMashup","iscAppInfo","iscResourcePermission","iscInStoreAppointment","iscI18n","iscModal",function(e,o,n,t,i,s,a,r,l,c,d,p,m){t.initializeModalScreen(e,{model:{appointmentCancelReasonCodeList:{},workOrderList:{},salesOrderModel:{},cancelWorkOrderList:[]},mashupRefs:[{mashupRefId:"getAppointmentCancelReasons",mashupId:"store.views.appointments.common.cancel-appointment.getAppointmentCancelReasons",modelName:"appointmentCancelReasonCodeList"},{mashupRefId:"getAppointmentsForCancellation",mashupId:"store.views.appointments.common.cancel-appointment.getAppointmentsForCancellation",modelName:"workOrderList"},{mashupRefId:"cancelAppointment",mashupId:"store.views.appointments.common.cancel-appointment.cancelAppointment"}],ui:{disableCancelAction:false,isCancellationReasonConfigured:true},initialize:function(){var e=[];if(s.appointmentModel&&(s.appointmentModel.OrderHeaderKey||s.appointmentModel.WorkOrderKey)){this.model.salesOrderModel=s.appointmentModel;e.push(r.getMashupRefObj(this,"getAppointmentCancelReasons",{}));e.push(r.getMashupRefObj(this,"getAppointmentsForCancellation",d.getWorkOrderListInput(this.model.salesOrderModel.OrderHeaderKey,this.model.salesOrderModel.WorkOrderKey)));r.callMashups(this,e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)}},handleInitApiCalls:function(e){this.ui.disableCancelAction=this.model.workOrderList.WorkOrders.TotalNumberOfRecords>1&&this.model.cancelWorkOrderList.length==0;this.ui.isCancellationReasonConfigured=!(this.model.appointmentCancelReasonCodeList.CommonCodeList.TotalNumberOfRecords==0)},getCancellationDescription:function(o){var n="";angular.forEach(this.model.appointmentCancelReasonCodeList.CommonCodeList.CommonCode,function(e){if(e.CodeValue==o){n=e.CodeShortDescription}});return n},uiOnWorkOrderSelection:function(e){var o=this.model.cancelWorkOrderList.indexOf(e);console.log("uiOnWorkOrderSelection - ",e);if(e.selected&&o<0){this.model.cancelWorkOrderList.push(e)}else if(o>-1){this.model.cancelWorkOrderList.splice(o,1)}this.ui.disableCancelAction=this.model.cancelWorkOrderList.length==0?true:false},uiRemoveBlankOption:function(e){if(iscCore.isVoid(e.CancelReasonCode)&&!iscCore.isVoid(this.model.appointmentCancelReasonCodeList.CommonCodeList.CommonCode)){e.CancelReasonCode=this.model.appointmentCancelReasonCodeList.CommonCodeList.CommonCode[0].CodeValue}},uiClose:function(){n.dismiss({data:"CANCEL"})},markMultipleWorkOrdersAsCancelled:function(){var e=[];for(var o=0;o<this.model.cancelWorkOrderList.length;o++){var n=this.model.cancelWorkOrderList[o];n.CancelReasonDescription=this.getCancellationDescription(n.CancelReasonCode);e.push(r.getMashupRefObj(this,"cancelAppointment",d.getCancelWorkOrderInput(n)))}r.callMashups(this,e,{isMultiAPICall:false}).then(this.afterWorkOrderCancellation.bind(this),angular.noop)},markWorkOrderAsCancelled:function(){var e=[];var o=this.model.workOrderList.WorkOrders.WorkOrder[0];o.CancelReasonDescription=this.getCancellationDescription(o.CancelReasonCode);e.push(r.getMashupRefObj(this,"cancelAppointment",d.getCancelWorkOrderInput(o)));r.callMashups(this,e,{}).then(this.afterWorkOrderCancellation.bind(this),angular.noop)},afterWorkOrderCancellation:function(e){var o={};o={data:{markAsCancelSuccess:true}};n.close(o)},uiSubmit:function(){if(this.model.workOrderList.WorkOrders.TotalNumberOfRecords>1&&this.model.cancelWorkOrderList.length>0){this.markMultipleWorkOrdersAsCancelled()}else if(this.model.workOrderList.WorkOrders.TotalNumberOfRecords==1){this.markWorkOrderAsCancelled()}}})}]);
angular.module("store").controller("store.views.appointments.common.mark-as-complete-appointment.mark-as-complete-appointment",["$scope","$rootScope","$uibModalInstance","iscScreen","iscWizard","modalInput","$filter","iscMashup","iscAppInfo","iscResourcePermission","iscInStoreAppointment","iscI18n","iscModal",function(e,t,r,o,s,i,m,p,l,a,n,d,k){o.initializeModalScreen(e,{model:{salesOrderModel:{},workOrderList:{},markAsCompleteWorkOrderList:[]},mashupRefs:[{mashupRefId:"getAppointmentsForMarkComplete",mashupId:"store.views.appointments.common.mark-as-complete-appointment.getAppointmentsForMarkComplete",modelName:"workOrderList"},{mashupRefId:"markAppointmentAsComplete",mashupId:"store.views.appointments.common.mark-as-complete-appointment.markAppointmentAsComplete"},{mashupRefId:"addNoteForAppointmentComplete",mashupId:"store.views.appointments.common.mark-as-complete-appointment.addNoteForAppointmentComplete"}],ui:{disableMarkAsComplete:false},initialize:function(){console.log(i);var e=[];if(i.appointmentModel&&i.appointmentModel.OrderHeaderKey){this.model.salesOrderModel=i.appointmentModel;e.push(p.getMashupRefObj(this,"getAppointmentsForMarkComplete",n.getWorkOrderListInput(this.model.salesOrderModel.OrderHeaderKey)));p.callMashups(this,e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)}},handleInitApiCalls:function(e){var t=p.getMashupOutput(e,"getAppointmentsForMarkComplete");this.model.workOrderList=t;if(this.model.workOrderList.WorkOrders.TotalNumberOfRecords>1&&this.model.markAsCompleteWorkOrderList.length==0){this.ui.disableMarkAsComplete=true}},uiOnWorkOrderSelection:function(e){var t=this.model.markAsCompleteWorkOrderList.indexOf(e);if(e.selected&&t<0){this.model.markAsCompleteWorkOrderList.push(e)}else if(t>-1){this.model.markAsCompleteWorkOrderList.splice(t,1)}this.ui.disableMarkAsComplete=this.model.markAsCompleteWorkOrderList.length==0?true:false},uiClose:function(){r.dismiss({data:"CANCEL"})},markMultipleWorkOrdersAsCompleted:function(){var e=[];for(var t=0;t<this.model.markAsCompleteWorkOrderList.length;t++){var r=this.model.markAsCompleteWorkOrderList[t];e.push(p.getMashupRefObj(this,"markAppointmentAsComplete",n.getConfirmWorkOrderInput(r)))}if(this.model.markAsCompleteWorkOrderList.length>0){e.push(p.getMashupRefObj(this,"addNoteForAppointmentComplete",n.getAddNotesInputForMultiAppointmentComplete(this.model.markAsCompleteWorkOrderList)))}p.callMashups(this,e,{}).then(this.afterWorkOrderCompletion.bind(this),angular.noop)},markWorkOrderAsCompleted:function(){var e=[];var t=this.model.workOrderList.WorkOrders.WorkOrder[0];e.push(p.getMashupRefObj(this,"addNoteForAppointmentComplete",n.getAddNotesInputForAppointmentComplete(t)));e.push(p.getMashupRefObj(this,"markAppointmentAsComplete",n.getConfirmWorkOrderInput(t)));p.callMashups(this,e,{}).then(this.afterWorkOrderCompletion.bind(this),angular.noop)},afterWorkOrderCompletion:function(e){var t={};t={data:{markAsCompleteSuccess:true}};r.close(t)},uiDisableMarkAsComplete:function(){if(this.model.workOrderList.WorkOrders.TotalNumberOfRecords>1){return this.model.markAsCompleteWorkOrderList.length==0?true:false}else if(this.model.workOrderList.WorkOrders.TotalNumberOfRecords==1){return false}},uiSubmit:function(e){console.log(this.model.markAsCompleteWorkOrderList);if(this.model.workOrderList.WorkOrders.TotalNumberOfRecords>1&&this.model.markAsCompleteWorkOrderList.length>0){this.markMultipleWorkOrdersAsCompleted()}else if(this.model.workOrderList.WorkOrders.TotalNumberOfRecords==1){this.markWorkOrderAsCompleted()}}})}]);
angular.module("store").controller("store.views.appointments.common.service-description.service-description",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput",function(i,e,o,n,s){n.initializeModalScreen(i,{ui:{serviceDetails:{}},initialize:function(){this.ui.serviceDetails=s},uiClose:function(){o.dismiss()},uiAddService:function(){o.close("ADD")}})}]);
angular.module("store").controller("store.views.appointments.common.share-appointment.share-appointment",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscI18n","$timeout","iscDomUtility","iscPrint",function(e,i,n,t,a,r,o,m,s,l,p){t.initializeModalScreen(e,{mashupRefs:[{mashupRefId:"sendAppointmentAsEmail",mashupId:"store.views.appointments.common.share-appointment.sendAppointmentAsEmail"},{mashupRefId:"printAppointmentSummary",mashupId:"store.views.appointments.common.share-appointment.printAppointmentSummary"}],ui:{showEmailError:false,emailSent:false,emailForm:{},emailid:""},initialize:function(){if(a.appointmentModel.CustomerEMailID){this.ui.emailid=a.appointmentModel.CustomerEMailID}s(function(){l.setFocus(document.getElementById("shareappointment_emailId"))},0)},uiSendEmail:function(){var i=this;s(function(){i.ui.emailForm.$setDirty();if(iscCore.isVoid(i.ui.emailid)||!i.ui.emailForm.$valid){i.ui.showEmailError=true;document.getElementById("shareappointment_emailId").focus()}else if(i.ui.emailForm.$valid){var e={};e.Order={};e.Order.OrderHeaderKey=a.appointmentModel.OrderHeaderKey;e.Order.Currency=a.appointmentModel.PriceInfo.Currency;e.Order.OrganizationCode=a.appointmentModel.EnterpriseCode;e.Order.ToEmailID=this.ui.emailid;r.callMashup(i,"sendAppointmentAsEmail",e,{}).then(i.emailCallBackHandler.bind(i),angular.noop)}}.bind(this),200)},uiResetEmailFlags:function(){var e=document.getElementById("shareappointment_emailId").value;if(!iscCore.isVoid(e)){this.ui.emailSent=false;this.ui.showEmailError=false}},emailCallBackHandler:function(e){var i=r.getMashupOutput(e,"sendAppointmentAsEmail");if(i){this.ui.emailSent=true}},uiPrintSummary:function(){var e={};e.Order={};e.Order.OrderHeaderKey=a.appointmentModel.OrderHeaderKey;e.Order.Currency=a.appointmentModel.PriceInfo.Currency;e.Order.OrganizationCode=a.appointmentModel.EnterpriseCode;r.callMashup(this,"printAppointmentSummary",e,{}).then(this.printCallBackHandler.bind(this),angular.noop)},printCallBackHandler:function(e){var i=r.getMashupOutput(e,"printAppointmentSummary");p.printHtmlOutput(i)},uiClose:function(){n.dismiss("cancel")}})}]);
angular.module("store").controller("store.views.appointments.in-store.change-store.change-store",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscAppContext","$filter","iscI18n","$timeout",function(e,i,t,s,r,o,a,u,n,h,l){s.initializeModalScreen(e,{model:{serviceSkillList:{},nearbyStoreList:{},defaultRadiusValue:{},maxRadiusValue:{},distanceUOM:{},searchStoreList:{},FulfillmentType:{}},mashupRefs:[{mashupRefId:"getCurrentStoreDetails",mashupId:"store.views.appointments.in-store.change-store.getCurrentStoreDetails"},{mashupRefId:"getServiceAvailabilityAndBusinessHours",mashupId:"store.views.appointments.in-store.change-store.getServiceAvailabilityAndBusinessHours"},{mashupRefId:"getSkillsForServiceItem",mashupId:"store.views.appointments.in-store.change-store.getSkillsForServiceItem"},{mashupRefId:"getFulfillmentTypeForStore",mashupId:"store.views.appointments.in-store.change-store.getRuleDetails",modelName:"FulfillmentType"},{mashupRefId:"getDefaultRadiusValue",mashupId:"store.views.appointments.in-store.change-store.getRuleDetails",modelName:"defaultRadiusValue"},{mashupRefId:"getMaxRadiusValue",mashupId:"store.views.appointments.in-store.change-store.getRuleDetails",modelName:"maxRadiusValue"},{mashupRefId:"getDistanceUOM",mashupId:"store.views.appointments.in-store.change-store.getDistanceUOM",modelName:"distanceUOM"},{mashupRefId:"getSurroundingNodeListForStore",mashupId:"store.views.appointments.in-store.change-store.getSurroundingNodeListForStore",modelName:"nearbyStoreList"},{mashupRefId:"getSearchSurroundingNodeListForStore",mashupId:"store.views.appointments.in-store.change-store.getSurroundingNodeListForStore",modelName:"searchStoreList"}],ui:{currentShipNode:u.getFromContext("storeName"),currentStore:{},currentStoreAddress:u.getFromContext("storeAddress").ShipNodePersonInfo,existingSelectedShipNode:r.inputData.ShipNode?r.inputData.ShipNode:u.getFromContext("storeName"),currentSelectedStore:{},currentStoreSurroundingNodeList:null,selectedStore:"",searchedStore:"",nearStore:"",nearbyView:"true",searchStore:null,searchView:"false",noOfStoresFound:"",noOfStoresSearched:"",nearRadius:"",maxNearRadius:"",oldNearRadius:"",nearWach:"",searchRadius:"",maxSearchRadius:"",oldSearchRadius:"",distanceUOM:"",distanceUOMDesc:"",searchWach:"",nearApiExecComplete:"true",searchApiExecComplete:"true",personInfo:{},noNearStoreFound:"",noStoreFound:"",errorText:"",nearErrorText:"",searchButtonClick:"false",nearHighlightedStore:{},searchHighlightedStore:{},currentHighlightedStore:{},oPageSize:15,oTotalNearStores:15,oTotalSearchStores:15,oNearApiCallInProgress:false,oSearchApiCallInProgress:false},initialize:function(){var e=[];e.push(o.getMashupRefObj(this,"getFulfillmentTypeForStore",{Rules:{RuleSetFieldName:"WSC_STORE_PS_SEARCH"}}));e.push(o.getMashupRefObj(this,"getDefaultRadiusValue",{Rules:{RuleSetFieldName:"WSC_STORE_DISTANCE_TO_CONSIDER"}}));e.push(o.getMashupRefObj(this,"getMaxRadiusValue",{Rules:{RuleSetFieldName:"WSC_MAX_STORE_DISTANCE_TO_CONSIDER"}}));e.push(o.getMashupRefObj(this,"getDistanceUOM",{Rules:{RuleSetFieldName:"WSC_STORE_DISTANCE_UOM_TO_CONSIDER"}}));e.push(o.getMashupRefObj(this,"getSkillsForServiceItem",{Item:r.inputData.Item}));o.callMashups(this,e,{}).then(this.onSuccessInitApis.bind(this),angular.noop)},onSuccessInitApis:function(e){this.onSuccessGetMaxRadiusValue(e);this.onSuccessDistanceUOM(e);this.onSuccessGetDefaultRadiusValue(e);this.onSuccessGetSkillsForServiceItem(e);this.startWatchOnRadius()},startWatchOnRadius:function(){var t=this;this.ui.nearWach=e.$watch(function(e){return e.ui.nearRadius},function(e,i){t.onNearRadiusChange(e,i)});this.ui.searchWach=e.$watch(function(e){return e.ui.searchRadius},function(e,i){t.onSearchRadiusChange(e,i)})},onSuccessGetMaxRadiusValue:function(){this.ui.maxNearRadius=this.model.maxRadiusValue.Rules.RuleSetValue;this.ui.maxSearchRadius=this.model.maxRadiusValue.Rules.RuleSetValue},onSuccessDistanceUOM:function(){this.ui.distanceUOM=this.model.distanceUOM.Rules.RuleSetValue;this.ui.distanceUOMDesc=this.model.distanceUOM.Rules.DistanceUOMDesc},onSuccessGetDefaultRadiusValue:function(){this.ui.nearRadius=this.model.defaultRadiusValue.Rules.RuleSetValue;this.ui.searchRadius=this.model.defaultRadiusValue.Rules.RuleSetValue},handleGetDefaultRadiusValueError:function(){if(this.ui.nearWach)this.ui.nearWach();if(this.ui.searchWach)this.ui.searchWach();this.ui.nearRadius="25";this.ui.searchRadius="25";this.ui.errorText=h.translate("changestore.Store_ErrMsg")},onSuccessGetSkillsForServiceItem:function(e){this.model.serviceSkillList.ServiceSkill=[];var i=o.getMashupOutput(e,"getSkillsForServiceItem");if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.ItemList)&&!iscCore.isVoid(i.ItemList.Item)){var t=i.ItemList.Item[0];if(t.ItemServiceSkillList&&t.ItemServiceSkillList.ItemServiceSkill)for(var s=0;s<t.ItemServiceSkillList.ItemServiceSkill.length;s++){this.model.serviceSkillList.ServiceSkill.push({ServiceSkillId:t.ItemServiceSkillList.ItemServiceSkill[s].ServiceSkillId})}}this.fetchCurrentNodeDetails();this.fetchNearbySurroundingNodeList(this.ui.nearRadius)},fetchCurrentNodeDetails:function(){o.callMashup(this,"getCurrentStoreDetails",this.getOrgNodeDetailsInput(this.ui.currentShipNode),{}).then(this.initializeCurrentAndExistingSelectedStore.bind(this),angular.noop)},getOrgNodeDetailsInput:function(e){var i={Organization:{OrganizationCode:e}};i.Organization.ServiceSkills=this.model.serviceSkillList;if(r.inputData.BusinessDay)i.Organization.BusinessDay=r.inputData.BusinessDay;return i},initializeCurrentAndExistingSelectedStore:function(e){var i=o.getMashupOutput(e,"getCurrentStoreDetails");this.ui.currentStore=i.Organization.Node;this.ui.currentStoreSurroundingNodeList={GetSurroundingNodeList:{NodeList:{Node:[this.ui.currentStore]}}};if(this.ui.currentShipNode===this.ui.existingSelectedShipNode)this.ui.currentSelectedStore=i.Organization.Node},fetchNearbySurroundingNodeList:function(e){if(iscCore.isVoid(this.ui.currentStoreAddress.Country)){this.ui.nearErrorText=h.translate("changestore.Store_ErrMsg")}else{this.ui.nearErrorText="";this.ui.nearApiExecComplete="false";o.callMashup(this,"getSurroundingNodeListForStore",this.getNearbyStoreInput(e),{}).then(this.handleNearbyStoreAvailability.bind(this),angular.noop)}},getNearbyStoreInput:function(e){nearByStoreInput={GetSurroundingNodeList:{InitialPageSize:this.ui.oPageSize}};if(r.inputData.BusinessDay)nearByStoreInput.GetSurroundingNodeList.BusinessDay=r.inputData.BusinessDay;nearByStoreInput.GetSurroundingNodeList.ServiceSkills=this.model.serviceSkillList;nearByStoreInput.GetSurroundingNodeList.FulfillmentType=this.model.FulfillmentType.Rules.RuleSetValue;nearByStoreInput.GetSurroundingNodeList.DistanceToConsider=e;nearByStoreInput.GetSurroundingNodeList.DistanceToConsiderUOM=this.ui.distanceUOM;nearByStoreInput.GetSurroundingNodeList.ShipToAddress=this.ui.currentStoreAddress;return nearByStoreInput},handleNearbyStoreAvailability:function(e){var i=this.model.nearbyStoreList;var t=iscCore.isVoid(i)||iscCore.isVoid(i.GetSurroundingNodeList.NodeList)||!i.GetSurroundingNodeList.NodeList.Node||!i.GetSurroundingNodeList.NodeList.Node.length?0:parseInt(i.GetSurroundingNodeList.NodeList.Node.length);var s=0;for(var r=0;r<t;r++){var o=i.GetSurroundingNodeList.NodeList.Node[r];if(o.ServiceAvailable!="N")s++;o.distanceUOMDesc=this.ui.distanceUOMDesc;if(t<=this.ui.oPageSize&&o.ServiceAvailable=="N"){o.displayStore="N"}else{o.displayStore="Y"}if(iscCore.isVoid(this.ui.currentSelectedStore)&&o.ShipNode===this.ui.existingSelectedShipNode){this.ui.nearStore=o}}var a=t<=this.ui.oPageSize?s:t;if(!a||a<1){this.ui.noOfStoresFound="";this.ui.noNearStoreFound=h.translate("changestore.Store_ErrMsg")}else{this.ui.noNearStoreFound="";this.ui.noOfStoresFound=a}if(!iscCore.isVoid(this.ui.currentSelectedStore)){this.ui.nearStore=""}this.ui.nearApiExecComplete="true";this.ui.oldNearRadius=""},onNearRadiusChange:function(e,i){if(!iscCore.isVoid(this.ui.oldNearRadius)){i=this.ui.oldNearRadius}if(!(e==i)){if(this.ui.nearApiExecComplete=="true"){this.ui.oldNearRadius=i;this.ui.nearStore="";this.model.nearbyStoreList={};this.ui.oTotalNearStores=this.ui.oPageSize;this.ui.oNearApiCallInProgress=false;this.fetchNearbySurroundingNodeList(e)}}},uiNearNextPageCall:function(){this.ui.oNearApiCallInProgress=true;var e=[];var i=this.ui.oTotalNearStores;var t=this.ui.oTotalNearStores+this.ui.oPageSize<this.model.nearbyStoreList.GetSurroundingNodeList.NodeList.Node.length?this.ui.oTotalNearStores+this.ui.oPageSize:this.model.nearbyStoreList.GetSurroundingNodeList.NodeList.Node.length;for(var s=i;s<t;s++){var r=this.model.nearbyStoreList.GetSurroundingNodeList.NodeList.Node[s];e.push(o.getMashupRefObj(this,"getServiceAvailabilityAndBusinessHours",this.getServiceAvlbInput(r)))}o.callMashups(this,e,{}).then(this.onSuccessNearNextPageCall.bind(this),angular.noop)},onSuccessNearNextPageCall:function(e){this.massageNextPageOutput(this.model.nearbyStoreList,e);this.ui.oNearApiCallInProgress=false;this.ui.oTotalNearStores=this.ui.oTotalNearStores+this.ui.oPageSize},uiOpenSearchTab:function(){this.ui.nearbyView="false";if(iscCore.isVoid(this.ui.searchStore))this.ui.searchStore="true"},uiBacktoSearch:function(){this.ui.searchStore="true";this.ui.nearbyView="false";this.ui.searchView="false";this.ui.noStoreFound="";this.ui.searchedStore="";this.ui.errorText="";this.ui.oTotalSearchStores=this.ui.oPageSize;this.ui.oSearchApiCallInProgress=false},uiSearchStore:function(){this.ui.searchButtonClick="true";if(iscCore.isVoid(this.ui.personInfo.ZipCode)&&(iscCore.isVoid(this.ui.personInfo.City)||iscCore.isVoid(this.ui.personInfo.State))){this.ui.errorText=h.translate("changestore.Address_ErrMsg");this.model.searchStoreList={}}else{this.ui.errorText="";this.ui.searchedStore="";this.model.searchStoreList={};this.ui.oTotalSearchStores=this.ui.oPageSize;this.ui.oSearchApiCallInProgress=false;this.fetchSearchSurroundingNodeList(this.ui.searchRadius)}},fetchSearchSurroundingNodeList:function(e){this.ui.searchApiExecComplete="false";o.callMashup(this,"getSearchSurroundingNodeListForStore",this.getSearchStoreInput(e),{}).then(this.handleSearchStoreAvailability.bind(this),angular.noop)},getSearchStoreInput:function(e){searchStoreInput={GetSurroundingNodeList:{InitialPageSize:this.ui.oPageSize}};searchStoreInput.GetSurroundingNodeList.ServiceSkills=this.model.serviceSkillList;if(r.inputData.BusinessDay)searchStoreInput.GetSurroundingNodeList.BusinessDay=r.inputData.BusinessDay;searchStoreInput.GetSurroundingNodeList.FulfillmentType=this.model.FulfillmentType.Rules.RuleSetValue;searchStoreInput.GetSurroundingNodeList.DistanceToConsider=e;searchStoreInput.GetSurroundingNodeList.DistanceToConsiderUOM=this.ui.distanceUOM;var i=this.ui.personInfo.State?this.ui.personInfo.State.RegionName:"";searchStoreInput.GetSurroundingNodeList.ShipToAddress={Country:this.ui.personInfo.Country,City:this.ui.personInfo.City,State:i,ZipCode:this.ui.personInfo.ZipCode};return searchStoreInput},handleSearchStoreAvailability:function(){var e=this.model.searchStoreList;var i=iscCore.isVoid(e)||iscCore.isVoid(e.GetSurroundingNodeList.NodeList)||!e.GetSurroundingNodeList.NodeList.Node||!e.GetSurroundingNodeList.NodeList.Node.length?0:parseInt(e.GetSurroundingNodeList.NodeList.Node.length);var t=0;for(var s=0;s<i;s++){var r=e.GetSurroundingNodeList.NodeList.Node[s];r.distanceUOMDesc=this.ui.distanceUOMDesc;if(r.ServiceAvailable!="N")t++;if(i<=this.ui.oPageSize&&r.ServiceAvailable=="N"){r.displayStore="N"}else{r.displayStore="Y"}if(iscCore.isVoid(this.ui.currentSelectedStore)&&r.ShipNode===this.ui.existingSelectedShipNode){this.ui.searchedStore=r}}var o=i<=this.ui.oPageSize?t:i;if(!o||o<1){if(this.ui.searchButtonClick=="true"){this.ui.errorText=""}else{this.ui.searchButtonClick="false"}this.ui.noStoreFound=h.translate("changestore.Store_ErrMsg");this.ui.noOfStoresSearched=""}else{this.ui.errorText="";this.ui.noStoreFound="";this.ui.searchButtonClick="false";this.ui.searchView="true";this.ui.searchStore="false";this.ui.noOfStoresSearched=o}if(!iscCore.isVoid(this.ui.currentSelectedStore)){this.ui.searchedStore=""}this.ui.searchApiExecComplete="true";this.ui.oldSearchRadius=""},onSearchRadiusChange:function(e,i){if(!iscCore.isVoid(this.ui.oldSearchRadius)){i=this.ui.oldSearchRadius}if(!(e==i)){if(this.ui.searchView=="false"||this.ui.nearbyView=="true"){return}else if(this.ui.searchApiExecComplete=="false"){this.ui.searchRadius=i}else if(this.ui.searchApiExecComplete=="true"){this.ui.oldSearchRadius=i;this.ui.errorText="";this.ui.searchedStore="";this.model.searchStoreList={};this.ui.oTotalSearchStores=this.ui.oPageSize;this.ui.oSearchApiCallInProgress=false;this.fetchSearchSurroundingNodeList(e);this.ui.searchApiExecComplete="false"}}},uiSearchNextPageCall:function(){this.ui.oSearchApiCallInProgress=true;var e=[];var i=this.ui.oTotalSearchStores;var t=this.ui.oTotalSearchStores+this.ui.oPageSize<this.model.searchStoreList.GetSurroundingNodeList.NodeList.Node.length?this.ui.oTotalSearchStores+this.ui.oPageSize:this.model.searchStoreList.GetSurroundingNodeList.NodeList.Node.length;for(var s=i;s<t;s++){var r=this.model.searchStoreList.GetSurroundingNodeList.NodeList.Node[s];e.push(o.getMashupRefObj(this,"getServiceAvailabilityAndBusinessHours",this.getServiceAvlbInput(r)))}o.callMashups(this,e,{}).then(this.onSuccessSearchNextPageCall.bind(this),angular.noop)},onSuccessSearchNextPageCall:function(e){this.massageNextPageOutput(this.model.searchStoreList,e);this.ui.oSearchApiCallInProgress=false;this.ui.oTotalSearchStores=this.ui.oTotalSearchStores+this.ui.oPageSize},getServiceAvlbInput:function(e){var i=e.Organization;var t={ResourcePool:{Node:i.OrganizationCode,CapacityOrganizationCode:i.CapacityOrganizationCode,BusinessCalendarKey:i.BusinessCalendarKey}};t.ResourcePool.ServiceSkills=this.model.serviceSkillList;if(r.inputData.BusinessDay)t.ResourcePool.BusinessDay=r.inputData.BusinessDay;return t},massageOutputForAvailability:function(e,i){},uiOnStoreHighlight:function(e){var i=e.mode;if(i=="common"){this.ui.nearHighlightedStore={};this.ui.searchHighlightedStore={}}else if(i=="nearby"||i=="search"){this.ui.currentHighlightedStore={}}},uiOnStoreSelection:function(e){if(e=="common"){this.ui.nearStore={};this.ui.searchedStore={}}else if(e=="nearby"||e=="search"){this.ui.currentSelectedStore={}}l(this.uiSubmit.bind(this),0)},uiOnNextPageCall:function(e){if(e.mode=="nearby"){this.uiNearNextPageCall()}else if(e.mode=="search"){this.uiSearchNextPageCall()}},massageNextPageOutput:function(e,i){for(var t=0;t<i.MashupRefs.MashupRef.length;t++){var s=i.MashupRefs.MashupRef[t].Output.Node;for(j=0;j<e.GetSurroundingNodeList.NodeList.Node.length;j++){var r=e.GetSurroundingNodeList.NodeList.Node[j];if(r.ShipNode===s.ShipNode){angular.extend(r,s);break}}}},uiClose:function(){t.dismiss("cancel")},uiSubmit:function(){if(!iscCore.isVoid(this.ui.currentSelectedStore)){this.ui.selectedStore=this.ui.currentSelectedStore}else if(this.ui.nearbyView=="false"){this.ui.selectedStore=this.ui.searchedStore}else if(this.ui.nearbyView=="true"){this.ui.selectedStore=this.ui.nearStore}if(iscCore.isVoid(this.ui.selectedStore)){this.ui.errorText=h.translate("changeStore.SelectStore_ErrMsg")}else{var e={data:this.ui.selectedStore};t.close(e)}}})}]);
angular.module("store").controller("store.views.appointments.in-store.store-appointments.appointments-calendar",["$scope","$interval","iscScreen","moment","iscMashup","iscState","iscI18n","iscInStoreAppointment","iscAppContext","$filter","iscTimezone","iscRule","iscResourcePermission",function(e,t,r,n,o,s,a,i,p,u,l,m,d){r.initializeScreen(e,{model:{},mashupRefs:[{mashupRefId:"getStoreAppointmentsList",mashupId:"store.views.appointments.in-store.store-appointments.getWorkOrderAppointmentsList"},{mashupRefId:"getOpenStoreAppointmentsCount",mashupId:"store.views.appointments.in-store.store-appointments.getOpenStoreAppointmentsCount"},{mashupRefId:"getCompletedStoreAppointmentsCount",mashupId:"store.views.appointments.in-store.store-appointments.getCompletedStoreAppointmentsCount"},{mashupRefId:"getStoreAvailabilityForCurrentWeek",mashupId:"store.views.appointments.in-store.store-appointments.getStoreAvailabilityForCurrentWeek"}],ui:{selectedDayString:"",storeAppointmentCount:0,openStoreAppointmentsCount:0,completedStoreAppointmentCount:0,storeBusinessCalendarKey:"",storeLocaleTimeZone:"",noAppointmentsForToday:true,isApiCallInProgress:true,eventsData:null,calenderWeekData:[],timezoneOffset:"",hasCreateAppointmentPermission:false,maxAppointmentDaysAhead:m.getRuleSetValue("maxAppointmentDaysAhead"),isSelectedDateAHoliday:false},initialize:function(){this.ui.storeBusinessCalendarKey=p.getFromContext("storeBusinessCalendarKey");this.ui.storeLocaleTimeZone=p.getFromContext("storeLocaleTimeZone");this.ui.timezoneOffset=l.getTimezoneOffset(this.ui.storeLocaleTimeZone);if(d.hasPermission("WSC000074")){this.ui.hasCreateAppointmentPermission=true}},uiHandleDateChange:function(e){this.ui.selectedDayString=e.selectedDate;this.ui.isApiCallInProgress=true;var t=this;var r={WorkOrderAppointment:{}};r.WorkOrderAppointment.FromPromisedApptStartDate=this.ui.selectedDayString+"T00:00:00"+this.ui.timezoneOffset;r.WorkOrderAppointment.ToPromisedApptStartDate=this.ui.selectedDayString+"T23:59:59"+this.ui.timezoneOffset;var n=[];n.push(o.getMashupRefObj(t,"getStoreAppointmentsList",r));n.push(o.getMashupRefObj(t,"getOpenStoreAppointmentsCount",r));n.push(o.getMashupRefObj(t,"getCompletedStoreAppointmentsCount",r));o.callMashups(t,n,{}).then(t.processListMashupOutput.bind(t),angular.noop)},uiHandleDateSelectionChangeIsHoliday:function(e){this.ui.isSelectedDateAHoliday=e.isHoliday},uiHandleAppointmentSelection:function(e){if(e.orderDetails&&e.customerDetails.billToId&&e.customerDetails.draftOrderFlag=="N"||!this.ui.hasCreateAppointmentPermission){i.openAppointmentSummary(e.orderDetails)}else{i.openCreateAppointmentWizard({input:e.orderDetails})}},uiHandleWeekChange:function(e){var t=e.fromDate;this.ui.isApiCallInProgress=true;var r=e.toDate;var n=this;var s={Calendar:{}};s.Calendar.CalendarKey=this.ui.storeBusinessCalendarKey;s.Calendar.FromDate=t;s.Calendar.ToDate=r;o.callMashup(n,"getStoreAvailabilityForCurrentWeek",s,{}).then(n.processWeeklySlotstMashupOutput.bind(n),angular.noop)},processListMashupOutput:function(e){var t=o.getMashupOutput(e,"getStoreAppointmentsList");var r=o.getMashupOutput(e,"getOpenStoreAppointmentsCount");var n=o.getMashupOutput(e,"getCompletedStoreAppointmentsCount");this.ui.openStoreAppointmentsCount=Number(r.WorkOrderAppointments.TotalNumberOfRecords);this.ui.completedStoreAppointmentCount=Number(n.WorkOrderAppointments.TotalNumberOfRecords);this.ui.storeAppointmentCount=this.ui.openStoreAppointmentsCount+this.ui.completedStoreAppointmentCount;this.showAppointmentCalendar(t)},processWeeklySlotstMashupOutput:function(e){var t=o.getMashupOutput(e,"getStoreAvailabilityForCurrentWeek");var r=[];if(t.Calendar.Dates.Date.length>0){for(var n=0;n<t.Calendar.Dates.Date.length;n++){var s=t.Calendar.Dates.Date[n];var i={};i.date=s.Date;i.startTime=s.EarliestShiftStartTime;i.endTime=s.LastShiftEndTime;i.isWorkingDay=s.Type;r.push(i)}}this.ui.calenderWeekData=r;this.updateEventDataForCalendar(r,null)},updateEventDataForCalendar:function(e,t){var r={};if(e!=null){r.selectedDayData={selectedDayString:this.ui.selectedDayString};for(var n=0;n<e.length;n++){var s=e[n];if(r.selectedDayData.selectedDayString===s.date){r.selectedDayData.min=s.startTime;r.selectedDayData.max=s.endTime;break}}}if(t!=null){r.eventArray=t}if(r.selectedDayData!=null&&r.eventArray!=null){this.ui.isApiCallInProgress=false;this.ui.eventsData=r;if(r.eventArray.length===0){this.ui.noAppointmentsForToday=true}else{this.ui.noAppointmentsForToday=false}}},uiClose:function(){s.goToState("/home",{},{})},showAppointmentCalendar:function(e){var t=this.ui.selectedDayString;var r=[];if(e.WorkOrderAppointments.TotalNumberOfRecords>0){for(var n=0;n<e.WorkOrderAppointments.TotalNumberOfRecords;n++){var s=e.WorkOrderAppointments.WorkOrderAppointment[n];var i={};i.eventName=s.WorkOrder.WorkOrderServiceLines.WorkOrderServiceLine[0].ItemShortDescription;i.start=u("date")(s.PromisedApptStartDate,"yyyy-MM-ddTHH:mm:ss",s.WorkOrder.TimezoneOffset);i.end=u("date")(s.PromisedApptEndDate,"yyyy-MM-ddTHH:mm:ss",s.WorkOrder.TimezoneOffset);i.status=s.ApptStatus;i.statusBundleKey="instoreappointment.LABEL_"+s.ApptStatus;i.customerDetails={};i.customerDetails.name=a.translate("address.LABEL_Display_name",{firstname:s.WorkOrder.Order.CustomerFirstName,lastname:s.WorkOrder.Order.CustomerLastName});i.customerDetails.email=s.WorkOrder.Order.CustomerEMailID;i.customerDetails.mobile=s.WorkOrder.Order.CustomerPhoneNo;i.customerDetails.billToId=s.WorkOrder.Order.BillToID;i.customerDetails.draftOrderFlag=s.WorkOrder.Order.DraftOrderFlag;i.orderDetails={};i.orderDetails.Order={};i.orderDetails.Order.OrderHeaderKey=s.WorkOrder.OrderHeaderKey;r.push(i)}}else{}this.updateEventDataForCalendar(this.ui.calenderWeekData,r)},uiCreateAppointment:function(){i.openCreateAppointmentWizard({})}})}]);
angular.module("store").controller("store.views.customer.customer-profile.list.customer-profile-list",["$scope","$rootScope","$filter","iscScreen","iscStateParams","iscMashup","iscModal","iscCustomer","iscResourcePermission","iscI18n","iscAppContext","iscState","$timeout","iscDomUtility",function(o,t,e,s,u,r,a,i,m,n,C,h,c,l){s.initializeScreen(o,{pageModel:{},model:{customerList:{},getCustomerListInput:{}},mashupRefs:[{mashupRefId:"getPaginatedCustomerList",mashupId:"store.views.customer.customer-profile.getPaginatedCustomerList",isPaginated:true,pageSize:C.getFromContext("listApiPageSize"),append:true,setFocus:true,appendPath:"CustomerList.Customer",modelName:"customerList"}],ui:{pageSize:Number(C.getFromContext("masterDataPageSize")),recordShownCount:Number(C.getFromContext("masterDataPageSize")),apiPageSize:Number(C.getFromContext("listApiPageSize")),noOfSearchResults:"-1",searchInProgress:false,hideSearch:"N",customerLookupType:"",searchText:"",searchCriteriaContextKeyName:"customerLookupSearchCriteria",getSearchCriteriaFromContext:false,isBackButtonClicked:false},initialize:function(){var t=u.params.openBlankPage?true:false;var e=u.params.input;this.ui.isBackButtonClicked=u.options&&u.options.backButtonClicked?true:false;if(!t||this.ui.isBackButtonClicked){if(this.ui.isBackButtonClicked){var s=C.getFromContext(this.ui.searchCriteriaContextKeyName);if(!iscCore.isVoid(s)&&!iscCore.isVoid(s.input)){this.model.getCustomerListInput=s.input;this.ui.getSearchCriteriaFromContext=true;this.ui.customerLookupType=s.lookupType}}else{C.removeFromContext(this.ui.searchCriteriaContextKeyName);if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.getCustomerListInput)){this.model.getCustomerListInput=e.getCustomerListInput}else{this.ui.noOfSearchResults=0}}if(e.lookupType){this.ui.customerLookupType=u.params.input.lookupType}r.callPaginatedMashup(this,"getPaginatedCustomerList",this.model.getCustomerListInput,"START",{}).then(this.processPaginatedCustomerList.bind(this),angular.noop)}else{this.ui.noOfSearchResults=0}var i=this;o.$watch("ui.CustomerPaymentMethod.DisplayCreditCardNo",function(t,e){if(!iscCore.isVoid(t)&&t.length>4){i.ui.CustomerPaymentMethod.DisplayCreditCardNo=e}});o.$watch("ui.showAdvanceSearch",function(t,e){if(t){l.setFocus(document.getElementById("lookupCustomerfirstName"))}})},processPaginatedCustomerList:function(t){var e=r.getMashupOutput(t,"getPaginatedCustomerList");this.ui.noOfSearchResults=Number(e.Page.Output.CustomerList.TotalNumberOfRecords);if(this.ui.noOfSearchResults==1&&!this.ui.isBackButtonClicked){h.goToState("customerprofilewizard",{action:"customerdetails",input:{Customer:e.Page.Output.CustomerList.Customer[0]}},{})}else{this.setCustomerSearchResultText();var s=Number(e.Page.Output.CustomerList.TotalNumberOfRecords);if(s>0){this.ui.selectedCustomerKey=e.Page.Output.CustomerList.Customer[0].CustomerKey}this.handleGetCustomerListOutput(e,false)}},setCustomerSearchResultText:function(){if(this.model.getCustomerListInput&&this.model.getCustomerListInput.Customer){if(this.ui.customerLookupType=="EMAILID"||this.ui.customerLookupType=="PHONE_NUMBER"){if(this.model.getCustomerListInput.Customer.CustomerContactList&&this.model.getCustomerListInput.Customer.CustomerContactList.CustomerContact){this.ui.searchText=this.model.getCustomerListInput.Customer.CustomerContactList.CustomerContact.ComplexQuery.Or.Exp[0].Value}}else if(this.ui.customerLookupType=="ADV_SEARCH"){if(this.model.getCustomerListInput.Customer.CustomerContactList&&this.model.getCustomerListInput.Customer.CustomerContactList.CustomerContact){var t=this.model.getCustomerListInput.Customer.CustomerContactList.CustomerContact.FirstName;var e=this.model.getCustomerListInput.Customer.CustomerContactList.CustomerContact.LastName;if(t){this.ui.searchText=t}if(e){this.ui.searchText=this.ui.searchText?this.ui.searchText+" "+e:e}}if(this.model.getCustomerListInput.Customer.CustomerPaymentMethodList&&this.model.getCustomerListInput.Customer.CustomerPaymentMethodList.CustomerPaymentMethod&&this.model.getCustomerListInput.Customer.CustomerPaymentMethodList.CustomerPaymentMethod.DisplayCreditCardNo){var s=this.model.getCustomerListInput.Customer.CustomerPaymentMethodList.CustomerPaymentMethod.DisplayCreditCardNo;this.ui.searchText=this.ui.searchText?this.ui.searchText+" "+s:s}}}},uiInitializeCustomerLookup:function(){if(this.model.getCustomerListInput&&this.model.getCustomerListInput.Customer){if(this.ui.customerLookupType=="EMAILID"||this.ui.customerLookupType=="PHONE_NUMBER"){if(this.model.getCustomerListInput.Customer.CustomerContactList&&this.model.getCustomerListInput.Customer.CustomerContactList.CustomerContact){this.model.lookupValue=this.model.getCustomerListInput.Customer.CustomerContactList.CustomerContact.ComplexQuery.Or.Exp[0].Value}}else if(this.ui.customerLookupType=="ADV_SEARCH"){this.ui.search=this.model.getCustomerListInput.Customer;if(this.model.getCustomerListInput.Customer.CustomerPaymentMethodList&&this.model.getCustomerListInput.Customer.CustomerPaymentMethodList.CustomerPaymentMethod){this.ui.CustomerPaymentMethod=this.model.getCustomerListInput.Customer.CustomerPaymentMethodList.CustomerPaymentMethod}else{this.ui.CustomerPaymentMethod={DisplayCreditCardNo:""}}}}},uiFindCustomerBySearchCriteria:function(){var t=this;var e={Customer:{CustomerContactList:{CustomerContact:{}}}};if(this.ui.search&&this.ui.search.CustomerContactList){e.Customer.CustomerContactList.CustomerContact=this.ui.search.CustomerContactList.CustomerContact}if(this.ui.CustomerPaymentMethod&&this.ui.CustomerPaymentMethod.DisplayCreditCardNo){e.Customer.CustomerPaymentMethodList={CustomerPaymentMethod:this.ui.CustomerPaymentMethod}}r.callPaginatedMashup(this,"getPaginatedCustomerList",e,"START",{}).then(this.processPaginatedCustomerList.bind(this),angular.noop);this.hideLookupAndSaveSearchCriteria("ADV_SEARCH",e)},hideLookupAndSaveSearchCriteria:function(t,e){this.model.getCustomerListInput=e;C.addToContext(this.ui.searchCriteriaContextKeyName,{input:this.model.getCustomerListInput,lookupType:t});this.ui.customerLookupType=t;this.ui.showAdvanceSearch=false;this.ui.hideSearch="N";this.ui.searchText="";this.ui.isBackButtonClicked=false},uiFindCustomers:function(){var t="";if(!iscCore.isVoid(this.model.lookupValue)){var e={Customer:{CustomerContactList:{CustomerContact:{ComplexQuery:{Or:{Exp:[]}}}}}};var s={Customer:{CustomerContactList:{CustomerContact:{}}}};if(this.model.lookupValue.indexOf("@")>-1){t="EMAILID";var i={Name:"EmailID",QryType:"EQ",Value:this.model.lookupValue};e.Customer.CustomerContactList.CustomerContact.ComplexQuery.Or.Exp.push(i)}else{t="PHONE_NUMBER";var o={Name:"DayPhone",QryType:"EQ",Value:this.model.lookupValue};e.Customer.CustomerContactList.CustomerContact.ComplexQuery.Or.Exp.push(o)}r.callPaginatedMashup(this,"getPaginatedCustomerList",e,"START",{}).then(this.processPaginatedCustomerList.bind(this),angular.noop);this.hideLookupAndSaveSearchCriteria(t,e)}else{a.showErrorMessage(n.translate("customerprofile.MSG_InvalidCustomerSearchData"))}},uiResetSearchCriteria:function(){this.ui.search.CustomerContactList.CustomerContact.FirstName=this.ui.search.CustomerContactList.CustomerContact.LastName="";this.ui.CustomerPaymentMethod.DisplayCreditCardNo="";C.removeFromContext(this.ui.searchCriteriaContextKeyName);this.ui.getCustomerListInput=""},uiCloseAdvanceSearch:function(){this.ui.showAdvanceSearch=false;c(function(){document.getElementById("lookupCustomerAdvanceSearchLink").focus()},500)},uiViewCustomerProfile:function(t){if(!iscCore.isVoid(t)){h.goToState("customerprofilewizard",{action:"customerdetails",input:{Customer:t}},{})}else{a.showErrorMessage(n.translate("return.MSG_CustomerNotFound"))}},uigetNextCustomerRecords:function(){var t=this.model.customerList.Page.Output.CustomerList;var e=t.Customer.length;console.log("numRecordsInModel="+e);if(e-this.ui.recordShownCount>=this.ui.pageSize){this.ui.recordShownCount+=this.ui.pageSize;console.log("Using existing model - doing client side pagination")}else{if(this.model.customerList.Page.IsLastPage!="Y"){console.log("calling API with input="+this.model.getCustomerListInput);this.ui.searchInProgress=true;r.callPaginatedMashup(this,"getPaginatedCustomerList",this.model.getCustomerListInput,"NEXT",{}).then(function(t){this.ui.searchInProgress=false;this.uigetNextCustomerRecords()}.bind(this),angular.noop)}else{this.ui.recordShownCount=e;console.log("not calling API but painting numItemsInModel="+e+" items")}}},uiNextPageActionValidator:function(){if(!this.ui.searchInProgress){return true}else if(this.ui.searchInProgress){return false}},handleGetCustomerListOutput:function(t,e){this.ui.searchInProgress=false;if(e){var s=t.Page.Output.CustomerList.Customer;for(var i=0;i<s.length;i++){this.model.customerList.Page.Output.CustomerList.Customer.push(s[i])}this.model.customerList.Page.PageNumber=t.Page.PageNumber;this.model.customerList.Page.IsFirstPage=t.Page.IsFirstPage;this.model.customerList.Page.IsLastPage=t.Page.IsLastPage;this.uigetNextCustomerRecords()}else{this.model.customerList=t;this.pageModel.getCustomerListPaginated={};this.pageModel.getCustomerListPaginated["0"]={};this.pageModel.getCustomerListPaginated[t.Page.PageNumber]=t.Page.LastRecord;this.pageModel.getCustomerListPaginated.currentPageNumber=t.Page.PageNumber;this.pageModel.getCustomerListPaginated.IsLastPage=t.Page.IsLastPage;this.pageModel.getCustomerListPaginated.IsFirstPage=t.Page.IsFirstPage;this.pageModel.getCustomerListPaginated.IsValidPage=t.Page.IsValidPage}},uiSetCustomerDisplayAddress:function(t){return i.getDisplayAddressForCustomer(t)},uiCancel:function(){h.goToState("/home",{},{})},uiSearchClose:function(){this.ui.hideSearch="N"}})}]);
angular.module("store").controller("store.views.return.common.disposition.return-disposition",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal",function(e,s,n,t,o,r,u,d,L,l){t.initializeModalScreen(e,{model:{dispositionList:{},returnLineList:{}},mashupRefs:[],ui:{selectedDisposition:"",showAllLines:true,returnLineShownCount:5,ohkey:""},initialize:function(){this.ui.ohkey=o.OrderHeaderKey;this.model.returnLineList=angular.copy(o.returnLineList);this.model.dispositionList=o.dispositionList;if(this.model.returnLineList.OrderLineList.TotalNumberOfRecords=="1"){this.ui.showAllLines=true}if(iscCore.isVoid(this.ui.selectedDisposition)){this.ui.selectedDisposition=this.model.dispositionList.ReturnDispositionList.ReturnDisposition[0].DispositionCode}},uiRemoveBlankOption:function(i){if(iscCore.isVoid(i.DispositionCode)){i.DispositionCode=this.model.dispositionList.ReturnDispositionList.ReturnDisposition[0].DispositionCode}},uiSubmit:function(){var e={Order:{OrderHeaderKey:this.ui.ohkey,OrderLines:{OrderLine:[]}}};var s=this.model.returnLineList.OrderLineList.OrderLine;var t=this.ui.selectedDisposition;for(i=0;i<s.length;i++){if(this.ui.showAllLines){t=s[i].DispositionCode}e.Order.OrderLines.OrderLine.push({OrderLineKey:s[i].OrderLineKey,DispositionCode:t})}var o={data:{inputChangeOrder:e}};n.close(o)},uiGetReturnOrderLineListNext:function(){if(this.ui.returnLineShownCount<=this.model.returnLineList.OrderLineList.OrderLine.length){this.ui.returnLineShownCount+=5}},uiReturnOrderLineScrollActionValidator:function(){return true},uiClose:function(){n.dismiss("cancel")}})}]);
angular.module("store").controller("store.views.return.common.override.override-policy-violation",["$scope","$rootScope","$uibModalInstance","iscScreen","iscWizard","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal",function(e,r,s,i,o,d,t,n,l,a,u){i.initializeModalScreen(e,{model:{reasonList:{},orderLine:{},overrideInput:{},managerOverrideRule:{},order:{},error:{}},mashupRefs:[{mashupRefId:"getOverridePolicyViolationReasonList",mashupId:"returnOrder_getOverridePolicyViolationReasonList",modelName:"reasonList"},{mashupRefId:"validateOverrideCode",mashupId:"returnOrder_validateOverrideCode"},{mashupRefId:"getManagerOverrideRule",mashupId:"returnOrder_getManagerOverrideRule",modelName:"managerOverrideRule"},{mashupRefId:"createReturnOrderWithPolicyOverride",mashupId:"orderDetails_createReturnOrderWithPolicyOverride"},{mashupRefId:"changeReturnOrderWithPolicyOverride",mashupId:"orderDetails_changeReturnOrderWithPolicyOverride"},{mashupRefId:"recordApprovalForReturnOrderLines",mashupId:"returnOrder_recordApprovalForReturnOrderLines"}],ui:{selectedReason:"",otherText:"",overrideCode:"",openViolation:false,openOverride:false,showInvalidError:false,orderLineShownCount:5,viewMode:"N",multipleOrderLines:"N",showError:false,showOverrideError:false,returnOrder:""},initialize:function(){if(!iscCore.isVoid(d.viewMode)&&d.viewMode=="Y"){this.ui.viewMode="Y"}if(!iscCore.isVoid(d.multipleOrderLines)&&d.multipleOrderLines=="Y"){this.ui.multipleOrderLines="Y";if(!iscCore.isVoid(d.orderModel)){this.model.order=d.orderModel}}this.model.orderLine=d.orderLineModel;this.model.overrideInput=d.overrideInput;this.ui.returnOrder=d.returnOrder;if(!iscCore.isVoid(d.openOverride)&&typeof d.openOverride==="boolean"&&d.openOverride){this.ui.openOverride=d.openOverride}else{this.ui.openViolation=true}n.callMashup(this,"getOverridePolicyViolationReasonList",{},{}).then(this.setDefaultSelectedReason.bind(this),angular.noop)},setDefaultSelectedReason:function(){if(iscCore.isVoid(this.ui.selectedReason)){this.ui.selectedReason=this.model.reasonList.CommonCodeList.CommonCode[0].CodeShortDescription}},uiOnEnterInputField:function(e){if(e&&e.$valid){this.uiSubmit(e)}},uiGetOrderLineListNext:function(){if(this.ui.orderLineShownCount<=this.model.order.Order.OrderLines.OrderLine.length){this.ui.orderLineShownCount+=10}},uiOrderLineListScrollActionValidator:function(){return true},uiClose:function(){var e={};e={data:{returnOrder:this.ui.returnOrder}};s.dismiss(e)},uiResetErrorFlags:function(){this.ui.showError=false;this.ui.showOverrideError=false;this.model.error.msg=""},getOverrideValidationInput:function(){this.model.overrideInput.Order.OrderLines.OrderLine.OverrideCode=this.ui.overrideCode;if(!iscCore.isVoid(this.ui.selectedReason)){this.model.overrideInput.Order.OrderLines.OrderLine.Notes={};this.model.overrideInput.Order.OrderLines.OrderLine.Notes.Note={};if(this.ui.selectedReason=="Other"){this.model.overrideInput.Order.OrderLines.OrderLine.Notes.Note.NoteText=this.ui.otherText}else{this.model.overrideInput.Order.OrderLines.OrderLine.Notes.Note.NoteText=this.ui.selectedReason}}return this.model.overrideInput},uiSubmit:function(){if(this.ui.viewMode=="Y"){s.close({})}else{if(!iscCore.isVoid(this.ui.overrideCode)){this.handleOverrideReasonWithoutValidation()}else{this.ui.showOverrideError=true;this.ui.showError=true;this.model.error.msg=a.translate("returns.MSG_ManagerOverrideCodeRequired");this.ui.overrideErrorMsg="returns.MSG_ManagerOverrideCodeRequired"}}},handleOverrideCodeValidation:function(e){var r=n.getMashupOutput(e,"validateOverrideCode");if(r.Order.IsOverrideCodeValid!="Y"){this.ui.showInvalidError=true;if(!iscCore.isVoid(r.Order.ErrorCode)){this.ui.overrideCodeError="apierror."+r.Order.ErrorCode}else{this.ui.overrideCodeError="returns.MSG_InvalidOverrideCode"}}else{this.handleOverrideReasonWithoutValidation()}},handleOverrideReasonWithoutValidation:function(){var e=angular.copy(this.ui.returnOrder);if(this.ui.multipleOrderLines=="Y"){if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Order)&&!iscCore.isVoid(e.Order.OrderLines)){var r=t("number")(e.Order.OrderLines.TotalNumberOfRecords);if(!isNaN(r)&&r>0){for(var i=e.Order.OrderLines.OrderLine.length-1;i>=0;i--){var o=e.Order.OrderLines.OrderLine[i];if(!iscCore.isVoid(o.ReturnPolicyViolations)&&o.ReturnPolicyViolations.CannotBeOverridden=="Y"){e.Order.OrderLines.OrderLine.splice(i,1)}else{o.OverrideCode=this.ui.overrideCode;o.Notes={};o.Notes.Note={};if(this.ui.selectedReason=="Other"){o.Notes.Note.NoteText=this.ui.otherText}else{o.Notes.Note.NoteText=this.ui.selectedReason}delete o.ImageURL;delete o.VariationAttrs;delete o["Order"];delete o["ItemDetails"];delete o["LineOverallTotals"]}}}}delete e.Order.OrderLines.TotalNumberOfRecords;delete e.Order.ShowOverridePopup;delete e.Order.ShowOverriddenLabel;e=angular.copy(e);n.callMashup(this,"recordApprovalForReturnOrderLines",e,{}).then(this.postRecordApprovalofReturnOrder.bind(this),angular.noop)}else{this.model.overrideInput.Order.OrderLines.OrderLine.OverrideCode=this.ui.overrideCode;this.model.overrideInput.Order.OrderLines.OrderLine.Notes={};this.model.overrideInput.Order.OrderLines.OrderLine.Notes.Note={};if(this.ui.selectedReason=="Other"){this.model.overrideInput.Order.OrderLines.OrderLine.Notes.Note.NoteText=this.ui.otherText}else{this.model.overrideInput.Order.OrderLines.OrderLine.Notes.Note.NoteText=this.ui.selectedReason}var d=!iscCore.isVoid(this.model.overrideInput.Order.OrderHeaderKey)?"changeReturnOrderWithPolicyOverride":"createReturnOrderWithPolicyOverride";n.callMashup(this,d,this.model.overrideInput,{}).then(this.postRecordApprovalofReturnOrder.bind(this),angular.noop)}},postRecordApprovalofReturnOrder:function(e){var r=e.MashupRefs.MashupRef[0].Output;var i=r.Order.IsRecordApprovalError;var o=r.Order.IsPolicyConfigInvalid;var d=r.Order.ErrorCode;if(this.ui.multipleOrderLines!="Y"){this.ui.returnOrder=r}if(!iscCore.isVoid(i)&&i=="Y"){d=iscCore.isVoid(d)?"MSG_UnableToApproveOverride":d;this.ui.showOverrideError=true;this.ui.overrideErrorMsg="orderDetails.MSG_UnableToApproveOverride"}else if(!iscCore.isVoid(o)&&o=="Y"){d=iscCore.isVoid(d)?"MSG_InvalidReturnPolicyConfiguration":d;this.model.error.type="danger";this.model.error.msg=a.translate("orderDetails.MSG_InvalidReturnPolicyConfiguration");this.ui.showError=true}else{var t={};t={data:{response:e}};s.close(t)}}})}]);
angular.module("store").controller("store.views.return.common.reason.return-reason-multiple",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal",function(e,n,t,o,r,s,u,d,a,l){o.initializeModalScreen(e,{model:{reasonList:{},returnLineList:{}},mashupRefs:[{mashupRefId:"getReturnReasonList",mashupId:"returnOrder_getCommonCodeListByType",modelName:"reasonList"}],ui:{selectedReason:"",showAllLines:false,returnLineShownCount:5,ohkey:""},initialize:function(){this.ui.ohkey=r.OrderHeaderKey;this.model.returnLineList=angular.copy(r.returnLineList);u.callMashup(this,"getReturnReasonList",{CommonCode:{CodeType:"RETURN_REASON"}},{}).then(this.setDefaultSelected.bind(this),angular.noop)},setDefaultSelected:function(){if(this.model.returnLineList.OrderLineList.TotalNumberOfRecords=="1"){this.ui.showAllLines=true}if(!iscCore.isVoid(this.model.reasonList.CommonCodeList.CommonCode)){this.ui.selectedReason=this.model.reasonList.CommonCodeList.CommonCode[0].CodeValue}else{l.showErrorMessage(a.translate("returns.MSG_NoReturnReasonConfigured")).then(function(){t.dismiss("cancel")})}},uiRemoveBlankOption:function(e){if(iscCore.isVoid(e.ReturnReason)&&!iscCore.isVoid(this.model.reasonList.CommonCodeList.CommonCode)){e.ReturnReason=this.model.reasonList.CommonCodeList.CommonCode[0].CodeValue}},uiSubmit:function(){var e={Order:{OrderHeaderKey:this.ui.ohkey,OrderLines:{OrderLine:[]}}};var n=this.model.returnLineList.OrderLineList.OrderLine;var o=this.ui.selectedReason;for(i=0;i<n.length;i++){if(this.ui.showAllLines){o=n[i].ReturnReason}e.Order.OrderLines.OrderLine.push({OrderLineKey:n[i].OrderLineKey,ReturnReason:o})}var r={data:{inputChangeOrder:e}};t.close(r)},uiGetReturnOrderLineListNext:function(){if(this.ui.returnLineShownCount<=this.model.returnLineList.OrderLineList.OrderLine.length){this.ui.returnLineShownCount+=5}},uiReturnOrderLineScrollActionValidator:function(){return true},uiClose:function(){t.dismiss("cancel")}})}]);
angular.module("store").controller("store.views.return.common.reason.return-reason-single",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n",function(e,i,s,o,n,t,a,u,r){o.initializeModalScreen(e,{model:{reasonList:{}},mashupRefs:[{mashupRefId:"getReturnReasonList",mashupId:"returnOrder_getCommonCodeListByType",modelName:"reasonList"}],ui:{selectedReason:""},initialize:function(){if(!iscCore.isVoid(n.returnReasonCode)){this.ui.selectedReason={};this.ui.selectedReason.CodeValue=n.returnReasonCode}var e=[];e.push(a.getMashupRefObj(this,"getReturnReasonList",{CommonCode:{CodeType:"RETURN_REASON"}}));a.callMashups(this,e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(){if(iscCore.isVoid(this.ui.selectedReason)){this.ui.selectedReason=this.model.reasonList.CommonCodeList.CommonCode[0]}},uiOnEnterInputField:function(e){if(e&&e.$valid){this.uiSubmit(e)}},isDataModified:function(){var e=true;return e},uiClose:function(){s.dismiss("cancel")},uiSubmit:function(){var e={};e={data:{returnReason:this.ui.selectedReason.CodeValue,applyToAll:false}};s.close(e)}})}]);
angular.module("store").controller("store.views.shipment.backroom-pick.pick-order-list.pick-order-list",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscStateParams","iscAppContext","iscWizard","iscResourcePermission","iscPrint","$timeout","iscShipment","$filter",function(i,t,e,s,r,p,n,h,a,u,o,l,c,S){t.initializeScreen(i,{model:{shipmentList:{},filterOptions:{}},mashupRefs:[{mashupRefId:"getShipmentList",mashupId:"store.views.shipment.backroomPick.pick-order-list.getPickOrderList",modelName:"shipmentList",isPaginated:true,pageSize:15,append:true,appendPath:"Shipments.Shipment"},{mashupRefId:"getShipmentListCountForPickOrders",mashupId:"store.views.shipment.backroomPick.getPickOrderList"},{mashupRefId:"getShipmentListCountForSFSOrders",mashupId:"store.views.shipment.backroomPick.getPickOrderList"},{mashupRefId:"printPickTicketForShipment",mashupId:"store.views.shipment.pick-order-list.printPickTicketForShipment"}],ui:{selectedShipmentKey:"",recordShownCount:15,numOfOrders:-1,pickOrderStatusFilter:[],sfsOrderStatusFilter:[],apiCallInProgress:false,activeTabIndex:0,showPickupView:true,showSFSView:false,pickOrdersCount:0,sfsOrdersCount:0,sortOptions:"N",activeTab:"PICK",isBackroomPickBOPIS:u.hasPermission("WSC000057"),isBackroomPickSFS:u.hasPermission("WSC000058")},initialize:function(){var i=n.params.input.FilterOptions;if(i=="All"){this.model.filterOptions.inProgressFlag="Y";this.model.filterOptions.readyForPickingFlag="Y";this.ui.pickOrderStatusFilter.push("1100.70.06.10");this.ui.pickOrderStatusFilter.push("1100.70.06.20");this.ui.sfsOrderStatusFilter.push("1100.70.06.10");this.ui.sfsOrderStatusFilter.push("1100.70.06.20")}else if(i=="InProgress"){this.model.filterOptions.inProgressFlag="Y";this.model.filterOptions.readyForPickingFlag="N";this.ui.pickOrderStatusFilter.push("1100.70.06.20");this.ui.sfsOrderStatusFilter.push("1100.70.06.20")}else if(i=="NotStarted"){this.model.filterOptions.inProgressFlag="N";this.model.filterOptions.readyForPickingFlag="Y";this.ui.pickOrderStatusFilter.push("1100.70.06.10");this.ui.sfsOrderStatusFilter.push("1100.70.06.10")}if(!this.ui.isBackroomPickBOPIS){this.ui.activeTab="SHP";this.ui.showPickupView=false;this.ui.showSFSView=true;var t=c.prepareGetShipmentListApiInput("N","SHP",this.ui.sfsOrderStatusFilter)}else{var t=c.prepareGetShipmentListApiInput("N","PICK",this.ui.pickOrderStatusFilter)}var e=[];e.push(p.getMashupRefObj(this,"getShipmentListCountForPickOrders",c.prepareGetShipmentListApiInput("","PICK",this.ui.pickOrderStatusFilter)));e.push(p.getMashupRefObj(this,"getShipmentListCountForSFSOrders",c.prepareGetShipmentListApiInput("","SHP",this.ui.sfsOrderStatusFilter)));p.callMashups(this,e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(i){var t=i.MashupRefs.MashupRef;if(t!==null&&t!==undefined){var e=t.length;for(var s=0;s<e;s++){var r=t[s];if(r.mashupRefId==="getShipmentListCountForPickOrders"){this.ui.pickOrdersCount=r.Output.Shipments.TotalNumberOfRecords}else if(r.mashupRefId==="getShipmentListCountForSFSOrders"){this.ui.sfsOrdersCount=r.Output.Shipments.TotalNumberOfRecords}else if(r.mashupRefId==="getShipmentList"){this.processPaginatedShipmentList(i)}}}},processPaginatedShipmentList:function(i){this.ui.apiCallInProgress=false;var t=p.getMashupOutput(i,"getShipmentList");this.ui.numOfOrders=S("number")(t.Page.Output.Shipments.TotalNumberOfRecords);if(this.ui.activeTab=="SHP"){this.ui.sfsOrdersCount=S("number")(t.Page.Output.Shipments.TotalNumberOfRecords)}else if(this.ui.activeTab=="PICK"){this.ui.pickOrdersCount=S("number")(t.Page.Output.Shipments.TotalNumberOfRecords)}if(t.Page.Output.Shipments.Shipment){if(iscCore.isVoid(this.ui.selectedShipmentKey)){this.ui.selectedShipmentKey=t.Page.Output.Shipments.Shipment[0].ShipmentKey}this.processShipment(t.Page.Output.Shipments)}},processShipment:function(i){for(var t=0;t<i.Shipment.length;t++){var e=i.Shipment[t];e.OrderNoToDisplay=c.getDisplayOrderNumber(e.DisplayOrderNo,"|",", ",true);e.StatusDescriptionToDisplay=c.getShipmentStatusDescription(e)}},uiPrintPickList:function(){var t=this;s.openModal("store.views.shipment.backroom-pick.common.print-pick-ticket.print-pick-ticket",{},{}).then(function(i){if(i.data!==null&&i.data!==undefined){t.postPrintPickTicketSelection.call(t,i.data)}},angular.noop)},postPrintPickTicketSelection:function(t){var e=this;if(t&&t.isPrintingLargeShipments){s.showConfirmationMessage(r.translate("pickorderlist.MSG_PrintLargeOrderConfirmation")).then(function(i){if(i=="YES"){e.getPickTicketPrintHTML(t.shipmentTypeToPrint)}})}else{this.getPickTicketPrintHTML(t.shipmentTypeToPrint)}},uiGoToShipmentSummary:function(i){e.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:i.ShipmentKey},flowName:"BackroomPick"}},{})},getPickTicketPrintHTML:function(i){var t={};if(i!="PRINT_ALL"){t={Shipment:{ShipmentLines:{ShipmentLine:{OrderLine:{DeliveryMethod:""}}}}};t.Shipment.ShipmentLines.ShipmentLine.OrderLine.DeliveryMethod=i=="PRINT_SFS"?"SHP":"PICK"}p.callMashup(this,"printPickTicketForShipment",t,{}).then(this.processPickTicketHTML.bind(this),angular.noop)},uipickOrder:function(i){e.goToState("backroomPickWizard",{input:{Shipment:{ShipmentKey:i}}},{})},processPickTicketHTML:function(i){var t=p.getMashupOutput(i,"printPickTicketForShipment");if(t.Shipments&&t.Shipments.TotalNumberOfRecords=="0"){s.showWarningMessage(r.translate("pickorderlist.MSG_NoShipmentsToPrint"))}else if(t.Output&&t.Output.out){o.printHtmlOutput(t)}},uiSelectShipment:function(i){this.ui.selectedShipmentKey=i.ShipmentKey},uiOrderListScrollActionValidator:function(){if(this.model.shipmentList.Page.IsLastPage!=="N"){return false}else return true},uiGetNextPickingRecords:function(){if(this.model.shipmentList.Page.IsLastPage!=="N"){return}this.ui.apiCallInProgress=true;var i={};if(this.ui.activeTab=="SHP"){i=c.prepareGetShipmentListApiInput(this.ui.sortOptions,this.ui.activeTab,this.ui.sfsOrderStatusFilter)}else if(this.ui.activeTab=="PICK"){i=c.prepareGetShipmentListApiInput(this.ui.sortOptions,this.ui.activeTab,this.ui.pickOrderStatusFilter)}p.callPaginatedMashup(this,"getShipmentList",i,"NEXT",{}).then(this.processPaginatedShipmentList.bind(this))},uiUpdateSelection:function(i){this.ui.selectedShipmentKey="";if(!this.ui.isBackroomPickBOPIS){this.ui.activeTab="SHP";this.ui.showPickupView=false;this.ui.showSFSView=true;var t=c.prepareGetShipmentListApiInput("N","SHP",this.ui.sfsOrderStatusFilter);i="SFS"}if(i=="Pickup"){this.ui.showPickupView=true;this.ui.showSFSView=false;this.ui.activeTab="PICK";this.model.shipmentList={};var t=c.prepareGetShipmentListApiInput("N","PICK",this.ui.pickOrderStatusFilter);p.callPaginatedMashup(this,"getShipmentList",t,"START",{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)}else if(i=="SFS"){this.ui.showSFSView=true;this.ui.showPickupView=false;this.ui.activeTab="SHP";this.model.shipmentList={};var t=c.prepareGetShipmentListApiInput("N","SHP",this.ui.sfsOrderStatusFilter);p.callPaginatedMashup(this,"getShipmentList",t,"START",{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)}},uiClose:function(){e.goToState("/home",{},{})},uiApplySortOptions:function(i){var t={};if(i.sortOption=="NEW_TO_OLD"){this.ui.sortOptions="Y"}else if(i.sortOption=="OLD_TO_NEW"){this.ui.sortOptions="N"}var t={};if(this.ui.activeTab=="SHP"){t=c.prepareGetShipmentListApiInput(this.ui.sortOptions,this.ui.activeTab,this.ui.sfsOrderStatusFilter)}else if(this.ui.activeTab=="PICK"){t=c.prepareGetShipmentListApiInput(this.ui.sortOptions,this.ui.activeTab,this.ui.pickOrderStatusFilter)}this.model.shipmentList={};p.callMashup(this,"getShipmentList",t,{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)},uiOnApplyFilter:function(i){var t=i.readyForPickingFlag;var e=i.inProgressFlag;var s={};if(this.ui.activeTab=="SHP"){this.ui.sfsOrderStatusFilter=[];if(t=="Y"&&e=="Y"){this.model.filterOptions.inProgressFlag="Y";this.model.filterOptions.readyForPickingFlag="Y";this.ui.sfsOrderStatusFilter.push("1100.70.06.10");this.ui.sfsOrderStatusFilter.push("1100.70.06.20")}else if(e=="Y"){this.model.filterOptions.inProgressFlag="Y";this.model.filterOptions.readyForPickingFlag="N";this.ui.sfsOrderStatusFilter.push("1100.70.06.20")}else if(t=="Y"){this.model.filterOptions.inProgressFlag="N";this.model.filterOptions.readyForPickingFlag="Y";this.ui.sfsOrderStatusFilter.push("1100.70.06.10")}s=c.prepareGetShipmentListApiInput(this.ui.sortOptions,this.ui.activeTab,this.ui.sfsOrderStatusFilter)}else if(this.ui.activeTab=="PICK"){this.ui.pickOrderStatusFilter=[];if(t=="Y"&&e=="Y"){this.model.filterOptions.inProgressFlag="Y";this.model.filterOptions.readyForPickingFlag="Y";this.ui.pickOrderStatusFilter.push("1100.70.06.10");this.ui.pickOrderStatusFilter.push("1100.70.06.20")}else if(e=="Y"){this.model.filterOptions.inProgressFlag="Y";this.model.filterOptions.readyForPickingFlag="N";this.ui.pickOrderStatusFilter.push("1100.70.06.20")}else if(t=="Y"){this.model.filterOptions.inProgressFlag="N";this.model.filterOptions.readyForPickingFlag="Y";this.ui.pickOrderStatusFilter.push("1100.70.06.10")}s=c.prepareGetShipmentListApiInput(this.ui.sortOptions,this.ui.activeTab,this.ui.pickOrderStatusFilter)}this.model.shipmentList={};var r=[];if(this.ui.showSFSView){r.push(p.getMashupRefObj(this,"getShipmentListCountForSFSOrders",c.prepareGetShipmentListApiInput("","SHP",this.ui.sfsOrderStatusFilter)))}if(this.ui.showPickupView){r.push(p.getMashupRefObj(this,"getShipmentListCountForPickOrders",c.prepareGetShipmentListApiInput("","PICK",this.ui.pickOrderStatusFilter)))}r.push(p.getMashupRefObj(this,"getShipmentList",s));p.callMashups(this,r,{}).then(this.handleInitApiCalls.bind(this),angular.noop)}})}]);
angular.module("store").controller("store.views.shipment.backroom-pick.pick-products.pick-products-list",["$scope","$rootScope","iscScreen","iscWizard","$timeout","$filter","$locale","iscMashup","iscState","iscStateParams","iscShipment","iscResourcePermission","iscModal","iscI18n","$q","iscDomUtility","iscAppContext","iscAppInfo","iscScrollUtility",function(s,e,i,o,n,a,h,r,t,m,p,c,u,l,d,S,L,k,g){o.initializeWizardPage(s,{model:{shipmentDetails:{},shipmentLineList:{},barCodeData:""},mashupRefs:[{mashupRefId:"getShipmentDetails",mashupId:"store.views.shipment.backroom-pick.getShipmentDetails"},{mashupRefId:"getPickableShipmentLineListCount",mashupId:"store.views.shipment.backroom-pick.getShipmentLineList"},{mashupRefId:"registerBarcodeForBackroomPick",mashupId:"store.views.shipment.backroom-pick.registerBarcodeForBackroomPick"},{mashupRefId:"pickAllShipmentLines",mashupId:"store.views.shipment.backroom-pick.pickAllShipmentLines"},{mashupRefId:"changeShipmentStatusToReadyForCustomerPickup",mashupId:"store.views.shipment.backroom-pick.changeShipmentStatusToReadyForCustomerPickup"},{mashupRefId:"changeShipmentStatusToReadyForPacking",mashupId:"store.views.shipment.backroom-pick.changeShipmentStatusToReadyForPacking"},{mashupRefId:"getPickableShipmentLineList",mashupId:"store.views.shipment.backroom-pick.getAllPickableShipmentLineList"},{mashupRefId:"validateShipmentForPickComplete",mashupId:"store.views.shipment.backroom-pick.validateShipmentForPickComplete"},{mashupRefId:"recordShortageForShipment",mashupId:"store.views.shipment.backroom-pick.recordShortageForShipment"},{mashupRefId:"updatePickQtyForShipmentLine",mashupId:"store.views.shipment.backroom-pick.updatePickedQuantityForShipmentLine"},{mashupRefId:"getStagingLocationRequiredRuleDetails",mashupId:"store.views.shipment.getStagingLocationRequiredRuleDetails"},{mashupRefId:"getRemainingShipmentLinesCountToBePicked",mashupId:"store.views.shipment.backroom-pick.getRemainingShipmentLinesCountToBePicked"}],ui:{recordShownCount:10,selectedShipmentLineKey:"",currentlySelectedShipmentLine:"",focusOnFirstLine:true,slaImageFullURL:"",productListIndex:0,numberOfPickableProducts:0,ONE_QUANTITY:1,shipmentPreviewTemplate:"store/views/shipment/backroom-pick/popover-preview.tpl.html",isManualPickEnabled:c.hasPermission("WSC000061"),isStagingLocationRuleEnabled:true},_isInitSelection:true,initialize:function(){var e=o.getWizardPageInput();var i=[];i.push(r.getMashupRefObj(this,"getShipmentDetails",{Shipment:{ShipmentKey:e.Shipment.ShipmentKey}}));i.push(r.getMashupRefObj(this,"getPickableShipmentLineList",{ShipmentLine:{ShipmentKey:e.Shipment.ShipmentKey}}));i.push(r.getMashupRefObj(this,"getStagingLocationRequiredRuleDetails",{Rule:{}}));r.callMashups(this,i,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){this.model.shipmentDetails=r.getMashupOutput(e,"getShipmentDetails");this.model.shipmentLineList=r.getMashupOutput(e,"getPickableShipmentLineList");var i=r.getMashupOutput(e,"getStagingLocationRequiredRuleDetails");this.ui.isStagingLocationRuleEnabled=i&&i.Rules.RuleSetValue=="Y"?true:false;this.ui.numberOfPickableProducts=Number(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords);this.setPickableShipmentLineCount();this.setSLAImageURL();o.setWizardModel("shipmentDetails",this.model.shipmentDetails);console.log("shipmentDetails - ",this.model.shipmentDetails)},uiGetFormattedOrderNo:function(e){return p.getDisplayOrderNumber(e,"|",", ",false)},setPickableShipmentLineCount:function(){if(!iscCore.isVoid(this.model.shipmentLineList)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords)){this.ui.numberOfPickableProducts=Number(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords);if(this.ui.focusOnFirstLine&&this.ui.numberOfPickableProducts>0){this.ui.currentlySelectedShipmentLine=this.model.shipmentLineList.ShipmentLines.ShipmentLine[0];this.ui.selectedShipmentLineKey=this.ui.currentlySelectedShipmentLine.ShipmentLineKey;this.uiStampBackoomPickQuantityAttrs(this.ui.currentlySelectedShipmentLine)}}},uiStampBackoomPickQuantityAttrs:function(e){if(e.BackroomPickedQuantity){e.EditableBackroomPickedQuantity=angular.copy(e.BackroomPickedQuantity)}else{e.EditableBackroomPickedQuantity=e.BackroomPickedQuantity="0"}e.BackroomPickComplete=e.BackroomPickComplete?e.BackroomPickComplete:"N";e.showQtyUpdate="N"},uiGetRemainingQuantity:function(e){var i=Number(e.Quantity);var t=Number(e.BackroomPickedQuantity);var n=i-t;return n},uiIsBackroomPickComplete:function(e){return e.BackroomPickComplete=="Y"?true:false},uiScanBarCodeData:function(){if(!iscCore.isVoid(this.model.barCodeData)){var e=[];var i=this;var t={BarCode:{BarCodeData:this.model.barCodeData,ShipmentContextualInfo:{}}};t.BarCode.ShipmentContextualInfo.ShipmentKey=this.model.shipmentDetails.Shipment.ShipmentKey;t.BarCode.ShipmentContextualInfo.SellerOrganizationCode=this.model.shipmentDetails.Shipment.SellerOrganizationCode;e.push(r.getMashupRefObj(this,"registerBarcodeForBackroomPick",t));e.push(r.getMashupRefObj(this,"getRemainingShipmentLinesCountToBePicked",{ShipmentLine:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}));r.callMashups(this,e,{}).then(this.processRegisterBarCodeOutput.bind(this),function(e){i.handleMashupErrors(e)})}else{u.showErrorMessage(l.translate("backroomPick.MSG_InvalidBarCodeData"))}},handleMashupErrors:function(e){var i=this;var t=e.Errors.Error[0].ErrorDescription;var n=e.Errors.Error[0].ErrorCode;if(l.hasKey("apierror."+n)){t=l.translate("apierror."+n);u.showErrorMessage(t,null,null).then(function(e){i.resetData()})}else{u.showErrorMessage(t,null,null).then(function(e){i.resetData()})}},processRegisterBarCodeOutput:function(e){var i=r.getMashupOutput(e,"registerBarcodeForBackroomPick");var t=r.getMashupOutput(e,"getRemainingShipmentLinesCountToBePicked");this.isShipmentPickComplete(t);this.updateShipmentLineListModel(i.BarCode.Shipment);this.highlightLastPickedProduct(i.BarCode.Shipment.ShipmentLine);n(function(){S.setFocus(document.getElementById("productScanInput"))},0);this.resetData()},resetData:function(){this.model.barCodeData="";if(s.backroomPickForm){s.backroomPickForm.$setPristine()}if(s.quantityForm){s.quantityForm.$setPristine()}},updateShipmentLineListModel:function(e){if(!iscCore.isVoid(this.model.shipmentLineList)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords)){var i=a("number")(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords);for(var t=0;t<i;t++){var n=this.model.shipmentLineList.ShipmentLines.ShipmentLine[t];this.ui.productListIndex++;if(!iscCore.isVoid(n)&&n.ShipmentLineKey==e.ShipmentLine.ShipmentLineKey){this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].BackroomPickedQuantity=a("number")(e.ShipmentLine.BackroomPickedQuantity);this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].EditableBackroomPickedQuantity=this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].BackroomPickedQuantity;this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].Quantity=a("number")(e.ShipmentLine.Quantity);this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].ShortageQty=a("number")(e.ShipmentLine.ShortageQty);this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].OriginalQuantity=a("number")(e.ShipmentLine.OriginalQuantity);if(e.ShipmentLine.BackroomPickComplete){this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].BackroomPickComplete=e.ShipmentLine.BackroomPickComplete}else{this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].BackroomPickComplete="N"}this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].showQtyUpdate="N";break}}}},highlightLastPickedProduct:function(e){if(this.ui.recordShownCount<this.ui.productListIndex){this.ui.recordShownCount=this.ui.productListIndex}var i=this;n(function(){g.scrollToElementWIthOffset(document.getElementById("shipmentLinelist"),document.getElementById(e.ShipmentLineKey),0,100)},0);this.ui.productListIndex=1;this.uiSelectShipmentLine(e)},setSLAImageURL:function(){var e=this.model.shipmentDetails.Shipment.ImageUrl;if(e){this.ui.slaImageFullURL=p.getFullURLForImage(e)}},checkForScreenDirtyBeforeClose:function(i){var e=this;var t=s.backroomPickForm.$dirty;if(t){u.showConfirmationMessage(l.translate("globals.MSG_Screen_dirty")).then(function(e){if(e==="YES"){i=="close"?o.closeWizard():o.exitWizard()}})}else{u.showConfirmationMessage(l.translate("backroomPick.MSG_CancelWarningMessage")).then(function(e){if(e==="YES"){i=="close"?o.closeWizard():o.exitWizard()}})}return true},uiCancel:function(){this.checkForScreenDirtyBeforeClose("close")},handleWizardBack:function(){var e=s.backroomPickForm.$dirty;if(e){u.showConfirmationMessage(l.translate("globals.MSG_Screen_dirty")).then(function(e){if(e==="YES"){o.gotoPreviousPage(true)}});return true}else{return false}},uiToggleOfPickedQty:function(e){var i=true;if(e.BackroomPickComplete=="Y"){i=e.ShortageQty>0||e.ShortageQty==e.OriginalQuantity?true:false}else{i=e.BackroomPickedQuantity==0&&e.ShortageQty==0?false:true}return i},uiPickAllShipmentLines:function(e){var i={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};r.callMashup(this,"pickAllShipmentLines",i,{}).then(this.showPickAllSuccessMessage.bind(this))},showPickAllSuccessMessage:function(){var i=this;if(this.uiIsStagingLocationAssigned()||!this.ui.isStagingLocationRuleEnabled){u.showSuccessMessage(l.translate("backroomPick.MSG_AllPickedSuccessfully")).then(function(e){if(e=="OK"){i.refreshProductListByView()}})}else{u.showConfirmationMessage(l.translate("backroomPick.MSG_AllPickedSuccessfullyAssignStagingLoc")).then(function(e){if(e==="YES"){i.uiOpenAssignStagingLocationPopup()}i.refreshProductListByView()})}},refreshProductListByView:function(){var e={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};var i="getPickableShipmentLineList";r.callMashup(this,i,e,{}).then(this.handleRefreshProductList.bind(this,i))},handleRefreshProductList:function(e,i){this.model.shipmentLineList=r.getMashupOutput(i,e);this._isInitSelection=true;this.ui.focusOnFirstLine=true;this.setPickableShipmentLineCount(this.model.shipmentLineList)},uiFinishPick:function(){var e=s.backroomPickForm.$dirty;var i=this;if(e){u.showConfirmationMessage(l.translate("globals.MSG_Screen_dirty")).then(function(e){if(e==="YES"){i.validateShipmentForPickComplete()}})}else{this.validateShipmentForPickComplete()}},isShipmentPickComplete:function(e){if(e&&e.ShipmentLines&&e.ShipmentLines.TotalNumberOfRecords){var i=Number(e.ShipmentLines.TotalNumberOfRecords);if(i==0){this.showPickAllSuccessMessage()}}},validateShipmentForPickComplete:function(){var e={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,ShipmentDeliveryMethod:this.model.shipmentDetails.Shipment.DeliveryMethod}};r.callMashup(this,"validateShipmentForPickComplete",e,{}).then(this.processShipmentForPickComplete.bind(this))},processShipmentForPickComplete:function(e){var i=this;var t=r.getMashupOutput(e,"validateShipmentForPickComplete");if(t&&t.ShipmentLines&&t.ShipmentLines.ShipmentValidationStatus){var n=t.ShipmentLines.ShipmentValidationStatus;if(n=="pickComplete"){o.finishWizard()}else if(n=="shipmentCancelled"){this.showShipmentCancelledPopup()}else if(n=="pickNotComplete"){u.showConfirmationMessage(l.translate("backroomPick.MSG_NotAllLinesPicked")).then(function(e){if(e==="YES"){o.closeWizard()}})}}},showShipmentCancelledPopup:function(){u.showWarningMessage(l.translate("backroomPick.MSG_OrderWillBeCancelled")).then(function(e){if(e=="OK"){o.finishWizard()}})},uiSelectShipmentLine:function(e){this.ui.selectedShipmentLineKey=e.ShipmentLineKey;this.uiStampBackoomPickQuantityAttrs(e);this.ui.currentlySelectedShipmentLine=e;this.ui.focusOnFirstLine=false;this._isInitSelection=false},uiIsStagingLocationAssigned:function(){return this.model.shipmentDetails.Shipment&&this.model.shipmentDetails.Shipment.HoldLocation!=null&&this.model.shipmentDetails.Shipment.HoldLocation!=""&&this.model.shipmentDetails.Shipment.HoldLocation!=undefined},uiGetDisplayStagingLocation:function(){if(!this.uiIsStagingLocationAssigned()){return l.translate("globals.LABEL_None")}else{return this.model.shipmentDetails.Shipment.HoldLocation}},uiOpenAssignStagingLocationPopup:function(){var i=this;var e={};e.shipment=this.model.shipmentDetails;var t={modalInput:function(){return e}};u.openModal("store.views.shipment.common.staging-location.staging-location",t,{}).then(function(e){if(e.data!==null&&e.data!==undefined){i.postStagingLocationAssignment.call(i,e.data)}})},postStagingLocationAssignment:function(e){this.model.shipmentDetails.Shipment.HoldLocation=e.StagingLocation},uiOpenItemDetails:function(e){p.openProductDetail(e)},uiDecreaseQty:function(e){var i=Number(e.EditableBackroomPickedQuantity);var t=i-this.ui.ONE_QUANTITY;if(t<0){u.showErrorMessage(l.translate("backroomPick.MSG_NegativeQtyError"))}this.invokeMashupForPickedQuantityUpdate("updatePickQtyForShipmentLine",this.getChangeShipmentInputForPickQuantityUpdate(t,e))},uiIncreaseQty:function(e){var i=Number(e.EditableBackroomPickedQuantity);var t=i+this.ui.ONE_QUANTITY;var n=Number(e.Quantity);if(t>n){u.showErrorMessage(l.translate("backroomPick.MSG_MaxQuantityError"))}this.invokeMashupForPickedQuantityUpdate("updatePickQtyForShipmentLine",this.getChangeShipmentInputForPickQuantityUpdate(t,e))},getChangeShipmentInputForPickQuantityUpdate:function(e,i){var t={Shipment:{ShipmentLines:{ShipmentLine:[]}}};t.Shipment.ShipmentKey=this.model.shipmentDetails.Shipment.ShipmentKey;t.Shipment.ShipmentLines.ShipmentLine[0]={};t.Shipment.ShipmentLines.ShipmentLine[0].ShipmentLineKey=i.ShipmentLineKey;t.Shipment.ShipmentLines.ShipmentLine[0].BackroomPickedQuantity=e;return t},postPickQuantityUpdate:function(e){var i=r.getMashupOutput(e,"updatePickQtyForShipmentLine");var t=r.getMashupOutput(e,"getRemainingShipmentLinesCountToBePicked");this.isShipmentPickComplete(t);this.updateShipmentLineListModel(i.Shipment);this.resetData()},uiOpenRecordShortagePopup:function(i){var t=this;var e={};e.codeType="YCD_PICK_SHORT_RESOL";e.shipmentLine=angular.copy(i);e.shipmentLine.DisplayQty=i.BackroomPickedQuantity;e.shipmentLine.DisplayTotalQty=i.OriginalQuantity;e.shipmentLine.OrderLine=i.OrderLine;e.shipmentLine.DisplayShortQty=Number(i.OriginalQuantity)-Number(i.BackroomPickedQuantity);var n={modalInput:function(){return e}};u.openModal("store.views.shipment.common.record-shortage.record-shortage",n,{}).then(function(e){if(e.data!==null&&e.data!==undefined){t.recordShortageForShipment.call(t,e.data,i)}})},recordShortageForShipment:function(e,i){var t=[];var n={Shipment:{ShipmentLines:{ShipmentLine:[]}}};n.Shipment.ShipmentKey=this.model.shipmentDetails.Shipment.ShipmentKey;n.Shipment.ShipmentLines.ShipmentLine[0]={};n.Shipment.ShipmentLines.ShipmentLine[0].ShipmentLineKey=i.ShipmentLineKey;n.Shipment.ShipmentLines.ShipmentLine[0].OrderLineKey=i.OrderLineKey;n.Shipment.ShipmentLines.ShipmentLine[0].OrderHeaderKey=i.OrderHeaderKey;n.Shipment.ShipmentLines.ShipmentLine[0].DocumentType=i.DocumentType;if(e.RecordShortage.ShortageReasonCode=="AllInventoryShortage"){n.Shipment.ShipmentLines.ShipmentLine[0].Quantity=i.BackroomPickedQuantity}else{n.Shipment.ShipmentLines.ShipmentLine[0].Quantity=i.Quantity}n.Shipment.ShipmentLines.ShipmentLine[0].ShortageQty=Number(i.OriginalQuantity)-Number(i.BackroomPickedQuantity);n.Shipment.ShortageReasonCode=e.RecordShortage.ShortageReasonCode;t.push(r.getMashupRefObj(this,"recordShortageForShipment",n));t.push(r.getMashupRefObj(this,"getRemainingShipmentLinesCountToBePicked",{ShipmentLine:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}));r.callMashups(this,t,{}).then(this.postRecordShortageForShipment.bind(this),angular.noop)},postRecordShortageForShipment:function(e){var i=r.getMashupOutput(e,"recordShortageForShipment");this.updateShipmentLineListModel(i.Shipment);var t=i.Shipment.Status;if(t.indexOf("9000")>-1){this.showShipmentCancelledPopup()}else{var n=r.getMashupOutput(e,"getRemainingShipmentLinesCountToBePicked");this.isShipmentPickComplete(n)}this.resetData()},uiGetNextShipmentLineRecords:function(){if(this.ui.recordShownCount<=this.model.shipmentLineList.ShipmentLines.ShipmentLine.length){this.ui.recordShownCount+=5}},uiShipmentLineScrollActionValidator:function(){return true},gotoShipmentSummary:function(){t.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}},{})},uiOnQuantityFieldFocus:function(e,i){var t="";if(this.ui.currentlySelectedShipmentLine.ShipmentLineKey==this.model.shipmentLineList.ShipmentLines.ShipmentLine[0].ShipmentLineKey){this._isInitSelection=false}if(s.backroomPickForm.$valid)t=h.NUMBER_FORMATS;var n=i.EditableBackroomPickedQuantity;if(n){n=n.replace(t.GROUP_SEP,"")}if(i.showQtyUpdate!=="Y"){e.oldQty=n}},uiValidateQuantity:function(e,i,t,n){if(!iscCore.isVoid(i)&&i.iscDatatypeValidator)return e;else var s=!isNaN(n);if(!iscCore.isBooleanTrue(s)||iscCore.isVoid(n)){e.booleanResponse=!isNaN(n)&&!iscCore.isVoid(n);e.errorMesssage=l.translate("globals.ERROR_invalid_input")}else if(!this._isInitSelection){var o=Number(this.ui.currentlySelectedShipmentLine.Quantity);if(Number(t)>o){e.booleanResponse=false;e.errorMesssage=l.translate("backroomPick.MSG_MaxQuantityError")}}return e},uiShowUpdateButton:function(e,i){var t=h.NUMBER_FORMATS;var n=i.EditableBackroomPickedQuantity;if(n)n=n.replace(t.GROUP_SEP,"");if(!iscCore.isVoid(n)&&e.oldQty!==n&&Number(i.BackroomPickedQuantity)!=Number(i.EditableBackroomPickedQuantity))i.showQtyUpdate="Y";else i.showQtyUpdate="N"},uiHideUpdateButton:function(e){e.showQtyUpdate="N"},uiValidateQuantityAndUpdate:function(e,i){var t=this;var n=h.NUMBER_FORMATS;var s=i.EditableBackroomPickedQuantity;if(s){s=s.replace(n.GROUP_SEP,"")}if(!iscCore.isVoid(s)&&e.oldQty!==s&&Number(i.EditableBackroomPickedQuantity)!=Number(i.BackroomPickedQuantity)){e.oldQty=s;if(typeof s=="string"){s=parseInt(s,10)}this.invokeMashupForPickedQuantityUpdate("updatePickQtyForShipmentLine",this.getChangeShipmentInputForPickQuantityUpdate(s,i))}},invokeMashupForPickedQuantityUpdate:function(e,i){var t=[];t.push(r.getMashupRefObj(this,e,i));t.push(r.getMashupRefObj(this,"getRemainingShipmentLinesCountToBePicked",{ShipmentLine:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}));r.callMashups(this,t,{}).then(this.postPickQuantityUpdate.bind(this),angular.noop)},handleWizardExit:function(){return this.checkForScreenDirtyBeforeClose("exit")}})}]);
angular.module("store").controller("store.views.shipment.backroom-pick.wizard.backroom-pick-finish",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscModal","iscI18n","iscState",function(e,i,t,a,s,n,o,h,m){t.initializeWizardPage(e,{model:{shipmentDetails:{}},mashupRefs:[{mashupRefId:"getSingleProcessPickPackRuleDetails",mashupId:"store.views.shipment.backroom-pick.getSingleProcessPickPackRuleDetails"},{mashupRefId:"getShipmentDetails",mashupId:"store.views.shipment.backroom-pick.getShipmentDetails"}],ui:{hasPermissionForPack:s.hasPermission("WSC000062")},initialize:function(){if(t.getWizardAction()==="FINISH"){var e=[];this.model.shipmentDetails=t.getWizardModel("shipmentDetails");if(this.ui.hasPermissionForPack){var i={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};e.push(a.getMashupRefObj(this,"getShipmentDetails",i));e.push(a.getMashupRefObj(this,"getSingleProcessPickPackRuleDetails",{}));a.callMashups(this,e,{}).then(this.processShipmentForPack.bind(this))}else{this.gotoShipmentSummary()}}else if(t.getWizardAction()==="CLOSE"){m.goToPreviousState()}},processShipmentForPack:function(e){var i=a.getMashupOutput(e,"getShipmentDetails");var t=a.getMashupOutput(e,"getSingleProcessPickPackRuleDetails");var s=this;if(i.Shipment.Status.Status.indexOf("1100.70.06.50")>-1&&t.Rules.RuleSetValue=="Y"){o.showConfirmationMessage(h.translate("backroomPick.MSG_Pack_Shipment_Now")).then(function(e){if(e==="YES"){s.openPackFlow(i)}else{s.gotoShipmentSummary()}})}else{this.gotoShipmentSummary()}},openPackFlow:function(e){m.goToState("containerpack",{input:{Shipment:{ShipmentKey:e.Shipment.ShipmentKey}}},{})},gotoShipmentSummary:function(){var e={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};m.goToState("shipmentsummary",{input:e},{})}})}]);
angular.module("store").controller("store.views.shipment.backroom-pick.wizard.backroom-pick-init",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscModal","iscI18n","iscState","$filter","iscStateParams",function(i,e,t,a,n,s,o,h,r,m){t.initializeWizardPage(i,{model:{shipmentDetails:{}},mashupRefs:[{mashupRefId:"validateShipmentForBackroomPick",mashupId:"store.views.shipment.backroom-pick.ValidateShipmentForBackroomPick"},{mashupRefId:"startOverShipmentForBackroomPick",mashupId:"store.views.shipment.backroom-pick.handleInProgressShipment"},{mashupRefId:"continueShipmentForBackroomPick",mashupId:"store.views.shipment.backroom-pick.handleInProgressShipment"},{mashupRefId:"removeShipmentFromBatch",mashupId:"store.views.shipment.backroom-pick.handleInProgressShipment"},{mashupRefId:"changeShipmentStatusToPickingInProgress",mashupId:"store.views.shipment.backroom-pick.changeShipmentStatusToPickingInProgress"},{mashupRefId:"assignShipmentToLoggedInUser",mashupId:"store.views.shipment.backroom-pick.assignShipmentToLoggedInUser"}],ui:{hasPermissionForBOPISPick:n.hasPermission("WSC000057"),hasPermissionForSFSPick:n.hasPermission("WSC000058")},initialize:function(){var i=m.params.input;i={Shipment:{ShipmentKey:i.Shipment.ShipmentKey,Action:"BackroomPick"}};a.callMashup(this,"validateShipmentForBackroomPick",i,{}).then(this.processShipmentDetailsForBackroomPick.bind(this))},processShipmentDetailsForBackroomPick:function(i){var e=a.getMashupOutput(i,"validateShipmentForBackroomPick");this.model.shipmentDetails=e;if(e.Shipment.Error){this.handleShipmentValidationError(e)}else if(this.hasPermissionForPick()){this.changeShipmentStatusAndAssignToUser()}},hasPermissionForPick:function(){var i=this.model.shipmentDetails.Shipment.DeliveryMethod;if(i&&i=="PICK"&&this.ui.hasPermissionForBOPISPick){return true}else if(i&&i=="SHP"&&this.ui.hasPermissionForSFSPick){return true}this.gotoShipmentSummary()},changeShipmentStatusAndAssignToUser:function(){var i=[];var e=this.model.shipmentDetails.Shipment.Status.indexOf("1100.70.06.20")>-1;var t=this.getChangeShipmentStatusInput();if(!e){i.push(a.getMashupRefObj(this,"changeShipmentStatusToPickingInProgress",t))}if(!this.model.shipmentDetails.Shipment.AssignedToUserId){i.push(a.getMashupRefObj(this,"assignShipmentToLoggedInUser",{Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}))}if(i.length>0)a.callMashups(this,i,{isMultiAPICall:true}).then(this.afterChangeShipmentStatus.bind(this),angular.noop);else this.gotoWizardFirstPage()},getChangeShipmentStatusInput:function(){var i={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};if(this.isTransferOrderShipment()){i.Shipment.TransactionId="YCD_BACKROOM_PICK_IN_PROGRESS.0006"}return i},isTransferOrderShipment:function(){return this.model.shipmentDetails.Shipment.DocumentType=="0006"?true:false},afterChangeShipmentStatus:function(i){this.gotoWizardFirstPage()},gotoWizardFirstPage:function(){t.startCustomWizard("pick-products",this.model.shipmentDetails,{})},gotoShipmentSummary:function(){var i={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};h.goToState("shipmentsummary",{input:i},{})},closeBackroomPickWizard:function(){t.setWizardModel("shipmentDetails",this.model.shipmentDetails);t.closeWizard()},handleShipmentValidationError:function(i){var e=i.Shipment.Error.ErrorDescription;var t=i.Shipment.Error.action;if(e=="AssignedToUserIsDifferent"){this.openAssingedToDifferentUserPopup(i)}else if(e=="ShipmentIncludedInBatch"){this.openShipmentPickedInBatchPopup(i)}else if(e=="InvalidShipmentShipNode"||e.indexOf("InvalidTransactionAllowed_")>-1){this.showCustomErrorModal(o.translate("backroomPick.MSG_"+e),i)}},showCustomErrorModal:function(i,e){var t=this;var n={options:{headerText:"modal.TITLE_Error",headerIconCss:"app-glyphicons app-icon-error_30",action:[{actionName:"goBack",actionLabel:"backroomPick.ACTION_GoBack"},{actionName:"gotoSummary",actionLabel:"backroomPick.ACTION_GotoShipmentSummary"}]},settings:{size:"md",type:"error"}};s.showConfirmationMessage(i,n).then(function(i){if(i=="goBack"){t.closeBackroomPickWizard()}else if(i=="gotoSummary"){t.gotoShipmentSummary()}})},openShipmentPickedInBatchPopup:function(i){var e=this;var t={};t.shipmentDetails=i;var n={modalInput:function(){return t}};s.openModal("store.views.shipment.backroom-pick.common.shipment-in-batch.shipment-in-batch",n,{}).then(function(i){if(i.data!==null&&i.data!==undefined){e.handleShipmentPickedInBatchPopupResponse(i.data)}},function(){e.closeBackroomPickWizard()})},handleShipmentPickedInBatchPopupResponse:function(i){var e={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,Action:"STARTOVER_FROM_BATCH_PICK",StoreBatchList:{StoreBatch:[]}}};var t=this;if(i=="START_OVER"){if(!iscCore.isVoid(this.model.shipmentDetails)&&!iscCore.isVoid(this.model.shipmentDetails.Shipment)&&!iscCore.isVoid(this.model.shipmentDetails.Shipment.StoreBatchList)&&!iscCore.isVoid(this.model.shipmentDetails.Shipment.StoreBatchList.TotalNumberOfRecords)){var n=r("number")(this.model.shipmentDetails.Shipment.StoreBatchList.TotalNumberOfRecords);if(n>0){for(var s=0;s<n;s++){var o=this.model.shipmentDetails.Shipment.StoreBatchList.StoreBatch[s];e.Shipment.StoreBatchList.StoreBatch[s]={};e.Shipment.StoreBatchList.StoreBatch[s].StoreBatchKey=o.StoreBatchKey}}}console.log("shipmentInput - ",e);a.callMashup(this,"removeShipmentFromBatch",e,{}).then(function(i){t.gotoWizardFirstPage()})}},openAssingedToDifferentUserPopup:function(i){var e=this;var t={};t.shipmentDetails=i;t.flowName="BACKROOM_PICK";var n={modalInput:function(){return t}};s.openModal("store.views.shipment.common.abandon-shipment.abandon-shipment",n,{}).then(function(i){if(i.data!==null&&i.data!==undefined){e.handleAbandonShipmentPopupResponse(i.data)}},function(){e.closeBackroomPickWizard()})},handleAbandonShipmentPopupResponse:function(i){var e={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};var t=this;var n="";if(i=="START_OVER"){e.Shipment.Action="STARTOVER";n="startOverShipmentForBackroomPick"}else if(i=="CONTINUE"){e.Shipment.Action="CONTINUE";n="continueShipmentForBackroomPick"}a.callMashup(this,n,e,{}).then(function(i){t.gotoWizardFirstPage()})}})}]);
angular.module("store").controller("store.views.shipment.batchpick.batch-list.batch-list",["$scope","$rootScope","iscScreen","iscWizard","iscStateParams","iscMashup","iscModal","iscResourcePermission","iscI18n","iscAppContext","iscState","iscRule","iscShipment",function(t,e,a,i,s,o,n,c,r,h,l,u,g){i.initializeWizardPage(t,{model:{batchlist:{}},mashupRefs:[{mashupRefId:"getBatchList",mashupId:"store.views.shipment.batchpick.batch-list.getBatchListForStore"},{mashupRefId:"createStoreBatch",mashupId:"store.views.shipment.batchpick.createStoreBatch"},{mashupRefId:"assignBatchToLoginUserId",mashupId:"store.views.shipment.batchpick.batch-list.assignBatchToLoginUserId"}],ui:{recordShownCount:h.isMobile()?16:20,apiPageSize:h.isMobile()?16:20,searchInProgress:false,filterOptionImgPath:g.getFullURLForImage("wsc/resources/css/icons/images/filterBy_blueOn.png"),configureImgPath:g.getFullURLForImage("wsc/resources/css/icons/images/config_blue.png"),showfilter:false},initialize:function(){var t=i.getWizardPageInput();this.ui.configureImgPath=g.getFullURLForImage("wsc/resources/css/icons/images/config_blue.png");var e={StoreBatch:{PageSize:this.ui.apiPageSize}};this.callGetBatchList(e)},callGetBatchList:function(t){o.callMashup(this,"getBatchList",t,{}).then(function(t){var e=o.getMashupOutput(t,"getBatchList");this.handleGetBatchListPaginatedOutput(e,false)}.bind(this),angular.noop)},uiGetNextRecords:function(){var t=this.model.batchlist.Page.Output.StoreBatchList;var e=t.StoreBatch.length;console.log("actualRecordsInModel="+e);if(e-this.ui.recordShownCount>=this.ui.pageSize){this.ui.recordShownCount+=this.ui.pageSize;console.log("Using existing model - doing client side pagination")}else{if(this.model.batchlist.Page.IsLastPage!="Y"){var a=Number(this.model.batchlist.Page.PageNumber);var i={StoreBatch:{PageNumber:a+1,PageSize:this.ui.apiPageSize,PreviousPage:{PageNumber:a,StoreBatch:{StoreBatchKey:t.StoreBatch[e-1].StoreBatchKey,BatchNo:t.StoreBatch[e-1].BatchNo}}}};console.log("calling API with input="+i);this.ui.searchInProgress=true;o.callMashup(this,"getBatchList",i,"NEXT",{}).then(function(t){var e=o.getMashupOutput(t,"getBatchList");this.handleGetBatchListPaginatedOutput(e,true);this.ui.searchInProgress=false}.bind(this),angular.noop)}else{this.ui.recordShownCount=e}}},uiNextPageActionValidator:function(){if(!this.ui.searchInProgress){return true}else if(this.ui.searchInProgress){return false}},handleGetBatchListPaginatedOutput:function(t,e){this.ui.searchInProgress=false;if(e){var a=t.Page.Output.StoreBatchList.StoreBatch;for(var i=0;i<a.length;i++){this.model.batchlist.Page.Output.StoreBatchList.StoreBatch.push(a[i])}this.model.batchlist.Page.PageNumber=t.Page.PageNumber;this.model.batchlist.Page.IsLastPage=t.Page.IsLastPage;this.uiGetNextRecords()}else{this.model.batchlist=t;this.updateFilterImage();console.log(t)}this.massageBatchList();this.ui.showfilter=true},massageBatchList:function(){var t=this.model.batchlist;var e=this.model.batchlist.Page.Output.StoreBatchList.StoreBatch;var a={};for(var i=0;i<e.length;i++){a=e[i];if(!iscCore.isVoid(a.DepartmentDisplayDesc)&&a.DepartmentDisplayDesc.lastIndexOf(",")!=-1){a.uiDepartmentDisplayDesc="MULTIPLE"}else{a.uiDepartmentDisplayDesc=a.DepartmentDisplayDesc}}},uiCancel:function(){i.exitWizard()},handleWizardBack:function(){i.closeWizard()},handleWizardExit:function(){i.exitWizard()},uiGetSLAStyling:function(t){if(!iscCore.isVoid(t)&&t.lastIndexOf("/")!=-1){var e=t.substring(t.lastIndexOf("/")+1,t.indexOf("."));if(!iscCore.isVoid(e)){console.log("cssClass="+e);return e}}},updateFilterImage:function(){var t=this.model.batchlist.Page.Output.StoreBatchList.FilterOptions;if(t.Picked=="Y"&&t.InProgress=="Y"&&t.NotStarted=="Y"){this.ui.filterOptionImgPath=g.getFullURLForImage("wsc/resources/css/icons/images/filterBy_blue.png")}else{this.ui.filterOptionImgPath=g.getFullURLForImage("wsc/resources/css/icons/images/filterBy_blueOn.png")}},uiOpenFilterPopup:function(){var e=this;var t={FilterOptions:{}};t.FilterOptions=this.model.batchlist.Page.Output.StoreBatchList.FilterOptions;var a={modalInput:function(){return t}};n.openModal("store.views.shipment.batchpick.batch-list.filter.batch-list-filter",a,{}).then(function(t){if(t.data!==null&&t.data!==undefined){e.applyBatchListFilter.call(e,t.data)}},angular.noop)},uiApplyBatchListFilter:function(t){var e={StoreBatch:{}};e.StoreBatch.Picked=t.FilterOptions.Picked;e.StoreBatch.InProgress=t.FilterOptions.InProgress;e.StoreBatch.NotStarted=t.FilterOptions.NotStarted;e.StoreBatch.PageSize=this.ui.apiPageSize;this.callGetBatchList(e)},uiOpenConfigurePopup:function(){var e=this;var t={};var a={modalInput:function(){return t}};n.openModal("store.views.shipment.batchpick.batch-list.pref.batch-list-preferences",a,{}).then(function(t){n.showInfoMessage(r.translate("batchpick.MSG_ChangeConfigOptions"));e.applyBatchListPreferences.call(e)},angular.noop)},applyBatchListPreferences:function(){var t={StoreBatch:{}};t.StoreBatch.PageSize=this.ui.apiPageSize;this.callGetBatchList(t)},uiPickBatch:function(t){if(r.translate("batchpick.BATCH_DRAFTED")===t.Status){var e={};e.StoreBatch={};e.StoreBatch.ShipmentLines=t.ShipmentLines;e.StoreBatch.StoreBatchConfigList=t.StoreBatchConfigList;o.callMashup(this,"createStoreBatch",e,{}).then(this.handleCreateStoreBatchApiOutput.bind(this),angular.noop)}},handleCreateStoreBatchApiOutput:function(t){var e=o.getMashupOutput(t,"createStoreBatch");e.callBatchListApi="N";if(e.StoreBatch.BatchType=="SORT_WHILE_PICK"){i.gotoCustomPage("swpPicking",e,{})}else if(e.StoreBatch.BatchType=="SORT_AFTER_PICK"){i.gotoCustomPage("sapPicking",e,{})}},uiContinueBatch:function(e){var a=h.getFromContext("currentLoginID");if(e.AssignedToUserId!=a){var i=this;var t=r.translate("batchpick.MSG_BatchAssignedToUser",{loginid:e.AssignedToUserId});n.showConfirmationMessage(t).then(function(t){if(t==="YES"){i.changeBatchOwner(e,a)}else if(t==="NO"){}},function(t){})}else this.openContinueBatch(e)},changeBatchOwner:function(a,t){var e={StoreBatch:{StoreBatchKey:a.StoreBatchKey,AssignedToUserId:t}};o.callMashup(this,"assignBatchToLoginUserId",e,{}).then(function(t){var e=o.getMashupOutput(t,"assignBatchToLoginUserId");this.openContinueBatch(a)}.bind(this),angular.noop)},openContinueBatch:function(t){if(r.translate("batchpick.BATCH_OPEN")===t.Status){t.callBatchListApi="Y";if(t.BatchType=="SORT_WHILE_PICK"){i.gotoCustomPage("swpPicking",t,{})}else{i.gotoCustomPage("sapPicking",t,{})}}else if(r.translate("batchpick.BATCH_PICK_COMPLETE_NOT_STAGED")===t.Status&&u.getRuleSetValue("enableStagingLocation")=="Y"){var e={StoreBatch:{StoreBatchKey:t.StoreBatchKey,BatchNo:t.BatchNo}};if(t.BatchType=="SORT_WHILE_PICK"){i.gotoCustomPage("swpStaging",e,{})}else{i.gotoCustomPage("sapStaging",e,{})}}},uiOpenDepartmentModal:function(t){var e=this;var a={DepData:{}};a.DepData.Departments=t.DepartmentDisplayDesc;a.DepData.BatchNo=t.BatchNo;var i={modalInput:function(){return a}};n.openModal("store.views.shipment.batchpick.batch-list.departments.batch-list-departments",i,{}).then(function(t){},angular.noop)}})}]);
angular.module("store").controller("store.views.shipment.batchpick.sap-picking.sap-picking",["$scope","$rootScope","iscScreen","iscWizard","$timeout","$filter","$locale","iscMashup","iscResourcePermission","iscDomUtility","iscModal","iscI18n","iscScrollUtility","iscRule","iscShipment","iscStateParams","iscAppContext",function(t,e,i,a,n,o,r,c,s,h,l,u,p,B,d,f,S){a.initializeWizardPage(t,{model:{getStoreBatchDetails:{},filtermodel:{}},mashupRefs:[{mashupRefId:"getStoreBatchDetails",mashupId:"store.views.shipment.batchpick.getStoreBatchDetails"},{mashupRefId:"registerBatchPickManualMode",mashupId:"store.views.shipment.batchpick.sap-picking.registerBatchPickManualMode"},{mashupRefId:"registerBatchPickScanMode",mashupId:"store.views.shipment.batchpick.sap-picking.registerBatchPickScanMode"},{mashupRefId:"recordShortageForBatchPick",mashupId:"store.views.shipment.batchpick.sap-picking.recordShortageForBatchPick"},{mashupRefId:"finishBatch",mashupId:"store.views.shipment.batchpick.sap-picking.finishBatch"}],ui:{recordShownCount:5,selectedBatchLine:{},batchLineFilter:"N",focusOnFirstLine:true,filteredItems:[],filteredItemsLength:0},initialize:function(){var t=a.getWizardPageInput();if(t.callBatchListApi==="N"){this.model.getStoreBatchDetails=t;this.getBatchLineSizeAfterFilterApply()}else{var e={StoreBatch:{StoreBatchKey:t.StoreBatchKey}};c.callMashup(this,"getStoreBatchDetails",e,{}).then(this.handleInitApiCalls.bind(this),angular.noop)}this.initializefilterModel()},handleWizardBack:function(){var t=a.isFirstPage();if(t){confirmationMsg=u.translate("batchpick.WarningMessage_Cancel");l.showConfirmationMessage(confirmationMsg).then(function(t){if(t==="YES"){a.closeWizard()}});return true}else if(!t){confirmationMsg=u.translate("batchpick.WarningMessage_Cancel");l.showConfirmationMessage(confirmationMsg).then(function(t){if(t==="YES"){a.gotoPreviousPage(true)}});return true}else{return false}},getBatchLineSizeAfterFilterApply:function(){if(this.ui.batchLineFilter=="N"){var t=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.StoreBatchLine;var e=0;for(var i=0;i<t.length;i++){if(t[i].BackroomPickComplete=="N"){e++}}this.ui.filteredItemsLength=e}else{this.ui.filteredItemsLength=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.TotalNumberOfRecords}},uiGetNextBatchLineRecords:function(){if(this.ui.recordShownCount<=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.StoreBatchLine.length){this.ui.recordShownCount+=5}},initializefilterModel:function(){if(this.ui.batchLineFilter=="N"){this.model.filtermodel.filter="IN_PROGRESS"}else{this.model.filtermodel.filter="ALL"}},handleInitApiCalls:function(t){var e=c.getMashupOutput(t,"getStoreBatchDetails");h.setFocus(document.getElementById("productScanInput"));this.model.getStoreBatchDetails=e;this.getBatchLineSizeAfterFilterApply();this.checkBatchStatus()},checkBatchStatus:function(){var e=this;if(this.model.getStoreBatchDetails.StoreBatch.Status=="2000"){var t=B.getRuleSetValue("enableStagingLocation");if(t=="Y"){var i={options:{action:[{actionName:"YES",actionLabel:"batchpick.ACTION_AssignStaging"},{actionName:"NO",actionLabel:"batchpick.ACTION_Finish"}]}};l.showConfirmationMessage(u.translate("batchpick.MSG_AllBatchLinesPicked"),i).then(function(t){if(t==="YES"){e.uiGotoAssignStaging()}else if(t==="NO"){e.finishBatch()}},function(t){})}else{var i={options:{action:[{actionName:"YES",actionLabel:"batchpick.ACTION_Finish"}]}};l.showConfirmationMessage(u.translate("batchpick.MSG_AllBatchLinesPicked"),i).then(function(t){if(t==="YES"){e.finishBatch()}},function(t){})}}else if(this.model.getStoreBatchDetails.StoreBatch.Status=="9000"){l.showInfoMessage(u.translate("batchpick.MSG_BatchCancelled")).then(function(t){if(f.params.action==="batchList"){a.gotoCustomPage("batchList",{},{})}else if(f.params.action==="skipbatchList"){a.closeWizard()}})}},uiGotoAssignStaging:function(){var t={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}};a.gotoCustomPage("sapStaging",t,{})},finishBatch:function(){var t={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}};c.callMashup(this,"finishBatch",t,{}).then(function(t){this.gotoBatchList()}.bind(this),angular.noop)},gotoBatchList:function(){if(f.params.action==="batchList"){a.gotoCustomPage("batchList",{},{})}else if(f.params.action==="skipbatchList"){a.closeWizard()}},uiGetBatchLineTrackBy:function(t){return t.ItemDetails.ItemID+t.ItemDetails.UnitOfMeasure},uiSelectBatchLine:function(t){this.ui.selectedBatchLine=this.uiGetBatchLineTrackBy(t);this.ui.focusOnFirstLine=false},uiScanItem:function(t){if(iscCore.isVoid(t)){l.showErrorMessage(u.translate("batchpick.MSG_NoProductScanned"))}else{var e={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey,BarCode:{BarCodeData:t}}};c.callMashup(this,"registerBatchPickScanMode",e,{}).then(function(t){this.handleRegisterBatchPickScanOutput(t)}.bind(this),this.handleRegisterBatchPickErrors.bind(this))}},handleRegisterBatchPickErrors:function(t){if(t.Errors){var e=t.Errors.Error[0].ErrorDescription;var i=t.Errors.Error[0].ErrorCode;if(i=="YCD00093"){e=u.translate("apierror."+"YCD00093_pick");l.showErrorMessage(e,null,null)}else{if(u.hasKey("apierror."+i)){e=u.translate("apierror."+i);l.showErrorMessage(e,null,null)}else{l.showErrorMessage(e,null,null)}}}},handleRegisterBatchPickScanOutput:function(t){this.ui.barcodeData="";var e=c.getMashupOutput(t,"registerBatchPickScanMode");console.log(e);this.updateBatchLine(e)},updateBatchLine:function(t){this.model.getStoreBatchDetails.StoreBatch.Status=t.StoreBatch.Status;var e=t.StoreBatch.StoreBatchLine.ItemID;var i=t.StoreBatch.StoreBatchLine.UnitOfMeasure;var a=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.StoreBatchLine;for(var n=0;n<a.length;n++){if(a[n].ItemID==e&&a[n].UnitOfMeasure==i){a[n]=t.StoreBatch.StoreBatchLine;this.ui.focusOnFirstLine=false;this.ui.selectedBatchLine=this.uiGetBatchLineTrackBy(a[n]);if(a[n].BackroomPickComplete=="Y"&&this.ui.batchLineFilter=="N"){this.ui.filteredItemsLength-=1}break}}p.scrollToElementWIthOffsetAndFixedHeader(document.getElementById("batch-line-list"),document.getElementById(this.ui.selectedBatchLine),0,10,40);this.checkBatchStatus()},uiDecreaseQty:function(e){var t=e.ItemDetails.ItemID;var i=e.ItemDetails.UnitOfMeasure;var a={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey,Item:{ItemID:t,UnitOfMeasure:i,Action:"UNDOPICK"}}};var n=this;c.callMashup(this,"registerBatchPickManualMode",a,{}).then(function(t){console.log(e);this.handleRegisterBatchPickManualOutput(t)}.bind(this),angular.noop)},uiIncreaseQty:function(e){var t=e.ItemDetails.ItemID;var i=e.ItemDetails.UnitOfMeasure;var a={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey,Item:{ItemID:t,UnitOfMeasure:i,Action:"PICK"}}};var n=this;c.callMashup(this,"registerBatchPickManualMode",a,{}).then(function(t){console.log(e);this.handleRegisterBatchPickManualOutput(t)}.bind(this),angular.noop)},handleRegisterBatchPickManualOutput:function(t){var e=c.getMashupOutput(t,"registerBatchPickManualMode");console.log(e);this.updateBatchLine(e)},uiOpenFilterPopup:function(){var e=this;var t={};if(this.ui.batchLineFilter=="N"){t.filter="IN_PROGRESS"}else{t.filter="ALL"}var i={modalInput:function(){return t}};l.openModal("store.views.shipment.batchpick.common.filter.batch-line-filter",i,{}).then(function(t){if(t.data!==null&&t.data!==undefined){e.applyBatchListFilter.call(e,t.data)}},angular.noop)},uiApplyBatchListFilter:function(t){if(t.filter=="IN_PROGRESS"){this.ui.batchLineFilter="N"}else{this.ui.batchLineFilter=""}this.getBatchLineSizeAfterFilterApply();this.ui.selectedBatchLine={}},uiOpenRecordShortagePopup:function(e){var i=this;var t={};t.codeType="YCD_PICK_SHORT_RESOL";t.shipmentLine=angular.copy(e);t.shipmentLine.OrderLine={};t.shipmentLine.OrderLine.ItemDetails=t.shipmentLine.ItemDetails;t.shipmentLine.OrderLine.variation=t.shipmentLine.variation;t.shipmentLine.DisplayQty=e.BackroomPickedQuantity;t.shipmentLine.DisplayTotalQty=e.OriginalQuantity;t.shipmentLine.DisplayShortQty=Number(e.OriginalQuantity)-Number(e.BackroomPickedQuantity);var a={modalInput:function(){return t}};l.openModal("store.views.shipment.common.record-shortage.record-shortage",a,{}).then(function(t){if(t.data!==null&&t.data!==undefined){i.stampRecordShortage.call(i,t.data,e)}},angular.noop)},stampRecordShortage:function(t,e){var i=e.ItemDetails.ItemID;var a=e.ItemDetails.UnitOfMeasure;var n={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey,Item:{ItemID:i,UnitOfMeasure:a,ShortageReason:t.RecordShortage.ShortageReasonCode}}};c.callMashup(this,"recordShortageForBatchPick",n,{}).then(function(t){this.handleRecordShortage(t)}.bind(this),angular.noop)},uiCancel:function(){l.showConfirmationMessage(u.translate("batchpick.WarningMessage_Cancel")).then(function(t){if(t==="YES"){if(f.params.action==="batchList"){a.gotoCustomPage("batchList",{},{})}else if(f.params.action==="skipbatchList"){a.closeWizard()}}},function(t){})},uiOpenItemDetails:function(t){d.openProductDetail(t)},uiIsBackroomPickComplete:function(t){return t.BackroomPickComplete=="Y"?true:false},handleRecordShortage:function(t){var e=c.getMashupOutput(t,"recordShortageForBatchPick");console.log(e);if(e.StoreBatch.ItemRemovedFromBatch=="Y"){}var i=angular.copy(e);i.StoreBatch.StoreBatchLine=e.StoreBatch.StoreBatchLines.StoreBatchLine[0];delete i.StoreBatch.StoreBatchLines;this.updateBatchLine(i)}})}]);
angular.module("store").controller("store.views.shipment.batchpick.sap-staging.sap-staging",["$scope","$rootScope","iscScreen","iscWizard","$timeout","$filter","$locale","iscMashup","iscResourcePermission","iscDomUtility","iscModal","iscI18n","iscScrollUtility","iscAppContext","iscStateParams","iscShipment",function(t,e,i,a,r,n,o,h,s,l,c,u,g,S,d,p){a.initializeWizardPage(t,{model:{getStoreBatchDetails:{},currentBatchLine:{},stgLocScanRule:{},filtermodel:{}},mashupRefs:[{mashupRefId:"getStoreBatchDetails",mashupId:"store.views.shipment.batchpick.getStoreBatchDetails"},{mashupRefId:"getStagingLocForBatchLine",mashupId:"store.views.shipment.batchpick.sap-picking.getStagingLocForBatchLine"},{mashupRefId:"updateHoldLocation",mashupId:"store.views.shipment.batchpick.sap-picking.updateHoldLocation"},{mashupRefId:"translateBarCodeForItem",mashupId:"store.views.shipment.batchpick.sap-picking.translateBarCodeForItem"},{mashupRefId:"finishBatch",mashupId:"store.views.shipment.batchpick.sap-picking.finishBatch"},{mashupRefId:"getRuleDetailsForStgLocScan",mashupId:"store.views.shipment.batchpick.sap-picking.getRuleDetailsForStgLocScan",modelName:"stgLocScanRule"},{mashupRefId:"translateBarCodeForStagingLocation",mashupId:"store.views.shipment.batchpick.sap-picking.translateBarCodeForStagingLocation"}],ui:{recordShownCount:5,selectedBatchLine:{},batchLineFilter:"N",focusOnFirstLine:true,showSelectedItem:false,showStagingLocScanButton:false,filteredItems:[],filteredItemsLength:0,focusOnScanField:true},initialize:function(){var t=a.getWizardPageInput();var e={StoreBatch:{StoreBatchKey:t.StoreBatch.StoreBatchKey}};var i=[];i.push(h.getMashupRefObj(this,"getStoreBatchDetails",e));i.push(h.getMashupRefObj(this,"getRuleDetailsForStgLocScan",{}));h.callMashups(this,i,{}).then(this.handleInitApiCalls.bind(this),angular.noop);this.initializefilterModel()},handleInitApiCalls:function(t){var e=h.getMashupOutput(t,"getStoreBatchDetails");this.model.getStoreBatchDetails=e;this.getBatchLineSizeAfterFilterApply();if(this.model.stgLocScanRule.Rules.RuleSetValue=="Y"){this.ui.showStagingLocScanButton=true}this.checkIfStagingComplete();r(function(){l.setFocus(document.getElementById("productScanInput"))},0)},getBatchLineSizeAfterFilterApply:function(){if(this.ui.batchLineFilter=="N"){var t=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.StoreBatchLine;var e=0;for(var i=0;i<t.length;i++){if(t[i].StagingComplete=="N"){e++}}this.ui.filteredItemsLength=e}else{this.ui.filteredItemsLength=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.TotalNumberOfRecords}},uiGetNextRecords:function(){if(this.ui.recordShownCount<=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.StoreBatchLine.length){this.ui.recordShownCount+=5}},initializefilterModel:function(){if(this.ui.batchLineFilter=="N"){this.model.filtermodel.filter="IN_PROGRESS"}else{this.model.filtermodel.filter="ALL"}},uiGotoAssignStaging:function(){var t={};a.gotoCustomPage("sapStaging",t,{})},uiFinishBatch:function(){var t=this.model.getStoreBatchDetails.StoreBatch.BatchStagingProcessComplete;var i=this;if(!iscCore.isVoid(t)&&t!="Y"){c.showConfirmationMessage(u.translate("batchpick.Warning_stg_assign_not_finished")).then(function(t){if(t==="YES"){var e={StoreBatch:{StoreBatchKey:i.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}};h.callMashup(i,"finishBatch",e,{}).then(function(t){i.gotoBatchList()}.bind(this),angular.noop)}},function(t){})}else{var e={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}};h.callMashup(this,"finishBatch",e,{}).then(function(t){this.gotoBatchList()}.bind(this),angular.noop)}},gotoBatchList:function(){if(d.params.action==="batchList"){a.gotoCustomPage("batchList",{},{})}else if(d.params.action==="skipbatchList"){a.closeWizard()}},uiGetBatchLineTrackBy:function(t){return t.ItemDetails.ItemID+t.ItemDetails.UnitOfMeasure},uiSelectBatchLine:function(t){this.ui.selectedBatchLine=this.uiGetBatchLineTrackBy(t);this.ui.focusOnFirstLine=false},uiScanItem:function(t){if(iscCore.isVoid(t)){c.showErrorMessage(u.translate("batchpick.MSG_NoProductScanned"))}else{var e={BarCode:{BarCodeData:t,StoreBatchContextualInfo:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}}};h.callMashup(this,"translateBarCodeForItem",e,{}).then(function(t){this.handleTranslateBarCodeForItemOutput(t)}.bind(this),this.handleTranslateBarCodeErrors.bind(this))}this.ui.focusOnScanField=true},handleTranslateBarCodeForItemOutput:function(t){this.ui.barcodeData="";var e=h.getMashupOutput(t,"translateBarCodeForItem");console.log(e);this.setCurrentBatchLine(e.BarCode.StoreBatch.StoreBatchLines.StoreBatchLine)},handleWizardBack:function(){var t=a.isFirstPage();if(t){confirmationMsg=u.translate("batchpick.WarningMessage_Cancel");c.showConfirmationMessage(confirmationMsg).then(function(t){if(t==="YES"){a.closeWizard()}});return true}else if(!t){confirmationMsg=u.translate("batchpick.WarningMessage_Cancel");c.showConfirmationMessage(confirmationMsg).then(function(t){if(t==="YES"){a.gotoPreviousPage(true)}});return true}else{return false}},handleTranslateBarCodeErrors:function(t){if(t.Errors){var e=t.Errors.Error[0].ErrorDescription;var i=t.Errors.Error[0].ErrorCode;if(i=="YCD00093"){e=u.translate("apierror."+"YCD00093");c.showErrorMessage(e,null,null)}else{if(u.hasKey("apierror."+i)){e=u.translate("apierror."+i);c.showErrorMessage(e,null,null)}else{c.showErrorMessage(e,null,null)}}}},uiOpenItemDetails:function(t){p.openProductDetail(t)},uiApplyBatchListFilter:function(t){if(t.filter=="IN_PROGRESS"){this.ui.batchLineFilter="N"}else{this.ui.batchLineFilter=""}this.getBatchLineSizeAfterFilterApply();this.ui.focusOnFirstLine=true;this.ui.selectedBatchLine={}},uiShowSelectedItem:function(t){var e=t.ItemID;var i=t.UnitOfMeasure;var a={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey,StoreBatchLine:{ItemID:e,UnitOfMeasure:i}}};h.callMashup(this,"getStagingLocForBatchLine",a,{}).then(function(t){this.handleGetStagingLocForBatchLine(t)}.bind(this),angular.noop);this.ui.focusOnScanField=false},handleGetStagingLocForBatchLine:function(t){var e=h.getMashupOutput(t,"getStagingLocForBatchLine");this.setCurrentBatchLine(e.StoreBatch.StoreBatchLines.StoreBatchLine[0])},setCurrentBatchLine:function(t){this.model.currentBatchLine.StoreBatchLine=t;console.log(this.model.currentBatchLine.StoreBatchLine);this.ui.showSelectedItem=true;if(!iscCore.isVoid(this.model.currentBatchLine.StoreBatchLine.HoldLocation)){this.ui.stagingLocationList={};this.ui.stagingLocationList.stagingLocation=[];var e=this.model.currentBatchLine.StoreBatchLine.HoldLocation.split(",");for(var i=0;i<e.length;i++){this.ui.stagingLocationList.stagingLocation[i]={};this.ui.stagingLocationList.stagingLocation[i].holdLocation=e[i]}}this.ui.stagingloc=this.model.currentBatchLine.StoreBatchLine.ShipmentLine.Shipment.SuggestedHoldLocation;r(function(){l.setFocus(document.getElementById("stgLocScanInput"),100)},510)},uiCancel:function(){this.ui.showSelectedItem=false;var t=null;if(this.ui.focusOnScanField){t="productScanInput"}else{t="assign"+this.model.currentBatchLine.StoreBatchLine.ItemDetails.ItemID+this.model.currentBatchLine.StoreBatchLine.ItemDetails.UnitOfMeasure}r(function(){l.setFocus(document.getElementById(t))},0)},uiScanOrSaveStagingLoc:function(t){if(this.ui.showStagingLocScanButton&&t!=this.model.currentBatchLine.StoreBatchLine.ShipmentLine.Shipment.SuggestedHoldLocation){this.uiScanStagingLoc(t)}else{this.saveStgLoc(t)}},saveStgLoc:function(t){if(!iscCore.isVoid(t)){var e=false;var i=this.model.currentBatchLine.StoreBatchLine;var a={Shipment:{ShipmentKey:i.ShipmentLine.ShipmentKey,StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey,ShipmentLines:{ShipmentLine:[{ShipmentLineKey:i.ShipmentLine.ShipmentLineKey,StagedQuantity:i.ShipmentLine.QuantityToBeStaged,ItemID:i.ItemID,UnitOfMeasure:i.UnitOfMeasure}]}}};var n=p.getHoldLocationArr(this.model.currentBatchLine.StoreBatchLine.ShipmentLine.Shipment.HoldLocation);if(p.isHoldLocationDuplicate(t,n)){}else{var o=p.appendHoldLocation(this.ui.stagingloc,n);var s=p.getHoldLocationString(o);if(s.length>40){c.showErrorMessage(u.translate("batchpick.MSG_InvalidHoldLocationLength"));e=true}a.Shipment.HoldLocation=s}if(!e){h.callMashup(this,"updateHoldLocation",a,{}).then(function(t){this.handleStagingLocationUpdate(t)}.bind(this),angular.noop)}}else{this.ui.showStagingLocMandatoryError=true}},handleStagingLocationUpdate:function(t){var e=h.getMashupOutput(t,"updateHoldLocation");var i=e.Shipment.StoreBatch.StoreBatchLines.StoreBatchLine;this.model.getStoreBatchDetails.StoreBatch.Status=e.Shipment.StoreBatch.Status;this.model.getStoreBatchDetails.StoreBatch.BatchStagingProcessComplete=e.Shipment.StoreBatch.BatchStagingProcessComplete;var a=i.ItemID;var n=i.UnitOfMeasure;var o=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.StoreBatchLine;for(var s=0;s<o.length;s++){if(o[s].ItemID==a&&o[s].UnitOfMeasure==n){o[s]=i;this.ui.focusOnFirstLine=false;this.ui.selectedBatchLine=this.uiGetBatchLineTrackBy(o[s]);if(o[s].StagingComplete=="Y"&&this.ui.batchLineFilter=="N"){this.ui.filteredItemsLength-=1}break}}this.ui.stagingloc="";this.ui.showSelectedItem=false;g.scrollToElementWIthOffsetAndFixedHeader(document.getElementById("staging-line-list"),document.getElementById(this.ui.selectedBatchLine),0,10,40);var c=null;if(this.ui.focusOnScanField){c="productScanInput"}else{c="assign"+a+n}r(function(){l.setFocus(document.getElementById(c))},0);this.checkIfStagingComplete()},uiScanStagingLoc:function(t){if(t!=this.model.currentBatchLine.StoreBatchLine.ShipmentLine.Shipment.SuggestedHoldLocation){if(iscCore.isVoid(t)){c.showErrorMessage(u.translate("batchpick.MSG_NoStaginLocationScanned"))}else{var e={BarCode:{BarCodeData:t}};h.callMashup(this,"translateBarCodeForStagingLocation",e,{}).then(function(t){this.handleStagingLocationBarcodeTranslation(t)}.bind(this),angular.noop)}}else{this.saveStgLoc(t)}},handleStagingLocationBarcodeTranslation:function(t){var e=h.getMashupOutput(t,"translateBarCodeForStagingLocation");if(e.BarCode.Translations.Translation){if(e.BarCode.Translations.Translation.length>1){c.showErrorMessage(u.translate("batchpick.MSG_MultipleHoldLocationsFound"))}else{this.saveStgLoc(e.BarCode.Translations.Translation[0].LocationContextualInfo.HoldLocationId)}}else{c.showErrorMessage(u.translate("batchpick.MSG_StagingTranslationNotFound"))}},uiClose:function(){c.showConfirmationMessage(u.translate("batchpick.WarningMessage_Cancel")).then(function(t){if(t==="YES"){if(d.params.action==="batchList"){a.gotoCustomPage("batchList",{},{})}else if(d.params.action==="skipbatchList"){a.closeWizard()}}},function(t){})},checkIfStagingComplete:function(){var e=this;var t="";if(d.params.action==="batchList"){t="batchpick.MSG_stg_loc_finished"}else if(d.params.action==="skipbatchList"){t="batchpick.MSG_stg_location_finished"}var i=this.model.getStoreBatchDetails.StoreBatch.BatchNo;if(this.model.getStoreBatchDetails.StoreBatch.BatchStagingProcessComplete=="Y"){c.showConfirmationMessage(u.translate(t,{batchNo:i})).then(function(t){if(t==="YES"){e.uiFinishBatch()}else if(t==="NO"){}},function(t){})}}})}]);
angular.module("store").controller("store.views.shipment.batchpick.swp-picking.swp-picking",["$scope","$rootScope","iscScreen","iscWizard","$timeout","$filter","$locale","iscMashup","iscResourcePermission","iscRule","iscDomUtility","iscModal","iscI18n","iscScrollUtility","iscShipment","iscStateParams","iscAppContext",function(t,e,i,a,s,o,r,c,n,h,l,S,u,B,m,d,p){a.initializeWizardPage(t,{model:{getStoreBatchDetails:{},scanItemInput:{barcodeData:""},getRuleDetailsForToteScan:{},toteDataModel:{toteId:""},filtermodel:{},batchLineForCurrentItem:{}},mashupRefs:[{mashupRefId:"getStoreBatchDetails",mashupId:"store.views.shipment.batchpick.getStoreBatchDetails",modelName:"getStoreBatchDetails"},{mashupRefId:"registerBatchPickInScanMode",mashupId:"store.views.shipment.batchpick.registerBatchPickinScanMode",modelName:"registerBatchPickOutput"},{mashupRefId:"getRuleDetailsForToteScan",mashupId:"store.views.shipment.batchpick.getRuleDetailsForToteScan",modelName:"getRuleDetailsForToteScan"},{mashupRefId:"translateBarcodeForTote",mashupId:"store.views.shipment.batchpick.translateBarcodeForTote"},{mashupRefId:"registerBatchPickUpdateMode",mashupId:"store.views.shipment.batchpick.registerBatchPickUpdateMode"},{mashupRefId:"registerBatchPickInManualMode",mashupId:"store.views.shipment.batchpick.registerBatchPickInManualMode",modelName:"registerBatchPickOutput"},{mashupRefId:"recordShortageForBatchPick",mashupId:"store.views.shipment.batchpick.sap-picking.recordShortageForBatchPick"},{mashupRefId:"finishBatchPick",mashupId:"store.views.shipment.batchpick.finishBatchPick"},{mashupRefId:"getStoreBatchLineLocationDetailsByItemId",mashupId:"store.views.shipment.batchpick.getStoreBatchLineLocationDetailsByItemId"}],ui:{showCurrentItem:false,currentItemMode:"scan",bLineShownCount:5,selectedBatchLine:{},batchLineFilter:"N",focusOnFirstLine:true,filteredItems:[],orderedToteList:[],orderedESDToteList:[],deltaToteQty:0,showToteRearrangePopup:false,filteredItemsLength:0,focusOnScanField:true},initialize:function(){var t=a.getWizardPageInput();if(t.callBatchListApi==="N"){this.model.getStoreBatchDetails=t;c.callMashup(this,"getRuleDetailsForToteScan",{},{});this.massageGetStoreBatchDetailsOutput(this.model.getStoreBatchDetails)}else{var e={StoreBatch:{StoreBatchKey:t.StoreBatchKey}};var i=[];i.push(c.getMashupRefObj(this,"getStoreBatchDetails",e));i.push(c.getMashupRefObj(this,"getRuleDetailsForToteScan",{}));c.callMashups(this,i,{}).then(this.handleInitApiCalls.bind(this),angular.noop)}},handleInitApiCalls:function(t){var e=c.getMashupOutput(t,"getStoreBatchDetails");this.massageGetStoreBatchDetailsOutput(e)},massageGetStoreBatchDetailsOutput:function(t){var e=[];e=t.StoreBatch.StoreBatchLines.StoreBatchLine;for(var i=0;i<e.length;i++){e[i].uiBackroomPickComplete=e[i].BackroomPickComplete}s(function(){l.setFocus(document.getElementById("productScanInput"))},0);this.getBatchLineSizeAfterFilterApply()},uiIsBatchLineEditable:function(t){return t.BackroomPickedQuantity=="0"||t.BackroomPickedQuantity=="0.00"?true:false},uiHandleToteSave:function(){barCodeData=this.model.toteDataModel.toteId;var t=null;if(!iscCore.isVoid(this.model.registerBatchPickOutput.StoreBatch.ShipmentLines.ShipmentLine.StoreBatchLocation)){t=this.model.registerBatchPickOutput.StoreBatch.ShipmentLines.ShipmentLine.StoreBatchLocation.ToteId}if(iscCore.isVoid(t)){if(iscCore.isVoid(barCodeData)){S.showErrorMessage(u.translate("batchpick.MSG_NoToteScanned"))}else{if(this.model.getRuleDetailsForToteScan.Rules.RuleSetValue==="Y")this.scanToteId(barCodeData);else this.saveToteDetails(barCodeData)}}else this.saveToteDetails(null)},saveToteDetails:function(t){var e=0;var i=Number(this.model.registerBatchPickOutput.StoreBatch.ShipmentLines.ShipmentLine.BackroomPickedQty);var a=Number(this.model.registerBatchPickOutput.StoreBatch.ShipmentLines.ShipmentLine.TranslatedQuantity);var o=(!isNaN(i)?i:e)+(!isNaN(a)?a:e);var r={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey,Mode:"UPDATE"}};r.StoreBatch.ShipmentLines={};r.StoreBatch.ShipmentLines.ShipmentLine=[];r.StoreBatch.ShipmentLines.ShipmentLine[0]={};r.StoreBatch.ShipmentLines.ShipmentLine[0].ShipmentLineKey=this.model.registerBatchPickOutput.StoreBatch.ShipmentLines.ShipmentLine.ShipmentLineKey;r.StoreBatch.ShipmentLines.ShipmentLine[0].BackroomPickedQty=o;if(!iscCore.isVoid(t)){r.StoreBatch.ShipmentLines.ShipmentLine[0].StoreBatchLocation={};r.StoreBatch.ShipmentLines.ShipmentLine[0].StoreBatchLocation.ToteId=t}c.callMashup(this,"registerBatchPickUpdateMode",r,{}).then(this.handleRegisterBatchPickUpdate.bind(this,"registerBatchPickUpdateMode"),angular.noop)},scanToteId:function(t){if(!iscCore.isVoid(t)){var e={BarCode:{BarCodeData:t}};var i=0;var a=Number(this.model.registerBatchPickOutput.StoreBatch.ShipmentLines.ShipmentLine.BackroomPickedQty);var o=Number(this.model.registerBatchPickOutput.StoreBatch.ShipmentLines.ShipmentLine.TranslatedQuantity);var r=(!isNaN(a)?a:i)+(!isNaN(o)?o:i);var n={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey,Mode:"UPDATE"}};n.StoreBatch.ShipmentLines={};n.StoreBatch.ShipmentLines.ShipmentLine=[];n.StoreBatch.ShipmentLines.ShipmentLine[0]={};n.StoreBatch.ShipmentLines.ShipmentLine[0].ShipmentLineKey=this.model.registerBatchPickOutput.StoreBatch.ShipmentLines.ShipmentLine.ShipmentLineKey;n.StoreBatch.ShipmentLines.ShipmentLine[0].BackroomPickedQty=r;var e={};e.BarCode={};e.BarCode.BarCodeData=t;e.BarCode.registerBatchPickInputElem=n;c.callMashup(this,"translateBarcodeForTote",e,{}).then(this.handleRegisterBatchPickUpdate.bind(this,"translateBarcodeForTote"),angular.noop)}else{S.showErrorMessage(u.translate("viewcartdetails.MSG_InvalidBarCodeData"))}},uiScanProduct:function(t){if(iscCore.isVoid(t)){S.showErrorMessage(u.translate("batchpick.MSG_NoProductScanned"))}else{var e={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}};e.StoreBatch.BarCode={};e.StoreBatch.BarCode.BarCodeData=t;c.callMashup(this,"registerBatchPickInScanMode",e,{}).then(this.handleRegisterBatchPick.bind(this,"registerBatchPickInScanMode","MANUAL",null),this.handleRegisterBatchPickErrors.bind(this));this.model.scanItemInput.barcodeData="";this.ui.focusOnScanField=true}},handleRegisterBatchPickErrors:function(t){if(t.Errors){var e=t.Errors.Error[0].ErrorDescription;var i=t.Errors.Error[0].ErrorCode;if(i=="YCD00093"){e=u.translate("apierror."+"YCD00093_pick");S.showErrorMessage(e,null,null)}else{if(u.hasKey("apierror."+i)){e=u.translate("apierror."+i);S.showErrorMessage(e,null,null)}else{S.showErrorMessage(e,null,null)}}}},handleRegisterBatchPick:function(t,e,i,a){var o=c.getMashupOutput(a,t);this.ui.showCurrentItem=true;if(iscCore.isVoid(i)){var i=null;var r=[];r=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.StoreBatchLine;for(var n=0;n<r.length;n++){if(o.StoreBatch.ShipmentLines.ShipmentLine.ItemID==r[n].ItemDetails.ItemID&&o.StoreBatch.ShipmentLines.ShipmentLine.UnitOfMeasure==r[n].ItemDetails.UnitOfMeasure){i=r[n];break}}}this.model.batchLineForCurrentItem=i;var h=Number(i.BackroomPickedQuantity)+Number(o.StoreBatch.ShipmentLines.ShipmentLine.TranslatedQuantity);this.model.batchLineForCurrentItem.pickableQty=h;if(e==="MANUAL"){this.ui.currentItemMode="MANUAL"}else if(e==="EDIT"){this.ui.currentItemMode="EDIT";this.initializeToteListArray(o)}this.cloneToteScanModel(o);s(function(){l.setFocus(document.getElementById("toteScanInput"),100)},510)},uiCancelToteAssignment:function(){var t=null;if(this.ui.focusOnScanField){t="productScanInput"}else{t="pick"+this.model.batchLineForCurrentItem.ItemDetails.ItemID+this.model.batchLineForCurrentItem.ItemDetails.UnitOfMeasure}s(function(){l.setFocus(document.getElementById(t))},0);this.ui.showCurrentItem=false},initializeToteListArray:function(t){this.ui.deltaToteQty=0;this.ui.showToteRearrangePopup=false;this.ui.orderedToteList=[];this.ui.orderedESDToteList=[];if(!iscCore.isVoid(t.StoreBatch.StoreBatchLocationList)&&!iscCore.isVoid(t.StoreBatch.StoreBatchLocationList.StoreBatchLocation)&&!iscCore.isVoid(t.StoreBatch.StoreBatchLocationList.StoreBatchLocation.length)){for(var e=0;e<t.StoreBatch.StoreBatchLocationList.StoreBatchLocation.length;e++){var i=t.StoreBatch.StoreBatchLocationList.StoreBatchLocation[e];this.ui.orderedToteList.push(i.ToteId)}}if(!iscCore.isVoid(t.StoreBatch.StoreBatchLocationList)&&!iscCore.isVoid(t.StoreBatch.StoreBatchLocationList.StoreBatchLocation)&&!iscCore.isVoid(t.StoreBatch.StoreBatchLocationList.StoreBatchLocation.length)){var a=(new Date).getTime()+(new Date).getTimezoneOffset()*6e4;for(var e=0;e<t.StoreBatch.StoreBatchLocationList.StoreBatchLocation.length;e++){var i=t.StoreBatch.StoreBatchLocationList.StoreBatchLocation[e];var o=new Date(i.Shipment.ExpectedShipmentDate);var r=o.getTime()+o.getTimezoneOffset()*6e4;var n=r-a;this.ui.orderedESDToteList.push(n)}}},computeDeltaToteQtyBasedOnSLA:function(t,e){var i="";if(this.ui.orderedToteList.indexOf(t)!=-1&&this.ui.orderedToteList.indexOf(t)<this.ui.orderedToteList.length-1){i=t;this.ui.deltaToteQty++}if(this.ui.deltaToteQty<=2&&this.ui.orderedToteList.indexOf(i)!=-1&&this.ui.orderedToteList.indexOf(i)<this.ui.orderedToteList.length-1){this.ui.showToteRearrangePopup=true}else if(this.ui.deltaToteQty>2){this.ui.showToteRearrangePopup=false}if(this.ui.showToteRearrangePopup){var a=true;var o=this.ui.orderedToteList.indexOf(t);if(o>-1){var r=this.ui.orderedESDToteList[o];for(var n=0;n<this.ui.orderedESDToteList.length;n++){if(r==this.ui.orderedESDToteList[n]){continue}else{a=false;break}}}if(a)this.ui.showToteRearrangePopup=false}},cloneToteScanModel:function(t){if(!iscCore.isVoid(t.StoreBatch.ShipmentLines.ShipmentLine.StoreBatchLocation)){this.model.toteDataModel.toteId=angular.copy(t.StoreBatch.ShipmentLines.ShipmentLine.StoreBatchLocation.ToteId)}else{this.model.toteDataModel.toteId=""}},handleRegisterBatchPickUpdate:function(t,e){var i=c.getMashupOutput(e,t);var a=angular.copy(i);a.StoreBatch.StoreBatchLine=i.StoreBatch.StoreBatchLines.StoreBatchLine[0];delete a.StoreBatch.StoreBatchLines;this.updateBatchLine(a);var o=null;if(this.ui.focusOnScanField){o="productScanInput"}else{o="pick"+a.StoreBatch.StoreBatchLine.ItemDetails.ItemID+a.StoreBatch.StoreBatchLine.ItemDetails.UnitOfMeasure}s(function(){l.setFocus(document.getElementById(o))},0)},uiHandleBatchLinePick:function(t,e){var i=t.BackroomPickComplete;if(i=="Y"){var a={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}};a.StoreBatch.StoreBatchLine={};a.StoreBatch.StoreBatchLine.ItemID=t.ItemID;a.StoreBatch.StoreBatchLine.UnitOfMeasure=t.UnitOfMeasure;c.callMashup(this,"getStoreBatchLineLocationDetailsByItemId",a,{}).then(this.handleGetStoreBatchDetails.bind(this,t),angular.noop)}else{var o={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}};o.StoreBatch.Item={};o.StoreBatch.Item.ItemID=t.ItemID;o.StoreBatch.Item.UnitOfMeasure=t.UnitOfMeasure;c.callMashup(this,"registerBatchPickInManualMode",o,{}).then(this.handleRegisterBatchPick.bind(this,"registerBatchPickInManualMode",e,t),angular.noop)}this.ui.focusOnScanField=false},handleGetStoreBatchDetails:function(t,e){var i=c.getMashupOutput(e,"getStoreBatchLineLocationDetailsByItemId");var a=angular.copy(t);this.model.batchLineForCurrentItem=t;var o={};o.StoreBatch={};o.StoreBatch.ShipmentLines={};o.StoreBatch.ShipmentLines.ShipmentLine=[];o.StoreBatch.ShipmentLines.ShipmentLine=t;o.StoreBatch.ShipmentLines.ShipmentLine.ItemDetails={};o.StoreBatch.ShipmentLines.ShipmentLine.StoreBatchLocationList={};o.StoreBatch.ShipmentLines.ShipmentLine.OrderLine={};o.StoreBatch.ShipmentLines.ShipmentLine.OrderLine.ItemDetails={};o.StoreBatch.ShipmentLines.ShipmentLine.OrderLine.ItemDetails=a.ItemDetails;o.StoreBatch.StoreBatchLocationList={};o.StoreBatch.StoreBatchLocationList=i.StoreBatch.StoreBatchLines.StoreBatchLine[0].StoreBatchLocationList;o.StoreBatch.ShipmentLines.ShipmentLine.BackroomPickComplete=i.StoreBatch.StoreBatchLines.StoreBatchLine[0].BackroomPickComplete;this.model.registerBatchPickOutput=o;this.ui.showCurrentItem=true;this.ui.currentItemMode="EDIT";this.initializeToteListArray(o);this.cloneToteScanModel(o);s(function(){l.setFocus(document.getElementById("toteScanInput"),100)},510)},uiDecreaseQty:function(t){var e=0;var i=1;var a=Number(t.LBPPShipmentLineBPQty);a=!isNaN(t.LBPPShipmentLineBPQty)?a:e;if(a==0){S.showErrorMessage(u.translate("batchpick.MSG_NegativeQtyError"));return}a=a-i;var o={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}};o.StoreBatch.ShipmentLines={};o.StoreBatch.ShipmentLines.ShipmentLine=[];o.StoreBatch.ShipmentLines.ShipmentLine[0]={};o.StoreBatch.ShipmentLines.ShipmentLine[0].ShipmentLineKey=t.LBPPShipmentLineKey;o.StoreBatch.ShipmentLines.ShipmentLine[0].BackroomPickedQty=a;o.StoreBatch.ShipmentLines.ShipmentLine[0].StoreBatchLocation={};o.StoreBatch.ShipmentLines.ShipmentLine[0].StoreBatchLocation.ToteId=t.ToteId;c.callMashup(this,"registerBatchPickUpdateMode",o,{}).then(this.handleRegisterBatchPickEdit.bind(this,t,a),angular.noop)},handleRegisterBatchPickEdit:function(t,e,i){var a=c.getMashupOutput(i,"registerBatchPickUpdateMode");this.model.batchLineForCurrentItem.BackroomPickedQuantity=Number(this.model.batchLineForCurrentItem.BackroomPickedQuantity)-1;this.computeDeltaToteQtyBasedOnSLA(t.ToteId,a);this.model.registerBatchPickOutput=a},getBatchLineSizeAfterFilterApply:function(){if(this.ui.batchLineFilter=="N"){var t=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.StoreBatchLine;var e=0;for(var i=0;i<t.length;i++){if(t[i].BackroomPickComplete=="N"){e++}}this.ui.filteredItemsLength=e}else{this.ui.filteredItemsLength=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.TotalNumberOfRecords}},uiRepaintBatchLines:function(){if(this.ui.showToteRearrangePopup){var a=this;S.showInfoMessage(u.translate("batchpick.MSG_HighPriorityToteEdit")).then(function(t){a.model.batchLineForCurrentItem={};var e={StoreBatch:{StoreBatchKey:a.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}};var i=[];i.push(c.getMashupRefObj(a,"getStoreBatchDetails",e));i.push(c.getMashupRefObj(a,"getRuleDetailsForToteScan",{}));c.callMashups(a,i,{});a.ui.showCurrentItem=false})}else{this.model.batchLineForCurrentItem={};var t={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}};var e=[];e.push(c.getMashupRefObj(this,"getStoreBatchDetails",t));e.push(c.getMashupRefObj(this,"getRuleDetailsForToteScan",{}));c.callMashups(this,e,{});this.ui.showCurrentItem=false}},uiGetNextBatchLineRecords:function(){if(this.ui.bLineShownCount<=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.StoreBatchLine.length){this.ui.bLineShownCount+=5}},uiBatchLineScrollActionValidator:function(){return true},initializefilterModel:function(){if(this.ui.batchLineFilter=="N"){this.model.filtermodel.filter="IN_PROGRESS"}else{this.model.filtermodel.filter="ALL"}},uiApplyBatchListFilter:function(t){if(t.filter=="IN_PROGRESS"){this.ui.batchLineFilter="N"}else{this.ui.batchLineFilter=""}this.getBatchLineSizeAfterFilterApply();this.ui.focusOnFirstLine=true;this.ui.selectedBatchLine={}},uiGetBatchLineTrackBy:function(t){return t.ItemDetails.ItemID+t.ItemDetails.UnitOfMeasure},uiSelectBatchLine:function(t){this.ui.selectedBatchLine=this.uiGetBatchLineTrackBy(t);this.ui.focusOnFirstLine=false},uiOpenRecordShortagePopup:function(e){var i=this;var t={};t.codeType="YCD_PICK_SHORT_RESOL";t.shipmentLine=angular.copy(e);t.shipmentLine.OrderLine={};t.shipmentLine.OrderLine.ItemDetails=t.shipmentLine.ItemDetails;t.shipmentLine.OrderLine.variation=t.shipmentLine.variation;t.shipmentLine.DisplayQty=e.BackroomPickedQuantity;t.shipmentLine.DisplayTotalQty=e.OriginalQuantity;t.shipmentLine.DisplayShortQty=Number(e.OriginalQuantity)-Number(e.BackroomPickedQuantity);var a={modalInput:function(){return t}};S.openModal("store.views.shipment.common.record-shortage.record-shortage",a,{}).then(function(t){if(t.data!==null&&t.data!==undefined){i.stampRecordShortage.call(i,t.data,e)}},angular.noop)},stampRecordShortage:function(t,e){var i=e.ItemDetails.ItemID;var a=e.ItemDetails.UnitOfMeasure;var o={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey,Item:{ItemID:i,UnitOfMeasure:a,ShortageReason:t.RecordShortage.ShortageReasonCode}}};c.callMashup(this,"recordShortageForBatchPick",o,{}).then(function(t){this.handleRecordShortage(t)}.bind(this),angular.noop)},handleRecordShortage:function(t){var e=c.getMashupOutput(t,"recordShortageForBatchPick");if(e.StoreBatch.ItemRemovedFromBatch=="Y"){}var i=angular.copy(e);i.StoreBatch.StoreBatchLine=e.StoreBatch.StoreBatchLines.StoreBatchLine[0];delete i.StoreBatch.StoreBatchLines;this.updateBatchLine(i)},updateBatchLine:function(t){this.model.getStoreBatchDetails.StoreBatch.Status=t.StoreBatch.Status;var e=t.StoreBatch.StoreBatchLine.ItemID;var i=t.StoreBatch.StoreBatchLine.UnitOfMeasure;var a=this.model.getStoreBatchDetails.StoreBatch.StoreBatchLines.StoreBatchLine;for(var o=0;o<a.length;o++){if(a[o].ItemID==e&&a[o].UnitOfMeasure==i){a[o]=t.StoreBatch.StoreBatchLine;this.ui.focusOnFirstLine=false;this.ui.selectedBatchLine=this.uiGetBatchLineTrackBy(a[o]);this.ui.showCurrentItem=false;if(a[o].BackroomPickComplete=="Y"&&this.ui.batchLineFilter=="N"){this.ui.filteredItemsLength-=1}break}}B.scrollToElementWIthOffsetAndFixedHeader(document.getElementById("batch-line-list"),document.getElementById(this.ui.selectedBatchLine),0,10,40);this.checkBatchStatus()},checkBatchStatus:function(){var e=this;if(this.model.getStoreBatchDetails.StoreBatch.Status=="2000"){var t=h.getRuleSetValue("enableStagingLocation");if(t=="Y"){var i={options:{action:[{actionName:"YES",actionLabel:"batchpick.ACTION_AssignStaging"},{actionName:"NO",actionLabel:"batchpick.ACTION_Finish"}]}};S.showConfirmationMessage(u.translate("batchpick.MSG_AllBatchLinesPicked"),i).then(function(t){if(t==="YES"){e.uiGotoAssignStaging()}else if(t==="NO"){e.finishBatch()}},function(t){})}else{var i={options:{action:[{actionName:"YES",actionLabel:"batchpick.ACTION_Finish"}]}};S.showConfirmationMessage(u.translate("batchpick.MSG_AllBatchLinesPicked"),i).then(function(t){if(t==="YES"){e.finishBatch()}},function(t){})}}else if(this.model.getStoreBatchDetails.StoreBatch.Status=="9000"){S.showInfoMessage(u.translate("batchpick.MSG_BatchCancelled")).then(function(t){if(d.params.action==="batchList"){a.gotoCustomPage("batchList",{},{})}else if(d.params.action==="skipbatchList"){a.closeWizard()}})}},uiGotoAssignStaging:function(){var t={StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey,BatchNo:this.model.getStoreBatchDetails.StoreBatch.BatchNo}};a.gotoCustomPage("swpStaging",t,{})},finishBatch:function(){if(d.params.action==="batchList"){c.callMashup(this,"finishBatchPick",{StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}},{}).then(a.gotoCustomPage("batchList",{},{}))}else if(d.params.action==="skipbatchList"){c.callMashup(this,"finishBatchPick",{StoreBatch:{StoreBatchKey:this.model.getStoreBatchDetails.StoreBatch.StoreBatchKey}},{}).then(a.closeWizard())}},uiCancel:function(){S.showConfirmationMessage(u.translate("batchpick.WarningMessage_Cancel")).then(function(t){if(t==="YES"){if(d.params.action==="batchList"){a.gotoCustomPage("batchList",{},{})}else if(d.params.action==="skipbatchList"){a.closeWizard()}}},function(t){})},uiOpenItemDetails:function(t){m.openProductDetail(t)},uiIsBackroomPickComplete:function(t){return t.BackroomPickComplete=="Y"?true:false},handleWizardBack:function(){var t=a.isFirstPage();if(t){confirmationMsg=u.translate("batchpick.WarningMessage_Cancel");S.showConfirmationMessage(confirmationMsg).then(function(t){if(t==="YES"){a.closeWizard()}});return true}else if(!t){confirmationMsg=u.translate("batchpick.WarningMessage_Cancel");S.showConfirmationMessage(confirmationMsg).then(function(t){if(t==="YES"){a.gotoPreviousPage(true)}});return true}else{return false}}})}]);
angular.module("store").controller("store.views.shipment.batchpick.swp-staging.swp-staging",["$scope","$rootScope","iscScreen","iscWizard","$timeout","$filter","$locale","iscMashup","iscResourcePermission","iscAppInfo","iscDomUtility","iscModal","iscI18n","iscStateParams","iscAppContext",function(t,e,o,g,c,a,i,d,n,s,r,p,L,h,l){g.initializeWizardPage(t,{model:{getStoreBatchDetails:{},getStoreBatchLocationList:{},getRuleDetailsForToteScan:{},getRuleDetailsForStagingLocScan:{},toteScanInput:{toteId:""},selectedTote:{},stgLocScanInput:{holdLocation:""}},mashupRefs:[{mashupRefId:"getStoreBatchLocationList",mashupId:"store.views.shipment.batchpick.getStoreBatchLocationList",modelName:"getStoreBatchLocationList"},{mashupRefId:"getRuleDetailsForToteScan",mashupId:"store.views.shipment.batchpick.getRuleDetailsForToteScan",modelName:"getRuleDetailsForToteScan"},{mashupRefId:"getRuleDetailsForStagingLocScan",mashupId:"store.views.shipment.batchpick.getRuleDetailsForStagingLocScan",modelName:"getRuleDetailsForStagingLocScan"},{mashupRefId:"translateBarCodeForTote",mashupId:"store.views.shipment.batchpick.translateBarCodeForTote"},{mashupRefId:"translateBarCodeForStgLocation",mashupId:"store.views.shipment.batchpick.translateBarCodeForStgLocation"},{mashupRefId:"changeShipmentForStagingLoc",mashupId:"store.views.shipment.batchpick.changeShipment"},{mashupRefId:"finishBatchPick",mashupId:"store.views.shipment.batchpick.finishBatchPick"}],ui:{showCurrentTote:false,focusOnFirstLine:true,selectedTote:{},focusOnScanField:true},initialize:function(){var t=g.getWizardPageInput();this.model.getStoreBatchDetails=t;var e={StoreBatch:{StoreBatchKey:t.StoreBatch.StoreBatchKey}};var o=[];o.push(d.getMashupRefObj(this,"getStoreBatchLocationList",e));o.push(d.getMashupRefObj(this,"getRuleDetailsForToteScan",{}));o.push(d.getMashupRefObj(this,"getRuleDetailsForStagingLocScan",{}));d.callMashups(this,o,{}).then(this.handleGetStoreBatchLocationList.bind(this),angular.noop)},uiSelectTote:function(t){this.ui.selectedTote=t.StoreBatchLocationKey;this.ui.focusOnFirstLine=false},handleGetStoreBatchLocationList:function(t){var e=d.getMashupOutput(t,"getStoreBatchLocationList");var o=[];o=e.StoreBatchLocationList.StoreBatchLocation;for(var a=0;a<o.length;a++){o[a].deliveryMethodURL=window.location.protocol+"//"+window.location.host+s.getApplicationContext()+"//"+o[a].ImageUrl+"//"+o[a].ImageId}if(e.StoreBatchLocationList.BatchStagedCompletely=="Y"){this.showBatchStagingCompletionSuccess(e,false)}c(function(){r.setFocus(document.getElementById("toteScanInput"))},0)},uiHandleAssign:function(t){this.model.selectedTote=this.getSelectedToteModelWithModifiedImage(t);this.ui.showCurrentTote=true;c(function(){r.setFocus(document.getElementById("stgLocScanInput"),100)},510);this.ui.focusOnScanField=false},uiScanTote:function(t){if(iscCore.isVoid(t)){p.showErrorMessage(L.translate("batchpick.MSG_NoToteScanned"))}else{if(this.model.getRuleDetailsForToteScan.Rules.RuleSetValue=="Y"){var e=g.getWizardPageInput();var o={BarCode:{BarCodeData:t}};o.BarCode.ToteContextualInfo={};o.BarCode.ToteContextualInfo.StoreBatchKey=e.StoreBatch.StoreBatchKey;d.callMashup(this,"translateBarCodeForTote",o,{}).then(this.handleToteTranslation.bind(this),angular.noop)}else{var a=this.model.getStoreBatchLocationList.StoreBatchLocationList.StoreBatchLocation;var i=null;for(var n=0;n<a.length;n++){if(a[n]["ToteId"]===t){i=a[n];break}}if(!iscCore.isVoid(i)){this.model.selectedTote=this.getSelectedToteModelWithModifiedImage(i);this.ui.showCurrentTote=true;this.uiSelectTote(i);c(function(){r.setFocus(document.getElementById("stgLocScanInput"),100)},510)}else{p.showErrorMessage(L.translate("batchpick.MSG_TranslationNotFoundError"))}}this.model.toteScanInput.toteId=""}this.ui.focusOnScanField=true},uiScanStagingLocation:function(t){if(iscCore.isVoid(t)){p.showErrorMessage(L.translate("batchpick.MSG_NoStagingLocScanned"))}else{if(this.model.getRuleDetailsForStagingLocScan.Rules.RuleSetValue=="Y"){d.callMashup(this,"translateBarCodeForStgLocation",{BarCode:{BarCodeData:t}},{}).then(this.handleStagingLocTranslation.bind(this),angular.noop)}else{this.addHoldLocation(t)}this.model.stgLocScanInput.holdLocation=""}},handleStagingLocTranslation:function(t){var e=d.getMashupOutput(t,"translateBarCodeForStgLocation");if(e.BarCode.Translations.TotalNumberOfRecords=="0"){p.showErrorMessage(L.translate("batchpick.MSG_StagingTranslationNotFound"))}else{var o=e.BarCode.Translations.Translation[0].LocationContextualInfo.HoldLocationId;this.addHoldLocation(o)}},addHoldLocation:function(t){var e=this.model.selectedTote;var o=e.Shipment.HoldLocation;var a=[];var i=g.getWizardPageInput();var n=false;if(!iscCore.isVoid(o)){a=o.split(",");for(var c=0;c<a.length;c++){if(a[c].trim()==t){n=true;break}}}if(n){p.showErrorMessage(L.translate("batchpick.MSG_DuplicateStgLocation"))}else{if(a.length>=1){t=o+","+t}if(t.length>40){p.showErrorMessage(L.translate("batchpick.MSG_InvalidHoldLocationLength"))}else{var s={};s.Shipment={};s.Shipment.ShipmentKey=e.Shipment.ShipmentKey;s.Shipment.HoldLocation=t;s.Shipment.ShipmentLines={};var r=s.Shipment.ShipmentLines.ShipmentLine=[];var h=e.Shipment.ShipmentLines.ShipmentLine;if(!iscCore.isVoid(h)){for(var c=0;c<h.length;c++){var l=h[c];var u=r[r.length]={};u.ShipmentLineKey=l.ShipmentLineKey;if(l.BackroomPickedQty)u.StagedQuantity=l.BackroomPickedQty;else u.StagedQuantity=0}}var S={StoreBatchLocation:{StoreBatchKey:i.StoreBatch.StoreBatchKey,StoreBatchLocationKey:e.StoreBatchLocationKey}};s.Shipment.getStoreBatchLocationListInput=S;d.callMashup(this,"changeShipmentForStagingLoc",s,{}).then(this.handleUpdateHoldLocation.bind(this),angular.noop)}}},handleUpdateHoldLocation:function(t){var e=d.getMashupOutput(t,"changeShipmentForStagingLoc");var o=e.StoreBatchLocationList.StoreBatchLocation[0].StoreBatchLocationKey;if(e.StoreBatchLocationList.BatchStagedCompletely=="Y"){this.showBatchStagingCompletionSuccess(e,true)}else{this.model.getStoreBatchLocationList.StoreBatchLocationList.BatchStagedCompletely=e.StoreBatchLocationList.BatchStagedCompletely;o=e.StoreBatchLocationList.StoreBatchLocation[0].StoreBatchLocationKey;var a=this.model.getStoreBatchLocationList.StoreBatchLocationList.StoreBatchLocation;for(var i=0;i<a.length;i++){if(a[i].StoreBatchLocationKey==o){a[i]=e.StoreBatchLocationList.StoreBatchLocation[0];this.ui.showCurrentTote=false;break}}}var n=null;if(this.ui.focusOnScanField){n="toteScanInput"}else{n="tote"+o}c(function(){r.setFocus(document.getElementById(n))},0)},showBatchStagingCompletionSuccess:function(i,n){var t="";if(h.params.action==="batchList"){t="batchpick.MSG_stg_loc_finished"}else if(h.params.action==="skipbatchList"){t="batchpick.MSG_stg_location_finished"}var e={options:{headerText:"globals.LABEL_Success",headerIconCss:"app-glyphicons app-icon-success_ok_30"}};var c=g.getWizardPageInput();var s=this;p.showConfirmationMessage(L.translate(t,{batchNo:c.StoreBatch.BatchNo}),e).then(function(t){if(t==="YES"){if(h.params.action==="batchList"){d.callMashup(s,"finishBatchPick",{StoreBatch:{StoreBatchKey:c.StoreBatch.StoreBatchKey}},{}).then(g.gotoCustomPage("batchList",{},{}))}else if(h.params.action==="skipbatchList"){d.callMashup(s,"finishBatchPick",{StoreBatch:{StoreBatchKey:c.StoreBatch.StoreBatchKey}},{}).then(g.closeWizard())}}else if(t==="NO"&&n){s.model.getStoreBatchLocationList.StoreBatchLocationList.BatchStagedCompletely=i.StoreBatchLocationList.BatchStagedCompletely;var e=i.StoreBatchLocationList.StoreBatchLocation[0].StoreBatchLocationKey;var o=s.model.getStoreBatchLocationList.StoreBatchLocationList.StoreBatchLocation;for(var a=0;a<o.length;a++){if(o[a].StoreBatchLocationKey==e){o[a]=i.StoreBatchLocationList.StoreBatchLocation[0];s.ui.showCurrentTote=false;break}}}},function(t){})},handleToteTranslation:function(t){var e=d.getMashupOutput(t,"translateBarCodeForTote");var o=e.BarCode.Translations.Translation[0].ToteContextualInfo.StoreBatchLocationKey;var a=this.model.getStoreBatchLocationList.StoreBatchLocationList.StoreBatchLocation;var i=null;for(var n=0;n<a.length;n++){if(a[n]["StoreBatchLocationKey"]===o){i=a[n];break}}this.model.selectedTote=this.getSelectedToteModelWithModifiedImage(i);this.ui.showCurrentTote=true;this.uiSelectTote(i);c(function(){r.setFocus(document.getElementById("stgLocScanInput"),100)},510)},getSelectedToteModelWithModifiedImage:function(t){if(t){var e=angular.copy(t);var o=e.ImageId;if(o){if(o==="shipping_med.png"){e.ImageId="shipping_big.png"}else if(o==="pickup_med.png"){e.ImageId="pickup_big.png"}e.deliveryMethodURL=window.location.protocol+"//"+window.location.host+s.getApplicationContext()+"//"+e.ImageUrl+"//"+e.ImageId}}return e},handleWizardBack:function(){var t=g.isFirstPage();if(t){confirmationMsg=L.translate("batchpick.WarningMessage_Cancel");p.showConfirmationMessage(confirmationMsg).then(function(t){if(t==="YES"){g.closeWizard()}});return true}else if(!t){confirmationMsg=L.translate("batchpick.WarningMessage_Cancel");p.showConfirmationMessage(confirmationMsg).then(function(t){if(t==="YES"){g.gotoPreviousPage(true)}});return true}else{return false}},uiCancel:function(){p.showConfirmationMessage(L.translate("batchpick.WarningMessage_Cancel")).then(function(t){if(t==="YES"){if(h.params.action==="batchList"){g.gotoCustomPage("batchList",{},{})}else if(h.params.action==="skipbatchList"){g.closeWizard()}}},function(t){})},uiCancelStagingLocation:function(){var t=null;if(this.ui.focusOnScanField){t="toteScanInput"}else{t="tote"+this.model.selectedTote.StoreBatchLocationKey}c(function(){r.setFocus(document.getElementById(t))},0);this.ui.showCurrentTote=false},uiFinishBatch:function(){var t=g.getWizardPageInput();if(h.params.action==="batchList"){d.callMashup(this,"finishBatchPick",{StoreBatch:{StoreBatchKey:t.StoreBatch.StoreBatchKey}},{}).then(g.gotoCustomPage("batchList",{},{}))}else if(h.params.action==="skipbatchList"){d.callMashup(this,"finishBatchPick",{StoreBatch:{StoreBatchKey:t.StoreBatch.StoreBatchKey}},{}).then(g.closeWizard())}}})}]);
angular.module("store").controller("store.views.shipment.common.abandon-shipment.abandon-shipment",["$scope","$rootScope","$uibModalInstance","iscScreen","iscWizard","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal",function(i,e,n,s,t,o,a,m,c,l,r){s.initializeModalScreen(i,{model:{shipmentDetails:{}},mashupRefs:[],ui:{flowName:"",inProgressMessageKey:"",inProgressTitleKey:"",continueActionKey:""},initialize:function(){this.model.shipmentDetails=o.shipmentDetails;this.ui.flowName=o.flowName;if(this.ui.flowName=="BACKROOM_PICK"){this.ui.inProgressMessageKey="abandonShipment.MSG_ShipmentPickingInProgress";this.ui.inProgressTitleKey="abandonShipment.TITLE_ShipmentPickingInProgress";this.ui.continueActionKey="abandonShipment.ACTION_ContinuePick"}else if(this.ui.flowName=="PACK"){this.ui.inProgressMessageKey="abandonShipment.MSG_ShipmentPackingInProgress";this.ui.inProgressTitleKey="abandonShipment.TITLE_ShipmentPackingInProgress";this.ui.continueActionKey="abandonShipment.ACTION_ContinuePack"}console.log("Shipment Details - ",this.model.shipmentDetails)},uiClose:function(){n.dismiss({data:"CANCEL"})},uiSubmit:function(i){n.close({data:i})}})}]);
angular.module("store").controller("store.views.shipment.common.product-details.product-details",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal","iscMedia","iscDomUtility","$timeout","iscState","iscProduct",function(e,t,i,s,o,m,n,r,a,l,p,u,I,c,d){s.initializeModalScreen(e,{model:{itemDetails:{},itemSpecDetails:{},itemComponentsDetails:{}},mashupRefs:[{mashupRefId:"getCompleteItemDetails",mashupId:"store.views.shipment.common.product-details.getProductDetails"},{mashupRefId:"getCompleteItemSpecifications",mashupId:"store.views.shipment.common.product-details.getProductSpecifications"},{mashupRefId:"getCompleteItemComponents",mashupId:"store.views.shipment.common.product-details.getProductComponents"}],ui:{itemSpecsEmpty:false,openSpecs:false,itemSpecsFetched:false,openComponents:false,showItemComponents:false},initialize:function(){n.callMashup(this,"getCompleteItemDetails",this.getCompleteItemDetailsInput(),{}).then(this.initializeItemDetails.bind(this),angular.noop);var t=this;e.$watch("ui.openComponents",function(e){if(!iscCore.isVoid(e)){t.openItemComponents(e)}});e.$watch("ui.openSpecs",function(e){if(!iscCore.isVoid(e)){t.openItemSpecs(e)}})},initializeItemDetails:function(e){var t=n.getMashupOutput(e,"getCompleteItemDetails");if(t){this.model.itemDetails.Item=t.ItemList.Item[0];this.model.itemDetails.Item.Currency=t.ItemList.Currency}if(this.model.itemDetails.Item&&this.model.itemDetails.Item.PrimaryInformation&&this.model.itemDetails.Item.PrimaryInformation.KitCode&&(this.model.itemDetails.Item.PrimaryInformation.KitCode=="PK"||this.model.itemDetails.Item.PrimaryInformation.KitCode=="BUNDLE")){this.ui.showItemComponents=true}},openItemSpecs:function(e){if(true===e&&iscCore.isVoid(this.model.itemSpecDetails)&&!this.ui.itemSpecsFetched){n.callMashup(this,"getCompleteItemSpecifications",this.getCompleteItemDetailsInput(),{}).then(this.initializeItemSpecifications.bind(this),angular.noop)}},initializeItemSpecifications:function(e){this.ui.itemSpecsFetched=true;var t=n.getMashupOutput(e,"getCompleteItemSpecifications");if(t&&t.ItemList.Item){this.model.itemSpecDetails=this.getFirstItemChildElementFromItemList(t)}else{console.log("ERROR: Unable to fetch Item Specs Details - ",t)}if(iscCore.isVoid(iscCore.getValueFromJsonPath(this.model.itemSpecDetails,"Item.ItemAttributeGroupTypeList.ItemAttributeGroupType.ItemAttributeGroupList.ItemAttributeGroup"))){this.ui.itemSpecsEmpty=true}},openItemComponents:function(e){if(true===e&&iscCore.isVoid(this.model.itemComponentsDetails)&&this.ui.showItemComponents){n.callMashup(this,"getCompleteItemComponents",this.getCompleteItemDetailsInput(),{}).then(this.initializeItemComponents.bind(this),angular.noop)}},initializeItemComponents:function(e){var t=n.getMashupOutput(e,"getCompleteItemComponents");if(t.ItemList.Item){var i=t.ItemList.Item[0];if(i.Components&&i.Components.Component){this.model.itemComponentsDetails=i.Components;d.generateComponentImageURL(this.model.itemComponentsDetails)}}},getCompleteItemDetailsInput:function(){var e={};e.Item={};if(!iscCore.isVoid(o)&&!iscCore.isVoid(o.ItemDetails)&&!iscCore.isVoid(o.ItemDetails.ItemID)&&!iscCore.isVoid(o.ItemDetails.UnitOfMeasure)){e.Item.ItemID=o.ItemDetails.ItemID;e.Item.UnitOfMeasure=o.ItemDetails.UnitOfMeasure}else{console.log("ERROR: ItemID or UnitOfMeasure is null in modal input - ",o.ItemDetails)}return e},getFirstItemChildElementFromItemList:function(e){var t={};t.Item=e.ItemList.Item[0];if(!iscCore.isVoid(e.ItemList.Item[0].ItemAttributeGroupTypeList)&&!iscCore.isVoid(e.ItemList.Item[0].ItemAttributeGroupTypeList.ItemAttributeGroupType[0])){t.Item.ItemAttributeGroupTypeList.ItemAttributeGroupType=e.ItemList.Item[0].ItemAttributeGroupTypeList.ItemAttributeGroupType[0]}t.Item.Currency=e.ItemList.Currency;return t},uiGetExtendedDescription:function(e){if(!iscCore.isVoid()){e=e.replaceAll(/\n/g,"<br />")}return e},uiGetAttributeName:function(e){return iscCore.isVoid(e.Attribute.ShortDescription)?e.ItemAttributeName:e.Attribute.ShortDescription},uiGetAttributeValue:function(e){var t="-";if(!iscCore.isVoid(e.AssignedValueList)&&!iscCore.isVoid(e.AssignedValueList.AssignedValue)&&!iscCore.isVoid(e.AssignedValueList.AssignedValue.length)){t=e.AssignedValueList.AssignedValue[0].ShortDescription;if(!iscCore.isVoid(t)){if("Y"==t){t=a.translate("globals.ACTION_Yes")}else if("N"==t){t=a.translate("globals.ACTION_No")}}else{t="-"}}return t},uiClose:function(){i.dismiss({})}})}]);
angular.module("store").controller("store.views.shipment.common.record-shortage.record-shortage",["$scope","$rootScope","$uibModalInstance","iscScreen","iscWizard","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal","iscScrollUtility",function(i,e,s,o,a,n,t,l,c,r,h,d){o.initializeModalScreen(i,{model:{shortageReasonList:{},cancelReasonList:{},shipmentLine:{}},mashupRefs:[{mashupRefId:"getShortageReasonList",mashupId:"store.view.shipment.getShortageReasonList",modelName:"shortageReasonList"},{mashupRefId:"getCancelReasonList",mashupId:"store.view.shipment.getShortageReasonList",modelName:"cancelReasonList"}],ui:{selectedShortageReasonCode:"",processType:"BACKROOM_PICK",showCancelReason:false,cancelReason:undefined,markAllLines:false,showCancelReasonError:false,showCancelReasonErrorDesc:r.translate("shortage.MSG_CancellationReasonCode")},initialize:function(){var o=this;i.$watch("ui.selectedShortageReasonCode",function(e){if(!iscCore.isVoid(e)){o.onShortageReasonSelect(e)}});this.model.shipmentLine=n.shipmentLine;var e=n.codeType;if(iscCore.isVoid(e)){e="YCD_PICK_SHORT_RESOL";this.ui.processType="BACKROOM_PICK"}else if(e.indexOf("PACK")>-1){this.ui.processType="PACK"}else if(e.indexOf("YCD_SHORT_RESOLU")>-1){this.ui.processType="CUSTOMER_PICKUP"}var s={};s.CommonCode={};s.CommonCode.CodeType=e;s.CommonCode.DocumentType=this.model.shipmentLine.DocumentType;l.callMashup(this,"getShortageReasonList",s,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){if(iscCore.isVoid(this.ui.selectedShortageReasonCode)){this.ui.selectedShortageReasonCode=this.model.shortageReasonList.CommonCodeList.CommonCode[0].CodeValue}},onShortageReasonSelect:function(e){if(this.ui.mode="CUSTOMER_PICKUP"&&e==="Cancel"){this.ui.showCancelReason=true;if(iscCore.isVoid(this.model.cancelReasonList)){var o={};o.CommonCode={};o.CommonCode.CodeType="YCD_CANCEL_REASON";l.callMashup(this,"getCancelReasonList",o,{}).then(function(e){}.bind(this),angular.noop)}}else{this.ui.showCancelReason=false}},uiCancelReasonChange:function(){this.ui.showCancelReasonError=false},uiClose:function(){s.dismiss({})},uiSubmit:function(){var e=true;var o={};o={data:{RecordShortage:{ShortageReasonCode:this.ui.selectedShortageReasonCode}}};if(this.ui.processType!="BACKROOM_PICK"){o.data.RecordShortage.MarkAllLines=this.ui.markAllLines;if(this.ui.processType=="CUSTOMER_PICKUP"&&this.ui.selectedShortageReasonCode==="Cancel"){if(!iscCore.isVoid(this.ui.cancelReason)){o.data.RecordShortage.CancellationReason=this.ui.cancelReason.CodeValue}else{e=false;this.ui.showCancelReasonError=true;d.scrollToElementWIthOffset(document.getElementById("model-body"),document.getElementById("cancelReasonContainer"),0,100)}}}if(e){s.close(o)}}})}]);
angular.module("store").controller("store.views.shipment.common.staging-location.staging-location",["$scope","$rootScope","$uibModalInstance","iscScreen","iscWizard","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal",function(a,t,i,n,o,e,s,r,l,h,g){n.initializeModalScreen(a,{model:{shipmentDetails:{}},mashupRefs:[{mashupRefId:"getShipmentStagingLocationDetails",mashupId:"store.view.shipment.getShipmentStagingLocationDetails",modelName:"shipmentDetails"},{mashupRefId:"manageStagingLocationForShipment",mashupId:"store.view.shipment.manageStagingLocationShipment"},{mashupRefId:"translateBarCodeForStagingLocation",mashupId:"store.view.shipment.translateBarCodeForStagingLocation"},{mashupRefId:"getStagingLocationBarcodeTranslationRuleDetails",mashupId:"store.views.shipment.getStagingLocationBarcodeTranslationRuleDetails"}],ui:{isStagingLocationTranlationRequired:false,stagingLocationErrors:{displayError:false,errorMsg:""}},initialize:function(){var t=[];var i=e.shipment;var a={Shipment:{ShipmentKey:i.Shipment.ShipmentKey}};t.push(r.getMashupRefObj(this,"getShipmentStagingLocationDetails",a));t.push(r.getMashupRefObj(this,"getStagingLocationBarcodeTranslationRuleDetails",{Rule:{}}));r.callMashups(this,t,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(t){var i=r.getMashupOutput(t,"getStagingLocationBarcodeTranslationRuleDetails");this.ui.isStagingLocationTranlationRequired=i&&i.Rules.RuleSetValue=="Y"?true:false},uiManageStagingLocation:function(t,i){console.log("stagingLocationDetails - ",t);console.log("action - ",i);if(i=="ADD"&&this.ui.isStagingLocationTranlationRequired){this.translateBarCodeAndSaveStagingLocation(t)}else{this.updateStagingLocationForShipment(t)}},updateStagingLocationForShipment:function(t){var i={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,HoldLocation:t}};r.callMashup(this,"manageStagingLocationForShipment",i,{}).then(this.postStagingLocationUpdate.bind(this),function(t){that.handleMashupErrors(t)})},handleMashupErrors:function(t){var i=this;this.ui.stagingLocationErrors={displayError:false,errorMsg:""};var a=t.Errors.Error[0].ErrorDescription;var n=t.Errors.Error[0].ErrorCode;if(h.hasKey("apierror."+n)){this.ui.stagingLocationErrors.displayError=true;this.ui.stagingLocationErrors.errorMsg=h.translate("apierror."+n)}},translateBarCodeAndSaveStagingLocation:function(t){var i=this;var a={BarCode:{BarCodeData:t,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};r.callMashup(this,"translateBarCodeForStagingLocation",a,{}).then(this.handleStagingLocationBarcodeTranslation.bind(this),function(t){i.handleMashupErrors(t)})},handleStagingLocationBarcodeTranslation:function(t){var i=r.getMashupOutput(t,"translateBarCodeForStagingLocation");if(i.BarCode.Shipment){this.model.shipmentDetails.Shipment.HoldLocation=angular.copy(i.BarCode.Shipment.HoldLocation);a.stagingLocationForm.$setPristine();console.log("updated shipmentDetails - ",this.model.shipmentDetails)}},postStagingLocationUpdate:function(t){var i=r.getMashupOutput(t,"manageStagingLocationForShipment");this.model.shipmentDetails.Shipment.HoldLocation=angular.copy(i.Shipment.HoldLocation);a.stagingLocationForm.$setPristine();console.log("updated shipmentDetails - ",this.model.shipmentDetails)},uiClose:function(){i.dismiss({})},uiSubmit:function(){var t={};t={data:{StagingLocation:this.model.shipmentDetails.Shipment.HoldLocation}};i.close(t)}})}]);
angular.module("store").controller("store.views.shipment.containerpack.pack-order-list.pack-order-list",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscAppContext","iscStateParams","$timeout","iscShipment","iscShipmentStatus","$filter",function(t,i,e,s,n,r,a,p,o,h,u,l){i.initializeScreen(t,{model:{shipmentList:{},filterOptions:{}},mashupRefs:[{mashupRefId:"getShipmentList",mashupId:"store.views.shipment.containerpack.getPackOrderList",modelName:"shipmentList",isPaginated:true,pageSize:15,append:true,appendPath:"Shipments.Shipment"}],ui:{apiCallInProgress:false,selectedShipmentKey:"",recordShownCount:15,numOfOrders:-1,statusArray:[],sortOptions:"N"},initialize:function(){var t=u.getShipmentStatusConfig("Pick");var i=u.getShipmentStatusConfig("Pack");var e=p.params.input.FilterOptions;if(e=="All"){this.model.filterOptions.inProgressFlag="Y";this.model.filterOptions.readyForPackingFlag="Y";this.ui.statusArray.push("1100.70.06.50");this.ui.statusArray.push("1100.70.06.70")}else if(e=="InProgress"){this.model.filterOptions.inProgressFlag="Y";this.model.filterOptions.readyForPackingFlag="N";this.ui.statusArray.push("1100.70.06.70")}else if(e=="NotStarted"){this.model.filterOptions.inProgressFlag="N";this.model.filterOptions.readyForPackingFlag="Y";this.ui.statusArray.push("1100.70.06.50")}var s=h.prepareGetShipmentListApiInput("N","SHP",this.ui.statusArray);r.callMashup(this,"getShipmentList",s,{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)},processPaginatedShipmentList:function(t){this.ui.apiCallInProgress=false;var i=r.getMashupOutput(t,"getShipmentList");this.ui.numOfOrders=l("number")(i.Page.Output.Shipments.TotalNumberOfRecords);if(i.Page.Output.Shipments.Shipment){if(iscCore.isVoid(this.ui.selectedShipmentKey)){this.ui.selectedShipmentKey=i.Page.Output.Shipments.Shipment[0].ShipmentKey}this.processShipment(i.Page.Output.Shipments)}},processShipment:function(t){for(var i=0;i<t.Shipment.length;i++){var e=t.Shipment[i];e.OrderNoToDisplay=h.getDisplayOrderNumber(e.DisplayOrderNo,"|",", ",true);e.StatusDescriptionToDisplay=h.getShipmentStatusDescription(e)}},uiSelectShipment:function(t){this.ui.selectedShipmentKey=t.ShipmentKey},uiOrderListScrollActionValidator:function(){return true},uiGetNextPackingRecords:function(){if(this.model.shipmentList.Page.IsLastPage!=="N"){return}this.ui.apiCallInProgress=true;var t=h.prepareGetShipmentListApiInput(this.ui.sortOptions,"SHP",this.ui.statusArray);r.callPaginatedMashup(this,"getShipmentList",t,"NEXT",{}).then(this.processPaginatedShipmentList.bind(this))},uiGoToShipmentSummary:function(t){e.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:t.ShipmentKey},flowName:"Pack"}},{})},uiOnApplyFilter:function(t){var i=t.readyForPackingFlag;var e=t.inProgressFlag;this.ui.statusArray=[];if(i=="Y"&&e=="Y"){this.model.filterOptions.inProgressFlag="Y";this.model.filterOptions.readyForPackingFlag="Y";this.ui.statusArray.push("1100.70.06.50");this.ui.statusArray.push("1100.70.06.70")}else if(e=="Y"){this.model.filterOptions.inProgressFlag="Y";this.model.filterOptions.readyForPackingFlag="N";this.ui.statusArray.push("1100.70.06.70")}else if(i=="Y"){this.model.filterOptions.inProgressFlag="N";this.model.filterOptions.readyForPackingFlag="Y";this.ui.statusArray.push("1100.70.06.50")}this.model.shipmentList={};var s=h.prepareGetShipmentListApiInput(this.ui.sortOptions,"SHP",this.ui.statusArray);if(t.selectedShipmentCarrier){s.Shipment.SCAC=t.selectedShipmentCarrier}r.callMashup(this,"getShipmentList",s,{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)},uiClose:function(){e.goToState("/home",{},{})},uiOpenPackFlow:function(t){e.goToState("containerpack",{input:{Shipment:{ShipmentKey:t.ShipmentKey}}},{})},uiApplySortOptions:function(t){var i={};if(t.sortOption=="NEW_TO_OLD"){this.ui.sortOptions="Y"}else if(t.sortOption=="OLD_TO_NEW"){this.ui.sortOptions="N"}i=h.prepareGetShipmentListApiInput(this.ui.sortOptions,this.ui.activeTab,this.ui.statusArray);this.model.shipmentList={};r.callMashup(this,"getShipmentList",i,{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)}})}]);
(function(){"use strict";angular.module("store").controller("store.views.shipment.containerpack.pack-products.pack-container-products",["$scope","$rootScope","$uibModalInstance","iscScreen","iscWizard","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal",function(e,i,n,t,a,s,o,r,c,p,m){t.initializeModalScreen(e,{model:{shipmentLineDetails:{},containerDetails:{}},mashupRefs:[{mashupRefId:"getContainerShipmentLineList",mashupId:"store.views.shipment.containerpack.getContainerShipmentLineList",modelName:"shipmentLineDetails"}],ui:{},initialize:function(){this.model.containerDetails=s.containerDetails;this.ui.ScacIntegrationRequired=s.ScacIntegrationRequired;var e={ShipmentLine:{ShipmentContainerKey:s.ShipmentContainerKey,ShipmentKey:s.ShipmentKey,ContainerDetails:{ContainerDetail:{Container:{ShipmentContainerKey:s.ShipmentContainerKey,ShipmentKey:s.ShipmentKey}}}}};r.callMashup(this,"getContainerShipmentLineList",e,{})},uiClose:function(){n.dismiss({})}})}])})();
(function(){"use strict";angular.module("store").controller("store.views.shipment.containerpack.pack-products.pack-products",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscModal","iscI18n","iscState","$filter","iscShipment","iscStateParams","$locale","iscPrint","$timeout",function(o,e,s,p,i,m,l,c,t,a,n,u,r,h){s.initializeWizardPage(o,{model:{shipmentDetails:{},activeContainerModel:{},scanItemInput:{barcodeData:""},lastProductScanned:{},shipmentLineList:{},shipmentContainerDetails:{},containerContents:{}},mashupRefs:[{mashupRefId:"getShipmentDetails",mashupId:"store.views.shipment.containerpack.getShipmentDetails"},{mashupRefId:"getContainerShipmentLineList",mashupId:"store.views.shipment.containerpack.getContainerShipmentLineList",modelName:"containerContents"},{mashupRefId:"registerBarcodeForPacking",mashupId:"store.views.shipment.containerpack.registerBarCodeForPacking"},{mashupRefId:"getShipmentLineList",mashupId:"store.views.shipment.containerpack.getShipmentLineList"},{mashupRefId:"containerPack_packAll",mashupId:"store.views.shipment.containerpack.packAll"},{mashupRefId:"getShipmentContainerDetails",mashupId:"store.views.shipment.containerpack.getShipmentContainerList",modelName:"shipmentContainerDetails"},{mashupRefId:"generateSCM",mashupId:"store.views.shipment.containerpack.generateSCM"},{mashupRefId:"deleteContainer",mashupId:"store.views.shipment.containerpack.deleteContainer"},{mashupRefId:"manualPackForNewContainer",mashupId:"store.views.shipment.containerpack.manualPackForNewContainer"},{mashupRefId:"manualPackForExistingContainer",mashupId:"store.views.shipment.containerpack.manualPackForExistingContainer"},{mashupRefId:"recordShortage",mashupId:"store.views.shipment.containerpack.recordShortage"},{mashupRefId:"generateTrackingNoAndPrintLabel",mashupId:"store.views.shipment.containerpack.StoreContainerLabel_94"},{mashupRefId:"reprintLabel",mashupId:"store.views.shipment.containerpack.StoreLabelReprint_94"},{mashupRefId:"getUpdatedContainerDetails",mashupId:"store.views.shipment.containerpack.getShipmentContainerDetails"},{mashupRefId:"changeShipmentForWeight",mashupId:"store.views.shipment.containerpack.changeShipmentForWeight"},{mashupRefId:"getShipmentContainerList_NoScac",mashupId:"store.views.shipment.containerpack.getShipmentContainerList_NoScac"},{mashupRefId:"getShipmentContainerList_Scac",mashupId:"store.views.shipment.containerpack.getShipmentContainerList_Scac"},{mashupRefId:"finishpack_changeShipment",mashupId:"store.views.shipment.containerpack.finishpack_changeShipment"},{mashupRefId:"voidTrackingNo",mashupId:"store.views.shipment.containerpack.voidTrackingNo"},{mashupRefId:"print_packSlip",mashupId:"store.views.shipment.containerpack.print_packSlip"}],ui:{showLastScannedProduct:false,showScanAccordion:true,showProductsAccordion:true,slaImageFullURL:"",activeTab:"0",focusOnFirstLine:true,selectedShipmentLineKey:"",contianerView:false,containerShownCount:5,showProductView:false,showPackageView:true,totalNoOfpackages:0,productLineFilter:"IN_PROGRESS",shipmentPreviewTemplate:"store/views/shipment/containerpack/pack-products/shipment-popover-preview.tpl.html",isManualPackEnabled:i.hasPermission("WSC000066"),isUnpackAllowed:i.hasPermission("WSC000063"),isPrintAllowed:i.hasPermission("WSC000064"),currentlySelectedShipmentLine:"",ONE_QUANTITY:1,currentContainerDetails:{},draftContainerDetails:{},productsToPack:0,selectDraftContainer:false,allProductsPacked:false,showSuccessMessagePanel:false,displayStatus:l.translate("containerPack.LABEL_1100_70_06_70"),successPanelMessage:l.translate("containerPack.Message_PackCompleted"),callGetContainerShipmentLineList:false,scacIntegrationReqd:"N"},_isInitSelection:true,initialize:function(){var e=s.getWizardPageInput();var i={Shipment:{ShipmentKey:e.Shipment.ShipmentKey}};if(!iscCore.isVoid(e.Shipment.ItemID)){i.Shipment.ItemID=e.Shipment.ItemID;i.Shipment.UnitOfMeasure=e.Shipment.UnitOfMeasure;i.Shipment.Quantity=e.Shipment.Quantity}var t={};t.ShipmentLine={};t.ShipmentLine.ShipmentKey=e.Shipment.ShipmentKey;var n={Shipment:{ShipmentKey:e.Shipment.ShipmentKey}};var a=[];a.push(p.getMashupRefObj(this,"getShipmentDetails",i));a.push(p.getMashupRefObj(this,"getShipmentLineList",t));a.push(p.getMashupRefObj(this,"getShipmentContainerDetails",n));p.callMashups(this,a,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){this.processShipmentDetails(e);this.processGetShipmentLineList(e);this.handleShipmentContainerDetails(e)},processShipmentDetails:function(e){if(typeof String.prototype.startsWith!="function"){String.prototype.startsWith=function(e){return this.substring(0,e.length)===e}}var i=p.getMashupOutput(e,"getShipmentDetails");this.model.shipmentDetails=i;this.ui.scacIntegrationReqd=this.model.shipmentDetails.Shipment.ScacIntegrationRequired;this.setSLAImageURL();this.initializeactiveContainerModel(i);if(this.model.shipmentDetails.Shipment.Status.Status.startsWith("1100.70.06.50")){this.ui.displayStatus=l.translate("containerPack.LABEL_1100_70_06_50")}if(Number(i.Shipment.ShipmentContainerizedFlag)===3){this.ui.allProductsPacked=true;this.ui.showSuccessMessagePanel=true}else{this.ui.allProductsPacked=false;this.ui.showSuccessMessagePanel=false;var t=s.getWizardPageInput();if(!iscCore.isVoid(t.Shipment.ItemID)){this.ui.showScanAccordion=false;this.ui.showProductsAccordion=true}}},uiGetFormattedOrderNo:function(e){return a.getDisplayOrderNumber(e,"|",", ",false)},setSLAImageURL:function(){var e=this.model.shipmentDetails.Shipment.ImageUrl;if(e){this.ui.slaImageFullURL=a.getFullURLForImage(e)}},initializeactiveContainerModel:function(e){var i={};i.Container={};if(e.Shipment.Containers.TotalNumberOfRecords==0){i.Container.ContainerScm=e.Shipment.Container.ContainerScm;i.Container.ShipmentContainerKey="";i.Container.ContainerNo=l.translate("containerPack.draftContainer");i.Container.ContainerDetails={};i.Container.ContainerDetails.TotalNumberOfRecords="0"}else{i.Container=e.Shipment.Containers.Container[0];this.ui.totalNoOfpackages=e.Shipment.Containers.TotalNumberOfRecords}this.model.activeContainerModel=i;this.ui.currentContainerDetails=i.Container},uiScanProduct:function(e){var i=[];if(iscCore.isVoid(e)){m.showErrorMessage(l.translate("containerPack.MSG_NoProductScanned"))}else{var t=this.ui.currentContainerDetails.ShipmentContainerKey;var n={BarCode:{BarCodeData:e}};n.BarCode.ShipmentContextualInfo={};n.BarCode.ShipmentContextualInfo.ShipmentKey=this.model.shipmentDetails.Shipment.ShipmentKey;var a={};a.ShipmentLine={};a.ShipmentLine.ShipmentKey=this.model.shipmentDetails.Shipment.ShipmentKey;if(iscCore.isVoid(t)){n.BarCode.ShipmentContextualInfo.ContainerScm=this.model.activeContainerModel.Container.ContainerScm;i.push(p.getMashupRefObj(this,"registerBarcodeForPacking",n));i.push(p.getMashupRefObj(this,"getShipmentLineList",a));p.callMashups(this,i,{}).then(this.handleBarCodeScanning.bind(this,t),angular.noop)}else{n.BarCode.ShipmentContextualInfo.ShipmentContainerKey=t;var s={ShipmentLine:{ShipmentContainerKey:t,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,ContainerDetails:{ContainerDetail:{Container:{ShipmentContainerKey:t,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}}}};i.push(p.getMashupRefObj(this,"registerBarcodeForPacking",n));i.push(p.getMashupRefObj(this,"getContainerShipmentLineList",s));i.push(p.getMashupRefObj(this,"getShipmentLineList",a));p.callMashups(this,i,{}).then(this.handleBarCodeScanning.bind(this,t),angular.noop)}this.model.scanItemInput.barcodeData=""}},refreshCurrentContainerContents:function(){var e={ShipmentLine:{ShipmentContainerKey:this.ui.currentContainerDetails.ShipmentContainerKey,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,ContainerDetails:{ContainerDetail:{Container:{ShipmentContainerKey:this.ui.currentContainerDetails.ShipmentContainerKey,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}}}};p.callMashup(this,"getContainerShipmentLineList",e,{})},handleBarCodeScanning:function(e,i){this.handleScanOutput(e,i);if(!iscCore.isVoid(e)){this.refreshCurrentContainerDetails(e)}var t="";var n="N";var a=p.getMashupOutput(i,"registerBarcodeForPacking");var s=0;this.model.shipmentLineList=p.getMashupOutput(i,"getShipmentLineList");if(!iscCore.isVoid(a.BarCode)&&a.BarCode.Shipment&&a.BarCode.Shipment.ShipmentLine&&a.BarCode.Shipment.ShipmentLine.ShipmentLineKey){this.ui.selectedShipmentLineKey=a.BarCode.Shipment.ShipmentLine.ShipmentLineKey;this.ui.focusOnFirstLine=false;t=a.BarCode.Shipment.ShipmentLine.ShipmentLineKey;n=a.BarCode.Shipment.ShipmentLine.IsPackComplete;if(!iscCore.isVoid(this.model.shipmentLineList)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords)){var o=[];o=this.model.shipmentLineList.ShipmentLines;if(n=="Y"){for(var r=0;r<this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords;r++){if(t==this.model.shipmentLineList.ShipmentLines.ShipmentLine[r].ShipmentLineKey){this.model.shipmentLineList.ShipmentLines.ShipmentLine[r].IsPackComplete="Y"}if(!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines.ShipmentLine[r].IsPackComplete)&&this.model.shipmentLineList.ShipmentLines.ShipmentLine[r].IsPackComplete!="Y"){s+=1}else if(iscCore.isVoid(this.model.shipmentLineList.ShipmentLines.ShipmentLine[r].IsPackComplete)){s+=1}}this.ui.productsToPack=s}for(var h=0;h<this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords;h++){if(t==this.model.shipmentLineList.ShipmentLines.ShipmentLine[h].ShipmentLineKey){var m=this.model.shipmentLineList.ShipmentLines.ShipmentLine[h];this.model.shipmentLineList.ShipmentLines.ShipmentLine.splice(h,1);this.model.shipmentLineList.ShipmentLines.ShipmentLine.splice(0,0,m)}}}if(!iscCore.isVoid(a.BarCode.Shipment.ShipmentLine.Instructions)&&!iscCore.isVoid(a.BarCode.Shipment.ShipmentLine.Instructions.Instruction)){this.uiopenPackInstructions(a.BarCode.Shipment.ShipmentLine)}}},handleScanOutput:function(e,i){var t=p.getMashupOutput(i,"registerBarcodeForPacking");if(iscCore.isVoid(e)){this.updateActiveContainerModel(t)}this.updateLastScannedProduct(t);this.setPackableQty(this.model.lastProductScanned.ShipmentLine);this.uiStampContainerDetailQty(this.model.lastProductScanned.ShipmentLine);this.resetData();if(Number(t.BarCode.Shipment.ShipmentContainerizedFlag)===3){this.ui.allProductsPacked=true;this.ui.showSuccessMessagePanel=true}else{this.ui.allProductsPacked=false;this.ui.showSuccessMessagePanel=false}var n=this.model.shipmentLineList.ShipmentLines;for(var a=0;a<this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords;a++){if(!iscCore.isVoid(n.ShipmentLine[a].IsPackComplete)&&n.ShipmentLine[a].IsPackComplete=="Y"&&n.ShipmentLine[a].ShortageQty>0){this.ui.allProductsPacked=false}}},uiDisplayContainerDetails:function(e){this.ui.currentContainerDetails=e;if(iscCore.isVoid(e.ShipmentContainerKey)){this.model.containerContents.ShipmentLines.ShipmentLine={};this.ui.currentContainerDetails.ContainerDetails={};this.ui.currentContainerDetails.ContainerDetails.TotalNumberOfRecords="0";this.ui.currentContainerDetails.ActualWeight="0"}else{var i={ShipmentLine:{ShipmentContainerKey:e.ShipmentContainerKey,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,ContainerDetails:{ContainerDetail:{Container:{ShipmentContainerKey:e.ShipmentContainerKey,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}}}};this.ui.selectDraftContainer=false;p.callMashup(this,"getContainerShipmentLineList",i,{});this.refreshCurrentContainerDetails(e.ShipmentContainerKey)}},updateActiveContainerModel:function(e){var i=[];if(!iscCore.isVoid(e.BarCode)){i=e.BarCode.Containers.Container}else if(!iscCore.isVoid(e.Shipment)){i=e.Shipment.Containers.Container}for(var t=0;t<i.length;t++){if(i[t].ContainerScm==this.model.activeContainerModel.Container.ContainerScm){var n={};n.Container={};n.Container=i[t];this.model.activeContainerModel=n;this.uiLoadShipmentContainerDetails()}}this.model.shipmentContainerDetails.Containers.Container=i;this.ui.totalNoOfpackages=i.length},updateLastScannedProduct:function(e){var i={};i.ShipmentLine={};i.ShipmentLine=e.BarCode.Shipment.ShipmentLine;this.model.lastProductScanned=i;this.ui.showLastScannedProduct=true},uiGetRemainingQuantity:function(e){var i=Number(e.Quantity);var t=Number(e.PlacedQuantity);var n=i-t;return n},uiopenPackInstructions:function(e){var i={options:{headerText:l.translate("containerPack.TITLE_PackInstructions"),headerIconCss:"app-glyphicons app-icon-package_30"}};var t=e.Instructions.Instruction.InstructionText;if(iscCore.isVoid(t)){t=e.Instructions.Instruction[0].InstructionText}m.showInfoMessage(t,i)},loadProductsView:function(e){var i={};i.ShipmentLine={};i.ShipmentLine.ShipmentContainerKey=this.model.activeContainerModel.Container.ShipmentContainerKey;i.ShipmentLine.ShipmentKey=this.model.shipmentDetails.Shipment.ShipmentKey;if(!iscCore.isVoid(e)&&e=="IN_PROGRESS"){i.ShipmentLine.IsPackComplete="Y";i.ShipmentLine.IsPackCompleteQryType="NE"}p.callMashup(this,"getShipmentLineList",i,{}).then(this.processGetShipmentLineList.bind(this))},processGetShipmentLineList:function(e){var i=p.getMashupOutput(e,"getShipmentLineList");this.model.shipmentLineList={};this.model.shipmentLineList=i;this.ui.allProductsPacked=true;var t=0;if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.ShipmentLines)&&!iscCore.isVoid(i.ShipmentLines.ShipmentLine)&&!iscCore.isVoid(i.ShipmentLines.ShipmentLine.length)){for(var n=0;n<i.ShipmentLines.ShipmentLine.length;n++){if(!iscCore.isVoid(i.ShipmentLines.ShipmentLine[n].IsPackComplete)&&i.ShipmentLines.ShipmentLine[n].IsPackComplete=="Y"&&i.ShipmentLines.ShipmentLine[n].ShortageQty==0){}else{this.ui.allProductsPacked=false;break}}for(var n=0;n<i.ShipmentLines.ShipmentLine.length;n++){if(!iscCore.isVoid(i.ShipmentLines.ShipmentLine[n].IsPackComplete)&&i.ShipmentLines.ShipmentLine[n].IsPackComplete!="Y"){t+=1}else if(iscCore.isVoid(i.ShipmentLines.ShipmentLine[n].IsPackComplete)){t+=1}}if(this._isInitSelection==true){for(var n=0;n<i.ShipmentLines.ShipmentLine.length;n++){if(!iscCore.isVoid(i.ShipmentLines.ShipmentLine[n].IsPackComplete)){if(i.ShipmentLines.ShipmentLine[n].IsPackComplete!="Y"){this.ui.selectedShipmentLineKey=i.ShipmentLines.ShipmentLine[n].ShipmentLineKey;break}else if(i.ShipmentLines.ShipmentLine[n].IsPackComplete=="Y"&&i.ShipmentLines.ShipmentLine[n].ShortageQty!="0"){this.ui.selectedShipmentLineKey=i.ShipmentLines.ShipmentLine[n].ShipmentLineKey;break}}else{this.ui.selectedShipmentLineKey=i.ShipmentLines.ShipmentLine[n].ShipmentLineKey;break}}this._isInitSelection=false}else{for(var a=0;a<this.model.shipmentLineList.ShipmentLines.ShipmentLine.length;a++){if(!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines.ShipmentLine[a].ShipmentLineKey)){if(this.model.shipmentLineList.ShipmentLines.ShipmentLine[a].ShipmentLineKey==this.ui.selectedShipmentLineKey){var s=this.model.shipmentLineList.ShipmentLines.ShipmentLine[a];this.model.shipmentLineList.ShipmentLines.ShipmentLine.splice(a,1);this.model.shipmentLineList.ShipmentLines.ShipmentLine.splice(0,0,s)}}}}this.ui.productsToPack=t}this.ui.currentlySelectedShipmentLine=this.model.shipmentLineList.ShipmentLines.ShipmentLine[0];if(iscCore.isVoid(this.ui.selectedShipmentLineKey)||this.ui.selectedShipmentLineKey==""){this.ui.focusOnFirstLine=true}this.setPackableQty(this.ui.currentlySelectedShipmentLine);this.uiStampContainerDetailQty(this.ui.currentlySelectedShipmentLine)},expandOrCollapseScanView:function(e){if(e===true){this.ui.showLastScannedProduct=false;this.model.lastProductScanned={}}},expandOrCollapseProductsView:function(e){if(e===true){this.loadProductsView(this.ui.productLineFilter)}},uiOnProductsTabSelection:function(){if(this.ui.showScanAccordion===true){this.ui.showLastScannedProduct=false;this.model.lastProductScanned={}}else if(this.ui.showProductsAccordion===true){this.resetShipmentLineSelection();this.loadProductsView(this.ui.productLineFilter)}},uiPackAll:function(){var e=this.ui.currentContainerDetails.ShipmentContainerKey;var i={};var t=[];i.Shipment={};i.Shipment.ShipmentKey=this.model.shipmentDetails.Shipment.ShipmentKey;i.Shipment.Containers={};i.Shipment.Containers.Container={};i.Shipment.Containers.Container.ContainerScm=this.ui.currentContainerDetails.ContainerScm;i.Shipment.Containers.Container.ShipmentContainerKey=e;t.push(p.getMashupRefObj(this,"containerPack_packAll",i));var n={ShipmentLine:{ShipmentContainerKey:this.ui.currentContainerDetails.ShipmentContainerKey,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,ContainerDetails:{ContainerDetail:{Container:{ShipmentContainerKey:this.ui.currentContainerDetails.ShipmentContainerKey,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}}}};t.push(p.getMashupRefObj(this,"getContainerShipmentLineList",n));p.callMashups(this,t,{}).then(this.handlePackAll.bind(this,e),angular.noop)},handlePackAll:function(e,i){var t=p.getMashupOutput(i,"containerPack_packAll");if(!iscCore.isVoid(t.Shipment.AlreadyPacked)){m.showErrorMessage(l.translate("containerPack.MessageAllLinesPacked"))}else{if(iscCore.isVoid(e)){this.updateActiveContainerModel(t)}if(Number(t.Shipment.ShipmentContainerizedFlag)===3){this.ui.showSuccessMessagePanel=true}else{this.ui.allProductsPacked=false;this.ui.showSuccessMessagePanel=false}this.refreshCurrentContainerDetails(e);this.loadProductsView()}},checkForScreenDirtyBeforeClose:function(){var e=this;var i=o.containerPackForm.$dirty;if(i){m.showConfirmationMessage(l.translate("globals.MSG_Screen_dirty")).then(function(e){if(e==="YES"){s.closeWizard()}})}else{m.showConfirmationMessage(l.translate("containerPack.MSG_CancelWarningMessage")).then(function(e){if(e==="YES"){s.closeWizard()}})}},uiCancel:function(){this.checkForScreenDirtyBeforeClose()},uiApplyProductListFilter:function(e){this.ui.productLineFilter=e.filter;this.loadProductsView(e.filter)},handleRefreshProductList:function(e,i){this.model.shipmentLineList=p.getMashupOutput(i,e);this.setPickableShipmentLineCount(this.model.shipmentLineList);this.ui.focusOnFirstLine=true;this.ui.selectedShipmentLineKey=""},handleWizardBack:function(){var e=s.isFirstPage();var i=o.containerPackForm.$dirty;if(e){if(i){m.showConfirmationMessage("globals.MSG_Screen_dirty").then(function(e){if(e==="YES"){s.closeWizard()}});return true}else{m.showConfirmationMessage("containerPack.MSG_CancelWarningMessage").then(function(e){if(e==="YES"){s.closeWizard()}});return true}}else{return false}},uiSelectShipmentLine:function(e){this._isInitSelection=false;this.ui.selectedShipmentLineKey=e.ShipmentLineKey;this.ui.focusOnFirstLine=false;this.ui.currentlySelectedShipmentLine=e;this.setPackableQty(e);this.uiStampContainerDetailQty(e)},resetShipmentLineSelection:function(){this.ui.selectedShipmentLineKey="";this.ui.focusOnFirstLine=true},uiLoadShipmentContainerDetails:function(){this.ui.contianerView=true;var e=s.getWizardPageInput();var i={Shipment:{ShipmentKey:e.Shipment.ShipmentKey}};p.callMashup(this,"getShipmentContainerDetails",i,{}).then(this.handleShipmentContainerDetails.bind(this),angular.noop)},handleShipmentContainerDetails:function(e){var i=p.getMashupOutput(e,"getShipmentContainerDetails");if(!iscCore.isVoid(this.ui.draftContainerDetails)&&!iscCore.isVoid(this.ui.draftContainerDetails.ContainerNo)){if(iscCore.isVoid(this.model.shipmentContainerDetails.Containers)){this.model.shipmentContainerDetails.Containers={};this.model.shipmentContainerDetails.Containers.Container=[]}else if(iscCore.isVoid(this.model.shipmentContainerDetails.Containers.Container)){this.model.shipmentContainerDetails.Containers.Container=[]}this.model.shipmentContainerDetails.Containers.Container.splice(0,0,this.ui.draftContainerDetails);this.ui.draftContainerDetails={}}var t=s.getWizardPageInput();if(!iscCore.isVoid(i.Containers.Container)){for(var n=0;n<i.Containers.Container.length;n++){this.updateContainerFlags(i.Containers.Container[n])}this.ui.currentContainerDetails=i.Containers.Container[0];if(!iscCore.isVoid(i.Containers.Container[0].ShipmentContainerKey)){var a={ShipmentLine:{ShipmentContainerKey:i.Containers.Container[0].ShipmentContainerKey,ShipmentKey:t.Shipment.ShipmentKey,ContainerDetails:{ContainerDetail:{Container:{ShipmentContainerKey:i.Containers.Container[0].ShipmentContainerKey,ShipmentKey:t.Shipment.ShipmentKey}}}}};p.callMashup(this,"getContainerShipmentLineList",a,{})}else{this.model.containerContents={}}}else{i.Containers.Container=[]}},uiValidateWeightAndUpdate:function(e,i){var t=u.NUMBER_FORMATS;var n=i.ActualWeight;if(n){n=n.replace(t.GROUP_SEP,"")}if(!iscCore.isVoid(n)&&e.oldWeight!==n){e.oldWeight=n;i.ActualWeight=n;if(e.oldWeight!==n){e.oldWeight=n}if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.TrackingNo)){if(i.TrackingNo!=""){var a={Container:{ShipmentContainerKey:i.ShipmentContainerKey,ShipmentKey:i.ShipmentKey}};p.callMashup(this,"voidTrackingNo",a,{}).then(this.updateWeightAfterVoiding.bind(this,i))}else{this.saveContainerWeight(i)}}else{this.saveContainerWeight(i)}}},updateWeightAfterVoiding:function(e,i){this.saveContainerWeight(e)},saveContainerWeight:function(i){if(Number(i.ContainerDetails.TotalNumberOfRecords)===0){m.showErrorMessage("containerPack.Message_EmptyContainer")}else{if(iscCore.isVoid(i.ActualWeight)){m.showErrorMessage("containerPack.Message_NoPackageWeight")}else if(Number(i.ActualWeight)<0){m.showErrorMessage("containerPack.Message_NegativePackageWeight")}else{var e={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,Containers:{Container:{ActualWeight:i.ActualWeight,ShipmentContainerKey:i.ShipmentContainerKey,ActualWeightUOM:i.ActualWeightUOM}}}};if(this.ui.scacIntegrationReqd==="N"){e.Shipment.Containers.Container.IsPackProcessComplete="Y"}else{if(!iscCore.isVoid(i.TrackingNo)){e.Shipment.CallVoidTrackingNo="Y"}}var t={Container:{ShipmentContainerKey:i.ShipmentContainerKey,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};var n=[];n.push(p.getMashupRefObj(this,"changeShipmentForWeight",e));n.push(p.getMashupRefObj(this,"getUpdatedContainerDetails",t));p.callMashups(this,n,{}).then(function(e){this.handleContainerWeightUpdate(e,i)}.bind(this),angular.noop)}}},uiShowTrackingNo:function(){if(!iscCore.isVoid(this.model.shipmentDetails)&&!iscCore.isVoid(this.model.shipmentDetails.Shipment)&&!iscCore.isVoid(this.model.shipmentDetails.Shipment.ScacIntegrationRequired)){if(this.model.shipmentDetails.Shipment.ScacIntegrationRequired=="Y"){if(!iscCore.isVoid(this.ui.currentContainerDetails.TrackingNo)&&this.ui.currentContainerDetails.TrackingNo!=""){return true}}}return false},uiScrollLeft:function(){document.getElementById("containers").scrollLeft-=120},uiScrollRight:function(){document.getElementById("containers").scrollLeft+=120},handleContainerWeightUpdate:function(e,i){var t=p.getMashupOutput(e,"getUpdatedContainerDetails");i.ActualWeight=t.Container.ActualWeight;i.TrackingNo=t.Container.TrackingNo;i.TrackingURL=t.Container.TrackingURL;this.updateContainerFlags(i);o.containerPackForm.$setPristine()},refreshCurrentContainerDetails:function(e){var i={Container:{ShipmentContainerKey:e,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};p.callMashup(this,"getUpdatedContainerDetails",i,{}).then(this.handleRefreshCurrentContainerDetails.bind(this))},handleRefreshCurrentContainerDetails:function(e){var i=p.getMashupOutput(e,"getUpdatedContainerDetails");if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.Container)){this.ui.currentContainerDetails=i.Container}},uiShowWeightUpdateButton:function(e,i){var t=u.NUMBER_FORMATS;var n=i.ActualWeight;if(n){n=n.replace(t.GROUP_SEP,"")}if(!iscCore.isVoid(n)&&Number(e.oldWeight)!==Number(n))i.showWeightUpdate="Y";else i.showWeightUpdate="N"},uiHideWeightUpdateButton:function(e){e.showWeightUpdate="N"},uiValidateWeight:function(e,i,t,n){if(!iscCore.isVoid(i)&&i.iscDatatypeValidator)return e;else var a=!isNaN(n);if(!iscCore.isBooleanTrue(a)||iscCore.isVoid(n)){e.booleanResponse=!isNaN(n)&&!iscCore.isVoid(n);e.errorMesssage=l.translate("containerPack.ERROR_invalid_input")}return e},uiAddNewContainer:function(){if(!iscCore.isVoid(this.ui.currentContainerDetails)&&!iscCore.isVoid(this.ui.currentContainerDetails.ShipmentContainerKey)&&!(this.ui.currentContainerDetails.ShipmentContainerKey=="")){if(this.model.shipmentContainerDetails.Containers.Container.length>1){if(this.isDraftContainerPresent()){if(!iscCore.isVoid(this.model.shipmentContainerDetails)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers.Container)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers.Container.length)){if(this.model.shipmentContainerDetails.Containers.Container.length>1){this.uiDisplayContainerDetails(this.model.shipmentContainerDetails.Containers.Container[0])}}document.getElementById("containers").scrollLeft=0}else{var e={generateSCM:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,EnterpriseCode:this.model.shipmentDetails.Shipment.EnterpriseCode}};p.callMashup(this,"generateSCM",e,{}).then(this.handleGenerateSCM.bind(this),angular.noop)}}else{var e={generateSCM:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,EnterpriseCode:this.model.shipmentDetails.Shipment.EnterpriseCode}};p.callMashup(this,"generateSCM",e,{}).then(this.handleGenerateSCM.bind(this),angular.noop)}}},isDraftContainerPresent:function(){var e=this.model.shipmentContainerDetails.Containers.Container;for(var i=0;i<e.length;i++){if(e[i].ShipmentContainerKey==""){return true}}},handleGenerateSCM:function(e){var i=p.getMashupOutput(e,"generateSCM");if(!iscCore.isVoid(iscCore.getValueFromJsonPath(i,"SCMs.SCM.SCM"))){this.model.activeContainerModel={Container:{}};this.model.activeContainerModel.Container.ContainerScm=i.SCMs.SCM.SCM;this.model.activeContainerModel.Container.ContainerNo=l.translate("containerPack.draftContainer");this.ui.currentContainerDetails=this.model.activeContainerModel.Container;this.ui.currentContainerDetails.ShipmentContainerKey="";this.ui.selectDraftContainer=true;if(iscCore.isVoid(iscCore.getValueFromJsonPath(this.model.shipmentContainerDetails,"Containers.Container"))){this.model.shipmentContainerDetails.Containers={Container:[]}}this.model.shipmentContainerDetails.Containers.Container.unshift(this.model.activeContainerModel.Container);this.model.shipmentContainerDetails.Containers.TotalNumberOfRecords=this.model.shipmentContainerDetails.Containers.Container.length;this.ui.showPackageView=false;this.ui.showProductView=true;this.uiOnProductsTabSelection();this.model.containerContents.ShipmentLines.ShipmentLine={};this.ui.currentContainerDetails.ContainerDetails={};this.ui.currentContainerDetails.ContainerDetails.TotalNumberOfRecords="0";this.ui.currentContainerDetails.ActualWeight="0"}},updateContainerFlags:function(e){if(this.ui.scacIntegrationReqd==="Y"){if(!iscCore.isVoid(e.TrackingNo)){e.isComplete=true}else{e.isComplete=false}}else{if(!iscCore.isVoid(e.ActualWeight)&&Number(e.ActualWeight)>0){e.isComplete=true}else{e.isComplete=false}}e.showWeightUpdate="N"},uiGenerateTrackingNo:function(i){if(!iscCore.isVoid(i.ShipmentContainerKey)){if(iscCore.isVoid(i.ActualWeight)||Number(i.ActualWeight)===0){m.showErrorMessage("containerPack.Message_ContainerNotweighed")}else{var e={Container:{ShipmentContainerKey:i.ShipmentContainerKey,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};var t=[];t.push(p.getMashupRefObj(this,"generateTrackingNoAndPrintLabel",e));t.push(p.getMashupRefObj(this,"getUpdatedContainerDetails",e));p.callMashups(this,t,{}).then(function(e){this.handleGenerateTrackingNo(e,i)}.bind(this),angular.noop)}}},handleGenerateTrackingNo:function(e,i){var t=p.getMashupOutput(e,"getUpdatedContainerDetails");var n=p.getMashupOutput(e,"generateTrackingNoAndPrintLabel");this.updateContainerFlags(t.Container);if(!iscCore.isVoid(t.Container.TrackingNo)){i.TrackingNo=t.Container.TrackingNo;i.TrackingURL=t.Container.TrackingURL}this.ui.currentContainerDetails=i;if(!iscCore.isVoid(n.Output.out)){a.decodeShippingLabelURL(n);h(function(){r.printHtmlOutput(n)},0)}else{m.showErrorMessage("containerPack.Message_Print_failure")}},uiIsScacIntegrationRequired:function(){if(!iscCore.isVoid(this.model.shipmentDetails)&&!iscCore.isVoid(this.model.shipmentDetails.Shipment)&&!iscCore.isVoid(this.model.shipmentDetails.Shipment.ScacIntegrationRequired)){return this.model.shipmentDetails.Shipment.ScacIntegrationRequired=="Y"?true:false}else{return false}},uiNoInstructions:function(e){if(!iscCore.isVoid(e.Instructions)&&!iscCore.isVoid(e.Instructions.Instruction)){return false}else{return true}},uiPackagesCount:function(e){var i=Number(e);if(!iscCore.isVoid(this.model.shipmentContainerDetails)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers.Container)){for(var t=0;t<this.model.shipmentContainerDetails.Containers.Container.length;t++){if(this.model.shipmentContainerDetails.Containers.Container[t].ContainerNo==l.translate("containerPack.draftContainer")){i=i+1}}}return i},uiViewContainerProducts:function(e){var i=this;var t={modalInput:function(){return{ShipmentContainerKey:e.ShipmentContainerKey,ShipmentKey:i.model.shipmentDetails.Shipment.ShipmentKey,containerDetails:e,ScacIntegrationRequired:i.model.shipmentDetails.Shipment.ScacIntegrationRequired}}}},uiAddMoreContainerProducts:function(e){var i=this.selectActiveContainer(e.ShipmentContainerKey,this.model.shipmentContainerDetails);this.setActiveContainer(i);this.ui.showPackageView=false;this.ui.showProductView=true;this.uiOnProductsTabSelection()},uiUnpackContainerProducts:function(t){var e=false;this.model.shipmentContainerDetails.Containers.Container;if(!iscCore.isVoid(this.model.shipmentContainerDetails)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers.Container)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers.Container.length)){if(this.model.shipmentContainerDetails.Containers.Container.length>0){for(var i=0;i<Number(this.model.shipmentContainerDetails.Containers.Container.length);i++){if(this.model.shipmentContainerDetails.Containers.Container[i].ContainerNo==l.translate("containerPack.draftContainer")){this.ui.draftContainerDetails=this.model.shipmentContainerDetails.Containers.Container[i];e=true;break}}}}if(!iscCore.isVoid(t.ShipmentContainerKey)){m.showConfirmationMessage("containerPack.Message_Delete_container").then(function(e){if(e==="YES"){var i={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,Containers:{Container:{ShipmentContainerKey:t.ShipmentContainerKey}},isDraftContainer:t.ShipmentContainerKey===""?"Y":"N"}};this.ui.deletedShipmentContainerKey=t.ShipmentContainerKey;p.callMashup(this,"deleteContainer",i,{}).then(this.handleDeleteContainer.bind(this),angular.noop)}}.bind(this),angular.noop)}},removeEmptyContainer:function(e){if(!iscCore.isVoid(e.ShipmentContainerKey)){var i={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,Containers:{Container:{ShipmentContainerKey:e.ShipmentContainerKey}},isDraftContainer:e.ShipmentContainerKey===""?"Y":"N"}};this.ui.deletedShipmentContainerKey=e.ShipmentContainerKey;p.callMashup(this,"deleteContainer",i,{})}},uiIsGenerateTrackingNoDisabled:function(e){return!iscCore.isVoid(e.TrackingNo)},uiIsReprintDisabled:function(e){return iscCore.isVoid(e.TrackingNo)},uiReprintContainerLabel:function(i){if(!iscCore.isVoid(i.TrackingNo)){var e={Container:{ShipmentContainerKey:i.ShipmentContainerKey,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};p.callMashup(this,"reprintLabel",e,{}).then(function(e){this.handleReprintLabel(e,i)}.bind(this),angular.noop)}},handleReprintLabel:function(e,i){var t=p.getMashupOutput(e,"reprintLabel");if(!iscCore.isVoid(t.Output.out)){a.decodeShippingLabelURL(t);h(function(){r.printHtmlOutput(t)},0)}else{m.showErrorMessage("containerPack.Message_Print_failure")}},handleDeleteContainer:function(e){var i=p.getMashupOutput(e,"deleteContainer");if(Number(i.Shipment.ShipmentContainerizedFlag)===1){if(this.model.activeContainerModel.Container.ShipmentContainerKey===""){var t=this.selectActiveContainer("",this.model.shipmentContainerDetails);this.setActiveContainer(t);this.ui.selectDraftContainer=true;this.ui.currentContainerDetails=this.model.activeContainerModel.Container;this.ui.currentContainerDetails.ShipmentContainerKey="";this.model.containerContents.ShipmentLines.ShipmentLine={};this.ui.currentContainerDetails.ContainerDetails.TotalNumberOfRecords="0";this.ui.currentContainerDetails.ActualWeight="0"}else{this.model.activeContainerModel={Container:i.Shipment.Containers.Container[0]};this.model.activeContainerModel.Container.ContainerNo=l.translate("containerPack.draftContainer");this.model.activeContainerModel.Container.ShipmentContainerKey="";if(iscCore.isVoid(iscCore.getValueFromJsonPath(this.model.shipmentContainerDetails,"Containers.Container"))){this.model.shipmentContainerDetails.Containers={Container:[]}}this.model.shipmentContainerDetails.Containers.Container.push(this.model.activeContainerModel.Container);this.model.shipmentContainerDetails.Containers.TotalNumberOfRecords=this.model.shipmentContainerDetails.Containers.Container.length;this.model.containerContents.ShipmentLines.ShipmentLine={};this.ui.currentContainerDetails=this.model.activeContainerModel.Container;this.ui.currentContainerDetails.ContainerDetails={};this.ui.currentContainerDetails.ContainerDetails.TotalNumberOfRecords="0";this.ui.currentContainerDetails.ActualWeight="0";this.ui.selectDraftContainer=true}}else{if(this.model.activeContainerModel.Container.ShipmentContainerKey===this.ui.deletedShipmentContainerKey){if(i.Shipment.Containers.Container.length>0){this.model.activeContainerModel={};this.model.activeContainerModel.Container=i.Shipment.Containers.Container[0];this.ui.currentContainerDetails=i.Shipment.Containers.Container[0]}}}this.ui.showSuccessMessagePanel=false;this.model.shipmentContainerDetails.Containers.TotalNumberOfRecords=i.Shipment.Containers.TotalNumberOfRecords;this.ui.totalNoOfpackages=this.model.shipmentContainerDetails.Containers.TotalNumberOfRecords;this.uiLoadShipmentContainerDetails();this.loadProductsView()},selectActiveContainer:function(e,i){var t=null;for(var n=0;n<i.Containers.Container.length;n++){var a=i.Containers.Container[n];if(iscCore.isVoid(e)&&iscCore.isVoid(a.ShipmentContainerKey)){t={};t.Container=a;break}else if(e===a.ShipmentContainerKey){t={};t.Container=a;break}}return t},uiOnWeightFieldFocus:function(e,i){var t="";if(o.containerPackForm.$valid)t=u.NUMBER_FORMATS;var n=i.ActualWeight;if(!iscCore.isVoid(n)&&t){n=n.replace(t.GROUP_SEP,"")}if(i.showWeightUpdate!=="Y"){e.oldWeight=n}},setActiveContainer:function(e){this.model.activeContainerModel=e},uiIsShipmentLinePackComplete:function(e){return e.IsPackComplete=="Y"?true:false},uiOnQuantityFieldFocus:function(e,i){var t="";if(o.containerPackForm.$valid)t=u.NUMBER_FORMATS;var n=i.ContainerDetail.QuantityPlaced;if(!iscCore.isVoid(n)&&t){n=n.replace(t.GROUP_SEP,"")}if(i.showQtyUpdate!=="Y"){e.oldQty=n}},uiShowUpdateButton:function(e,i){var t=u.NUMBER_FORMATS;var n=i.ContainerDetail.QuantityPlaced;if(n)n=n.replace(t.GROUP_SEP,"");if(!iscCore.isVoid(n)&&e.oldQty!==n&&Number(i.ContainerDetail.QuantityPlaced)!=Number(i.ContainerDetail.EditableQtyPlaced))i.showQtyUpdate="Y";else i.showQtyUpdate="N"},uiHideUpdateButton:function(e){e.showQtyUpdate="N"},uiValidateQuantityAndUpdate:function(e,i){var t=this;var n=u.NUMBER_FORMATS;var a=i.ContainerDetail.QuantityPlaced;if(a){a=a.replace(n.GROUP_SEP,"")}if(!iscCore.isVoid(a)&&e.oldQty!==a&&Number(i.ContainerDetail.QuantityPlaced)!=Number(i.ContainerDetail.EditableQtyPlaced)){e.oldQty=a;if(typeof a=="string"){a=parseInt(a,10)}var s=Number(i.PlacedQuantity);var o=0;if(!iscCore.isVoid(i.ContainerDetail)){o=Number(i.ContainerDetail.EditableQtyPlaced)}var r=s-o;var h=Number(i.Quantity)-r;if(a>h){m.showErrorMessage(l.translate("containerPack.MSG_MaxQuantityError"))}else{this.callChangeShipmentForManualPack(i,a)}}},uiShowBorderForHoldLocation:function(){if(!iscCore.isVoid(this.model.shipmentDetails.Shipment)&&!iscCore.isVoid(this.model.shipmentDetails.Shipment.HoldLocation)){if(this.model.shipmentDetails.Shipment.HoldLocation!=""){return false}else{return true}}else{return true}},uiValidateQuantity:function(e,i,t,n){if(!iscCore.isVoid(i)&&i.iscDatatypeValidator)return e;else var a=!isNaN(n);if(!iscCore.isBooleanTrue(a)||iscCore.isVoid(n)){e.booleanResponse=!isNaN(n)&&!iscCore.isVoid(n);e.errorMesssage=l.translate("containerPack.ERROR_invalid_input")}return e},uiStampContainerDetailQty:function(e){if(iscCore.isVoid(e.ContainerDetail)){e.ContainerDetail={};e.ContainerDetail.QuantityPlaced=0}e.ContainerDetail.EditableQtyPlaced=angular.copy(e.ContainerDetail.QuantityPlaced);e.showQtyUpdate="N"},setPackableQty:function(e){var i=Number(e.PlacedQuantity);var t=0;if(!iscCore.isVoid(e.ContainerDetail)){t=Number(e.ContainerDetail.QuantityPlaced)}var n=i-t;var a=Number(e.Quantity)-n;e.maxPackableQty=a},uiDecreaseQty:function(e){var i=Number(e.ContainerDetail.EditableQtyPlaced);var t=i-this.ui.ONE_QUANTITY;if(t<0){m.showErrorMessage(l.translate("containerPack.MSG_NegativeQtyError"))}this.callChangeShipmentForManualPack(e,t)},uiIncreaseQty:function(e){var i=Number(e.ContainerDetail.EditableQtyPlaced);var t=i+this.ui.ONE_QUANTITY;var n=Number(e.maxPackableQty);if(t>n){m.showErrorMessage(l.translate("containerPack.MSG_MaxQuantityError"))}this.callChangeShipmentForManualPack(e,t)},uiPackOneQty:function(e){var i=0;var t;if(!iscCore.isVoid(this.model.containerContents)&&!iscCore.isVoid(this.model.containerContents.ShipmentLines)&&!iscCore.isVoid(this.model.containerContents.ShipmentLines.ShipmentLine)){for(var n=0;n<this.model.containerContents.ShipmentLines.ShipmentLine.length;n++){if(e.ShipmentLineKey==this.model.containerContents.ShipmentLines.ShipmentLine[n].ShipmentLineKey){i=Number(this.model.containerContents.ShipmentLines.ShipmentLine[n].ContainerDetail.QuantityPlaced);break}}}var a=i+this.ui.ONE_QUANTITY;this.callChangeShipmentForManualPack(e,a);if(!iscCore.isVoid(e.Instructions)&&!iscCore.isVoid(e.Instructions.Instruction)){this.uiopenPackInstructions(e)}},callChangeShipmentForManualPack:function(e,i){var t=this.ui.currentContainerDetails.ShipmentContainerKey;var n={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};n.Shipment.Containers={};n.Shipment.Containers.Container={};var a=null;if(iscCore.isVoid(t)){n.Shipment.Containers.Container.ContainerScm=this.model.activeContainerModel.Container.ContainerScm;a="manualPackForNewContainer"}else{n.Shipment.Containers.Container.ShipmentContainerKey=t;if(this.ui.showProductsAccordion){n.Shipment.Containers.Container.VoidTrackingNo="Y"}a="manualPackForExistingContainer"}n.Shipment.Containers.Container.ContainerDetails={};n.Shipment.Containers.Container.ContainerDetails.ContainerDetail={};n.Shipment.Containers.Container.ContainerDetails.ContainerDetail.Quantity=i;n.Shipment.Containers.Container.ContainerDetails.ContainerDetail.QuantityPlaced=i;n.Shipment.Containers.Container.ContainerDetails.ContainerDetail.ShipmentLineKey=e.ShipmentLineKey;this.ui.selectedShipmentLineKey=e.ShipmentLineKey;this.ui.focusOnFirstLine=false;var s={};var o=[];o.push(p.getMashupRefObj(this,a,n));if(iscCore.isVoid(t)){this.ui.callGetContainerShipmentLineList=true}else{s={ShipmentLine:{ShipmentContainerKey:t,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,ContainerDetails:{ContainerDetail:{Container:{ShipmentContainerKey:t,ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}}}};o.push(p.getMashupRefObj(this,"getContainerShipmentLineList",s))}var r={};r.ShipmentLine={};r.ShipmentLine.ShipmentKey=this.model.shipmentDetails.Shipment.ShipmentKey;o.push(p.getMashupRefObj(this,"getShipmentLineList",r));p.callMashups(this,o,{}).then(this.handleMultiApiCalls.bind(this,t,a),angular.noop)},handleMultiApiCalls:function(e,i,t){this.postPackQuantityUpdate(e,i,t);this.processGetShipmentLineList(t);this.refreshCurrentContainerDetails(e)},postPackQuantityUpdate:function(e,i,t){var n=p.getMashupOutput(t,i);if(iscCore.isVoid(e)){this.updateActiveContainerModel(n)}if(this.ui.showScanAccordion){this.model.lastProductScanned.ShipmentLine=n.Shipment.ShipmentLine;this.model.lastProductScanned.ShipmentLine.showQtyUpdate="N";this.setPackableQty(this.model.lastProductScanned.ShipmentLine);this.uiStampContainerDetailQty(this.model.lastProductScanned.ShipmentLine)}else{this.updateShipmentLineListModel(n.Shipment)}this.resetData();if(Number(n.Shipment.ShipmentContainerizedFlag)===3){this.ui.showSuccessMessagePanel=true;var a=this;a.ui.allProductsPacked=true}else{this.ui.allProductsPacked=false;this.ui.showSuccessMessagePanel=false}},updateShipmentLineListModel:function(e){if(!iscCore.isVoid(this.model.shipmentLineList)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines)&&!iscCore.isVoid(this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords)){var i=this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords;for(var t=0;t<i;t++){var n=this.model.shipmentLineList.ShipmentLines.ShipmentLine[t];if(!iscCore.isVoid(n)&&n.ShipmentLineKey==e.ShipmentLine.ShipmentLineKey){this.model.shipmentLineList.ShipmentLines.ShipmentLine[t]=e.ShipmentLine;this.ui.currentlySelectedShipmentLine=e.ShipmentLine;this.model.shipmentLineList.ShipmentLines.ShipmentLine[t].showQtyUpdate="N";this.setPackableQty(e.ShipmentLine);this.uiStampContainerDetailQty(e.ShipmentLine);break}}}},resetData:function(){if(o.containerPackForm){o.containerPackForm.$setPristine()}if(o.quantityForm){o.quantityForm.$setPristine()}if(o.scanQuantityForm){o.scanQuantityForm.$setPristine()}},uiOpenRecordShortagePopup:function(i){var t=this;var e={};e.codeType="YCD_PACK_SHORT_RESOL";e.shipmentLine=angular.copy(i);e.shipmentLine.DisplayQty=i.PlacedQuantity;e.shipmentLine.OrderLine=i.OrderLine;e.shipmentLine.DisplayTotalQty=Number(i.Quantity);e.shipmentLine.DisplayShortQty=Number(i.Quantity)-Number(i.PlacedQuantity);var n={modalInput:function(){return e}};m.openModal("store.views.shipment.common.record-shortage.record-shortage",n,{}).then(function(e){if(e.data!==null&&e.data!==undefined){t.recordShortageForShipmentLine.call(t,e.data,i)}})},recordShortageForShipmentLine:function(e,i){var t=this.ui.currentContainerDetails.ShipmentContainerKey;var n={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};n.Shipment.ShipmentLines={};n.Shipment.ShipmentLines.ShipmentLine={};n.Shipment.ShipmentLines.ShipmentLine.ShipmentLineKey=i.ShipmentLineKey;n.Shipment.ShipmentLines.ShipmentLine.ShortageReason=e.RecordShortage.ShortageReasonCode;if(!iscCore.isVoid(t)){n.Shipment.ShipmentContainerKey=t}p.callMashup(this,"recordShortage",n,{}).then(this.postRecordShortageForShipmentLine.bind(this))},postRecordShortageForShipmentLine:function(e){var i=p.getMashupOutput(e,"recordShortage");if(i.Shipment.Status=="9000"){var t=this;var n=l.translate("containerPack.MSG_ShipmentCancelled");m.showInfoMessage(n,{}).then(function(e){c.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:t.model.shipmentDetails.Shipment.ShipmentKey}}},{})})}else{this.updateShipmentLineListModel(i.Shipment);if(Number(i.Shipment.ShipmentContainerizedFlag)===3){this.ui.showSuccessMessagePanel=true;var t=this;t.ui.allProductsPacked=true;if(!iscCore.isVoid(t.model.shipmentLineList)&&!iscCore.isVoid(t.model.shipmentLineList.ShipmentLines)&&!iscCore.isVoid(t.model.shipmentLineList.ShipmentLines.ShipmentLine)&&!iscCore.isVoid(t.model.shipmentLineList.ShipmentLines.ShipmentLine.length)){for(var a=0;a<t.model.shipmentLineList.ShipmentLines.ShipmentLine.length;a++){if(!iscCore.isVoid(t.model.shipmentLineList.ShipmentLines.ShipmentLine[a].IsPackComplete)&&t.model.shipmentLineList.ShipmentLines.ShipmentLine[a].IsPackComplete=="Y"&&t.model.shipmentLineList.ShipmentLines.ShipmentLine[a].ShortageQty==0){}else{t.ui.allProductsPacked=false;break}}}}else{this.ui.allProductsPacked=false;this.ui.showSuccessMessagePanel=false}this.refreshCurrentContainerDetails(this.ui.currentContainerDetails.ShipmentContainerKey);this.refreshCurrentContainerContents()}},uiFinishPack:function(){var e=o.containerPackForm.$dirty;var s=this;var i={};var t="";var n=[];if(e){m.showConfirmationMessage(l.translate("globals.MSG_Screen_dirty")).then(function(e){var i={};var t="";var n=[];if(e==="YES"){i={Container:{ShipmentKey:s.model.shipmentDetails.Shipment.ShipmentKey}};if(s.ui.scacIntegrationReqd=="N"){t="getShipmentContainerList_NoScac";n.push(p.getMashupRefObj(s,"getShipmentContainerList_NoScac",i))}else if(s.ui.scacIntegrationReqd=="Y"){t="getShipmentContainerList_Scac";n.push(p.getMashupRefObj(s,"getShipmentContainerList_Scac",i))}var a={Shipment:{ShipmentKey:s.model.shipmentDetails.Shipment.ShipmentKey}};n.push(p.getMashupRefObj(s,"getShipmentContainerDetails",a));p.callMashups(s,n,{}).then(s.handleGetShipmentContainerList.bind(s,t),angular.noop)}})}else{i={Container:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};if(this.ui.scacIntegrationReqd=="N"){t="getShipmentContainerList_NoScac";n.push(p.getMashupRefObj(this,"getShipmentContainerList_NoScac",i))}else if(this.ui.scacIntegrationReqd=="Y"){t="getShipmentContainerList_Scac";n.push(p.getMashupRefObj(this,"getShipmentContainerList_Scac",i))}var a={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};n.push(p.getMashupRefObj(this,"getShipmentContainerDetails",a));p.callMashups(this,n,{}).then(this.handleGetShipmentContainerList.bind(this,t),angular.noop)}},handleGetShipmentContainerList:function(e,i){var t=p.getMashupOutput(i,e);if(Number(t.Containers.ShipmentContainerizedFlag)===3){this.ui.allProductsPacked=true;var n=0;if(!iscCore.isVoid(this.model.shipmentContainerDetails)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers.Container)){for(var a=0;a<this.model.shipmentContainerDetails.Containers.Container.length;a++){if(Number(this.model.shipmentContainerDetails.Containers.Container[a].ActualWeight)=="0"&&this.model.shipmentContainerDetails.Containers.Container[a].ContainerDetails.TotalNumberOfRecords!="0"){n=n+1}if(this.ui.scacIntegrationReqd=="Y"){if(iscCore.isVoid(this.model.shipmentContainerDetails.Containers.Container[a].TrackingNo)){n=n+1}else if(this.model.shipmentContainerDetails.Containers.Container[a].TrackingNo==""){n=n+1}}}}if(Number(n)>0){var s=this;if(this.ui.scacIntegrationReqd=="N"){m.showConfirmationMessage(l.translate("containerPack.MSG_NotAllContainersWeighed")).then(function(e){if(e==="YES"){c.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:s.model.shipmentDetails.Shipment.ShipmentKey}}},{})}else{s.ui.showPackageView=true}})}else if(this.ui.scacIntegrationReqd=="Y"){m.showConfirmationMessage(l.translate("containerPack.MSG_NotAllContainersTracked")).then(function(e){if(e==="YES"){c.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:s.model.shipmentDetails.Shipment.ShipmentKey}}},{})}else{s.ui.showPackageView=true}})}}else{var o={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}};var r=[];var h={};if(!iscCore.isVoid(this.model.shipmentContainerDetails)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers)&&!iscCore.isVoid(this.model.shipmentContainerDetails.Containers.Container)){for(var a=0;a<this.model.shipmentContainerDetails.Containers.Container.length;a++){if(!iscCore.isVoid(this.model.shipmentContainerDetails.Containers.Container[a].ContainerDetails)&&this.model.shipmentContainerDetails.Containers.Container[a].ContainerNo!=l.translate("containerPack.draftContainer")){if(this.model.shipmentContainerDetails.Containers.Container[a].ContainerDetails.TotalNumberOfRecords=="0"){if(!iscCore.isVoid(this.model.shipmentContainerDetails.Containers.Container[a].ShipmentContainerKey)){h={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,Containers:{Container:{ShipmentContainerKey:this.model.shipmentContainerDetails.Containers.Container[a].ShipmentContainerKey}},isDraftContainer:this.model.shipmentContainerDetails.Containers.Container[a].ShipmentContainerKey===""?"Y":"N"}};r.push(p.getMashupRefObj(this,"deleteContainer",h))}}}}}r.push(p.getMashupRefObj(this,"finishpack_changeShipment",o));p.callMashups(this,r,{}).then(this.handleFinishPack.bind(this),angular.noop)}}else{this.ui.allProductsPacked=false;var s=this;m.showConfirmationMessage(l.translate("containerPack.MSG_NotAllLinesPacked")).then(function(e){if(e==="YES"){c.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:s.model.shipmentDetails.Shipment.ShipmentKey}}},{})}})}},handleFinishPack:function(){c.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey}}},{})},handlePrintPackSlip:function(e,i){var t=p.getMashupOutput(i,"print_packSlip");if(!iscCore.isVoid(t.Output.out)){h(function(){r.printHtmlOutput(t)},0)}else{m.showErrorMessage("containerPack.Message_Print_failure")}},uiHideNavigation:function(){var e=Number(document.getElementById("containers").offsetWidth);var i=Number(this.uiPackagesCount(this.ui.totalNoOfpackages));if(e>i*100){return true}else{return false}},uiPrintPackSlip:function(e){if(!iscCore.isVoid(e.ContainerDetails)){if(!iscCore.isVoid(e.ContainerDetails.TotalNumberOfRecords)){if(e.ContainerDetails.TotalNumberOfRecords!=0){var i={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,ShipmentContainerKey:e.ShipmentContainerKey}};p.callMashup(this,"print_packSlip",i,{}).then(this.handlePrintPackSlip.bind(this,this.model.shipmentDetails.Shipment.ShipmentKey))}else{m.showErrorMessage("containerPack.Message_Empty_Package")}}}},uiOpenItemDetails:function(e){}})}])})();
angular.module("store").controller("store.views.shipment.customer-pickup.customer-pick-order-list.customer-pick-order-list",["$scope","iscScreen","iscState","iscModal","iscI18n","iscMashup","iscAppContext","$timeout","iscShipment","$filter",function(t,i,e,s,n,p,r,u,o,a){i.initializeScreen(t,{model:{shipmentList:{}},mashupRefs:[{mashupRefId:"getShipmentList",mashupId:"store.views.shipment.customer-pick-order-list.getPickupOrderList",modelName:"shipmentList",isPaginated:true,pageSize:15,append:true,appendPath:"Shipments.Shipment"}],ui:{apiCallInProgress:false,selectedShipmentKey:"",recordShownCount:15,numOfOrders:-1,statusArray:[],sortOptions:"N"},initialize:function(){this.ui.statusArray.push("1100.70.06.30");var t=o.prepareGetShipmentListApiInput("N","PICK",this.ui.statusArray);p.callPaginatedMashup(this,"getShipmentList",t,"START",{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)},processPaginatedShipmentList:function(t){this.ui.apiCallInProgress=false;var i=p.getMashupOutput(t,"getShipmentList");this.ui.numOfOrders=a("number")(i.Page.Output.Shipments.TotalNumberOfRecords);if(i.Page.Output.Shipments.Shipment){if(iscCore.isVoid(this.ui.selectedShipmentKey)){this.ui.selectedShipmentKey=i.Page.Output.Shipments.Shipment[0].ShipmentKey}this.processShipment(i.Page.Output.Shipments)}},uiClose:function(){e.goToState("/home",{},{})},processShipment:function(t){for(var i=0;i<t.Shipment.length;i++){var e=t.Shipment[i];e.OrderNoToDisplay=o.getDisplayOrderNumber(e.DisplayOrderNo,"|",", ",true);e.StatusDescriptionToDisplay=o.getShipmentStatusDescription(e)}},uiSelectShipment:function(t){this.ui.selectedShipmentKey=t.ShipmentKey},uiOrderListScrollActionValidator:function(){return true},uiGetNextPickingRecords:function(){if(this.model.shipmentList.Page.IsLastPage!=="N"){return}this.ui.apiCallInProgress=true;apiInput=o.prepareGetShipmentListApiInput(this.ui.sortOptions,"PICK",this.ui.statusArray);p.callPaginatedMashup(this,"getShipmentList",apiInput,"NEXT",{}).then(this.processPaginatedShipmentList.bind(this))},uipickOrder:function(t){e.goToState("customer-pickup",{input:{Shipment:{ShipmentKey:t}}},{})},uiGoToShipmentSummary:function(t){e.goToState("shipmentsummary",{input:{Shipment:{ShipmentKey:t.ShipmentKey},flowName:"CustomerPickup"}},{})},uiApplySortOptions:function(t){var i={};if(t.sortOption=="NEW_TO_OLD"){this.ui.sortOptions="Y"}else if(t.sortOption=="OLD_TO_NEW"){this.ui.sortOptions="N"}i=o.prepareGetShipmentListApiInput(this.ui.sortOptions,"PICK",this.ui.statusArray);this.model.shipmentList={};p.callMashup(this,"getShipmentList",i,{}).then(this.processPaginatedShipmentList.bind(this),angular.noop)}})}]);
angular.module("store").controller("store.views.appointments.in-store.manage-appointment.customer-lookup",["$scope","iscScreen","iscState","iscI18n","iscMashup","iscAppContext","$timeout","iscShipment","iscWizard","iscShipmentStatus","iscInStoreAppointment","iscModal","$filter",function(i,e,t,o,a,r,s,u,n,m,d,C,l){n.initializeWizardPage(i,{model:{customerList:{},newCustomer:{},selectedCustomer:{}},mashupRefs:[{mashupRefId:"findCustomerProfileBySearchCriteria",mashupId:"store.views.manage-appointment.findCustomerProfileBySearchCriteria",modelName:"customerList"},{mashupRefId:"getPaginatedCustomerList",mashupId:"store.views.manage-appointment.findCustomerProfileByPhoneCriteria",isPaginated:true,pageSize:15,append:true,setFocus:true,appendPath:"CustomerList.Customer",modelName:"customerList"},{mashupRefId:"manageCustomer",mashupId:"store.views.manage-appointment.manageCustomer"},{mashupRefId:"manageCustomerForEdit",mashupId:"store.views.manage-appointment.manageCustomerForEdit"},{mashupRefId:"changeOrder",mashupId:"store.views.manage-appointment.customer-lookup.changeOrder"},{mashupRefId:"confirmDraftOrder",mashupId:"store.views.manage-appointment.confirmDraftOrder"},{mashupRefId:"deleteDraftAppntSalesOrder",mashupId:"store.views.appointments.in-store.deleteAppointmentSalesOrder"},{mashupRefId:"getAndDeletePendingWorkOrderLines",mashupId:"store.views.appointments.in-store.getAndDeletePendingWorkOrderLines"}],ui:{selectedAddress:{},selectedCustomer:{},showSearchCriteria:true,showAdvanceSearch:false,lookupType:"BASIC_SEARCH",showNewCustomerPreview:false,newCustomerKey:null},initialize:function(){i.$on("AddressVerified",function(e,t){i.formScope=t.formScope;if(t){var r={customer:{},addressSelected:t.data};if(t.State=="SINGLE_ADDRESS"){if(i.formScope.addressCapture.$invalid){console.log("screen in error")}else{var s={data:r};i.uiCallManageApi(s)}}else if(t.State=="MULTI_ADDRESS"){i.currentSelection={data:r};i.uiChangeScreenState("AddressMatchSelected")}else if(t.State=="MODIFY_ADDRESS"){i.currentSelection={data:r};i.uiChangeScreenState("AddressBeingModified")}}})},uiGetNextCustomerRecords:function(){if(this.model.customerList.Page.IsLastPage!=="N"){return}this.ui.apiCallInProgress=true;var e={};if(this.ui.lookupType=="BASIC_SEARCH"){this.uiFindCustomers("NEXT")}else if(this.ui.lookupType=="ADV_SEARCH"){this.uiFindCustomerBySearchCriteria("NEXT")}},uiCustomerListScrollActionValidator:function(){if(this.model.customerList.Page.IsLastPage!=="N"){return false}else return true},uiFindCustomers:function(e){if(!iscCore.isVoid(this.model.lookupValue)){var t={Customer:{CustomerContactList:{CustomerContact:{ComplexQuery:{Or:{Exp:[]}}}}}};if(this.model.lookupValue.indexOf("@")>-1){var r={Name:"EmailID",QryType:"EQ",Value:this.model.lookupValue};t.Customer.CustomerContactList.CustomerContact.ComplexQuery.Or.Exp.push(r)}else{var s={Name:"DayPhone",QryType:"EQ",Value:this.model.lookupValue};t.Customer.CustomerContactList.CustomerContact.ComplexQuery.Or.Exp.push(s)}this.ui.lookupType="BASIC_SEARCH";if(e=="START"){this.model.customerList={}}if(!iscCore.isVoid(this.ui.search)&&!iscCore.isVoid(this.ui.search.CustomerContactList)){this.ui.search.CustomerContactList.CustomerContact={}}this.ui.CustomerPaymentMethod="";a.callPaginatedMashup(this,"getPaginatedCustomerList",t,e,{}).then(this.processCustomerProfileSearchResult.bind(this),angular.noop)}else{C.showErrorMessage(o.translate("customerprofile.MSG_InvalidCustomerSearchData"))}},uiFindCustomerBySearchCriteria:function(e){this.ui.lookupType="ADV_SEARCH";this.model.lookupValue="";var t={Customer:{CustomerContactList:{CustomerContact:{}}}};if(this.ui.search&&this.ui.search.CustomerContactList){t.Customer.CustomerContactList.CustomerContact=this.ui.search.CustomerContactList.CustomerContact}if(this.ui.search&&this.ui.search.CustomerPaymentMethod&&this.ui.search.CustomerPaymentMethod.DisplayCreditCardNo){t.Customer.CustomerPaymentMethodList={CustomerPaymentMethod:this.ui.search.CustomerPaymentMethod}}if(e=="START"){this.model.customerList={}}a.callPaginatedMashup(this,"getPaginatedCustomerList",t,e,{}).then(this.processCustomerProfileSearchResult.bind(this),angular.noop)},processCustomerProfileSearchResult:function(e){this.ui.showSearchCriteria=false;var t=a.getMashupOutput(e,"getPaginatedCustomerList");this.ui.selectedCustomer=this.model.customerList.Page.Output.CustomerList.Customer[0];this.uiOnCustomerSelection(this.model.customerList.Page.Output.CustomerList.Customer[0]);i.customerLookup.$setPristine()},uiCreateCustomer:function(){if(i.formScope&&i.formScope.addressCapture&&i.formScope.addressCapture.$invalid){console.log("Screen is in error")}else{i.$broadcast("callVerifyAddress",{id:"1"})}},uiCallManageApi:function(e){var t=e.data.addressSelected;var r={};r.Customer={};r.Customer=t;var s=n.getWizardModel("createAppointmentOrderModel");r.Customer.OrderHeaderKey=s.Order.OrderHeaderKey;if(iscCore.isVoid(this.model.selectedCustomer.Customer)){a.callMashup(this,"manageCustomer",r,{}).then(this.successHandler.bind(this),angular.noop)}else{r.Customer.CustomerKey=this.model.selectedCustomer.Customer.CustomerKey;r.Customer.CustomerContactID=this.model.selectedCustomer.Customer.CustomerContactList.CustomerContact[0].CustomerContactID;a.callMashup(this,"manageCustomer",r,{}).then(this.successHandler.bind(this),angular.noop)}},successHandler:function(e){var t=a.getMashupOutput(e,"manageCustomer");this.ui.newCustomerKey=t.Customer.CustomerKey;var r=t.Customer.CustomerContactList.CustomerContact[0].CustomerAdditionalAddressList.CustomerAdditionalAddress[0];var s={customerModel:t,addressSelected:r};var o={data:s};this.model.newCustomer=t;this.model.selectedCustomer=t;this.ui.showNewCustomerPreview=true;n.setWizardModel("createAppointmentCustomerModel",t);i.customerLookup.$setPristine()},editAddresssuccessHandler:function(e){var t=a.getMashupOutput(e,"manageCustomerForEdit");var r=t.Customer.CustomerContactList.CustomerContact[0].CustomerAdditionalAddressList.CustomerAdditionalAddress[0];var s={customerModel:t,addressSelected:r};var o={data:s};this.model.newCustomer=t;this.model.selectedCustomer=t;this.ui.showNewCustomerPreview=true},uiEditCustomerInfo:function(){this.ui.showNewCustomerPreview=false},uiStampCustomerAndConfirmDraftOrder:function(){var e=n.getWizardModel("createAppointmentOrderModel");if(!iscCore.isVoid("this.ui.newCustomerKey")&&this.ui.newCustomerKey==this.model.selectedCustomer.Customer.CustomerKey){var t={};t.ConfirmDraftOrder={};t.ConfirmDraftOrder.OrderHeaderKey=e.Order.OrderHeaderKey;a.callMashup(this,"confirmDraftOrder",t,{}).then(this.handlechangeOrderForCustomer.bind(this),angular.noop)}else{var r={};r=angular.copy(this.model.selectedCustomer);var s={};s.Order={};s.Order.OrderHeaderKey=e.Order.OrderHeaderKey;s.Order.BillToID=r.Customer.CustomerID;s.Order.PersonInfoBillTo={};s.Order.PersonInfoBillTo=angular.copy(r.Customer.CustomerContactList.CustomerContact[0].CustomerAdditionalAddressList.CustomerAdditionalAddress[0].PersonInfo);if(r.Customer.CustomerType==="02"||r.Customer.CustomerContactList&&r.Customer.CustomerContactList.CustomerContact&&r.Customer.CustomerContactList.CustomerContact.length===1){s.Order.CustomerContactID=r.Customer.CustomerContactList.CustomerContact[0].CustomerContactID;s.Order.CustomerFirstName=r.Customer.CustomerContactList.CustomerContact[0].FirstName;s.Order.CustomerLastName=r.Customer.CustomerContactList.CustomerContact[0].LastName;s.Order.CustomerEMailID=r.Customer.CustomerContactList.CustomerContact[0].EmailID;s.Order.CustomerZipCode=r.Customer.CustomerContactList.CustomerContact[0].CustomerAdditionalAddressList.CustomerAdditionalAddress[0].PersonInfo.ZipCode}a.callMashup(this,"changeOrder",s,{}).then(this.handlechangeOrderForCustomer.bind(this),angular.noop)}},handlechangeOrderForCustomer:function(){n.finishWizard()},uiUpdateSelection:function(e){if(e=="New_Customer"){if(!iscCore.isVoid(this.ui.newCustomerKey)){this.model.selectedCustomer=this.model.newCustomer;this.ui.showNewCustomerPreview=true}else{if(!this.ui.showSearchCriteria){this.ui.selectedCustomer={};this.model.selectedCustomer={};this.ui.showNewCustomerPreview=false}}}else if(e=="Existing_Customer"){this.ui.showSearchCriteria=true;this.ui.showAdvanceSearch=false;if(!iscCore.isVoid(this.ui.search)&&!iscCore.isVoid(this.ui.search.CustomerContactList)){this.ui.search.CustomerContactList.CustomerContact={}}this.ui.CustomerPaymentMethod="";this.model.lookupValue=""}},getAppointmentSalesOrderWizardModel:function(){return n.getWizardModel("createAppointmentOrderModel")},uiClose:function(){var e=o.translate("instoreappointment.MSG_ExitAppointmentCreationFlow");C.showConfirmationMessage(e).then(function(e){if(e==="YES"){n.closeWizard()}})},handleWizardBack:function(){var e=n.isFirstPage();var t=i.customerLookup.$dirty;if(t){var r=null;if(e){r=o.translate("order.WarningMessage_Cancel");C.showConfirmationMessage(r).then(function(e){if(e==="YES"){n.closeWizard()}})}else{C.showConfirmationMessage(o.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){n.gotoPreviousPage(true)}})}return true}else if(e){var r=o.translate("instoreappointment.MSG_ExitAppointmentCreationFlow");C.showConfirmationMessage(r).then(function(e){if(e==="YES"){n.closeWizard()}});return true}else{return false}},uiOnCustomerSelection:function(e){var t={};t.Customer={};t.Customer=e;this.model.selectedCustomer=t},uiShowSearchCriteria:function(){this.ui.showSearchCriteria=true;this.model.selectedCustomer={}},uiCheckDirtyStateBeforeConfirmDraftOrder:function(){var e=i.customerLookup.$dirty;if(!this.ui.showNewCustomerPreview&&!this.ui.showSearchCriteria){e=false}if(e){var t=this;C.showConfirmationMessage(o.translate("addItems.MSG_Screen_dirty")).then(function(e){if(iscCore.isBooleanTrue(e)){t.uiStampCustomerAndConfirmDraftOrder()}})}else{this.uiStampCustomerAndConfirmDraftOrder()}},handleWizardExit:function(){var t=this;var e=o.translate("instoreappointment.MSG_ExitAppointmentCreationFlow");C.showConfirmationMessage(e).then(function(e){if(e==="YES"){t.cleanupPendingData()}});return true},cleanupPendingData:function(){var e=[];var t=n.getWizardModel("createAppointmentOrderModel");if(!iscCore.isVoid(t)){if(d.isDraftAppointmentSalesOrder()){e.push(a.getMashupRefObj(this,"deleteDraftAppntSalesOrder",d.getDeleteAppointmentSalesOrderInput(t)))}else{e.push(a.getMashupRefObj(this,"getAndDeletePendingWorkOrderLines",{WorkOrder:{OrderHeaderKey:t.Order.OrderHeaderKey}}))}if(e.length>0){a.callMashups(this,e,{}).then(function(e){n.exitWizard()},angular.noop)}else{n.exitWizard()}}else{n.exitWizard()}}})}]);
angular.module("store").controller("store.views.appointments.in-store.manage-appointment.schedule.appointment-schedule",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscModal","iscI18n","iscState","$filter","iscStateParams","$interval","$timeout","iscAppointment","iscObjectUtility","iscInStoreAppointment","iscAppContext","iscRule",function(t,e,i,s,r,a,n,o,d,p,l,u,h,m,O,c,k){i.initializeWizardPage(t,{model:{appointmentDetails:{},appointmentOptions:{},calenderWeekData:{},customerDetails:{}},mashupRefs:[{mashupRefId:"getAppointmentDetails",mashupId:"store.views.appointments.in-store.manage-appointment.schedule.getAppointmentDetails",modelName:"appointmentDetails"},{mashupRefId:"getAppointmentOptions",mashupId:"store.views.appointments.in-store.manage-appointment.schedule.getAppointmentOptions",modelName:"appointmentOptions"},{mashupRefId:"updateAppointmentDetails",mashupId:"store.views.appointments.in-store.manage-appointment.schedule.updateAppointmentDetails"},{mashupRefId:"removeServiceFromDraftOrder",mashupId:"store.views.appointments.in-store.manage-appointment.schedule.deleteAppointmentDetails"},{mashupRefId:"getStoreAvailabilityForWeek",mashupId:"store.views.appointments.in-store.manage-appointment.schedule.getStoreAvailabilityForWeek"},{mashupRefId:"confirmAppointment",mashupId:"store.views.appointments.in-store.manage-appointment.schedule.confirmAppointment"},{mashupRefId:"deleteServiceFromConfirmedOrder",mashupId:"store.views.appointments.in-store.manage-appointment.schedule.deleteUnconfirmedAppointment"},{mashupRefId:"deleteDraftAppntSalesOrder",mashupId:"store.views.appointments.in-store.deleteAppointmentSalesOrder"},{mashupRefId:"getStoreWorkOrderListByService",mashupId:"store.views.appointments.in-store.manage-appointment.schedule.getStoreWorkOrderListByService"},{mashupRefId:"getAndDeletePendingWorkOrderLines",mashupId:"store.views.appointments.in-store.getAndDeletePendingWorkOrderLines"}],ui:{initalDataLoaded:false,selectedDate:"",selectedWorkOrder:undefined,selectedWorkOrderIndex:0,workOrder:undefined,loadingCalenderWeekData:true,loadingTimeSlotData:false,showFinish:false,isDraftAppointmentSalesOrder:true,customerIdentified:false,currentStore:c.getFromContext("storeName"),maxAppointmentDaysAhead:k.getRuleSetValue("maxAppointmentDaysAhead"),unavailableReason:"",isSelectedDateAHoliday:false,loadingWeekData:true},initialize:function(){var e=i.getWizardModel("createAppointmentOrderModel");s.callMashup(this,"getAppointmentDetails",{Order:{OrderHeaderKey:e.Order.OrderHeaderKey}},{}).then(this.handleGetAppointmentDetials.bind(this),angular.noop);this.model.customerDetails=i.getWizardModel("createAppointmentCustomerModel");if(!iscCore.isVoid(this.model.customerDetails)){this.ui.customerIdentified=true}t.$watch("ui.workOrder",function(e){if(e!==undefined&&e.WorkOrderKey!==undefined&&!iscCore.isVoid(iscCore.getValueFromJsonPath(e,"selectedTimeSlot.slot.Date",false))){this.ui.selectedDate=e.selectedTimeSlot.slot.Date}u(this.handleWorkOrderChange.bind(this),0)}.bind(this))},uiHandleDateChange:function(e){this.ui.selectedDate=e.selectedDate;this.handleWorkOrderChange()},uiHandleDateSelectionChangeIsHoliday:function(e){this.ui.isSelectedDateAHoliday=e.isHoliday},uiHandleWeekChange:function(e){var t={Calendar:{CalendarKey:this.ui.workOrder.NodeBusinessCalendarKey,FromDate:e.fromDate,ToDate:e.toDate}};this.ui.loadingCalenderWeekData=true;s.callMashup(this,"getStoreAvailabilityForWeek",t,{}).then(this.processWeeklySlotsMashupOutput.bind(this),angular.noop)},processWeeklySlotsMashupOutput:function(e){var t=s.getMashupOutput(e,"getStoreAvailabilityForWeek");this.ui.calenderWeekData=h.getCalenderWeekData(t);this.ui.loadingCalenderWeekData=false},handleWorkOrderChange:function(){this.ui.loadingWeekData=false;if(this.ui.workOrder!==undefined&&this.ui.workOrder.WorkOrderKey!==undefined&&!this.ui.workOrder.DisplayAppointmentInPastWarning&&!iscCore.isVoid(this.ui.selectedDate)){var e={Promise:{WorkOrderKey:this.ui.workOrder.WorkOrderKey,Overrides:{ReqDeliveryDate:this.ui.selectedDate.substring(0,10)+"T00:00:00",Timezone:this.ui.workOrder.Timezone}}};this.ui.loadingTimeSlotData=true;s.callMashup(this,"getAppointmentOptions",e,{showMask:false}).then(this.handleGetAppointmentOptions.bind(this),angular.noop)}},handleGetAppointmentDetials:function(e){this.ui.initalDataLoaded=true;var t=s.getMashupOutput(e,"getAppointmentDetails");this.ui.isDraftAppointmentSalesOrder=O.isDraftAppointmentSalesOrder(t);this.removeCancelledWorkOrders(t.Order.WorkOrders);this.ui.workOrder=t.Order.WorkOrders.WorkOrder[this.ui.selectedWorkOrderIndex];this.ui.showFinish=!iscCore.isVoid(t.Order.BillToID);for(var r=0;r<t.Order.WorkOrders.WorkOrder.length;r++){var i=t.Order.WorkOrders.WorkOrder[r];if(i.WorkOrderAppointments&&i.WorkOrderAppointments.WorkOrderAppointment&&i.WorkOrderAppointments.WorkOrderAppointment[0]){var n=i.WorkOrderAppointments.WorkOrderAppointment[0].PromisedApptStartDate;var o=i.WorkOrderAppointments.WorkOrderAppointment[0].PromisedApptEndDate;i.selectedTimeSlot=h.getTimeSlotData(n,o,i.TimezoneOffset);i.isAppointmentDateInPast=h.isAppointmentTimePassed(n,i.TimezoneOffset);i.DisplayAppointmentInPastWarning=i.isAppointmentDateInPast;i._hasConfirmedAppointment=true}else if(!this.ui.isDraftAppointmentSalesOrder){i._hasConfirmedAppointment=false}i.selectedShipNode=i.WorkOrderServiceLines.WorkOrderServiceLine[0].OrderLine.Shipnode}},handleGetAppointmentOptions:function(e){var t=s.getMashupOutput(e,"getAppointmentOptions");var r=t.Promise.Overrides.ReqDeliveryDate.substring(19,25);if(iscCore.isBooleanFalse(t.Promise.SuggestedOption.Option.HasAnyUnavailableQty)){var i=t.Promise.SuggestedOption.Option.PromiseServiceLines.PromiseServiceLine[0].Slots;i.TimezoneOffset=r;this.ui.slotGroupData=h.getSlotGroupData(i)}else{this.ui.slotGroupData={hasAnyAvailableSlot:false}}this.ui.unavailableReason="";if(!iscCore.isVoid(iscCore.getValueFromJsonPath(t,"Promise.SuggestedOption.UnavailableLines.UnavailableLine"))){this.ui.unavailableReason=t.Promise.SuggestedOption.UnavailableLines.UnavailableLine[0].Reasons.Reason[0].Text}this.ui.loadingTimeSlotData=false},uiSelectPreviousAppointment:function(){this.ui.selectedWorkOrderIndex=this.ui.selectedWorkOrderIndex>0?this.ui.selectedWorkOrderIndex-1:this.ui.selectedWorkOrderIndex;this.ui.workOrder=this.model.appointmentDetails.Order.WorkOrders.WorkOrder[this.ui.selectedWorkOrderIndex]},uiSelectNextAppointment:function(){this.ui.selectedWorkOrderIndex=this.ui.selectedWorkOrderIndex<this.model.appointmentDetails.Order.WorkOrders.WorkOrder.length-1?this.ui.selectedWorkOrderIndex+1:this.ui.selectedWorkOrderIndex;this.ui.workOrder=this.model.appointmentDetails.Order.WorkOrders.WorkOrder[this.ui.selectedWorkOrderIndex]},uiOnSlotSelectionChange:function(){console.log(this.ui.workOrder.selectedTimeSlot)},uiContinue:function(){this.updateWorkOrderDetails()},uiReschedule:function(){this.ui.workOrder.DisplayAppointmentInPastWarning=false;this.handleWorkOrderChange()},uiCancelAppointment:function(){var t=this;this.ui.workOrder.deleteWorkOrder=true;var e={appointmentModel:{OrderHeaderKey:this.model.appointmentDetails.Order.OrderHeaderKey,WorkOrderKey:this.ui.workOrder.WorkOrderKey}};var r={modalInput:function(){return e}};a.openModal("store.views.appointments.common.cancel-appointment.cancel-appointment",r,{}).then(function(e){if(e.data!==null&&e.data!==undefined&&e.data.markAsCancelSuccess){t.handleCancelAppointment()}},angular.noop)},handleCancelAppointment:function(){this.removeCancelledWorkOrders(this.model.appointmentDetails.Order.WorkOrders)},uiDeleteAppointment:function(){a.showConfirmationMessage("appointmentschedule.MESSAGE_Remove_appointment").then(function(e){if(e==="YES"){this.ui.workOrder.deleteWorkOrder=true;var t=this.ui.isDraftAppointmentSalesOrder?"removeServiceFromDraftOrder":"deleteServiceFromConfirmedOrder";var r=O.deleteAppointmentInput(this.ui.workOrder);s.callMashup(this,t,r,{}).then(this.handleDeleteAppointment.bind(this),angular.noop)}}.bind(this),angular.noop)},handleDeleteAppointment:function(e){this.removeCancelledWorkOrders(this.model.appointmentDetails.Order.WorkOrders)},removeCancelledWorkOrders:function(e){for(var t=0;t<e.WorkOrder.length;t++){var r=e.WorkOrder[t];if(r.Status.Status.match("1400")||r.Status.Status.match("1600")||iscCore.isVoid(r.WorkOrderServiceLines.WorkOrderServiceLine)){e.WorkOrder.splice(t,1);t--}if(r.deleteWorkOrder){e.WorkOrder.splice(t,1);t--}}if(this.ui.selectedWorkOrderIndex>0&&this.ui.selectedWorkOrderIndex>=e.WorkOrder.length){this.ui.selectedWorkOrderIndex=this.ui.selectedWorkOrderIndex-1}if(e.WorkOrder.length===0){if(O.isDraftAppointmentSalesOrder(this.model.appointmentDetails)){a.showWarningMessage("appointmentschedule.MESSAGE_No_services_available").then(function(e){i.gotoPreviousPage(true)}.bind(this),angular.noop)}else{a.showWarningMessage("appointmentschedule.MESSAGE_AppointmentCancelled").then(function(e){i.finishWizard()}.bind(this),angular.noop)}}else{this.ui.workOrder=e.WorkOrder[this.ui.selectedWorkOrderIndex]}},updateWorkOrderDetails:function(){var e=false;var t=null;var r=[];for(var i=0;i<this.model.appointmentDetails.Order.WorkOrders.WorkOrder.length;i++){var n=this.model.appointmentDetails.Order.WorkOrders.WorkOrder[i];if(iscCore.isVoid(iscCore.getValueFromJsonPath(n,"selectedTimeSlot.slot.Date"))){e=true;t=i;break}else{var o=O.getScheduleAppointmentInput(n);if(!iscCore.isVoid(o)){r.push(s.getMashupRefObj(this,"updateAppointmentDetails",o))}}}if(!e){console.log(r);if(r.length>0){s.callMashups(this,r,{isMultiAPICall:true}).then(this.handleUpdateWorkOrderDetails.bind(this),this.handleUpdateWorkOrderDetailsError.bind(this))}else{this.processPendingWorkOrderServiceLines()}}else{a.showErrorMessage("appointmentschedule.MESSAGE_Unsheduled_appointments").then(function(){this.ui.selectedWorkOrderIndex=t;this.ui.workOrder=this.model.appointmentDetails.Order.WorkOrders.WorkOrder[this.ui.selectedWorkOrderIndex]}.bind(this))}},processPendingWorkOrderServiceLines:function(){s.callMashup(this,"getAndDeletePendingWorkOrderLines",{WorkOrder:{OrderHeaderKey:this.model.appointmentDetails.Order.OrderHeaderKey}},{}).then(this.processAppointmentSalesOrderAndGotoNextScreen.bind(this),angular.noop)},handleUpdateWorkOrderDetails:function(e){this.processAppointmentSalesOrderAndGotoNextScreen()},processAppointmentSalesOrderAndGotoNextScreen:function(){if(O.isDraftAppointmentSalesOrder(this.model.appointmentDetails)){if(this.ui.showFinish){var e=i.getWizardModel("createAppointmentOrderModel");s.callMashup(this,"confirmAppointment",{Order:{OrderHeaderKey:e.Order.OrderHeaderKey}},{}).then(function(){i.finishWizard()}.bind(this),angular.noop)}else{this.gotoCustomerLookup()}}else{i.finishWizard()}},gotoCustomerLookup:function(){i.gotoCustomPage("customer-lookup",{},{})},handleUpdateWorkOrderDetailsError:function(e){if(e.Errors.Attributes.ErrorCode==="VAS00066"){var t=e.Errors.Attributes.WorkOrderNo;for(var r=0;r<this.model.appointmentDetails.Order.WorkOrders.WorkOrder.length;r++){var i=this.model.appointmentDetails.Order.WorkOrders.WorkOrder[r];if(i.WorkOrderNo===t){a.showErrorMessage(n.translate("appointmentschedule.MESSAGE_No_slot_available",{service:i.WorkOrderServiceLines.WorkOrderServiceLine[0].ItemShortDescription}))}}}else{s.handleMashupError(e)}},uiSelectStore:function(e){var t=this;var r=this.ui.workOrder.WorkOrderServiceLines.WorkOrderServiceLine[0].OrderLine;var i={modalInput:function(){return{inputData:{Item:{ItemID:r.ItemDetails.ItemID,UnitOfMeasure:r.ItemDetails.UnitOfMeasure},ShipNode:r.Shipnode.ShipNode}}}};a.openModal("store.views.appointments.in-store.change-store.change-store",i,{}).then(function(e){t.afterStoreSelection.call(t,e.data)},angular.noop)},afterStoreSelection:function(e){var t=O.getStoreWorkOrderByserviceInput(e,this.ui.workOrder);s.callMashup(this,"getStoreWorkOrderListByService",t,{}).then(this.processWorkOrderList.bind(this),angular.noop)},processWorkOrderList:function(e){var t=s.getMashupOutput(e,"getStoreWorkOrderListByService");console.log("WorkOrderList - ",t);if(!iscCore.isVoid(t)&&!iscCore.isVoid(t.WorkOrders)&&!iscCore.isVoid(t.WorkOrders.WorkOrder[0])){var r=t.WorkOrders.WorkOrder[0];if(r.WorkOrderAppointments&&r.WorkOrderAppointments.WorkOrderAppointment&&r.WorkOrderAppointments.WorkOrderAppointment[0]){var i=r.WorkOrderAppointments.WorkOrderAppointment[0].PromisedApptStartDate;var n=r.WorkOrderAppointments.WorkOrderAppointment[0].PromisedApptEndDate;r.selectedTimeSlot=h.getTimeSlotData(i,n,r.TimezoneOffset);r.isAppointmentDateInPast=h.isAppointmentTimePassed(i,r.TimezoneOffset);r.DisplayAppointmentInPastWarning=r.isAppointmentDateInPast;r._hasConfirmedAppointment=true}else{r._hasConfirmedAppointment=false}r.selectedShipNode=r.WorkOrderServiceLines.WorkOrderServiceLine[0].OrderLine.Shipnode;this.model.appointmentDetails.Order.WorkOrders.WorkOrder[this.ui.selectedWorkOrderIndex]=r;this.ui.workOrder=r}},uiFinish:function(){this.updateWorkOrderDetails()},handleWizardExit:function(){var t=this;var e=n.translate("instoreappointment.MSG_ExitAppointmentCreationFlow");a.showConfirmationMessage(e).then(function(e){if(e==="YES"){t.cleanupPendingData()}});return true},cleanupPendingData:function(){var e=[];var t=i.getWizardModel("createAppointmentOrderModel");if(!iscCore.isVoid(t)){if(O.isDraftAppointmentSalesOrder()){e.push(s.getMashupRefObj(this,"deleteDraftAppntSalesOrder",O.getDeleteAppointmentSalesOrderInput(t)))}else{e.push(s.getMashupRefObj(this,"getAndDeletePendingWorkOrderLines",{WorkOrder:{OrderHeaderKey:t.Order.OrderHeaderKey}}))}if(e.length>0){s.callMashups(this,e,{}).then(function(e){i.exitWizard()},angular.noop)}else{i.exitWizard()}}else{i.exitWizard()}},uiCancel:function(){var e=n.translate("instoreappointment.MSG_ExitAppointmentCreationFlow");a.showConfirmationMessage(e).then(function(e){if(e==="YES"){i.closeWizard()}})},handleWizardBack:function(){var e=i.isFirstPage();if(e){var t=n.translate("instoreappointment.MSG_ExitAppointmentCreationFlow");a.showConfirmationMessage(t).then(function(e){if(e==="YES"){i.closeWizard()}});return true}else{var t=n.translate("globals.MSG_BackClickDirtyMessage");a.showConfirmationMessage(t).then(function(e){if(e==="YES"){s.callMashup(this,"getAndDeletePendingWorkOrderLines",{WorkOrder:{OrderHeaderKey:this.model.appointmentDetails.Order.OrderHeaderKey,NodeKey:this.ui.currentStore,NodeKeyQryType:"NE"}},{}).then(function(e){i.gotoPreviousPage(true)},angular.noop)}}.bind(this));return true}}})}]);
angular.module("store").controller("store.views.appointments.in-store.manage-appointment.select-services.select-services",["$scope","iscScreen","moment","iscMashup","iscState","iscI18n","iscInStoreAppointment","iscAppContext","iscWizard","iscModal","iscObjectUtility","iscDomUtility","iscMedia",function(t,e,r,i,n,s,o,d,a,c,u,p,l){a.initializeWizardPage(t,{model:{configuredServices:{},appointmentSalesOrderDetails:{},customerDetails:{}},mashupRefs:[{mashupRefId:"getCompleteItemList",mashupId:"store.views.appointments.in-store.manage-appointment.select-services.getCompleteItemList",modelName:"configuredServices"},{mashupRefId:"createAppntSalesOrder",mashupId:"store.views.appointments.in-store.manage-appointment.select-services.createOrder"},{mashupRefId:"getAppointmentSalesOrderDetails",mashupId:"store.views.appointments.in-store.manage-appointment.select-services.getAppointmentDetails"},{mashupRefId:"modifyAppntSalesOrder",mashupId:"store.views.appointments.in-store.manage-appointment.select-services.modifyAppntSalesOrder"},{mashupRefId:"updateInstructionsOnWorkOrder",mashupId:"store.views.appointments.in-store.manage-appointment.select-services.updateInstructionsOnWorkOrder"},{mashupRefId:"deleteServiceOrderLine",mashupId:"store.views.appointments.in-store.manage-appointment.select-services.deleteServiceOrderLine"},{mashupRefId:"deleteDraftAppntSalesOrder",mashupId:"store.views.appointments.in-store.deleteAppointmentSalesOrder"},{mashupRefId:"getAndDeletePendingWorkOrderLines",mashupId:"store.views.appointments.in-store.getAndDeletePendingWorkOrderLines"}],ui:{numberOfServicesSelected:0,noServicesConfiguredForStore:false,addedServices:[],modifiedServices:[],servicesToBeDeleted:[],selectedServiceMap:{},modifiedWorkOrderInstructionMap:{},highlightedService:{},serviceClickedForMoreInfo:false,isDraftAppointmentSalesOrder:false,customerIdentified:false,currentStore:d.getFromContext("storeName")},initialize:function(){var e=[];var r=a.getWizardModel("createAppointmentOrderModel");if(!iscCore.isVoid(r)&&!iscCore.isVoid(r.Order)&&!iscCore.isVoid(r.Order.OrderHeaderKey)){e.push(i.getMashupRefObj(this,"getAppointmentSalesOrderDetails",{Order:{OrderHeaderKey:r.Order.OrderHeaderKey}}))}this.model.customerDetails=a.getWizardModel("createAppointmentCustomerModel");if(!iscCore.isVoid(this.model.customerDetails)){this.ui.customerIdentified=true}e.push(i.getMashupRefObj(this,"getCompleteItemList",{Item:{}}));i.callMashups(this,e,{}).then(this.handleInitMashupOutput.bind(this),angular.noop);t.$watch("ui.highlightedService.ServiceInstructions",function(e,r){t.uiIsExistingInstructionModified()})},handleInitMashupOutput:function(e){if(!angular.isArray(this.model.configuredServices.ItemList.Item)){this.ui.noServicesConfiguredForStore=true}else{this.model.configuredServices.ItemList.Item=this.model.configuredServices.ItemList.Item.sort(this.sortServices)}this.model.appointmentSalesOrderDetails=i.getMashupOutput(e,"getAppointmentSalesOrderDetails");if(!iscCore.isVoid(this.model.appointmentSalesOrderDetails)&&!iscCore.isVoid(this.model.appointmentSalesOrderDetails.Order)){a.setWizardModel("createAppointmentOrderModel",this.model.appointmentSalesOrderDetails);this.ui.isDraftAppointmentSalesOrder=o.isDraftAppointmentSalesOrder(this.model.appointmentSalesOrderDetails);this.initializeAddedServices()}},sortServices:function(e,r){var t=e.PrimaryInformation.ShortDescription.toLowerCase().replace(/\s/g,"");var i=r.PrimaryInformation.ShortDescription.toLowerCase().replace(/\s/g,"");if(t<i){return-1}if(t>i){return 1}return 0},initializeAddedServices:function(){if(!iscCore.isVoid(this.model.appointmentSalesOrderDetails)&&!iscCore.isVoid(this.model.appointmentSalesOrderDetails.Order)&&!iscCore.isVoid(this.model.appointmentSalesOrderDetails.Order.WorkOrders)&&!iscCore.isVoid(this.model.appointmentSalesOrderDetails.Order.WorkOrders.WorkOrder)){var e=u.isNumber(Number(this.model.appointmentSalesOrderDetails.Order.WorkOrders.WorkOrder.length))?Number(this.model.appointmentSalesOrderDetails.Order.WorkOrders.WorkOrder.length):0;if(e>0){for(var r=0;r<e;r++){var t=this.model.appointmentSalesOrderDetails.Order.WorkOrders.WorkOrder[r];if(!iscCore.isVoid(t)&&!o.isWorkOrderOpen(t)&&!iscCore.isVoid(t.WorkOrderServiceLines)&&!iscCore.isVoid(t.WorkOrderServiceLines.WorkOrderServiceLine[0])){var i={};i.WorkOrderKey=t.WorkOrderKey;if(t.WorkOrderAppointments&&t.WorkOrderAppointments.WorkOrderAppointment&&t.WorkOrderAppointments.WorkOrderAppointment[0]){i._hasConfirmedAppointment=true}else{i._hasConfirmedAppointment=false}var n=t.WorkOrderServiceLines.WorkOrderServiceLine[0];if(n.OrderLine&&n.OrderLine.ItemDetails){i.OrderLineKey=n.OrderLine.OrderLineKey;i.ItemID=n.OrderLine.ItemDetails.ItemID;i.UnitOfMeasure=n.OrderLine.ItemDetails.UnitOfMeasure;i.DisplayUnitOfMeasure=n.OrderLine.ItemDetails.DisplayUnitOfMeasure;i.UOMDisplayFormat=n.OrderLine.ItemDetails.UOMDisplayFormat;i.ItemDetails=n.OrderLine.ItemDetails;if(n.OrderLine.LinePriceInfo){i.ComputedPrice={ListPrice:n.OrderLine.LinePriceInfo.ListPrice}}if(n.OrderLine.ItemDetails.PrimaryInformation){i.PrimaryInformation={ShortDescription:n.OrderLine.ItemDetails.PrimaryInformation.ShortDescription,ExtendedDescription:n.OrderLine.ItemDetails.PrimaryInformation.ExtendedDescription,FixedCapacityQtyPerLine:n.OrderLine.ItemDetails.PrimaryInformation.FixedCapacityQtyPerLine}}if(!iscCore.isVoid(t.Instructions)&&!iscCore.isVoid(t.Instructions.Instruction[0])){i.ServiceInstructions=t.Instructions.Instruction[0].InstructionText;i.InstructionDetailKey=t.Instructions.Instruction[0].InstructionDetailKey}i.isServiceAdded=true;this.updateServiceAsAddedInConfiguredServiceModel(i.ItemID,i.UnitOfMeasure,i.ServiceInstructions,i.InstructionDetailKey);this.ui.addedServices.push(i);this.ui.numberOfServicesSelected++;this.ui.highlightedService=i;this.ui.selectedServiceMap[i.ItemID+i.UnitOfMeasure]=true}}}}}},updateServiceAsAddedInConfiguredServiceModel:function(e,r,t,i){for(var n=0;n<this.model.configuredServices.ItemList.Item.length;n++){var s=this.model.configuredServices.ItemList.Item[n];if(s.ItemID==e&&s.UnitOfMeasure==r){s.isServiceAdded=true;s.ServiceInstructions=t;s.InstructionDetailKey=i;break}}},uiIsExistingInstructionModified:function(){if(!iscCore.isVoid(this.ui.highlightedService)&&!iscCore.isVoid(this.ui.highlightedService.OrderLineKey)){var e=angular.copy(this.ui.highlightedService);this.ui.modifiedWorkOrderInstructionMap[e.OrderLineKey]=e}},uiContinueAppointmentCreation:function(){var e=this.getAppointmentSalesOrderWizardModel();if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Order)&&!iscCore.isVoid(e.Order.OrderHeaderKey)){this.validatePendingChangesAndContinue()}else{i.callMashup(this,"createAppntSalesOrder",this.getCreateAppointmentSalesOrderInput()).then(this.postAppntSalesOrderCreation.bind(this))}},validatePendingChangesAndContinue:function(){var e=[];var r=this.getModifyAppointmentSalesOrderInput();if(r.Order.OrderLines.OrderLine.length>0){e.push(i.getMashupRefObj(this,"modifyAppntSalesOrder",r))}for(var t in this.ui.modifiedWorkOrderInstructionMap){e.push(i.getMashupRefObj(this,"updateInstructionsOnWorkOrder",this.getModifyWorkOrderInstructionsInput(this.ui.modifiedWorkOrderInstructionMap[t])))}if(this.ui.servicesToBeDeleted.length>0){this.appendDeleteOrderLineMashups(e)}if(e.length>0){i.callMashups(this,e,{}).then(this.postAppntSalesOrderModification.bind(this),angular.noop)}else{this.gotoNextPage(this.getAppointmentSalesOrderWizardModel())}},getModifyWorkOrderInstructionsInput:function(e){var r={WorkOrder:{WorkOrderKey:e.WorkOrderKey,Instructions:{Instruction:[]}}};r.WorkOrder.Instructions.Instruction[0]={Action:"Modify",InstructionDetailKey:e.InstructionDetailKey,InstructionText:e.ServiceInstructions};if(iscCore.isVoid(e.ServiceInstructions)){r.WorkOrder.Instructions.Instruction[0].Action="Delete"}if(iscCore.isVoid(e.InstructionDetailKey)){r.WorkOrder.Instructions.Instruction[0].Action="Create";r.WorkOrder.Instructions.Instruction[0].InstructionType="ISA_INS"}return r},getModifyAppointmentSalesOrderInput:function(){var e={Order:{OrderHeaderKey:this.getAppointmentSalesOrderWizardModel().Order.OrderHeaderKey}};e.Order.OrderLines={};e.Order.OrderLines.OrderLine=[];for(var r=0;r<this.ui.addedServices.length;r++){var t=this.ui.addedServices[r];if(!iscCore.isVoid(t)&&iscCore.isVoid(t.OrderLineKey)){currentServiceInput={};currentServiceInput.Action="CREATE";currentServiceInput.Item={};currentServiceInput.Item.ItemID=t.ItemID;currentServiceInput.Item.UnitOfMeasure=t.UnitOfMeasure;currentServiceInput.OrderLineTranQuantity={};currentServiceInput.OrderLineTranQuantity.TransactionalUOM=t.UnitOfMeasure;currentServiceInput.ServiceInstructions=t.ServiceInstructions!==undefined?t.ServiceInstructions.trim():"";currentServiceInput.PersonInfoShipTo=o.getCurrentStoreAddress();e.Order.OrderLines.OrderLine.push(currentServiceInput)}}for(var r=0;r<this.ui.modifiedServices.length;r++){var t=this.ui.modifiedServices[r];if(!iscCore.isVoid(t)&&t.isDeleted&&!t._hasConfirmedAppointment){currentServiceInput={};currentServiceInput.Action="REMOVE";currentServiceInput.OrderLineKey=t.OrderLineKey;currentServiceInput.Item={};currentServiceInput.Item.ItemID=t.ItemID;currentServiceInput.Item.UnitOfMeasure=t.UnitOfMeasure;currentServiceInput.OrderLineTranQuantity={};currentServiceInput.OrderLineTranQuantity.TransactionalUOM=t.UnitOfMeasure;currentServiceInput.ServiceInstructions=t.ServiceInstructions!==undefined?t.ServiceInstructions.trim():"";e.Order.OrderLines.OrderLine.push(currentServiceInput)}}return e},appendDeleteOrderLineMashups:function(e){for(var r=0;r<this.ui.servicesToBeDeleted.length;r++){e.push(i.getMashupRefObj(this,"deleteServiceOrderLine",o.getDeleteOrderLineInput(this.getAppointmentSalesOrderWizardModel().Order.OrderHeaderKey,this.ui.servicesToBeDeleted[r].OrderLineKey)))}},getCreateAppointmentSalesOrderInput:function(){var e={Order:{}};e.Order.EntryType=d.getFromContext("storeEntryType");var r=a.getWizardModel("createAppointmentCustomerModel");if(!iscCore.isVoid(r)){e.Order.BillToID=r.Customer.CustomerID;if(!iscCore.isVoid(r.Customer.DisplayCustomerAddress)){e.Order.PersonInfoBillTo={};e.Order.PersonInfoBillTo=angular.copy(r.Customer.DisplayCustomerAddress);e.Order.CustomerZipCode=r.Customer.DisplayCustomerAddress.ZipCode}if(r.Customer.CustomerType==="02"||r.Customer.CustomerContactList&&r.Customer.CustomerContactList.CustomerContact&&r.Customer.CustomerContactList.CustomerContact.length===1){e.Order.CustomerContactID=r.Customer.CustomerContactList.CustomerContact[0].CustomerContactID;e.Order.CustomerFirstName=r.Customer.CustomerContactList.CustomerContact[0].FirstName;e.Order.CustomerLastName=r.Customer.CustomerContactList.CustomerContact[0].LastName;e.Order.CustomerEMailID=r.Customer.CustomerContactList.CustomerContact[0].EmailID}}e.Order.PersonInfoShipTo=o.getCurrentStoreAddress();e.Order.OrderLines={};e.Order.OrderLines.OrderLine=[];for(var t=0;t<this.ui.addedServices.length;t++){var i=this.ui.addedServices[t];currentServiceInput={};currentServiceInput.Item={};currentServiceInput.Item.ItemID=i.ItemID;currentServiceInput.Item.UnitOfMeasure=i.UnitOfMeasure;currentServiceInput.OrderLineTranQuantity={};currentServiceInput.OrderLineTranQuantity.TransactionalUOM=i.UnitOfMeasure;currentServiceInput.ServiceInstructions=i.ServiceInstructions!==undefined?i.ServiceInstructions.trim():"";currentServiceInput.PersonInfoShipTo=o.getCurrentStoreAddress();e.Order.OrderLines.OrderLine.push(currentServiceInput)}return e},postAppntSalesOrderCreation:function(e){var r=i.getMashupOutput(e,"createAppntSalesOrder");this.gotoNextPage(r)},postAppntSalesOrderModification:function(e){this.gotoNextPage(this.getAppointmentSalesOrderWizardModel())},gotoNextPage:function(e){if(e.Order.OrderHeaderKey){var r={Order:{OrderHeaderKey:e.Order.OrderHeaderKey,DraftOrderFlag:e.Order.DraftOrderFlag}};a.setWizardModel("createAppointmentOrderModel",r);a.gotoCustomPage("appointment-schedule",{},{})}},handleWizardExit:function(){var r=this;var e=s.translate("instoreappointment.MSG_ExitAppointmentCreationFlow");c.showConfirmationMessage(e).then(function(e){if(e==="YES"){r.cleanupPendingData()}});return true},cleanupPendingData:function(){var e=[];var r=a.getWizardModel("createAppointmentOrderModel");if(!iscCore.isVoid(r)){if(o.isDraftAppointmentSalesOrder()){e.push(i.getMashupRefObj(this,"deleteDraftAppntSalesOrder",o.getDeleteAppointmentSalesOrderInput(r)))}else{e.push(i.getMashupRefObj(this,"getAndDeletePendingWorkOrderLines",{WorkOrder:{OrderHeaderKey:r.Order.OrderHeaderKey}}))}if(e.length>0){i.callMashups(this,e,{}).then(function(e){a.exitWizard()},angular.noop)}else{a.exitWizard()}}else{a.exitWizard()}},uiCancel:function(){var e=s.translate("instoreappointment.MSG_ExitAppointmentCreationFlow");c.showConfirmationMessage(e).then(function(e){if(e==="YES"){a.closeWizard()}})},handleWizardBack:function(){var e=a.isFirstPage();if(e){var r=s.translate("instoreappointment.MSG_ExitAppointmentCreationFlow");c.showConfirmationMessage(r).then(function(e){if(e==="YES"){a.closeWizard()}});return true}else{return false}},confirmBeforeClose:function(e){e=="close"?a.closeWizard():a.exitWizard()},getAppointmentSalesOrderWizardModel:function(){return a.getWizardModel("createAppointmentOrderModel")},uiAddServiceToAppointment:function(e){e.isServiceAdded=true;this.ui.addedServices.push(e);this.ui.numberOfServicesSelected++;this.ui.highlightedService=e;this.ui.selectedServiceMap[e.ItemID+e.UnitOfMeasure]=true;this.model.search={}},uiIsServiceSelected:function(e){return this.ui.selectedServiceMap[e.ItemID+e.UnitOfMeasure]},uiDeleteServiceToAppointment:function(e){var r=this.getServiceObjectFromSelectedServices(e.ItemID);if(r.model._hasConfirmedAppointment===true){this.cancelService(r)}else{this.removeServiceFromSelectedServices(r)}},getServiceObjectFromSelectedServices:function(e){var r={model:"",index:-1};for(var t=this.ui.addedServices.length-1;t>=0;t--){var i=this.ui.addedServices[t];if(i.ItemID==e){r.model=i;r.index=t;break}}return r},removeServiceFromSelectedServices:function(e){e.model.isServiceAdded=false;e.model.ServiceInstructions="";this.updateServiceAsDeletedInConfiguredServiceModel(e.model.ItemID,e.model.UnitOfMeasure);this.ui.selectedServiceMap[e.model.ItemID+e.model.UnitOfMeasure]=false;this.ui.addedServices.splice(e.index,1);this.ui.numberOfServicesSelected--;if(e.index>this.ui.addedServices.length-1){this.ui.highlightedService=this.ui.addedServices[this.ui.addedServices.length-1]}else{this.ui.highlightedService=this.ui.addedServices[e.index]}if(this.ui.numberOfServicesSelected==0)this.ui.serviceClickedForMoreInfo=false;if(e.model.OrderLineKey){e.model.isDeleted=true;if(this.ui.isDraftAppointmentSalesOrder){this.ui.modifiedServices.push(e.model)}else if(!e.model._hasConfirmedAppointment){this.ui.servicesToBeDeleted.push(e.model)}}},updateServiceAsDeletedInConfiguredServiceModel:function(e,r){for(var t=0;t<this.model.configuredServices.ItemList.Item.length;t++){var i=this.model.configuredServices.ItemList.Item[t];if(i.ItemID==e&&i.UnitOfMeasure==r){i.isServiceAdded=false;i.ServiceInstructions="";i.InstructionDetailKey="";break}}},cancelService:function(r){var t=this;var e={appointmentModel:{WorkOrderKey:r.model.WorkOrderKey}};var i={modalInput:function(){return e}};c.openModal("store.views.appointments.common.cancel-appointment.cancel-appointment",i,{}).then(function(e){if(e.data!==null&&e.data!==undefined&&e.data.markAsCancelSuccess){t.postServiceCancellation(r)}},angular.noop)},postServiceCancellation:function(e){this.removeServiceFromSelectedServices(e);if(this.ui.addedServices.length==0){c.showWarningMessage("appointmentschedule.MESSAGE_AppointmentCancelled").then(function(e){a.finishWizard()}.bind(this),angular.noop)}},uiSelectAndLoadServiceDetails:function(e){this.ui.highlightedService=e},uiServiceSelectedForMoreInfo:function(r){this.ui.serviceClickedForMoreInfo=true;this.ui.highlightedService=r;if(l.isMediaEnabled("xs")){var t=this;var e=angular.copy(r);e.Currency=this.model.configuredServices.ItemList.Currency;var i={modalInput:function(){return e}};c.openModal("store.views.appointments.common.service-description.service-description",i,{}).then(function(e){if(e&&e=="ADD"){t.uiAddServiceToAppointment(r)}},angular.noop)}}})}]);
angular.module("store").controller("store.views.appointments.in-store.manage-appointment.wizard.manage-appointment-finish",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscStateParams","iscModal","iscI18n","iscInStoreAppointment","iscState",function(e,t,i,r,n,a,s,o,d,p){i.initializeWizardPage(e,{model:{},mashupRefs:[{mashupRefId:"deleteDraftAppntSalesOrder",mashupId:"store.views.appointments.in-store.deleteAppointmentSalesOrder"},{mashupRefId:"getAndDeletePendingWorkOrderLines",mashupId:"store.views.appointments.in-store.getAndDeletePendingWorkOrderLines"}],ui:{},initialize:function(){if(i.getWizardAction()==="CLOSE"){this.handleWizardClose()}else if(i.getWizardAction()==="FINISH"){this.handleWizardFinish()}},gotoAppointmentSummary:function(){var e=i.getWizardModel("createAppointmentOrderModel");var t=i.getWizardModel("AppointmentWizardMode");p.goToState("appointment-summary",{input:{Order:e},message:t=="EDIT"?"EDIT_SUCCESS":t=="CREATE"?"CREATED_SUCCESS":{}},{})},handleWizardFinish:function(){var e=[];var t=i.getWizardModel("createAppointmentOrderModel");e.push(r.getMashupRefObj(this,"getAndDeletePendingWorkOrderLines",{WorkOrder:{OrderHeaderKey:t.Order.OrderHeaderKey}}));r.callMashups(this,e,{}).then(this.gotoAppointmentSummary.bind(this),angular.noop)},handleWizardClose:function(){var e=[];var t=i.getWizardModel("createAppointmentOrderModel");if(!iscCore.isVoid(t)){if(d.isDraftAppointmentSalesOrder()){e.push(r.getMashupRefObj(this,"deleteDraftAppntSalesOrder",d.getDeleteAppointmentSalesOrderInput(t)))}else{e.push(r.getMashupRefObj(this,"getAndDeletePendingWorkOrderLines",{WorkOrder:{OrderHeaderKey:t.Order.OrderHeaderKey}}))}if(e.length>0){r.callMashups(this,e,{}).then(this.closeWizard.bind(this),angular.noop)}else{this.closeWizard()}}else{this.closeWizard()}},closeWizard:function(){p.goToPreviousState()}})}]);
angular.module("store").controller("store.views.appointments.in-store.manage-appointment.wizard.manage-appointment-init",["$scope","$rootScope","iscWizard","iscMashup","iscResourcePermission","iscModal","iscI18n","iscState","iscCustomer","$filter","iscStateParams",function(e,t,s,r,i,a,o,n,d,l,u){s.initializeWizardPage(e,{model:{},mashupRefs:[{mashupRefId:"getCustomerDetails",mashupId:"store.views.appointments.in-store.getCustomerDetails"},{mashupRefId:"getSalesOrderDetails",mashupId:"store.views.appointments.in-store.getSalesOrderDetails"}],ui:{},initialize:function(){var e=u.params.input;if(!iscCore.isVoid(e)&&!iscCore.isVoid(e.Customer)&&!iscCore.isVoid(e.Customer.CustomerKey)){this.getCustomerDetails(e)}else if(iscCore.getValueFromJsonPath(u.params,"input.Order",false)){this.getSalesOrderDetails(u.params.input)}else{this.startCreateAppointmentWizard()}},getCustomerDetails:function(e){var t={Customer:{CustomerKey:e.Customer.CustomerKey}};var s=[];s.push(r.getMashupRefObj(this,"getCustomerDetails",t));r.callMashups(this,s,{}).then(this.processCustomerDetails.bind(this),angular.noop)},startCreateAppointmentWizard:function(){if(iscCore.isVoid(s.getWizardModel("AppointmentWizardMode"))){s.setWizardModel("AppointmentWizardMode","CREATE")}s.startCustomWizard("select-services",{},{})},getSalesOrderDetails:function(){var t=this;var e=[];e.push(r.getMashupRefObj(this,"getSalesOrderDetails",{Order:{OrderHeaderKey:u.params.input.Order.OrderHeaderKey}}));r.callMashups(this,e,{}).then(this.validateSalesOrderDetails.bind(this),function(e){console.log("Invalid sales order passed in input");t.startCreateAppointmentWizard()})},validateSalesOrderDetails:function(e){var t=r.getMashupOutput(e,"getSalesOrderDetails");if(t.Order.MinOrderStatus.match("1100")||t.Order.DraftOrderFlag=="Y"){s.setWizardModel("createAppointmentOrderModel",{Order:{OrderHeaderKey:t.Order.OrderHeaderKey}});s.setWizardModel("AppointmentWizardMode",t.Order.DraftOrderFlag=="Y"?"CREATE":"EDIT");if(!iscCore.isVoid(t.Order.BillToID)){this.stampCustomerDetailsAndGotoWizard(t.Order.BillToID)}else{this.startCreateAppointmentWizard()}}else if(t.Order.MinOrderStatus.match("3700.7777")){n.goToState("appointment-summary",{input:{Order:t}},{})}else{a.showErrorMessage("instoreappointment.MESSAGE_InvalidAppointmentStatus",null,null).then(function(e){s.closeWizard()}.bind(this))}},stampCustomerDetailsAndGotoWizard:function(e){var t={Customer:{CustomerID:e}};var s=[];s.push(r.getMashupRefObj(this,"getCustomerDetails",t));r.callMashups(this,s,{}).then(this.processCustomerDetails.bind(this),angular.noop)},processCustomerDetails:function(e){var t=r.getMashupOutput(e,"getCustomerDetails");if(!iscCore.isVoid(t)){t={Customer:d.getDisplayAddressForCustomer(t.Customer)}}s.setWizardModel("createAppointmentCustomerModel",t);this.startCreateAppointmentWizard()}})}]);
angular.module("store").controller("store.views.receiving.receive-shipment.common.multiple-shipments.multiple-receiving-shipments",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal",function(i,e,t,n,s,o,h,u,m,l){n.initializeModalScreen(i,{model:{shipmentList:{}},mashupRefs:[],ui:{shipmentShownCount:10,entity:"",selectedShipment:"",refineResults:"N"},initialize:function(){this.ui.entity=s.entity;this.model.shipmentList=angular.copy(s.shipmentList);this.ui.selectedShipment=this.model.shipmentList.Shipments.Shipment[0]},uiGetShipmentListNext:function(){if(this.ui.shipmentShownCount==this.model.shipmentList.Shipments.Shipment.length){this.ui.refineResults="Y"}else if(this.ui.shipmentShownCount<=this.model.shipmentList.Shipments.Shipment.length){this.ui.shipmentShownCount+=5}},uiShipmentScrollActionValidator:function(){return true},uiGetShipmentDisplayStatusBundleKey:function(i){var e=angular.copy(i);if(!iscCore.isVoid(e)){if(e.indexOf(".")>0){e=e.replace(/\./g,"_")}return"instorereceiving.LABEL_"+e}},uiSubmit:function(){var i={data:this.ui.selectedShipment};t.close(i)},uiClose:function(){t.dismiss("cancel")}})}]);
angular.module("store").controller("store.views.receiving.receive-shipment.common.receive-full.receive-full-shipment",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal","iscAppContext",function(e,i,n,t,r,s,o,a,l,c,u){t.initializeModalScreen(e,{model:{reasonList:{}},mashupRefs:[{mashupRefId:"getFullShipmentReceiveReasonCode",mashupId:"store.views.receiving.getFullShipmentReceiveReasonCode"},{mashupRefId:"receiveAllItems",mashupId:"store.views.receiving.getShipmentLineListForFullReceiving"},{mashupRefId:"receiveAllContainers",mashupId:"store.views.receiving.getShipmentContainerListForFullReceiving"}],ui:{selectedReason:{},isReceiveReasonConfigured:"N",mashupId:"receiveAllItems"},initialize:function(){o.callMashup(this,"getFullShipmentReceiveReasonCode",{},{}).then(this.handleInitAPICalls.bind(this),angular.noop)},handleInitAPICalls:function(e){this.model.reasonList=o.getMashupOutput(e,"getFullShipmentReceiveReasonCode");if(this.model.reasonList.CommonCodeList.CommonCode){this.ui.isReceiveReasonConfigured="Y";this.ui.selectedReason=this.model.reasonList.CommonCodeList.CommonCode[0].CodeShortDescription}else{this.ui.isReceiveReasonConfigured="N"}},uiSubmit:function(){var e="";if("0005"==r.Shipment.DocumentType){e="defaultDispositionCodePO"}else if("0006"==r.Shipment.DocumentType){e="defaultDispositionCodeTO"}var i={};var t=l.translate("instorereceiving.MSG_ShipmentFullReceived",{reason:this.ui.selectedReason,user:u.getFromContext("currentLoginID")});if(r.Shipment.ShipmentContainerizedFlag=="03"){this.ui.mashupId="receiveAllContainers";i={Container:{ShipmentKey:r.Shipment.ShipmentKey,DocumentType:r.Shipment.DocumentType,DefaultDispositionCode:u.getFromContext(e),NoteText:t}}}else{i={ShipmentLine:{ShipmentKey:r.Shipment.ShipmentKey,DocumentType:r.Shipment.DocumentType,DefaultDispositionCode:u.getFromContext(e),NoteText:t}}}o.callMashup(this,this.ui.mashupId,i,{}).then(this.receiveOrderAPICallBack.bind(this),this.receiveOrderAPIErrorCallBack.bind(this))},receiveOrderAPICallBack:function(e){var i=o.getMashupOutput(e,this.ui.mashupId);var t={};t.receiveOrderAPICallBack={};if(i){t.receiveOrderAPICallBack.apiSuccess=true;t.receiveOrderAPICallBack.apiOutput=i;if(r.Shipment.ShipmentContainerizedFlag=="03"){t.receiveOrderAPICallBack.apiOutput.ShipmentKey=t.receiveOrderAPICallBack.apiOutput.Containers.ShipmentKey}else{t.receiveOrderAPICallBack.apiOutput.ShipmentKey=t.receiveOrderAPICallBack.apiOutput.ShipmentLines.ShipmentKey}}n.close(t)},receiveOrderAPIErrorCallBack:function(e){var i=e.Errors.Error[0].ErrorDescription;var t=e.Errors.Error[0].ErrorCode;if(l.hasKey("apierror."+t)){i=l.translate("apierror."+t);c.showErrorMessage(i,null,null)}else{c.showErrorMessage(i,null,null)}n.dismiss(e)},uiClose:function(){n.dismiss("cancel")}})}]);
angular.module("store").controller("store.views.receiving.receive-shipment.common.receive-later.receive-later",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal",function(e,i,n,t,s,o,h,p,a,c){t.initializeModalScreen(e,{model:{shipmentDetails:{},shipmentLineList:{},shipmentContainerList:{}},mashupRefs:[{mashupRefId:"closeReceipt",mashupId:"store.views.receiving.closeReceipt"},{mashupRefId:"changeShipment",mashupId:"store.views.receiving.changeShipmentForMissingNote"},{mashupRefId:"startReceipt",mashupId:"store.views.receiving.startReceipt"}],ui:{selectedReason:{},pageSize:5,recordShownCount:5,isShipmentContainerized:false,notReceivedCount:0,notReceivedMessageBundleKey:"",isReceiptOpen:false},initialize:function(){this.ui.selectedReason="RECEIVE_LATER";console.log(s);this.ui.isShipmentContainerized=s.isShipmentContainerized;this.model.shipmentDetails=s.shipmentDetails;if(this.ui.isShipmentContainerized){this.model.shipmentContainerList=s.apiOutput;this.ui.notReceivedCount=this.model.shipmentContainerList.Containers.TotalNumberOfRecords;this.ui.notReceivedMessageBundleKey="instorereceiving.MSG_ReceivingNotCompletePackage";if(this.model.shipmentContainerList.Containers.Receipt!=undefined&&this.model.shipmentContainerList.Containers.Receipt.ReceiptHeaderKey!=undefined){this.ui.isReceiptOpen=true}}else{this.model.shipmentLineList=s.apiOutput;this.ui.notReceivedCount=this.model.shipmentLineList.ShipmentLines.TotalNumberOfRecords;this.ui.notReceivedMessageBundleKey="instorereceiving.MSG_ReceivingNotCompleteProduct";if(this.model.shipmentLineList.ShipmentLines.Receipt!=undefined&&this.model.shipmentLineList.ShipmentLines.Receipt.ReceiptHeaderKey!=undefined){this.ui.isReceiptOpen=true}}},handleInitAPICalls:function(e){this.model.reasonList=h.getMashupOutput(e,"getFullShipmentReceiveReasonCode");if(this.model.reasonList.CommonCodeList.CommonCode){this.ui.isReceiveReasonConfigured="Y";this.ui.selectedReason=this.model.reasonList.CommonCodeList.CommonCode[0].CodeShortDescription}else{this.ui.isReceiveReasonConfigured="N"}},uiSubmit:function(){if(this.ui.selectedReason=="RECEIVE_LATER"){n.close({})}else{var e=[];var i={Receipt:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType}};var t={Shipment:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,Notes:{Note:{NoteText:a.translate("instorereceiving.MSG_ShipmentMissingReceived")}}}};if(!this.ui.isReceiptOpen){var s={Receipt:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType}};e.push(h.getMashupRefObj(this,"startReceipt",s))}e.push(h.getMashupRefObj(this,"closeReceipt",i));e.push(h.getMashupRefObj(this,"changeShipment",t));h.callMashups(this,e,{isMultiAPICall:true}).then(this.handleCloseReceipt.bind(this),angular.noop)}},handleCloseReceipt:function(e){n.close({})},uiGetNextList:function(){this.ui.recordShownCount+=this.ui.pageSize},uiScrollActionValidator:function(){return true},uiClose:function(){n.dismiss("cancel")}})}]);
angular.module("store").controller("store.views.receiving.receive-shipment.common.record-damage.record-damage",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","$filter","$locale","iscMashup","iscResourcePermission","iscI18n","iscModal",function(s,e,y,i,n,S,a,N,t,o,r){i.initializeModalScreen(s,{model:{damageDispositionList:{},damageReceiptLineList:{},_copyOfDamageReceiptLineList:{},shipmentLine:{},damagedReceiptLines:[],removedExistingLine:"N",unreceiveLines:{Receipt:{ReceiptLines:{ReceiptLine:[]}}},defaultDamageReceiptLine:{ReturnDisposition:{DispositionCode:""},_originalDispositionCode:"",Quantity:"0",EditableQuantity:"0",ItemDetails:"",ReceiptLineKey:"",ReceiptHeaderKey:"",_isRemoved:"N",_isQtyChanged:"N",_isDamageReasonChanged:"N",_existingDamageLine:"N"},containerDamagedReceiptLine:{},shipmentDetails:{}},mashupRefs:[{mashupRefId:"getDamageDispositionListByDocType",mashupId:"store.views.receiving.getDamageDispositionListByDocType",modelName:"damageDispositionList"},{mashupRefId:"getDamagedReceiptLines",mashupId:"store.views.receiving.getDamagedReceiptLines",modelName:"damageReceiptLineList"},{mashupRefId:"unreceiveGoodReceiptLine",mashupId:"store.views.receiving.unreceiveShipmentLine"},{mashupRefId:"receiveDamageReceiptLine",mashupId:"store.views.receiving.receiveDamageReceiptLine"},{mashupRefId:"unreceiveAllDamageReceiptLine",mashupId:"store.views.receiving.unreceiveDamageShipmentLines"},{mashupRefId:"getContainerDamagedReceiptLine",mashupId:"store.views.receiving.getContainerDamagedReceiptLine",modelName:"containerDamagedReceiptLine"},{mashupRefId:"receiveDamagedContainer",mashupId:"store.views.receiving.receiveDamagedContainer"}],ui:{containerDamagedReason:"",isDamageReasonConfigured:"N",removedDamageLinesCount:Number(0),showAPIError:false,removedAllDamagedLines:"N",errorMsg:"",isShipmentContainerized:false},initialize:function(){var e="";var i=[];if(!iscCore.isVoid(n)&&!iscCore.isVoid(n.isShipmentContainerized)){this.ui.isShipmentContainerized=n.isShipmentContainerized}if(!iscCore.isVoid(n)&&!iscCore.isVoid(n.ShipmentLine)){this.model.shipmentLine=n.ShipmentLine;this.model.shipmentDetails=n.shipment;e=this.model.shipmentLine.DocumentType;i.push(N.getMashupRefObj(this,"getDamagedReceiptLines",{ReceiptLine:{ShipmentLineKey:this.model.shipmentLine.ShipmentLineKey,DocumentType:this.model.shipmentLine.DocumentType}}))}if(!iscCore.isVoid(n)&&!iscCore.isVoid(n.container)){this.model.container=n.container;this.model.shipmentDetails=n.shipment;e=this.model.shipmentDetails.Shipment.DocumentType;if(this.model.container.ReceivedAsDamaged=="Y"){var t={ReceiptLine:{ShipmentContainerKey:this.model.container.ShipmentContainerKey,DocumentType:e}};i.push(N.getMashupRefObj(this,"getContainerDamagedReceiptLine",t))}}i.push(N.getMashupRefObj(this,"getDamageDispositionListByDocType",{ReturnDisposition:{DocumentType:e,CallingOrganizationCode:this.model.shipmentDetails.Shipment.EnterpriseCode}}));N.callMashups(this,i,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(e){if(!iscCore.isVoid(this.model.damageDispositionList)&&!iscCore.isVoid(this.model.damageDispositionList.ReturnDispositionList)&&!iscCore.isVoid(this.model.damageDispositionList.ReturnDispositionList.ReturnDisposition)&&!iscCore.isVoid(this.model.damageDispositionList.ReturnDispositionList.ReturnDisposition.length>0)){this.ui.isDamageReasonConfigured="Y";if(!this.ui.isShipmentContainerized){this.initDamagedReceiptLines();if(this.model.shipmentLine.showUndoDamageQtyError){this.ui.showUndoDamageQtyError=true}}else{if(this.model.containerDamagedReceiptLine.ReceiptLineList&&this.model.containerDamagedReceiptLine.ReceiptLineList.ReceiptLine){this.ui.containerDamagedReason=this.model.containerDamagedReceiptLine.ReceiptLineList.ReceiptLine[0].DispositionCode}else{this.ui.containerDamagedReason=this.model.damageDispositionList.ReturnDispositionList.ReturnDisposition[0].DispositionCode}}}},initDamagedReceiptLines:function(){if(!iscCore.isVoid(this.model.damageReceiptLineList)&&!iscCore.isVoid(this.model.damageReceiptLineList.ReceiptLineList)&&!iscCore.isVoid(this.model.damageReceiptLineList.ReceiptLineList.ReceiptLine)&&!iscCore.isVoid(this.model.damageReceiptLineList.ReceiptLineList.ReceiptLine.length>0)){var e=S("number")(this.model.damageReceiptLineList.ReceiptLineList.ReceiptLine.length);this.model._copyOfDamageReceiptLineList=angular.copy(this.model.damageReceiptLineList);if(!isNaN(e)&&e>0){for(var i=0;i<e;i++){var t=this.model.damageReceiptLineList.ReceiptLineList.ReceiptLine[i];t.EditableQuantity=S("number")(t.Quantity);t.ReturnDisposition={DispositionCode:t.DispositionCode};t._existingDamageLine="Y";t._originalDispositionCode=t.DispositionCode;t._isRemoved="N";t._isQtyChanged="N";t._isDamageReasonChanged="N";t.ItemDetails=this.model.shipmentLine.OrderLine.ItemDetails}}}else{this.model.damageReceiptLineList={ReceiptLineList:{ReceiptLine:[]}};this.model.damageReceiptLineList.ReceiptLineList.ReceiptLine.push(this.getNewDamageReceiptLine())}},uiAddDamageReceiptLine:function(){this.model.damageReceiptLineList.ReceiptLineList.ReceiptLine.push(this.getNewDamageReceiptLine());this.toggleErrorAlert()},getNewDamageReceiptLine:function(){var e=angular.copy(this.model.defaultDamageReceiptLine);if(this.ui.isDamageReasonConfigured=="Y"){e.ReturnDisposition=this.model.damageDispositionList.ReturnDispositionList.ReturnDisposition[0];e._originalDispositionCode=e.ReturnDisposition.DispositionCode;e.ItemDetails=this.model.shipmentLine.OrderLine.ItemDetails}return e},uiHideDeletedDamageReceiptLines:function(e){if(e._isRemoved=="Y"){if(e._existingDamageLine=="Y"){this.ui.removedExistingLine="Y"}return false}return true},uiRemoveDamageLine:function(e){e._isRemoved="Y";this.ui.removedDamageLinesCount+=Number(1);this.toggleErrorAlert()},toggleErrorAlert:function(){var e=S("number")(this.model.damageReceiptLineList.ReceiptLineList.ReceiptLine.length);if(Number(e)==Number(this.ui.removedDamageLinesCount)){this.ui.showAPIError=false;this.ui.showUndoDamageQtyError=false;this.ui.removedAllDamagedLines="Y"}else{this.ui.removedAllDamagedLines="N"}},uiOnQuantityFieldFocus:function(e,i){if(s.recordDamage.$valid)var t=a.NUMBER_FORMATS;var n=i.EditableQuantity;if(!iscCore.isVoid(n)){n=n.replace(t.GROUP_SEP,"");e.oldQty=n}},uiValidateQuantity:function(e,i,t,n){if(!iscCore.isVoid(i)&&i.iscDatatypeValidator)return e;else var s=!isNaN(n);if(!iscCore.isBooleanTrue(s)||iscCore.isVoid(n)){e.booleanResponse=!isNaN(n)&&!iscCore.isVoid(n);e.errorMesssage=o.translate("globals.ERROR_invalid_input")}return e},uiIsQuantityChanged:function(e,i){var t=a.NUMBER_FORMATS;var n=i.EditableQuantity;if(n){n=n.replace(t.GROUP_SEP,"")}if(!iscCore.isVoid(n)&&e.oldQty!==n&&Number(i.Quantity)!=Number(i.EditableQuantity)){i._isQtyChanged="Y"}else{i._isQtyChanged="N"}},uiOnDamageReasonChange:function(e,i){console.log("selectedDispositionCode - ",e);console.log("damageReciptLine - ",i);if(i._originalDispositionCode!=e.DispositionCode){i._isDamageReasonChanged="Y"}else{i._isDamageReasonChanged="N"}},uiSubmit:function(){if("Y"==this.ui.removedAllDamagedLines&&"N"==this.ui.removedExistingLine){y.close({data:"NOUPDATE"})}else if(this.ui.isShipmentContainerized){var e=this.model.containerDamagedReceiptLine.ReceiptLineList;if(e&&e.ReceiptLine&&e.ReceiptLine[0].DispositionCode==this.ui.containerDamagedReason){y.close({data:"NOUPDATE"})}else{var i={Receipt:{ShipmentKey:this.model.shipmentDetails.Shipment.ShipmentKey,DocumentType:this.model.shipmentDetails.Shipment.DocumentType,CaseId:this.model.container.ContainerScm,DispositionCode:this.ui.containerDamagedReason,ShipmentContainerKey:this.model.container.ShipmentContainerKey,ContainerIsReceived:this.model.container.IsReceived}};N.callMashup(this,"receiveDamagedContainer",i,{}).then(this.handleReceiveDamagedContainer.bind(this),angular.noop)}}else{this.prepareReceiptLinesForDamage()}},prepareReceiptLinesForDamage:function(){this.ui.showAPIError=this.ui.showUndoDamageQtyError=false;var e=Number(this.model.shipmentLine.DamagedReceivedQty);var i=Number(this.model.shipmentLine.GoodReceivedQty);var t=Number(this.model.shipmentLine.ReceivedQuantity);var n=Number(this.model.shipmentLine.Quantity);var s="",a=[],o="",r="",p=[],m="",c=0,d=0,h=0,L=0,l=0;var R={ReceiptLine:[]},u={ReceiptLine:[]};if(!iscCore.isVoid(this.model.damageReceiptLineList)&&!iscCore.isVoid(this.model.damageReceiptLineList.ReceiptLineList.ReceiptLine.length>0)){var g=S("number")(this.model.damageReceiptLineList.ReceiptLineList.ReceiptLine.length);if(!isNaN(g)&&g>0){for(var D=0;D<g;D++){var v=this.model.damageReceiptLineList.ReceiptLineList.ReceiptLine[D];c=Number(v.EditableQuantity);d=v._isDamageReasonChanged=="Y"||v._isQtyChanged=="Y"?d+1:d;if("Y"==v._existingDamageLine&&("Y"==v._isRemoved||c==0)){d++;if("Y"==v._isRemoved){L+=c}else{L+=Number(v.Quantity)-c}m=v.ReceiptHeaderKey;var C={ReceiptLineKey:v.ReceiptLineKey,UnreceiveEntireLine:"Y"};R.ReceiptLine.push(C)}else{if(c>0){h+=c;var C={ItemID:this.model.shipmentLine.OrderLine.ItemDetails.ItemID,ShipmentLineKey:this.model.shipmentLine.ShipmentLineKey,UnitOfMeasure:this.model.shipmentLine.OrderLine.ItemDetails.UnitOfMeasure,Quantity:c,DispositionCode:v.ReturnDisposition.DispositionCode};u.ReceiptLine.push(C);if(!iscCore.isVoid(v.ReceiptLineKey)){m=v.ReceiptHeaderKey;var C={ReceiptLineKey:v.ReceiptLineKey,UnreceiveEntireLine:"Y"};R.ReceiptLine.push(C)}}}}}if(d>0&&(h>0||L>0)){if(e==0){if(i>0){r="unreceiveGoodAndReceiveDamageQty";if(i>h){l=h}else{l=i}}else{r="unreceiveAndReceiveDamageQty"}}else{if(h==0){r="unreceiveAllDamageQty"}else if(h>e){var f=h-e;if(i>0){r="unreceiveGoodAndReceiveDamageQty";if(i>f){l=f}else{l=i}}else{r="unreceiveAndReceiveDamageQty"}}else if(h<e){r="unreceiveAndReceiveDamageQty"}}if(l>0){a.push(N.getMashupRefObj(this,"unreceiveGoodReceiptLine",{Receipt:{ShipmentLine:this.model.shipmentLine,ReceiptLines:{ReceiptLine:{Quantity:l}}}}));p.push("unreceiveGoodReceiptLine")}if(R.ReceiptLine.length>0){s="unreceiveAllDamageReceiptLine";o={Receipt:{ShipmentLine:this.model.shipmentLine,ReceiptHeaderKey:m,ReceiptLines:{ReceiptLine:R.ReceiptLine}}};a.push(N.getMashupRefObj(this,s,o));p.push(s)}if(u.ReceiptLine.length>0){s="receiveDamageReceiptLine";o={Receipt:{ShipmentLine:this.model.shipmentLine,ShipmentKey:this.model.shipmentLine.ShipmentKey,DocumentType:this.model.shipmentLine.DocumentType,ReceiptLines:{ReceiptLine:u.ReceiptLine}}};a.push(N.getMashupRefObj(this,s,o));p.push(s)}N.callMashups(this,a,{isMultiAPICall:true}).then(this.handleRecordDamage.bind(this),this.handleRecordDamageError.bind(this,this.model.shipmentLine.ItemID))}else{y.close({data:"NOUPDATE"})}}},handleRecordDamage:function(e){var i=N.getMashupOutput(e,"receiveDamageReceiptLine");if(iscCore.isVoid(i)){i=N.getMashupOutput(e,"unreceiveAllDamageReceiptLine")}if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.Receipt)&&!iscCore.isVoid(i.Receipt.ReceiptLines)&&!iscCore.isVoid(i.Receipt.ReceiptLines.ReceiptLine)&&!iscCore.isVoid(i.Receipt.ReceiptLines.ReceiptLine.length>0)){var t={ShipmentLine:i.Receipt.ReceiptLines.ReceiptLine[0].ShipmentLine};y.close({data:t,shipmentStatus:i.Receipt.ShipmentStatus})}},handleRecordDamageError:function(e,i){if(!iscCore.isVoid(i)&&!iscCore.isVoid(i.Errors)&&!iscCore.isVoid(i.Errors.Error)&&!iscCore.isVoid(i.Errors.Error.length>0)){this.ui.showAPIError=true;var t="apierror.MSG_UnableToRecordDamage";var n=i.Errors.Error[0];var s=n.ErrorCode;var a="";if("OMP10080"==s){a={itemId:e};t="apierror."+s}else{t="apierror."+s}console.log("Record Damage failed due - ",n.ErrorDescription);this.ui.errorMsg=o.translate(t,a)}},handleReceiveDamagedContainer:function(e){var i=N.getMashupOutput(e,"receiveDamagedContainer");var t={data:{container:i.Receipt.Container},shipmentStatus:i.Receipt.ShipmentStatus};y.close(t)},uiClose:function(){y.dismiss("cancel")}})}]);
angular.module("store").controller("store.views.receiving.receive-shipment.common.view-container.view-container",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","$filter","iscMashup","iscResourcePermission","iscI18n","iscModal",function(e,n,i,t,o,a,r,s,l,c){t.initializeModalScreen(e,{model:{container:{}},mashupRefs:[{mashupRefId:"getContainerDetails",mashupId:"store.views.receiving.getShipmentContainerDetails"}],ui:{pageSize:5,recordShownCount:5},initialize:function(){var e={Container:{ShipmentContainerKey:o.ShipmentContainerKey}};r.callMashup(this,"getContainerDetails",e,{}).then(this.handleInitAPICalls.bind(this),angular.noop)},handleInitAPICalls:function(e){this.model.container=r.getMashupOutput(e,"getContainerDetails");console.log("before array");console.log(this.model.container);if(parseInt(this.model.container.Container.ContainerDetails.TotalNumberOfRecords)==1){var n=this.model.container.Container.ContainerDetails.ContainerDetail;delete this.model.container.Container.ContainerDetails.ContainerDetail;this.model.container.Container.ContainerDetails.ContainerDetail=[n];console.log("After making it an array");console.log(this.model.container)}},uiGetNextList:function(){this.ui.recordShownCount+=this.ui.pageSize},uiScrollActionValidator:function(){return true},uiClose:function(){i.dismiss("cancel")}})}]);
angular.module("store").controller("store.views.shipment.backroom-pick.common.print-pick-ticket.print-pick-ticket",["$scope","$rootScope","$uibModalInstance","iscScreen","iscWizard","modalInput","$filter","iscMashup","iscAppInfo","iscResourcePermission","iscI18n","iscModal",function(i,t,n,e,s,S,h,p,r,o,m,u){e.initializeModalScreen(i,{model:{},mashupRefs:[{mashupRefId:"getBOPISShipmentToBePrintedCount",mashupId:"store.views.shipment.backroom-pick.getBOPISShipmentPrintPickTicketCount"},{mashupRefId:"getBOPISShipmentAlreadyPrintedCount",mashupId:"store.views.shipment.backroom-pick.getBOPISShipmentPrintPickTicketCount"},{mashupRefId:"getSFSShipmentToBePrintedCount",mashupId:"store.views.shipment.backroom-pick.getSFSShipmentPrintPickTicketCount"},{mashupRefId:"getSFSShipmentAlreadyPrintedCount",mashupId:"store.views.shipment.backroom-pick.getSFSShipmentPrintPickTicketCount"}],ui:{hasPermissionForBOPISShipment:o.hasPermission("WSC000057"),hasPermissionForSFSShipment:o.hasPermission("WSC000058"),BOPISShipmentsToBePrinted:0,BOPISShipmentsAlreadyPrinted:0,totalBOPISShipmentsToBePicked:0,SFSShipmentsToBePrinted:0,SFSShipmentsAlreadyPrinted:0,totalSFSShipmentsToBePicked:0,printBOPISShipments:false,printSFSShipments:false},initialize:function(){var i=[];var t={Shipment:{PickTicketPrinted:"Y"}};var e={Shipment:{PickTicketPrinted:"N"}};if(this.ui.hasPermissionForBOPISShipment){i.push(p.getMashupRefObj(this,"getBOPISShipmentToBePrintedCount",t));i.push(p.getMashupRefObj(this,"getBOPISShipmentAlreadyPrintedCount",e))}if(this.ui.hasPermissionForSFSShipment){i.push(p.getMashupRefObj(this,"getSFSShipmentToBePrintedCount",t));i.push(p.getMashupRefObj(this,"getSFSShipmentAlreadyPrintedCount",e))}p.callMashups(this,i,{}).then(this.handleInitApiCalls.bind(this),angular.noop)},handleInitApiCalls:function(i){var t="";if(this.ui.hasPermissionForBOPISShipment){t=p.getMashupOutput(i,"getBOPISShipmentToBePrintedCount");this.ui.BOPISShipmentsToBePrinted=Number(t.Shipments.TotalNumberOfRecords);t=p.getMashupOutput(i,"getBOPISShipmentAlreadyPrintedCount");this.ui.BOPISShipmentsAlreadyPrinted=Number(t.Shipments.TotalNumberOfRecords);this.ui.totalBOPISShipmentsToBePicked=this.ui.BOPISShipmentsAlreadyPrinted+this.ui.BOPISShipmentsToBePrinted}if(this.ui.hasPermissionForSFSShipment){t=p.getMashupOutput(i,"getSFSShipmentToBePrintedCount");this.ui.SFSShipmentsToBePrinted=Number(t.Shipments.TotalNumberOfRecords);t=p.getMashupOutput(i,"getSFSShipmentAlreadyPrintedCount");this.ui.SFSShipmentsAlreadyPrinted=Number(t.Shipments.TotalNumberOfRecords);this.ui.totalSFSShipmentsToBePicked=this.ui.SFSShipmentsAlreadyPrinted+this.ui.SFSShipmentsToBePrinted}},uiClose:function(){n.dismiss({data:"CANCEL"})},uiSubmit:function(i){var i="PRINT_ALL";var t=false;if(this.ui.printBOPISShipments&&!this.ui.printSFSShipments){i="PRINT_BOPIS";t=Number(this.ui.totalBOPISShipmentsToBePicked)>100}else if(this.ui.printSFSShipments&&!this.ui.printBOPISShipments){i="PRINT_SFS";t=Number(this.ui.totalSFSShipmentsToBePicked)>100}if(i=="PRINT_ALL"){t=Number(this.ui.totalBOPISShipmentsToBePicked)+Number(this.ui.totalSFSShipmentsToBePicked)>100}var e={};e={data:{shipmentTypeToPrint:i,isPrintingLargeShipments:t}};n.close(e)}})}]);
angular.module("store").controller("store.views.shipment.backroom-pick.common.shipment-in-batch.shipment-in-batch",["$scope","$rootScope","$uibModalInstance","iscScreen","iscWizard","modalInput","$filter","iscMashup","iscAppInfo","iscResourcePermission","iscI18n","iscModal",function(i,o,n,t,e,s,c,a,l,u,m,r){t.initializeModalScreen(i,{model:{shipmentDetails:{}},mashupRefs:[],ui:{},initialize:function(){this.model.shipmentDetails=s.shipmentDetails},uiGetDueInImageUrl:function(i){var o="";if(i){o=window.location.protocol+"//"+window.location.host+l.getApplicationContext()+"/"+i}return o},uiClose:function(){n.dismiss({data:"CANCEL"})},uiSubmit:function(i){n.close({data:i})}})}]);
angular.module("store").controller("store.views.shipment.batchpick.batch-list.departments.batch-list-departments",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscI18n","iscModal",function(e,t,i,s,a,c,o,n,l){s.initializeModalScreen(e,{model:{},mashupRefs:[],ui:{batchNo:"",departmentDesc:""},initialize:function(){this.ui.batchNo=a.DepData.BatchNo;this.ui.departmentDesc=a.DepData.Departments},uiCloseModal:function(){i.dismiss("close")}})}]);
angular.module("store").controller("store.views.shipment.batchpick.batch-list.pref.batch-list-preferences",["$scope","$rootScope","$uibModalInstance","iscScreen","modalInput","iscMashup","iscResourcePermission","iscI18n","iscModal",function(e,t,a,s,i,h,n,c,r){s.initializeModalScreen(e,{model:{userpref:{},batchMaxSize:{}},mashupRefs:[{mashupRefId:"manageBatchMaxSize",mashupId:"store.views.shipment.batchpick.batch-list.manageBatchMaxSize"},{mashupRefId:"manageBatchSortMethod",mashupId:"store.views.shipment.batchpick.batch-list.manageBatchSortMethod"},{mashupRefId:"getUserUiStateList",mashupId:"store.views.shipment.batchpick.batch-list.getUserUiStateList"}],ui:{pickedFlag:"N"},initialize:function(){var e={};h.callMashup(this,"getUserUiStateList",e,{}).then(function(e){var t=h.getMashupOutput(e,"getUserUiStateList");this.handleGetUserUiStateListOutput(t)}.bind(this),angular.noop)},handleGetUserUiStateListOutput:function(e){console.log(e);this.model.userpref=e},uiUpdate:function(){var e={UserUiState:{Definition:this.model.userpref.UserPref.BatchMaxShipments}};var t={UserUiState:{Definition:this.model.userpref.UserPref.BatchSortMethod}};var a=[];a.push(h.getMashupRefObj(this,"manageBatchMaxSize",e));a.push(h.getMashupRefObj(this,"manageBatchSortMethod",t));h.callMashups(this,a,{}).then(function(e){this.handleManageBatchPreferences(e)}.bind(this),angular.noop)},handleManageBatchPreferences:function(){a.close({})},uiClose:function(){a.dismiss("cancel")}})}]);
angular.module("store").config(["iscAppointmentStatusProvider",function(t){t.addAppointmentStatusConfig("OPEN","instoreappointment.LABEL_1100");t.addAppointmentStatusConfig("COMPLETE","instoreappointment.LABEL_1400");t.addAppointmentStatusConfig("CANCELED","instoreappointment.LABEL_1600")}]);
angular.module("store").config(["iscAutofocusProvider",function(t){var e={focus:function(t,e,u){if(e[0].getAttribute("active")){if(t.$$childHead.active){var a=e[0].getElementsByTagName("a");a[0].setAttribute("autofocus",true)}}else{var a=e[0].getElementsByTagName("a");a[0].setAttribute("autofocus",true)}}};t.addFocusConfiguration("uib-tab",e);var u={focus:function(t,e,u){var a=e[0].getElementsByTagName("select");a[0].setAttribute("autofocus",true)}};t.addFocusConfiguration("isc-Address-Capture",u)}]);
angular.module("store").config(["iscCurrencyFormatProvider",function(r){r.addCurrencyFormat({currencyCode:"USD",currencyDescription:"US Dollar",NUMBER_FORMATS:{CURRENCY_SYM:"$",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"GPB",NUMBER_FORMATS:{CURRENCY_SYM:"",currencyDescription:"GBP",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"EUR",NUMBER_FORMATS:{CURRENCY_SYM:"",currencyDescription:"Euro",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"INR",currencyDescription:"Indian Rupee",NUMBER_FORMATS:{CURRENCY_SYM:"",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:{gSize:2,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"CNY",currencyDescription:"Chinese Yuan",NUMBER_FORMATS:{CURRENCY_SYM:"",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"JPY",currencyDescription:"Japanese Yen",NUMBER_FORMATS:{CURRENCY_SYM:"",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"KRW",currencyDescription:"South Korean Won",NUMBER_FORMATS:{CURRENCY_SYM:"",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"BRL",currencyDescription:"Brazilian Real",NUMBER_FORMATS:{CURRENCY_SYM:"R$",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"PLN",currencyDescription:"Polish Zloty",NUMBER_FORMATS:{CURRENCY_SYM:"z",DECIMAL_SEP:",",GROUP_SEP:"",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"TRY",currencyDescription:"Turkish Lira",NUMBER_FORMATS:{CURRENCY_SYM:"TL",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"RUB",currencyDescription:"Russian Ruble",NUMBER_FORMATS:{CURRENCY_SYM:".",DECIMAL_SEP:",",GROUP_SEP:"",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"defaultPrefix",currencyDescription:"Default currency format with currency symbol as prefix",NUMBER_FORMATS:{CURRENCY_SYM:"",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}});r.addCurrencyFormat({currencyCode:"defaultSuffix",currencyDescription:"Default currency format with currency symbol as suffix",NUMBER_FORMATS:{CURRENCY_SYM:"",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}}})}]);
(function(e){angular.module("store").config(["iscI18nProvider",function(n){n.init({lngs:["de","en","es","fr","it","ja","ko","pl","pt","ru","tr","zh","zh-tw"],fallbackLng:"en",l10nKit:[{url:"./shared/nls/__lng__/shared.nls.json",ns:"app"},{url:"./store/nls/__lng__/login.nls.json",ns:"app"},{url:"./store/nls/__lng__/app.nls.json",ns:"app"},{url:"./store/nls/__lng__/app_a11y.nls.json",ns:"app"},{url:"./shared/nls/__lng__/shared_a11y.nls.json",ns:"app"}]});e.on("initialized",function(n){var s=e.services.pluralResolver.rules["en"];var l=e.services.pluralResolver.rules["ru"];var r=e.services.pluralResolver.rules["pl"];l.numbers=r.numbers=s.numbers;l.plurals=r.plurals=s.plurals})}])})(window.i18next);
angular.module("store").config(["iscDateFilterProvider",function(a){a.addDateFormatForLocale("de","dd.MM.yyyy");a.addDateFormatForLocale("en","MMM dd,yyyy");a.addDateFormatForLocale("es","yyyy/MM/dd");a.addDateFormatForLocale("fr","yyyy/MM/dd");a.addDateFormatForLocale("it","yyyy/MM/dd");a.addDateFormatForLocale("ja","yyyy/MM/dd");a.addDateFormatForLocale("ko","yyyy/MM/dd");a.addDateFormatForLocale("pl","yyyy/MM/dd");a.addDateFormatForLocale("pt","dd/MM/yyyy");a.addDateFormatForLocale("ru","yyyy/MM/dd");a.addDateFormatForLocale("tr","yyyy/MM/dd");a.addDateFormatForLocale("zh","yyyy/MM/dd");a.addDateFormatForLocale("zh-tw","yyyy/MM/dd");a.addDateTimeFormatForLocale("de","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("en","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("es","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("fr","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("it","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("ja","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("ko","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("pl","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("pt","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("ru","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("tr","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("zh","dd.MM.yyyy,h:mm a");a.addDateTimeFormatForLocale("zh-tw","dd.MM.yyyy,h:mm a")}]).run(["$rootScope","iscDateFilter","iscAppContext",function(a,d,y){var o=y.getFromContext("localeCode");a.dateTimeFormat=d.getDateTimeFormatForLocale(o)}]);
angular.module("store").config(["iscMediaProvider",function(d){d.addMediaQuery("xs",null,768);d.addMediaQuery("sm",768,992);d.addMediaQuery("md",992,1200);d.addMediaQuery("lg",1200,null);d.addMediaQuery("lte-800",null,801);d.addMediaQuery("gt-800",801,null);d.addMediaQuery("lte-480",null,481);d.addMediaQuery("gt-480",481,null);d.addMediaQuery("gte-480",480,null);d.addMediaQuery("gt-768",769,null);d.addMediaQuery("lte-768",null,769);d.addMediaQuery("gte-768",768,null)}]);
angular.module("store").run(["amSubtractFilter","amAddFilter","iscAppContext","iscDateFilterComboBox","iscDateFilter","iscAppInfo",function(e,t,a,o,l,r){var n=l.getDateFormatForLocale(a.getFromContext("localeCode"));if(!n)n="yyyy/MM/dd";var d=n.toUpperCase();var s="MMM dd,yyyy".toUpperCase();var D={labelBundleKey:"datefilter.LABEL_today",startDateDisplay:e(new Date,0,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),startDate:e(new Date,0,"days").format(s),endDateDisplay:e(new Date,0,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),endDate:e(new Date,0,"days").format(s)};var m={labelBundleKey:"datefilter.LABEL_yesterday",startDateDisplay:e(new Date,1,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),startDate:e(new Date,1,"days").format(s),endDateDisplay:e(new Date,1,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),endDate:e(new Date,1,"days").format(s)};var C={labelBundleKey:"datefilter.LABEL_last7Days",startDateDisplay:e(new Date,6,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),startDate:e(new Date,6,"days").format(s),endDateDisplay:e(new Date).locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),endDate:e(new Date).format(s)};var y={labelBundleKey:"datefilter.LABEL_lastMonth",startDateDisplay:e(new Date,29,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),startDate:e(new Date,29,"days").format(s),endDateDisplay:e(new Date).locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),endDate:e(new Date).format(s)};var c={labelBundleKey:"datefilter.LABEL_last3Months",startDateDisplay:e(new Date,89,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),startDate:e(new Date,89,"days").format(s),endDateDisplay:e(new Date).locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),endDate:e(new Date).format(s)};var i={labelBundleKey:"datefilter.LABEL_last6Months",startDateDisplay:e(new Date,179,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),startDate:e(new Date,179,"days").format(s),endDateDisplay:e(new Date).locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),endDate:e(new Date).format(s)};var p={labelBundleKey:"datefilter.LABEL_lastYear",startDateDisplay:e(new Date,364,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),startDate:e(new Date,364,"days").format(s),endDateDisplay:e(new Date).locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),endDate:e(new Date).format(s)};var f={labelBundleKey:"datefilter.LABEL_tomorrow",startDateDisplay:t(new Date,1,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),startDate:t(new Date,1,"days").format(s),endDateDisplay:t(new Date,1,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),endDate:t(new Date,1,"days").format(s)};var F={labelBundleKey:"datefilter.LABEL_next7Days",startDateDisplay:t(new Date).locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),startDate:t(new Date).format(s),endDateDisplay:t(new Date,6,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),endDate:t(new Date,6,"days").format(s)};var g={labelBundleKey:"datefilter.LABEL_nextMonth",startDateDisplay:t(new Date).locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),startDate:t(new Date).format(s),endDateDisplay:t(new Date,29,"days").locale(r.getLocaleCodeForMoment(a.getFromContext("localeCode"))).format(d),endDate:t(new Date,29,"days").format(s)};var L=[];L.push(C);L.push(y);L.push(c);L.push(i);L.push(p);o.addComboOptions("orderListDateFilter",L);o.addComboOptions("orderHistoryListDateFilter",L);var w=[];w.push(D);w.push(m);w.push(C);w.push(y);o.addComboOptions("shipmentDateFilter",w);var u=[];u.push(C);u.push(y);u.push(F);u.push(g);o.addComboOptions("appointmentDateFilter",u);var M=[];M.push(D);M.push(f);M.push(F);M.push(g);o.addComboOptions("shipmentDateFilter_incoming",M)}]);
angular.module("store").config(["iscShipmentStatusProvider",function(t){t.addShipmentStatusConfig("Pick","1100.70.06.10","shipmentList.LABEL_1100_70_06_10");t.addShipmentStatusConfig("Pick","1100.70.06.20","shipmentList.LABEL_1100_70_06_20");t.addShipmentStatusConfig("Pack","1100.70.06.50","shipmentList.LABEL_1100_70_06_50");t.addShipmentStatusConfig("Pack","1100.70.06.70","shipmentList.LABEL_1100_70_06_70");t.addShipmentStatusConfig("Pickup","1100.70.06.30","shipmentList.LABEL_1100_70_06_30");t.addShipmentStatusConfig("All","1100.70.06.10","shipmentList.LABEL_1100_70_06_10");t.addShipmentStatusConfig("All","1100.70.06.20","shipmentList.LABEL_1100_70_06_20");t.addShipmentStatusConfig("All","1100.70.06.30","shipmentList.LABEL_1100_70_06_30");t.addShipmentStatusConfig("All","1100.70.06.50","shipmentList.LABEL_1100_70_06_50");t.addShipmentStatusConfig("All","1100.70.06.70","shipmentList.LABEL_1100_70_06_70");t.addShipmentStatusConfig("All","1300","shipmentList.LABEL_1300");t.addShipmentStatusConfig("All","1400","shipmentList.LABEL_1400");t.addShipmentStatusConfig("All","9000","shipmentList.LABEL_9000")}]);
angular.module("store").config(["iscCordovaProvider",function(n){n.registerPluginInitialization(["iscBarcodeScanner",function(o){if(window.Infinea){Infinea.init();Infinea.barcodeDataCallback=function(n,a,i){o.placeBarcodeToElement(n)};Infinea.msrDataCallback=function(n){console.log(n)}}}])}]);
window.isCordovaInitialized=false;window.isCordovaDeviceReady=false;document.addEventListener("deviceready",function(){window.isCordovaDeviceReady=true;if(!window.isCordovaInitialized){window.isCordovaInitialized=true;setTimeout(function(){window.onCordovaDeviceReady()},100)}},false);angular.module("store").run(["iscCordova","$timeout",function(i,o){window.onCordovaDeviceReady=function(){window.isCordovaInitialized=true;o(function(){i.initializePlugins()},0)};if(window.isCordovaDeviceReady&&!window.isCordovaInitialized){window.onCordovaDeviceReady()}}]);